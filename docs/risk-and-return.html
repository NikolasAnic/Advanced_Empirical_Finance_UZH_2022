<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Risk and Return | Advanced Empirical Finance</title>
  <meta name="description" content="Chapter 3 Risk and Return | Advanced Empirical Finance" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Risk and Return | Advanced Empirical Finance" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Risk and Return | Advanced Empirical Finance" />
  
  
  

<meta name="author" content="Nikolas Anic &amp; Lorenz Gassmann" />


<meta name="date" content="2022-02-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="the-programming-environment.html"/>
<link rel="next" href="beta.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Empirical Finance - Lab Course</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction to the course objectives and organisation of the course</a></li>
<li class="chapter" data-level="2" data-path="the-programming-environment.html"><a href="the-programming-environment.html"><i class="fa fa-check"></i><b>2</b> The Programming Environment</a>
<ul>
<li class="chapter" data-level="2.1" data-path="the-programming-environment.html"><a href="the-programming-environment.html#markdown-files"><i class="fa fa-check"></i><b>2.1</b> Markdown Files</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="the-programming-environment.html"><a href="the-programming-environment.html#how-to-create-a-markdown-file"><i class="fa fa-check"></i><b>2.1.1</b> How to create a Markdown File</a></li>
<li class="chapter" data-level="2.1.2" data-path="the-programming-environment.html"><a href="the-programming-environment.html#the-r-markdown-structure"><i class="fa fa-check"></i><b>2.1.2</b> The R Markdown Structure</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="the-programming-environment.html"><a href="the-programming-environment.html#coding-in-r---a-concise-overview"><i class="fa fa-check"></i><b>2.2</b> Coding In R - A concise overview</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="the-programming-environment.html"><a href="the-programming-environment.html#introduction"><i class="fa fa-check"></i><b>2.2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2.2" data-path="the-programming-environment.html"><a href="the-programming-environment.html#vectors"><i class="fa fa-check"></i><b>2.2.2</b> Vectors</a></li>
<li class="chapter" data-level="2.2.3" data-path="the-programming-environment.html"><a href="the-programming-environment.html#data-types"><i class="fa fa-check"></i><b>2.2.3</b> Data Types</a></li>
<li class="chapter" data-level="2.2.4" data-path="the-programming-environment.html"><a href="the-programming-environment.html#data-frames"><i class="fa fa-check"></i><b>2.2.4</b> Data Frames</a></li>
<li class="chapter" data-level="2.2.5" data-path="the-programming-environment.html"><a href="the-programming-environment.html#importing-data"><i class="fa fa-check"></i><b>2.2.5</b> Importing Data</a></li>
<li class="chapter" data-level="2.2.6" data-path="the-programming-environment.html"><a href="the-programming-environment.html#data-manipulation"><i class="fa fa-check"></i><b>2.2.6</b> Data Manipulation</a></li>
<li class="chapter" data-level="2.2.7" data-path="the-programming-environment.html"><a href="the-programming-environment.html#data-reshaping"><i class="fa fa-check"></i><b>2.2.7</b> Data Reshaping</a></li>
<li class="chapter" data-level="2.2.8" data-path="the-programming-environment.html"><a href="the-programming-environment.html#beautiful-graphs-with-ggplot2"><i class="fa fa-check"></i><b>2.2.8</b> Beautiful Graphs with <code>ggplot2</code></a></li>
<li class="chapter" data-level="2.2.9" data-path="the-programming-environment.html"><a href="the-programming-environment.html#dates-and-times"><i class="fa fa-check"></i><b>2.2.9</b> Dates and Times</a></li>
<li class="chapter" data-level="2.2.10" data-path="the-programming-environment.html"><a href="the-programming-environment.html#string-manipulations-in-r-the-stringr-package"><i class="fa fa-check"></i><b>2.2.10</b> String Manipulations in R: The <code>stringr()</code> package</a></li>
<li class="chapter" data-level="2.2.11" data-path="the-programming-environment.html"><a href="the-programming-environment.html#database-queries"><i class="fa fa-check"></i><b>2.2.11</b> Database Queries</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="risk-and-return.html"><a href="risk-and-return.html"><i class="fa fa-check"></i><b>3</b> Risk and Return</a>
<ul>
<li class="chapter" data-level="3.1" data-path="risk-and-return.html"><a href="risk-and-return.html#the-time-series-of-returns---transformations-in-r-1"><i class="fa fa-check"></i><b>3.1</b> The time-series of Returns - Transformations in R</a></li>
<li class="chapter" data-level="3.2" data-path="risk-and-return.html"><a href="risk-and-return.html#security-returns"><i class="fa fa-check"></i><b>3.2</b> Security Returns</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="risk-and-return.html"><a href="risk-and-return.html#simple-returns"><i class="fa fa-check"></i><b>3.2.1</b> Simple Returns</a></li>
<li class="chapter" data-level="3.2.2" data-path="risk-and-return.html"><a href="risk-and-return.html#logarithmic-returns"><i class="fa fa-check"></i><b>3.2.2</b> Logarithmic Returns</a></li>
<li class="chapter" data-level="3.2.3" data-path="risk-and-return.html"><a href="risk-and-return.html#accounting-for-dividends-total-returns"><i class="fa fa-check"></i><b>3.2.3</b> Accounting for Dividends: Total Returns</a></li>
<li class="chapter" data-level="3.2.4" data-path="risk-and-return.html"><a href="risk-and-return.html#truncating-the-data"><i class="fa fa-check"></i><b>3.2.4</b> Truncating the data</a></li>
<li class="chapter" data-level="3.2.5" data-path="risk-and-return.html"><a href="risk-and-return.html#arithmetic-vs.-geometric-returns"><i class="fa fa-check"></i><b>3.2.5</b> Arithmetic vs. Geometric Returns</a></li>
<li class="chapter" data-level="3.2.6" data-path="risk-and-return.html"><a href="risk-and-return.html#cumulative-returns"><i class="fa fa-check"></i><b>3.2.6</b> Cumulative Returns</a></li>
<li class="chapter" data-level="3.2.7" data-path="risk-and-return.html"><a href="risk-and-return.html#periodic-transformation-of-returns"><i class="fa fa-check"></i><b>3.2.7</b> Periodic Transformation of Returns</a></li>
<li class="chapter" data-level="3.2.8" data-path="risk-and-return.html"><a href="risk-and-return.html#annualising-returns"><i class="fa fa-check"></i><b>3.2.8</b> Annualising Returns</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="risk-and-return.html"><a href="risk-and-return.html#portfolio-returns"><i class="fa fa-check"></i><b>3.3</b> Portfolio Returns</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="risk-and-return.html"><a href="risk-and-return.html#equal-weighted-returns"><i class="fa fa-check"></i><b>3.3.1</b> Equal-weighted Returns</a></li>
<li class="chapter" data-level="3.3.2" data-path="risk-and-return.html"><a href="risk-and-return.html#value-weighted-returns"><i class="fa fa-check"></i><b>3.3.2</b> Value-weighted Returns</a></li>
<li class="chapter" data-level="3.3.3" data-path="risk-and-return.html"><a href="risk-and-return.html#timing-of-returns"><i class="fa fa-check"></i><b>3.3.3</b> Timing of Returns</a></li>
<li class="chapter" data-level="3.3.4" data-path="risk-and-return.html"><a href="risk-and-return.html#nominal-vs.-real-returns"><i class="fa fa-check"></i><b>3.3.4</b> Nominal vs. Real Returns</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="risk-and-return.html"><a href="risk-and-return.html#individual-security-risk"><i class="fa fa-check"></i><b>3.4</b> Individual Security Risk</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="risk-and-return.html"><a href="risk-and-return.html#standard-deviation-and-variance"><i class="fa fa-check"></i><b>3.4.1</b> Standard Deviation and Variance</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="risk-and-return.html"><a href="risk-and-return.html#rolling-risk-characteristics"><i class="fa fa-check"></i><b>3.5</b> Rolling Risk Characteristics</a></li>
<li class="chapter" data-level="3.6" data-path="risk-and-return.html"><a href="risk-and-return.html#portfolio-risk"><i class="fa fa-check"></i><b>3.6</b> Portfolio Risk</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="risk-and-return.html"><a href="risk-and-return.html#portfolio-risk-of-two-securities"><i class="fa fa-check"></i><b>3.6.1</b> Portfolio Risk of two securities</a></li>
<li class="chapter" data-level="3.6.2" data-path="risk-and-return.html"><a href="risk-and-return.html#portfolio-risk-for-multiple-assets"><i class="fa fa-check"></i><b>3.6.2</b> Portfolio Risk for Multiple Assets</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="risk-and-return.html"><a href="risk-and-return.html#risk-in-extremes-and-alternative-risk-measures"><i class="fa fa-check"></i><b>3.7</b> Risk in Extremes and Alternative Risk Measures</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="risk-and-return.html"><a href="risk-and-return.html#value-at-risk-var"><i class="fa fa-check"></i><b>3.7.1</b> Value at Risk (VaR)</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="risk-and-return.html"><a href="risk-and-return.html#market-efficiency-and-independence-of-risk-and-return"><i class="fa fa-check"></i><b>3.8</b> Market Efficiency and independence of risk and return</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="risk-and-return.html"><a href="risk-and-return.html#variance-ratio-test"><i class="fa fa-check"></i><b>3.8.1</b> Variance Ratio Test</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="beta.html"><a href="beta.html"><i class="fa fa-check"></i><b>4</b> Beta</a>
<ul>
<li class="chapter" data-level="4.1" data-path="beta.html"><a href="beta.html#application-of-regression-analysis-beta-analysis-in-financial-market-settings"><i class="fa fa-check"></i><b>4.1</b> Application of Regression Analysis: <span class="math inline">\(\beta\)</span> analysis in Financial Market Settings</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="beta.html"><a href="beta.html#the-single-index-model"><i class="fa fa-check"></i><b>4.1.1</b> The Single Index Model</a></li>
<li class="chapter" data-level="4.1.2" data-path="beta.html"><a href="beta.html#estimation-of-the-sim"><i class="fa fa-check"></i><b>4.1.2</b> Estimation of the SIM</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><i class="fa fa-check"></i><b>5</b> Portfolio Theory: Mean-Variance Optimisation and the CAPM</a>
<ul>
<li class="chapter" data-level="5.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#markowitz-portfolio-theory-with-two-risky-assets"><i class="fa fa-check"></i><b>5.1</b> Markowitz Portfolio Theory with two Risky Assets</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-case-of-portfolios"><i class="fa fa-check"></i><b>5.1.1</b> The case of portfolios</a></li>
<li class="chapter" data-level="5.1.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-set-of-attainable-portfolios"><i class="fa fa-check"></i><b>5.1.2</b> The set of attainable portfolios</a></li>
<li class="chapter" data-level="5.1.3" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-minimum-variance-portfolio"><i class="fa fa-check"></i><b>5.1.3</b> The Minimum-Variance Portfolio</a></li>
<li class="chapter" data-level="5.1.4" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-role-of-correlation-on-the-frontier-of-portfolios"><i class="fa fa-check"></i><b>5.1.4</b> The role of correlation on the frontier of portfolios</a></li>
<li class="chapter" data-level="5.1.5" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#efficient-portfolios-with-two-risky-assets"><i class="fa fa-check"></i><b>5.1.5</b> Efficient Portfolios with two risky assets</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#markowitz-portfolio-theory-with-a-risky-and-a-risk-free-asset"><i class="fa fa-check"></i><b>5.2</b> Markowitz Portfolio Theory with a Risky and a Risk-Free Asset</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-capital-allocation-line-cal"><i class="fa fa-check"></i><b>5.2.1</b> The Capital Allocation Line (CAL)</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#markowitz-portfolio-theory-with-two-risky-and-a-risk-free-asset"><i class="fa fa-check"></i><b>5.3</b> Markowitz Portfolio Theory with two Risky and a Risk-Free Asset</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#tangency-portfolio"><i class="fa fa-check"></i><b>5.3.1</b> Tangency Portfolio</a></li>
<li class="chapter" data-level="5.3.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#mutual-fund-theorem-and-derivation-of-the-capital-market-line-cml"><i class="fa fa-check"></i><b>5.3.2</b> Mutual Fund Theorem and Derivation of the Capital Market Line (CML)</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#markowitz-portfolio-theory-with-n-risky-assets"><i class="fa fa-check"></i><b>5.4</b> Markowitz Portfolio Theory with N Risky Assets</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-theoretical-foundations-of-n-assets"><i class="fa fa-check"></i><b>5.4.1</b> The theoretical foundations of N Assets</a></li>
<li class="chapter" data-level="5.4.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-minimum-variance-portfolio-for-n-assets"><i class="fa fa-check"></i><b>5.4.2</b> The Minimum Variance Portfolio for N assets</a></li>
<li class="chapter" data-level="5.4.3" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-efficient-frontier-for-n-assets"><i class="fa fa-check"></i><b>5.4.3</b> The Efficient Frontier for N assets</a></li>
<li class="chapter" data-level="5.4.4" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-efficient-and-feasible-portfolio-cal-of-n-risky-assets-and-a-risk-free-asset"><i class="fa fa-check"></i><b>5.4.4</b> The Efficient and Feasible Portfolio CAL of N risky Assets and a risk-free Asset</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-capital-asset-pricing-model"><i class="fa fa-check"></i><b>5.5</b> The Capital Asset Pricing Model</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#intuition-of-the-capm"><i class="fa fa-check"></i><b>5.5.1</b> Intuition of the CAPM</a></li>
<li class="chapter" data-level="5.5.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#mathematical-derivation-of-the-security-market-line-sml"><i class="fa fa-check"></i><b>5.5.2</b> Mathematical Derivation of the Security Market Line (SML)</a></li>
<li class="chapter" data-level="5.5.3" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#similarity-of-the-cml-and-sml"><i class="fa fa-check"></i><b>5.5.3</b> Similarity of the CML and SML</a></li>
<li class="chapter" data-level="5.5.4" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#diagnostic-tests-of-the-capm"><i class="fa fa-check"></i><b>5.5.4</b> Diagnostic Tests of the CAPM</a></li>
<li class="chapter" data-level="5.5.5" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#fama-macbeth-1973-approach"><i class="fa fa-check"></i><b>5.5.5</b> Fama-MacBeth (1973) approach</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="factor-models.html"><a href="factor-models.html"><i class="fa fa-check"></i><b>6</b> Factor Models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="factor-models.html"><a href="factor-models.html#the-idea-behind-factor-models"><i class="fa fa-check"></i><b>6.1</b> The idea behind factor models</a></li>
<li class="chapter" data-level="6.2" data-path="factor-models.html"><a href="factor-models.html#the-quest-of-detecting-anomalies"><i class="fa fa-check"></i><b>6.2</b> The quest of detecting anomalies</a></li>
<li class="chapter" data-level="6.3" data-path="factor-models.html"><a href="factor-models.html#the-fama-french-three-factor-model"><i class="fa fa-check"></i><b>6.3</b> The Fama-French Three Factor Model</a></li>
<li class="chapter" data-level="6.4" data-path="factor-models.html"><a href="factor-models.html#testing-for-factor-validity"><i class="fa fa-check"></i><b>6.4</b> Testing for factor validity</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="factor-models.html"><a href="factor-models.html#portfolio-sorts"><i class="fa fa-check"></i><b>6.4.1</b> Portfolio Sorts</a></li>
<li class="chapter" data-level="6.4.2" data-path="factor-models.html"><a href="factor-models.html#factor-construction"><i class="fa fa-check"></i><b>6.4.2</b> Factor Construction</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="factor-models.html"><a href="factor-models.html#create-your-own-factors-a-step-by-step-example"><i class="fa fa-check"></i><b>6.5</b> Create your own factors: A step-by-step example</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="factor-models.html"><a href="factor-models.html#setting-up-the-wrds-proxy"><i class="fa fa-check"></i><b>6.5.1</b> Setting up the WRDS proxy</a></li>
<li class="chapter" data-level="6.5.2" data-path="factor-models.html"><a href="factor-models.html#factors-of-interest"><i class="fa fa-check"></i><b>6.5.2</b> Factors of interest</a></li>
<li class="chapter" data-level="6.5.3" data-path="factor-models.html"><a href="factor-models.html#get-the-data-to-construct-the-factors"><i class="fa fa-check"></i><b>6.5.3</b> Get the data to construct the factors</a></li>
<li class="chapter" data-level="6.5.4" data-path="factor-models.html"><a href="factor-models.html#portfolio-sorts-for-different-factors"><i class="fa fa-check"></i><b>6.5.4</b> Portfolio Sorts for different factors</a></li>
<li class="chapter" data-level="6.5.5" data-path="factor-models.html"><a href="factor-models.html#double-sorted-portfolios"><i class="fa fa-check"></i><b>6.5.5</b> Double-sorted Portfolios</a></li>
<li class="chapter" data-level="6.5.6" data-path="factor-models.html"><a href="factor-models.html#the-importance-of-data-selection"><i class="fa fa-check"></i><b>6.5.6</b> The importance of data selection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="statistical-properties.html"><a href="statistical-properties.html"><i class="fa fa-check"></i><b>7</b> Statistical Properties</a>
<ul>
<li class="chapter" data-level="7.1" data-path="statistical-properties.html"><a href="statistical-properties.html#random-variables-and-probability-distributions-introdcution"><i class="fa fa-check"></i><b>7.1</b> Random Variables and Probability Distributions: Introdcution</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="statistical-properties.html"><a href="statistical-properties.html#the-concept-of-probability-important-notions-and-definitions"><i class="fa fa-check"></i><b>7.1.1</b> The concept of Probability: Important Notions and Definitions</a></li>
<li class="chapter" data-level="7.1.2" data-path="statistical-properties.html"><a href="statistical-properties.html#random-variables"><i class="fa fa-check"></i><b>7.1.2</b> Random Variables</a></li>
<li class="chapter" data-level="7.1.3" data-path="statistical-properties.html"><a href="statistical-properties.html#discrete-random-variables-and-distributions"><i class="fa fa-check"></i><b>7.1.3</b> Discrete Random Variables and Distributions</a></li>
<li class="chapter" data-level="7.1.4" data-path="statistical-properties.html"><a href="statistical-properties.html#continuous-random-variables-and-distributions"><i class="fa fa-check"></i><b>7.1.4</b> Continuous Random Variables and Distributions</a></li>
<li class="chapter" data-level="7.1.5" data-path="statistical-properties.html"><a href="statistical-properties.html#the-cumulative-distribution"><i class="fa fa-check"></i><b>7.1.5</b> The cumulative Distribution</a></li>
<li class="chapter" data-level="7.1.6" data-path="statistical-properties.html"><a href="statistical-properties.html#continuous-distributions-with-appealing-properties"><i class="fa fa-check"></i><b>7.1.6</b> Continuous Distributions with Appealing Properties</a></li>
<li class="chapter" data-level="7.1.7" data-path="statistical-properties.html"><a href="statistical-properties.html#moments-and-properties-of-bivariate-distributions"><i class="fa fa-check"></i><b>7.1.7</b> Moments and Properties of bivariate distributions</a></li>
<li class="chapter" data-level="7.1.8" data-path="statistical-properties.html"><a href="statistical-properties.html#moments-of-probability-distributions"><i class="fa fa-check"></i><b>7.1.8</b> Moments of Probability Distributions</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="statistical-properties.html"><a href="statistical-properties.html#matrix-algebra-introduction"><i class="fa fa-check"></i><b>7.2</b> Matrix Algebra: Introduction</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="statistical-properties.html"><a href="statistical-properties.html#matrices-and-vectors"><i class="fa fa-check"></i><b>7.2.1</b> Matrices and Vectors</a></li>
<li class="chapter" data-level="7.2.2" data-path="statistical-properties.html"><a href="statistical-properties.html#basic-matrix-operations"><i class="fa fa-check"></i><b>7.2.2</b> Basic Matrix Operations</a></li>
<li class="chapter" data-level="7.2.3" data-path="statistical-properties.html"><a href="statistical-properties.html#summation-notation-in-matrix-form"><i class="fa fa-check"></i><b>7.2.3</b> Summation Notation in Matrix Form</a></li>
<li class="chapter" data-level="7.2.4" data-path="statistical-properties.html"><a href="statistical-properties.html#systems-of-linear-equations"><i class="fa fa-check"></i><b>7.2.4</b> Systems of Linear Equations</a></li>
<li class="chapter" data-level="7.2.5" data-path="statistical-properties.html"><a href="statistical-properties.html#positive-definite-pd-matrix"><i class="fa fa-check"></i><b>7.2.5</b> Positive Definite (PD) Matrix</a></li>
<li class="chapter" data-level="7.2.6" data-path="statistical-properties.html"><a href="statistical-properties.html#multivariate-probability-distributions"><i class="fa fa-check"></i><b>7.2.6</b> Multivariate Probability Distributions</a></li>
<li class="chapter" data-level="7.2.7" data-path="statistical-properties.html"><a href="statistical-properties.html#portfolio-construction-and-mathematical-properties-using-matrix-algebra"><i class="fa fa-check"></i><b>7.2.7</b> Portfolio Construction and Mathematical Properties using Matrix Algebra</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html"><i class="fa fa-check"></i><b>8</b> Inductive Statistics and Regression Analysis Fundamentals</a>
<ul>
<li class="chapter" data-level="8.1" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#inductive-statistics"><i class="fa fa-check"></i><b>8.1</b> Inductive Statistics</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#point-estimators"><i class="fa fa-check"></i><b>8.1.1</b> Point Estimators</a></li>
<li class="chapter" data-level="8.1.2" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#confidence-intervals"><i class="fa fa-check"></i><b>8.1.2</b> Confidence Intervals</a></li>
<li class="chapter" data-level="8.1.3" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#hypothesis-testing"><i class="fa fa-check"></i><b>8.1.3</b> Hypothesis Testing</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#introduction-to-regression-analysis"><i class="fa fa-check"></i><b>8.2</b> Introduction to Regression Analysis</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#the-role-of-correlation"><i class="fa fa-check"></i><b>8.2.1</b> The role of correlation</a></li>
<li class="chapter" data-level="8.2.2" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#the-simple-univariate-regression-model"><i class="fa fa-check"></i><b>8.2.2</b> The simple / univariate regression model</a></li>
<li class="chapter" data-level="8.2.3" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#the-multivariate-regression-model"><i class="fa fa-check"></i><b>8.2.3</b> The multivariate regression model</a></li>
<li class="chapter" data-level="8.2.4" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#goodness-of-fit"><i class="fa fa-check"></i><b>8.2.4</b> Goodness of Fit</a></li>
<li class="chapter" data-level="8.2.5" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#assumption-and-diagnostic-tests-of-ols"><i class="fa fa-check"></i><b>8.2.5</b> Assumption and diagnostic tests of OLS</a></li>
<li class="chapter" data-level="8.2.6" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#properties-of-the-ols-estimator"><i class="fa fa-check"></i><b>8.2.6</b> Properties of the OLS Estimator</a></li>
<li class="chapter" data-level="8.2.7" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#expected-value-and-variance-of-the-multivarite-ols-estimator-if-the-assumptions-hold"><i class="fa fa-check"></i><b>8.2.7</b> Expected Value and Variance of the multivarite OLS estimator if the assumptions hold:</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced Empirical Finance</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="risk-and-return" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Risk and Return</h1>
<p>The second week covers Risk and Return, one of the fundamental aspects of asset pricing. Therein, we cover the theoretical aspect behind portfolio theory, what risk metrics are, how to use performance measures, as well as how to visualise asset returns over time. Besides presenting application steps using pre-defined functions, we also cover how to calculate the metrics considered manually using matrix algebra to enhance your understanding of the respective empirical steps.</p>
<div id="the-time-series-of-returns---transformations-in-r-1" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> The time-series of Returns - Transformations in R</h2>
<p>Before we dig into the actual analysis, we need to clarify a common set-up for analysing time-serie returns.</p>
<p>Note that security analysis is always given within a time-series format. As we want to calculate returns and risk structures, we need to incorporate time-series since we want to compare security or portfolio behaviour over time. That is, we want to have a frame of reference and state how a security develops compared to that frame (e.g. the return from 2015 to now to assess what profit a portfolio has delivered).</p>
<p>In order to use time-series in securitiy analysis, we first need to modify the data set into a time-series format. We do so by using the package <code>xts</code>. Therein, we follow these steps to transform and use the concept of time-series within R:</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="risk-and-return.html#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in the dataset with your path</span></span>
<span id="cb216-2"><a href="risk-and-return.html#cb216-2" aria-hidden="true" tabindex="-1"></a>A1 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;/Users/nikolasanic/Desktop/Master UZH/Data/A1_dataset_01_Ex_Session.txt&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>,  <span class="at">dec =</span> <span class="st">&#39;.&#39;</span>)</span>
<span id="cb216-3"><a href="risk-and-return.html#cb216-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-4"><a href="risk-and-return.html#cb216-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Look the data set to get a better overview</span></span>
<span id="cb216-5"><a href="risk-and-return.html#cb216-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(A1)</span></code></pre></div>
<pre><code>##         Date   ABB Actelion  Adecco Alcon Alusuisse Baloise Ciba_SC Ciba_Geigy_I Ciba_Geigy_PS Clariant Compagnie_Financiere_Richemont
## 1 1988-06-30 5.294       NA 155.845    NA        NA      NA      NA       668.55        305.75       NA                             NA
## 2 1988-07-29 4.982       NA 157.232    NA        NA      NA      NA       649.82        301.81       NA                             NA
## 3 1988-08-31 5.049       NA 162.319    NA        NA      NA      NA       648.83        315.62       NA                             NA
## 4 1988-09-30 5.527       NA 171.476    NA        NA      NA      NA       668.55        327.45       NA                             NA
## 5 1988-10-31 5.928       NA 175.730    NA        NA      NA      NA       685.31        353.10       NA                             NA
## 6 1988-11-30 6.161       NA 171.080    NA        NA      NA      NA       534.45        398.47       NA                             NA
##   Credit_Suisse_Group Credit_Suisse_Holding Elektrowatt EMS_Chemie_Holding Geberit Georg_Fischer Givaudan Holcim Jacobs_Suchard Julius_Baer_Group
## 1                  NA                 76.45      296.70                 NA      NA            NA       NA  98.75           7890                NA
## 2                  NA                 77.05      294.23                 NA      NA            NA       NA  97.82           7700                NA
## 3                  NA                 75.54      286.81                 NA      NA            NA       NA  97.36           7500                NA
## 4                  NA                 80.83      279.89                 NA      NA       184.400       NA  98.29           7750                NA
## 5                  NA                 87.03      292.75                 NA      NA       179.771       NA  99.77           7680                NA
## 6                  NA                 81.28      274.94                 NA      NA       169.741       NA  95.04           6850                NA
##   Kudelski LafargeHolcim Lonza_Group Merck_Serono Nestle_I Nestle_PS Nobel_Biocare_Holding Novartis_I Novartis_N OC_Oerlikon_Corporation
## 1       NA            NA          NA           NA   834.87     4.103                    NA         NA         NA                  17.294
## 2       NA            NA          NA           NA   817.19     4.006                    NA         NA         NA                  16.325
## 3       NA            NA          NA           NA   816.69     4.123                    NA         NA         NA                  19.715
## 4       NA            NA          NA           NA   859.42     4.133                    NA         NA         NA                  21.444
## 5       NA            NA          NA           NA   873.17     4.264                    NA         NA         NA                  20.960
## 6       NA            NA          NA           NA   675.26     5.829                    NA         NA         NA                  21.790
##   Pargesa_Holding Partners_Group Roche_Holding SAirGroup Sandoz_PS Sandoz_N Schweizerische_Volksbank_StN Schweizerische_Volksbank_ST SGS Sika
## 1          30.672             NA        11.166        NA    467.50       NA                       158.67                          NA  NA   NA
## 2          31.068             NA        11.329        NA    491.85       NA                       155.73                          NA  NA   NA
## 3          31.661             NA        11.119        NA    478.21       NA                       154.75                          NA  NA   NA
## 4          33.541             NA        11.935        NA    481.13       NA                       152.79                          NA  NA   NA
## 5          32.057             NA        11.842        NA    479.19       NA                           NA                          NA  NA   NA
## 6          30.276             NA        11.655        NA    411.98       NA                           NA                          NA  NA   NA
##   Societe_Internationale_Pirelli Sulzer Swiss_Bank_I Swiss_Bank_PS Swiss_Bank_N Swiss_Life_Holding_I Swiss_Life_Holding_N Swiss_Re Swissair
## 1                         222.89     NA          351           292           NA                   NA                   NA   16.554  1068.24
## 2                         217.00     NA          380           299           NA                   NA                   NA   16.637  1125.22
## 3                         212.80     NA          357           291           NA                   NA                   NA   16.802  1082.49
## 4                         207.75     NA          375           303           NA                   NA                   NA   16.940  1101.48
## 5                         224.57     NA          391           313           NA                   NA                   NA   17.518  1125.22
## 6                         209.43     NA          363           296           NA                   NA                   NA   19.006  1035.01
##   Swisscom Syngenta Synthes The_Swatch_Group_I The_Swatch_Group_N Transocean UBS_N UBS_PS  UBS_I Winterthur Zurich_Insurance_Group_I
## 1       NA       NA      NA                 NA                 NA         NA    NA  112.5 610.87     955.02                  1406.93
## 2       NA       NA      NA                 NA                 NA         NA    NA  116.0 648.19     972.96                  1397.30
## 3       NA       NA      NA                 NA                 NA         NA    NA  113.5 624.61     937.09                  1319.00
## 4       NA       NA      NA                 NA                 NA         NA    NA  114.5 639.35    1008.82                  1373.21
## 5       NA       NA      NA                 NA                 NA         NA    NA  123.0 675.68     998.96                  1409.34
## 6       NA       NA      NA                 NA                 NA         NA    NA  114.0 613.81     824.99                  1144.34
##   Zurich_Insurance_Group_N
## 1                       NA
## 2                       NA
## 3                       NA
## 4                       NA
## 5                       NA
## 6                       NA</code></pre>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="risk-and-return.html#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the date column inthe dataset as as.Date()</span></span>
<span id="cb218-2"><a href="risk-and-return.html#cb218-2" aria-hidden="true" tabindex="-1"></a>date <span class="ot">=</span> <span class="fu">as.Date</span>(A1[,<span class="dv">1</span>]) </span>
<span id="cb218-3"><a href="risk-and-return.html#cb218-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-4"><a href="risk-and-return.html#cb218-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Here, we first assign a date format to the date variable, otherwise the xts package cannot read it. </span></span>
<span id="cb218-5"><a href="risk-and-return.html#cb218-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Other forms of transformation (as.POSIXct etc.) would certainly also work. </span></span>
<span id="cb218-6"><a href="risk-and-return.html#cb218-6" aria-hidden="true" tabindex="-1"></a>A1ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> A1[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> date)</span>
<span id="cb218-7"><a href="risk-and-return.html#cb218-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-8"><a href="risk-and-return.html#cb218-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(A1ts) <span class="co"># Print the Returns</span></span></code></pre></div>
<pre><code>##              ABB Actelion  Adecco Alcon Alusuisse Baloise Ciba_SC Ciba_Geigy_I Ciba_Geigy_PS Clariant Compagnie_Financiere_Richemont
## 1988-06-30 5.294       NA 155.845    NA        NA      NA      NA       668.55        305.75       NA                             NA
## 1988-07-29 4.982       NA 157.232    NA        NA      NA      NA       649.82        301.81       NA                             NA
## 1988-08-31 5.049       NA 162.319    NA        NA      NA      NA       648.83        315.62       NA                             NA
## 1988-09-30 5.527       NA 171.476    NA        NA      NA      NA       668.55        327.45       NA                             NA
## 1988-10-31 5.928       NA 175.730    NA        NA      NA      NA       685.31        353.10       NA                             NA
## 1988-11-30 6.161       NA 171.080    NA        NA      NA      NA       534.45        398.47       NA                             NA
##            Credit_Suisse_Group Credit_Suisse_Holding Elektrowatt EMS_Chemie_Holding Geberit Georg_Fischer Givaudan Holcim Jacobs_Suchard
## 1988-06-30                  NA                 76.45      296.70                 NA      NA            NA       NA  98.75           7890
## 1988-07-29                  NA                 77.05      294.23                 NA      NA            NA       NA  97.82           7700
## 1988-08-31                  NA                 75.54      286.81                 NA      NA            NA       NA  97.36           7500
## 1988-09-30                  NA                 80.83      279.89                 NA      NA       184.400       NA  98.29           7750
## 1988-10-31                  NA                 87.03      292.75                 NA      NA       179.771       NA  99.77           7680
## 1988-11-30                  NA                 81.28      274.94                 NA      NA       169.741       NA  95.04           6850
##            Julius_Baer_Group Kudelski LafargeHolcim Lonza_Group Merck_Serono Nestle_I Nestle_PS Nobel_Biocare_Holding Novartis_I Novartis_N
## 1988-06-30                NA       NA            NA          NA           NA   834.87     4.103                    NA         NA         NA
## 1988-07-29                NA       NA            NA          NA           NA   817.19     4.006                    NA         NA         NA
## 1988-08-31                NA       NA            NA          NA           NA   816.69     4.123                    NA         NA         NA
## 1988-09-30                NA       NA            NA          NA           NA   859.42     4.133                    NA         NA         NA
## 1988-10-31                NA       NA            NA          NA           NA   873.17     4.264                    NA         NA         NA
## 1988-11-30                NA       NA            NA          NA           NA   675.26     5.829                    NA         NA         NA
##            OC_Oerlikon_Corporation Pargesa_Holding Partners_Group Roche_Holding SAirGroup Sandoz_PS Sandoz_N Schweizerische_Volksbank_StN
## 1988-06-30                  17.294          30.672             NA        11.166        NA    467.50       NA                       158.67
## 1988-07-29                  16.325          31.068             NA        11.329        NA    491.85       NA                       155.73
## 1988-08-31                  19.715          31.661             NA        11.119        NA    478.21       NA                       154.75
## 1988-09-30                  21.444          33.541             NA        11.935        NA    481.13       NA                       152.79
## 1988-10-31                  20.960          32.057             NA        11.842        NA    479.19       NA                           NA
## 1988-11-30                  21.790          30.276             NA        11.655        NA    411.98       NA                           NA
##            Schweizerische_Volksbank_ST SGS Sika Societe_Internationale_Pirelli Sulzer Swiss_Bank_I Swiss_Bank_PS Swiss_Bank_N Swiss_Life_Holding_I
## 1988-06-30                          NA  NA   NA                         222.89     NA          351           292           NA                   NA
## 1988-07-29                          NA  NA   NA                         217.00     NA          380           299           NA                   NA
## 1988-08-31                          NA  NA   NA                         212.80     NA          357           291           NA                   NA
## 1988-09-30                          NA  NA   NA                         207.75     NA          375           303           NA                   NA
## 1988-10-31                          NA  NA   NA                         224.57     NA          391           313           NA                   NA
## 1988-11-30                          NA  NA   NA                         209.43     NA          363           296           NA                   NA
##            Swiss_Life_Holding_N Swiss_Re Swissair Swisscom Syngenta Synthes The_Swatch_Group_I The_Swatch_Group_N Transocean UBS_N UBS_PS  UBS_I
## 1988-06-30                   NA   16.554  1068.24       NA       NA      NA                 NA                 NA         NA    NA  112.5 610.87
## 1988-07-29                   NA   16.637  1125.22       NA       NA      NA                 NA                 NA         NA    NA  116.0 648.19
## 1988-08-31                   NA   16.802  1082.49       NA       NA      NA                 NA                 NA         NA    NA  113.5 624.61
## 1988-09-30                   NA   16.940  1101.48       NA       NA      NA                 NA                 NA         NA    NA  114.5 639.35
## 1988-10-31                   NA   17.518  1125.22       NA       NA      NA                 NA                 NA         NA    NA  123.0 675.68
## 1988-11-30                   NA   19.006  1035.01       NA       NA      NA                 NA                 NA         NA    NA  114.0 613.81
##            Winterthur Zurich_Insurance_Group_I Zurich_Insurance_Group_N
## 1988-06-30     955.02                  1406.93                       NA
## 1988-07-29     972.96                  1397.30                       NA
## 1988-08-31     937.09                  1319.00                       NA
## 1988-09-30    1008.82                  1373.21                       NA
## 1988-10-31     998.96                  1409.34                       NA
## 1988-11-30     824.99                  1144.34                       NA</code></pre>
<p>As you can see, the date column is now an index. We need this to be an index to be better able to calculate through it.</p>
<p><strong>Small Primer into using lag()</strong></p>
<p><code>lag()</code> is one of the most commonly used functions when working with time-series. You can use lag(1) for instance to define a variable that is lagged by 1 period. Like that, you can calculate returns manually. However, there is an <em>important caveat when using lag()</em>. That is: <strong>if the package <code>dplyr</code> is loaded, lag won’t work when trying to render or knit the document</strong>. This is b/c the lag function is available in both the <code>stats</code> and <code>dplyr</code> package. Thus, when we do ont specify from which package we should take the lag function, it will take the function automatically from a “higher-order” package, in this case dplyr. However, since the dplyr lag function cannot be rendered, we need to specify that we want to take the lag function explicitly from the stats package. That is, we need to write: <code>stats::lag()</code> to use the function.</p>
</div>
<div id="security-returns" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Security Returns</h2>
<p>In this chapter, we focus on the percentage changes in the price of a security. This is called the security’s return. From an investments perspective, the return of a security is sometimes a more important measure than the dollar change in the price of our investment. From an investments perspective, the return of a security is sometimes a more important measure than the dollar change in the price of our investment. To see why, suppose someone told you they made 500.- in 1 year from investing in some stock. That information alone does not tell us whether 500.- is a good return on their investment because we would need to know how much the person invested to make the 500.-. If the initial investment was 1000.-, making 500.- is exceptional as that equals to a 50% return in 1 year. However, if the initial investment was 100,000.-, making 500.- is only equal to a 0.5% return.</p>
<div id="simple-returns" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Simple Returns</h3>
<p>The daily price return is the percentage change in the price of a security today relative to its price yesterday. That is:</p>
<p><span class="math display">\[
R_{i,t} = \frac{P_t - P_{i,t-1}}{P_{i,t-1}} = \frac{P_{i,t}}{P_{i,t-1}} - 1
\]</span></p>
<p>Where <span class="math inline">\(R_{t}\)</span> is the return of security i at time t, <span class="math inline">\(P_{i,t}\)</span> is the price of this security at t and <span class="math inline">\(P_{i,t-1}\)</span> is the price of the security from one period earlier, that is t-1.</p>
<p>To calculate our first return, load the <code>return_bigfour</code> csv file into R.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="risk-and-return.html#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read big four dataset in</span></span>
<span id="cb220-2"><a href="risk-and-return.html#cb220-2" aria-hidden="true" tabindex="-1"></a>A1_bigfour <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;/Users/nikolasanic/Desktop/Advanced_Empirical_Finance_Documents/Data/Risk_Return/A1_bigfour.csv&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>,  <span class="at">dec =</span> <span class="st">&#39;.&#39;</span>)</span>
<span id="cb220-3"><a href="risk-and-return.html#cb220-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-4"><a href="risk-and-return.html#cb220-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Turn it to an xts file</span></span>
<span id="cb220-5"><a href="risk-and-return.html#cb220-5" aria-hidden="true" tabindex="-1"></a>date_bf <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="fu">dmy</span>(A1_bigfour<span class="sc">$</span>Date))</span>
<span id="cb220-6"><a href="risk-and-return.html#cb220-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb220-7"><a href="risk-and-return.html#cb220-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Here, we first assign a date format to the date variable, otherwise the xts package cannot read it. </span></span>
<span id="cb220-8"><a href="risk-and-return.html#cb220-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Other forms of transformation (as.POSIXct etc.) would certainly also work. </span></span>
<span id="cb220-9"><a href="risk-and-return.html#cb220-9" aria-hidden="true" tabindex="-1"></a>A1ts_bf <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> A1_bigfour[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> date_bf)</span></code></pre></div>
<p>An important feature of xts objects is the <code>date configuration</code> ability. That is, by writing the dates of interest in brackets next to the xts object, we can define the exact period of observation:</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="risk-and-return.html#cb221-1" aria-hidden="true" tabindex="-1"></a>A1ts_bf[<span class="st">&#39;1988-06-30/1989-12-29&#39;</span>]</span></code></pre></div>
<pre><code>##            Nestle_I Nestle_PS Novartis_I Novartis_N    UBS_I UBS_N Roche_Holding
## 1988-06-30  9120.50   9375.67         NA         NA 10256.78    NA       7304.75
## 1988-07-29  8927.36   9152.96         NA         NA 10883.40    NA       7411.50
## 1988-08-31  8921.99   9420.21         NA         NA 10487.64    NA       7274.25
## 1988-09-30  9388.75   9442.48         NA         NA 10734.99    NA       7808.00
## 1988-10-31  9538.97   9743.12         NA         NA 11345.12    NA       7747.00
## 1988-11-30  7376.87  13317.46         NA         NA 10306.25    NA       7625.00
## 1988-12-30  7768.52  14898.63         NA         NA 10553.60    NA       7716.50
## 1989-01-31  7886.55  15121.33         NA         NA 10784.46    NA       8402.75
## 1989-02-28  7543.19  14241.66         NA         NA 10058.89    NA       8326.50
## 1989-03-31  7811.44  14742.73         NA         NA 10652.54    NA       8997.50
## 1989-04-28  8090.42  14987.71         NA         NA 10685.52    NA       9912.50
## 1989-05-31  7618.30  14185.99         NA         NA 10058.89    NA       9882.00
## 1989-06-30  8858.22  17160.92         NA         NA 10982.34    NA      10391.95
## 1989-07-31  9455.53  18914.42         NA         NA 12598.36    NA      11773.45
## 1989-08-31  9962.68  19709.34         NA         NA 13356.90    NA      13752.90
## 1989-09-29  9692.20  19569.06         NA         NA 12565.38    NA      12387.60
## 1989-10-31  9252.67  18902.73         NA         NA 11955.25    NA      11438.55
## 1989-11-30  9765.45  19709.34         NA         NA 12862.20    NA      12287.70
## 1989-12-29  9940.14  20293.84         NA         NA 13521.80    NA      11954.70</code></pre>
<p>Now, we can calculate the returns for each security. We do this in two ways: First, with the formula above, then with the function <code>ReturnCalculate()</code></p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="risk-and-return.html#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Returns for Roche: </span></span>
<span id="cb223-2"><a href="risk-and-return.html#cb223-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-3"><a href="risk-and-return.html#cb223-3" aria-hidden="true" tabindex="-1"></a><span class="do">## ALWAYS USE stats::lag(). THIS IS B/C DPLYR PACKAGE ASSUMES AN INCORRECT LAG WHEN BEING CALLED AND THUS THE MARKDOWN CANNOT BE RENDERED. </span></span>
<span id="cb223-4"><a href="risk-and-return.html#cb223-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-5"><a href="risk-and-return.html#cb223-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Manually</span></span>
<span id="cb223-6"><a href="risk-and-return.html#cb223-6" aria-hidden="true" tabindex="-1"></a>A1_return_Roche_manual <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(A1ts_bf<span class="sc">$</span>Roche_Holding <span class="sc">/</span> stats<span class="sc">::</span><span class="fu">lag</span>(A1ts_bf<span class="sc">$</span>Roche_Holding, <span class="dv">1</span>) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb223-7"><a href="risk-and-return.html#cb223-7" aria-hidden="true" tabindex="-1"></a>A1_return_Roche_manual_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(A1_return_Roche_manual, <span class="at">order.by =</span> date_bf)</span>
<span id="cb223-8"><a href="risk-and-return.html#cb223-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-9"><a href="risk-and-return.html#cb223-9" aria-hidden="true" tabindex="-1"></a><span class="do">## With function: Here I combine the return calculate and xts function into one line</span></span>
<span id="cb223-10"><a href="risk-and-return.html#cb223-10" aria-hidden="true" tabindex="-1"></a>A1_return_Roche_function_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="fu">Return.calculate</span>(A1ts_bf<span class="sc">$</span>Roche_Holding, <span class="at">method =</span> <span class="st">&#39;discrete&#39;</span>), <span class="at">order.by =</span> date_bf)</span>
<span id="cb223-11"><a href="risk-and-return.html#cb223-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-12"><a href="risk-and-return.html#cb223-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the sum to ensure they are the same. We do this by an ifelse statement, stating that if both sums are identical, it prints a 1</span></span>
<span id="cb223-13"><a href="risk-and-return.html#cb223-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="fu">mean</span>(A1_return_Roche_function_ts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">==</span> <span class="fu">mean</span>(A1_return_Roche_manual_ts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="st">&quot;Both calculations are identical&quot;</span>, <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Both calculations are identical&quot;</code></pre>
<p>A small note here: As you may have noticed, the first return will always be a <code>NA</code> value, since there is no lagged parameter for the first price. As such, every time we work with data that has missing or NA values, we need to modify the calculus by using the argument <code>na.rm = TRUE</code> in a specific function. For that, look at the sum that we calculated. The function is <code>sum(A1_return_Roche_function, na.rm = TRUE)</code>. This tells R to simply skip or disregard the empty cells.</p>
</div>
<div id="logarithmic-returns" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Logarithmic Returns</h3>
<p>Log returns are often used as an approximation to normal returns. Given the Taylor approximation, we understand that log returns are approximately equal to simple returns if the <strong>volatility structure is relatively low</strong>, implying no large jumps between the periods. We know that volatility is generally higher for riskier assets and longer horizons.</p>
<p>Log returns are computed as follows:</p>
<p><span class="math display">\[
R_{i,t} = log(P_{i,t}) - log(P_{i,t-1})
\]</span></p>
<p>A large benefit of logarithmic returns is their additive behaviour. That is, we can state that the <strong>sum</strong> of normally distributed variables is <strong>normally distributed (if they are uncorrelated)</strong>. As opposed to this, the <strong>product</strong> of normally distributed variables is <strong>not normally distributed</strong>. Consequently, using log returns, we can still rely on many statistical tests that require normality assumptions (such as p values and confidence intervals). Another advantage is their computational simplicity. Note that with log returns, we just need additive properties, but not multiplicative, which is relatively less expensive to compute.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="risk-and-return.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s calculate the log returns for Roche:</span></span>
<span id="cb225-2"><a href="risk-and-return.html#cb225-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-3"><a href="risk-and-return.html#cb225-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Manually</span></span>
<span id="cb225-4"><a href="risk-and-return.html#cb225-4" aria-hidden="true" tabindex="-1"></a>A1_return_Roche_manual_log_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="fu">log</span>(A1ts_bf<span class="sc">$</span>Roche_Holding) <span class="sc">-</span> <span class="fu">log</span>(stats<span class="sc">::</span><span class="fu">lag</span>(A1ts_bf<span class="sc">$</span>Roche_Holding, <span class="dv">1</span>)), <span class="at">order.by =</span> date_bf)</span>
<span id="cb225-5"><a href="risk-and-return.html#cb225-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-6"><a href="risk-and-return.html#cb225-6" aria-hidden="true" tabindex="-1"></a><span class="do">## With function </span></span>
<span id="cb225-7"><a href="risk-and-return.html#cb225-7" aria-hidden="true" tabindex="-1"></a>A1_return_Roche_function_log_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="fu">Return.calculate</span>(A1ts_bf<span class="sc">$</span>Roche_Holding, <span class="at">method =</span> <span class="st">&#39;log&#39;</span>), <span class="at">order.by =</span> date_bf)</span>
<span id="cb225-8"><a href="risk-and-return.html#cb225-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-9"><a href="risk-and-return.html#cb225-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the sum to ensure they are the same. We do this by an ifelse statement, stating that if both sums are identical, it prints a 1</span></span>
<span id="cb225-10"><a href="risk-and-return.html#cb225-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="fu">mean</span>(A1_return_Roche_manual_log_ts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">==</span> <span class="fu">mean</span>(A1_return_Roche_function_log_ts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="st">&quot;Both calculations are identical&quot;</span>, <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Both calculations are identical&quot;</code></pre>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="risk-and-return.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can also compare both simple and log returns:</span></span>
<span id="cb227-2"><a href="risk-and-return.html#cb227-2" aria-hidden="true" tabindex="-1"></a>Roche_log_simpel <span class="ot">=</span> <span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(<span class="fu">mean</span>(A1_return_Roche_manual_log_ts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="fu">mean</span>(A1_return_Roche_manual_ts, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb227-3"><a href="risk-and-return.html#cb227-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-4"><a href="risk-and-return.html#cb227-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define colnames and rownames</span></span>
<span id="cb227-5"><a href="risk-and-return.html#cb227-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Roche_log_simpel) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Return Roche&quot;</span>) </span>
<span id="cb227-6"><a href="risk-and-return.html#cb227-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(Roche_log_simpel) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Mean Returns Log&quot;</span>, <span class="st">&quot;Mean Returns Simpel&quot;</span>)</span>
<span id="cb227-7"><a href="risk-and-return.html#cb227-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-8"><a href="risk-and-return.html#cb227-8" aria-hidden="true" tabindex="-1"></a>Roche_log_simpel</span></code></pre></div>
<pre><code>##                     Return Roche
## Mean Returns Log     0.008559642
## Mean Returns Simpel  0.010199229</code></pre>
</div>
<div id="accounting-for-dividends-total-returns" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Accounting for Dividends: Total Returns</h3>
<p>The return to investors from holding shares of stock is not limited to changes in the price of the security. For companies that pay dividends, the shareholders holding shares prior to the ex-dividend date receive cash payments that they are able to reinvest. Reinvesting dividends implies we get <strong>compounded returns on the dividends</strong>.</p>
<p>Returns that include dividend reinvestment are known as <strong>holding period returns</strong> (HPR) or <strong>total returns</strong>:</p>
<p><span class="math display">\[
R_{i,t}^{Tot} = \frac{P_t - P_{i,t-1} + CF_{i,t}}{P_{i,t-1}} = \underbrace{\left[\frac{P_{i,t}}{P_{i,t-1}} - 1\right]}_{\text{Capital Appreciation}} + \underbrace{\frac{CF_{i,t}}{P_{i,t-1}}}_{\text{CF Yield}}
\]</span>
For a daily total return calculation, the dividend yield is zero on non-ex dividend dates. This has two implications.</p>
<ul>
<li>On most days, the price return and the total return are the same because we only have the changes in the capital appreciation on those dates</li>
<li>For a non-dividend paying stock, the price return and total return are the same</li>
</ul>
<p>However, on the ex-dividend dates, we would expect the price return and total return to deviate. The more ex-dividend dates there are during our investment horizon, the larger the deviation between cumulative price returns and cumulative total returns will be.</p>
<p>To account for this, most large data providers report a variable that incorporates an adjustment for dividends. This variable is labeled the <strong>adjusted close price</strong>, which is the security’s close price adjusted for both stock splits and dividends (compared to solely close price, which is the non-adjusted price we take for return calculations).</p>
</div>
<div id="truncating-the-data" class="section level3" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Truncating the data</h3>
<p>Financial data are sometimes subject to extreme values or outliers. If we determine that these outliers are more noise than information, keeping the outliers in the data can unduly influence the outcome of the analysis and/or create problems in the interpretation of the results. The most common approach is to use truncation techniques. Truncation replaces the values greater than the i-th percentile and less than the (1 − i-th) percentile and removes them from the dataset. This is done using the <code>quantile()</code> and <code>subset()</code> function in R.</p>
<p>For example, if we want to winsorize at the 0.5% level, we can use this function to determine what is the cut-off value and then set values higher than the upper cut-off (i.e., 99.5%) to the value of the upper cut-off and set values lower than the lower cut-off (i.e., 0.5%) to the value of the lower cut-off. Let’s do this for Roche:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="risk-and-return.html#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We first calculate upper and lower cut-offs with the quantile() function</span></span>
<span id="cb229-2"><a href="risk-and-return.html#cb229-2" aria-hidden="true" tabindex="-1"></a>upper_co <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">quantile</span>(A1_return_Roche_function_ts, <span class="fl">0.995</span>, <span class="at">na.rm =</span> T))</span>
<span id="cb229-3"><a href="risk-and-return.html#cb229-3" aria-hidden="true" tabindex="-1"></a>lower_co <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">quantile</span>(A1_return_Roche_function_ts, <span class="fl">0.005</span>, <span class="at">na.rm =</span> T))</span>
<span id="cb229-4"><a href="risk-and-return.html#cb229-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb229-5"><a href="risk-and-return.html#cb229-5" aria-hidden="true" tabindex="-1"></a><span class="co"># We then take the ifelse statement to replace the most extreme values with the upper and lower cut-off scores</span></span>
<span id="cb229-6"><a href="risk-and-return.html#cb229-6" aria-hidden="true" tabindex="-1"></a>A1_return_Roche_function_co <span class="ot">&lt;-</span> <span class="fu">subset</span>(A1_return_Roche_function_ts, A1_return_Roche_function_ts <span class="sc">&lt;=</span> upper_co <span class="sc">&amp;</span> A1_return_Roche_function_ts <span class="sc">&gt;=</span> lower_co)</span></code></pre></div>
</div>
<div id="arithmetic-vs.-geometric-returns" class="section level3" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span> Arithmetic vs. Geometric Returns</h3>
<p>Now, we looked at how to calculate periodic returns. If we want to have a summary of all returns to understand an average behaviour of our data, we can use two return calculation methods. These are called Arithmetic and Geometric returns.</p>
<p>First, arithmetic returns:</p>
<p><span class="math display">\[
R_{i,T}^{A} = \frac{1}{T}\sum_{t=1}^T R_{i,t} - 1
\]</span></p>
<p>Then, Geometric returns:</p>
<p><span class="math display">\[
R_{i,T}^{G} = [(1+R_{i,1}*)(1+R_{i,2})*\dots*(1+R_{i,T})]^{1/T} = \left[\prod_{t=1}^T R_{i,t} \right]^{1/T} - 1
\]</span></p>
<p>There is an important difference as to when we need which returns:</p>
<ul>
<li>Arithmetic Returns: Use this when you want the expected return for a one period investment</li>
<li>Geometric Returns: Use this when you want the cumulative return over an entire investment period</li>
</ul>
<p>Consequently, we can get quite different results based on the decision of the return calculation method.</p>
</div>
<div id="cumulative-returns" class="section level3" number="3.2.6">
<h3><span class="header-section-number">3.2.6</span> Cumulative Returns</h3>
<p>When evaluating investments, we are typically concerned with how our investment has performed over a particular time horizon. Put differently, we are interested in cumulative multi-period returns. We could be interested in knowing the returns of our investment over the past week or over the past month or over the past year. To fully capture the effects of being able to reinvest dividends, we should calculate daily returns and string those returns together for longer periods.</p>
<p>As we mentioned, we use the geometric return calculation method when we want to assess returns over an entire investment horizon. As such, we calculate the period return with the formula above and then string each return together to obtain the dynamic investment return. We can do this either manually or use the function <code>cumprod()</code> given in the <code>PerformanceAnalytics</code> package.</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="risk-and-return.html#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, we need to cap the data set such that the first observation is no longer part of it (as this is a NA).</span></span>
<span id="cb230-2"><a href="risk-and-return.html#cb230-2" aria-hidden="true" tabindex="-1"></a>A1_return_Roche_ts_cap <span class="ot">&lt;-</span> A1_return_Roche_function_ts[<span class="sc">-</span><span class="dv">1</span>,] </span>
<span id="cb230-3"><a href="risk-and-return.html#cb230-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-4"><a href="risk-and-return.html#cb230-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, let&#39;s calculate the cumulative returns. To do so, we can use a handy feature of xts objects. By inserting the dates in brackets, we can define from when to when we want to have the analysis (thereby pinning-down a period of interest)</span></span>
<span id="cb230-5"><a href="risk-and-return.html#cb230-5" aria-hidden="true" tabindex="-1"></a>Roche_Prod <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">+</span>A1_return_Roche_ts_cap[<span class="st">&#39;1988-07-29/2000-12-29&#39;</span>])</span></code></pre></div>
<p>Note that this package also has three other handy features: <code>cumsum()</code>, <code>cummin()</code> and <code>cummax</code>. The first calculates the sum of the subsequent returns up to a given date. The latter two calculate the maximum and minimum value of a period up to a certain point. Let’s try this out:</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="risk-and-return.html#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s calculate the sum, min and max values</span></span>
<span id="cb231-2"><a href="risk-and-return.html#cb231-2" aria-hidden="true" tabindex="-1"></a>Roche_Sum <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(<span class="dv">1</span><span class="sc">+</span>A1_return_Roche_ts_cap[<span class="st">&#39;1988-07-29/2000-12-29&#39;</span>])</span>
<span id="cb231-3"><a href="risk-and-return.html#cb231-3" aria-hidden="true" tabindex="-1"></a>Roche_Min <span class="ot">&lt;-</span> <span class="fu">cummin</span>(<span class="dv">1</span><span class="sc">+</span>A1_return_Roche_ts_cap[<span class="st">&#39;1988-07-29/2000-12-29&#39;</span>])</span>
<span id="cb231-4"><a href="risk-and-return.html#cb231-4" aria-hidden="true" tabindex="-1"></a>Roche_Max <span class="ot">&lt;-</span> <span class="fu">cummax</span>(<span class="dv">1</span><span class="sc">+</span>A1_return_Roche_ts_cap[<span class="st">&#39;1988-07-29/2000-12-29&#39;</span>])</span>
<span id="cb231-5"><a href="risk-and-return.html#cb231-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-6"><a href="risk-and-return.html#cb231-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s bind all of them together with the merge.xts function, and create a dataframe and name the columns:</span></span>
<span id="cb231-7"><a href="risk-and-return.html#cb231-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-8"><a href="risk-and-return.html#cb231-8" aria-hidden="true" tabindex="-1"></a>cum_ret_all <span class="ot">&lt;-</span> <span class="fu">merge.xts</span>(Roche_Prod, Roche_Sum, Roche_Min, Roche_Max)</span>
<span id="cb231-9"><a href="risk-and-return.html#cb231-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-10"><a href="risk-and-return.html#cb231-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cum_ret_all) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Roche Cum Prod&quot;</span>, <span class="st">&quot;Roche Cum Sum&quot;</span>, <span class="st">&quot;Roche Cum Min&quot;</span>, <span class="st">&quot;Roche Cum Max&quot;</span>)</span></code></pre></div>
<p>Importantly, we use the <code>cumprod()</code> function to draw returns over time. That is, each share chart of an investment return you’ve seen is exactly constructed according to the cumulative function we just explored. To see this:</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="risk-and-return.html#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(Roche_Prod) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>index,<span class="at">y=</span> value, <span class="at">color=</span>series)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb232-2"><a href="risk-and-return.html#cb232-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">&quot;Cumulative Returns&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Cumulative Return of Roche from 1988 to 2000&quot;</span>) <span class="sc">+</span></span>
<span id="cb232-3"><a href="risk-and-return.html#cb232-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Cumulative Return&#39;</span>) <span class="sc">+</span></span>
<span id="cb232-4"><a href="risk-and-return.html#cb232-4" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb232-5"><a href="risk-and-return.html#cb232-5" aria-hidden="true" tabindex="-1"></a><span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb232-6"><a href="risk-and-return.html#cb232-6" aria-hidden="true" tabindex="-1"></a><span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb232-7"><a href="risk-and-return.html#cb232-7" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb232-8"><a href="risk-and-return.html#cb232-8" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb232-9"><a href="risk-and-return.html#cb232-9" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb232-10"><a href="risk-and-return.html#cb232-10" aria-hidden="true" tabindex="-1"></a><span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb232-11"><a href="risk-and-return.html#cb232-11" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb232-12"><a href="risk-and-return.html#cb232-12" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb232-13"><a href="risk-and-return.html#cb232-13" aria-hidden="true" tabindex="-1"></a><span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-149-1.png" width="672" /></p>
</div>
<div id="periodic-transformation-of-returns" class="section level3" number="3.2.7">
<h3><span class="header-section-number">3.2.7</span> Periodic Transformation of Returns</h3>
<p>Another important tool that we can use is the transformation functions that xts offers. That is, we can convert time series data to an OHLC series. In R, we do this by using the <code>to.period(xts)</code> package. In total, this package offers 12 time transformations, ranging from minutes to years. For us, the most important ones are <code>to.weekly()</code>, <code>to.monthly()</code>, <code>to.quarterly()</code> as well as <code>to.yearly()</code>. The terms of transformation are self-explanatory here.</p>
<p>To see how we can transform this, use:</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="risk-and-return.html#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, we need to transform the prices data set into different intervals. Note that we have daily prices. </span></span>
<span id="cb233-2"><a href="risk-and-return.html#cb233-2" aria-hidden="true" tabindex="-1"></a>Roche_ts_daily <span class="ot">&lt;-</span> <span class="fu">to.daily</span>(A1ts_bf<span class="sc">$</span>Roche_Holding)</span>
<span id="cb233-3"><a href="risk-and-return.html#cb233-3" aria-hidden="true" tabindex="-1"></a>Roche_ts_weekly <span class="ot">&lt;-</span> <span class="fu">to.weekly</span>(A1ts_bf<span class="sc">$</span>Roche_Holding)</span>
<span id="cb233-4"><a href="risk-and-return.html#cb233-4" aria-hidden="true" tabindex="-1"></a>Roche_ts_monthly <span class="ot">&lt;-</span> A1ts_bf<span class="sc">$</span>Roche_Holding</span>
<span id="cb233-5"><a href="risk-and-return.html#cb233-5" aria-hidden="true" tabindex="-1"></a>Roche_ts_quarterly <span class="ot">&lt;-</span> <span class="fu">to.quarterly</span>(A1ts_bf<span class="sc">$</span>Roche_Holding)</span>
<span id="cb233-6"><a href="risk-and-return.html#cb233-6" aria-hidden="true" tabindex="-1"></a>Roche_ts_yearly <span class="ot">&lt;-</span> <span class="fu">to.yearly</span>(A1ts_bf<span class="sc">$</span>Roche_Holding)</span>
<span id="cb233-7"><a href="risk-and-return.html#cb233-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-8"><a href="risk-and-return.html#cb233-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we can calculate the returns for each periodicity accoringly:</span></span>
<span id="cb233-9"><a href="risk-and-return.html#cb233-9" aria-hidden="true" tabindex="-1"></a>Roche_ts_daily_ret <span class="ot">&lt;-</span> <span class="fu">Return.calculate</span>(Roche_ts_daily, <span class="at">method =</span> <span class="st">&#39;discrete&#39;</span>)</span>
<span id="cb233-10"><a href="risk-and-return.html#cb233-10" aria-hidden="true" tabindex="-1"></a>Roche_ts_weekly_ret <span class="ot">&lt;-</span> <span class="fu">Return.calculate</span>(Roche_ts_weekly, <span class="at">method =</span> <span class="st">&#39;discrete&#39;</span>)</span>
<span id="cb233-11"><a href="risk-and-return.html#cb233-11" aria-hidden="true" tabindex="-1"></a>Roche_ts_monthly_ret <span class="ot">&lt;-</span> <span class="fu">Return.calculate</span>(Roche_ts_monthly, <span class="at">method =</span> <span class="st">&#39;discrete&#39;</span>)</span>
<span id="cb233-12"><a href="risk-and-return.html#cb233-12" aria-hidden="true" tabindex="-1"></a>Roche_ts_quarterly_ret <span class="ot">&lt;-</span> <span class="fu">Return.calculate</span>(Roche_ts_quarterly, <span class="at">method =</span> <span class="st">&#39;discrete&#39;</span>)</span>
<span id="cb233-13"><a href="risk-and-return.html#cb233-13" aria-hidden="true" tabindex="-1"></a>Roche_ts_yearly_ret <span class="ot">&lt;-</span> <span class="fu">Return.calculate</span>(Roche_ts_yearly, <span class="at">method =</span> <span class="st">&#39;discrete&#39;</span>)</span></code></pre></div>
</div>
<div id="annualising-returns" class="section level3" number="3.2.8">
<h3><span class="header-section-number">3.2.8</span> Annualising Returns</h3>
<p>One important feature we still need to consider is the annualisation of returns. Instead of simply transforming the time-series into different intervals, we here take periodic returns and calculate what their value when shifted to a different periodicity would be.</p>
<p>The daily to yearly formula for this is:</p>
<p><span class="math display">\[
R_{i,t}^{Annual} = (1+R_{i,t})^{365} -1 
\]</span></p>
<p>Under the assumption that <span class="math inline">\(R_{i,t}\)</span> are daily returns.</p>
<p>In general, if we have different periods, we can shift the periodicity by simply taking the n’th power of the underlying return metric, whereas n defines the product of the different periodicities. As such, we get:</p>
<ul>
<li>Daily to Weekly: n = 7</li>
<li>Daily to Monthly: n = 30</li>
<li>Daily to Annual: n = 252 (trading days)</li>
<li>Weekly to Monthly: n = 4</li>
<li>Weekly to Annual: n = 52</li>
<li>Monthly to Annual: n = 12</li>
</ul>
<p>Also, if you need to convert it into higher frequency, you take the 1/n’th power of the underlying return metric. As such:</p>
<ul>
<li>Annual to Monthly: 1/n = 1/12 (the rest is analogous)</li>
</ul>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="risk-and-return.html#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the mean monthly return for Roche: </span></span>
<span id="cb234-2"><a href="risk-and-return.html#cb234-2" aria-hidden="true" tabindex="-1"></a>Roche_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(A1_return_Roche_ts_cap[<span class="st">&#39;1988-07-29/2000-12-29&#39;</span>])</span>
<span id="cb234-3"><a href="risk-and-return.html#cb234-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-4"><a href="risk-and-return.html#cb234-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Annualise it:</span></span>
<span id="cb234-5"><a href="risk-and-return.html#cb234-5" aria-hidden="true" tabindex="-1"></a>Roche_mean_ann <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">+</span>Roche_mean)<span class="sc">^</span><span class="dv">12</span> <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb234-6"><a href="risk-and-return.html#cb234-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-7"><a href="risk-and-return.html#cb234-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Put together</span></span>
<span id="cb234-8"><a href="risk-and-return.html#cb234-8" aria-hidden="true" tabindex="-1"></a>Roche_average_returns <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(Roche_mean, Roche_mean_ann))</span>
<span id="cb234-9"><a href="risk-and-return.html#cb234-9" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Roche_average_returns) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Roche Monthly Mean&quot;</span>, <span class="st">&quot;Roche Monthly Mean Annualised&quot;</span>)</span>
<span id="cb234-10"><a href="risk-and-return.html#cb234-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-11"><a href="risk-and-return.html#cb234-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Print it</span></span>
<span id="cb234-12"><a href="risk-and-return.html#cb234-12" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(Roche_average_returns,<span class="dv">4</span>)</span></code></pre></div>
<pre><code>##   Roche Monthly Mean Roche Monthly Mean Annualised
## 1             0.0204                        0.2742</code></pre>
</div>
</div>
<div id="portfolio-returns" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Portfolio Returns</h2>
<p>A key lesson in finance is diversification, which means we should not put all our eggs in one basket. From the perspective of portfolio management, this means that we should have more than one stock in our portfolio. In the last chapter, we looked at returns of individual securities. In this chapter, we extend the returns calculation when you have more than one security in your portfolio. Here, we will look at return characteristics of multiple securities thus that are stacked into one portfolio. Given the matrix algebra and calculus theory from week 1, we can easily apply the derived notions in a practical setting.</p>
<p>For the calculation of the portfolios, we will use the bigfour data frame previously introduced. But instead of only assessing Roche, we now introduce Nestle, Novartis and UBS into the setting.</p>
<div id="equal-weighted-returns" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Equal-weighted Returns</h3>
<p>In general, there are two ways to calculate portfolio returns. The first is called <strong>Equal-weighted Returns</strong>. This implies that we invest equally in all stocks of a given portfolio. Thereby, we invest 1/N into each asset.</p>
<p>In terms of portfolio metrics calculations, this is equivalent as simply taking the <strong>mean of all security returns</strong>:</p>
<p><span class="math display">\[
R_{p,t} = \frac{1}{N}\sum_{i=1}^N R_{i,t}
\]</span></p>
<p>Where <span class="math inline">\(R_{p,t}\)</span> is the portfolio return at time t, <span class="math inline">\(R_{i,t}\)</span> is the security return at time t and N is the number of securities of the portfolio.</p>
<p>If we use this approach, we can easily calculate the mean return with the <code>rowMeans()</code> function:</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="risk-and-return.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, the non matrix algebra solution. </span></span>
<span id="cb236-2"><a href="risk-and-return.html#cb236-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-3"><a href="risk-and-return.html#cb236-3" aria-hidden="true" tabindex="-1"></a><span class="do">## We calculate the returns of all variables</span></span>
<span id="cb236-4"><a href="risk-and-return.html#cb236-4" aria-hidden="true" tabindex="-1"></a>A1_bigfour_ret_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="fu">Return.calculate</span>(A1ts_bf), <span class="at">order.by =</span> date_bf)</span>
<span id="cb236-5"><a href="risk-and-return.html#cb236-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-6"><a href="risk-and-return.html#cb236-6" aria-hidden="true" tabindex="-1"></a><span class="do">## We delete the first row as this is NA</span></span>
<span id="cb236-7"><a href="risk-and-return.html#cb236-7" aria-hidden="true" tabindex="-1"></a>A1_bigfour_ret_ts <span class="ot">&lt;-</span> A1_bigfour_ret_ts[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb236-8"><a href="risk-and-return.html#cb236-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-9"><a href="risk-and-return.html#cb236-9" aria-hidden="true" tabindex="-1"></a><span class="do">## We take the row to get the portfolio return at each period</span></span>
<span id="cb236-10"><a href="risk-and-return.html#cb236-10" aria-hidden="true" tabindex="-1"></a>bigfour_EW_ret_ts <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(A1_bigfour_ret_ts, <span class="at">na.rm =</span> T)</span>
<span id="cb236-11"><a href="risk-and-return.html#cb236-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb236-12"><a href="risk-and-return.html#cb236-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate annualized return for arithmetic value</span></span>
<span id="cb236-13"><a href="risk-and-return.html#cb236-13" aria-hidden="true" tabindex="-1"></a>bigfour_EW_ret_ts_mean_annual <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">mean</span>(bigfour_EW_ret_ts, <span class="at">na.rm =</span> T))<span class="sc">**</span><span class="dv">12</span> <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb236-14"><a href="risk-and-return.html#cb236-14" aria-hidden="true" tabindex="-1"></a>bigfour_EW_ret_ts_mean_annual</span></code></pre></div>
<pre><code>## [1] 0.1618578</code></pre>
<p>We can derive the same result and be a little faster by using matrix algebra as we have shown in Chapter 1. That is:</p>
<p><span class="math display">\[
R_p = \textbf{w}^T\textbf{R}
\]</span></p>
<p>That is, the overall portfolio return is the matrix multiplication of the weight vector with the individual security returns. To do so, we just use the following:</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="risk-and-return.html#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First we define the average return vector of the securities:</span></span>
<span id="cb238-2"><a href="risk-and-return.html#cb238-2" aria-hidden="true" tabindex="-1"></a>return_vector <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(A1_bigfour_ret_ts, <span class="at">na.rm =</span> T)</span>
<span id="cb238-3"><a href="risk-and-return.html#cb238-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-4"><a href="risk-and-return.html#cb238-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we can create a vector consisting of average weights. Here, we have seven securities, so each return will be multiplied with 1/7. </span></span>
<span id="cb238-5"><a href="risk-and-return.html#cb238-5" aria-hidden="true" tabindex="-1"></a>weight_vector <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">length</span>(return_vector),<span class="at">each=</span><span class="fu">length</span>(return_vector))</span>
<span id="cb238-6"><a href="risk-and-return.html#cb238-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-7"><a href="risk-and-return.html#cb238-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Now calculate the matrix product:</span></span>
<span id="cb238-8"><a href="risk-and-return.html#cb238-8" aria-hidden="true" tabindex="-1"></a>mean_return_bigfour <span class="ot">&lt;-</span> return_vector <span class="sc">%*%</span> weight_vector</span>
<span id="cb238-9"><a href="risk-and-return.html#cb238-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-10"><a href="risk-and-return.html#cb238-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Annualise it:</span></span>
<span id="cb238-11"><a href="risk-and-return.html#cb238-11" aria-hidden="true" tabindex="-1"></a>bigfour_EW_ret_ts_mean_annual_matmul <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">+</span>mean_return_bigfour)<span class="sc">^</span><span class="dv">12</span> <span class="sc">-</span><span class="dv">1</span> </span>
<span id="cb238-12"><a href="risk-and-return.html#cb238-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-13"><a href="risk-and-return.html#cb238-13" aria-hidden="true" tabindex="-1"></a><span class="co"># See if it is the same: </span></span>
<span id="cb238-14"><a href="risk-and-return.html#cb238-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(bigfour_EW_ret_ts_mean_annual <span class="sc">==</span> bigfour_EW_ret_ts_mean_annual_matmul, <span class="st">&quot;Both calculations are identical&quot;</span>, <span class="dv">0</span>)</span></code></pre></div>
<pre><code>##      [,1]                             
## [1,] &quot;Both calculations are identical&quot;</code></pre>
<p>This was important to show that portfolio returns are nothing else than matrix multiplication steps we saw in the Linear Algebra part.</p>
</div>
<div id="value-weighted-returns" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Value-weighted Returns</h3>
<p>As opposed to weighting each security with the same factor, we can also account for company size when evaluating portfolio performance. A value-weighted (VW) portfolio invests capital in proportion to the market capitalization of the securities in the portfolio. In a VW portfolio, returns of larger firms are given more weight.</p>
<p>As such, you weight the individual security returns with the inverse of their respective market capitalisation, proportional to the overall market capitalisation of the portfolio.</p>
<p>Importantly, when using VW strategies, we must use <strong>past weights</strong>. This follows an underlying logic. To calculate the day t market capitalization, we would need to know the return on day t for that security. So if we use the market capitalization on day t as the weights for day t return, we are assuming perfect foresight as to what the end of day return would be. This is not realistic. This phenomenon is also called the <strong>look-ahead bias</strong>. To combat this issue, a more appropriate approach is to take the market capitalization the day prior to the rebalancing date, as this information would have been known to investors on the rebalancing date.</p>
<p>The <strong>market capitalisation</strong> is calculated using:</p>
<p><span class="math display">\[
MC_{i,t} = P_{i,t} * SHROUT_{i,t}
\]</span></p>
<p>Whereas <span class="math inline">\(P_{i,t}\)</span> is the Price of security i at time t, and <span class="math inline">\(SHROUT_{i,t}\)</span> are the outstanding shares of security i at time t.</p>
<p>As such, once we have the data on Outstanding Shares, we can easily compute VW portfolio returns.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="risk-and-return.html#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in the Market Cap Dataset</span></span>
<span id="cb240-2"><a href="risk-and-return.html#cb240-2" aria-hidden="true" tabindex="-1"></a>A4_bigfour <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;/Users/nikolasanic/Desktop/Advanced_Empirical_Finance_Documents/Data/Risk_Return/A4_bifgour.csv&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb240-3"><a href="risk-and-return.html#cb240-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-4"><a href="risk-and-return.html#cb240-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the dataset into an xts object (since the length of the data frame is the same, we can use the date_bf as column to order the dates after)</span></span>
<span id="cb240-5"><a href="risk-and-return.html#cb240-5" aria-hidden="true" tabindex="-1"></a>A4ts_bf <span class="ot">&lt;-</span> <span class="fu">xts</span>(A4_bigfour, <span class="at">order.by =</span> date_bf)</span>
<span id="cb240-6"><a href="risk-and-return.html#cb240-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-7"><a href="risk-and-return.html#cb240-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we can create the weights. There are multiple options to do so, but I show just one:</span></span>
<span id="cb240-8"><a href="risk-and-return.html#cb240-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-9"><a href="risk-and-return.html#cb240-9" aria-hidden="true" tabindex="-1"></a><span class="do">## First, we take the sum of all the market capitalisations for each date</span></span>
<span id="cb240-10"><a href="risk-and-return.html#cb240-10" aria-hidden="true" tabindex="-1"></a>A4_marketcap <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(A4ts_bf, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb240-11"><a href="risk-and-return.html#cb240-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-12"><a href="risk-and-return.html#cb240-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Then we calculate the individual weights according to the overall market capitalisaiton</span></span>
<span id="cb240-13"><a href="risk-and-return.html#cb240-13" aria-hidden="true" tabindex="-1"></a>A4_weights <span class="ot">&lt;-</span> A4ts_bf <span class="sc">/</span> A4_marketcap</span>
<span id="cb240-14"><a href="risk-and-return.html#cb240-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-15"><a href="risk-and-return.html#cb240-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Lag the weights for one time period to avoid the look-ahead bias</span></span>
<span id="cb240-16"><a href="risk-and-return.html#cb240-16" aria-hidden="true" tabindex="-1"></a>A4_weights_lagged <span class="ot">&lt;-</span> <span class="fu">lag.xts</span>(A4_weights, <span class="dv">1</span>)</span>
<span id="cb240-17"><a href="risk-and-return.html#cb240-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-18"><a href="risk-and-return.html#cb240-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate the returns, given by the returns we calculated in A1ts_bf (discrete) times the lagged weights for each share </span></span>
<span id="cb240-19"><a href="risk-and-return.html#cb240-19" aria-hidden="true" tabindex="-1"></a>A4_returns <span class="ot">&lt;-</span> A1_bigfour_ret_ts <span class="sc">*</span> A4_weights_lagged</span>
<span id="cb240-20"><a href="risk-and-return.html#cb240-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-21"><a href="risk-and-return.html#cb240-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Now we sum this across all stock to get the portfolio return (rowSums()) since we already have the proportionally weighted returns, now their sum will deliver the actual VW return</span></span>
<span id="cb240-22"><a href="risk-and-return.html#cb240-22" aria-hidden="true" tabindex="-1"></a>Returns_VW_PF_A4 <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(A4_returns, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb240-23"><a href="risk-and-return.html#cb240-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-24"><a href="risk-and-return.html#cb240-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Define another date object</span></span>
<span id="cb240-25"><a href="risk-and-return.html#cb240-25" aria-hidden="true" tabindex="-1"></a>date_bf_A4 <span class="ot">=</span> <span class="fu">as.Date</span>(<span class="fu">dmy</span>(A1_bigfour[<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>]))</span>
<span id="cb240-26"><a href="risk-and-return.html#cb240-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-27"><a href="risk-and-return.html#cb240-27" aria-hidden="true" tabindex="-1"></a><span class="do">## Create xts object with correct number of dimensions</span></span>
<span id="cb240-28"><a href="risk-and-return.html#cb240-28" aria-hidden="true" tabindex="-1"></a>bigfour_VW_ret_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(Returns_VW_PF_A4, <span class="at">order.by =</span> date_bf_A4)</span></code></pre></div>
<p>To see the comparison of equal and value weighted returns, let’s look at the cumulative return structure of both:</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="risk-and-return.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, transform the variable &quot;bigfour_EW_ret_ts&quot; into an xts object</span></span>
<span id="cb241-2"><a href="risk-and-return.html#cb241-2" aria-hidden="true" tabindex="-1"></a>bigfour_EW_ret_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(bigfour_EW_ret_ts, <span class="at">order.by =</span> date_bf_A4)</span>
<span id="cb241-3"><a href="risk-and-return.html#cb241-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-4"><a href="risk-and-return.html#cb241-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the cumprod for value weighted and equal weighted returns for a given time-frame</span></span>
<span id="cb241-5"><a href="risk-and-return.html#cb241-5" aria-hidden="true" tabindex="-1"></a>Bigfour_cp_VW <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">+</span>bigfour_VW_ret_ts[<span class="st">&#39;1988-07-29/2000-12-29&#39;</span>])</span>
<span id="cb241-6"><a href="risk-and-return.html#cb241-6" aria-hidden="true" tabindex="-1"></a>Bigfour_cp_EW <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">+</span>bigfour_EW_ret_ts[<span class="st">&#39;1988-07-29/2000-12-29&#39;</span>])</span>
<span id="cb241-7"><a href="risk-and-return.html#cb241-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-8"><a href="risk-and-return.html#cb241-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the data merged:</span></span>
<span id="cb241-9"><a href="risk-and-return.html#cb241-9" aria-hidden="true" tabindex="-1"></a>cum_ret_EW_VW_bigfour <span class="ot">&lt;-</span> <span class="fu">merge.xts</span>(Bigfour_cp_VW, Bigfour_cp_EW)</span>
<span id="cb241-10"><a href="risk-and-return.html#cb241-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-11"><a href="risk-and-return.html#cb241-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Change the names of the columns</span></span>
<span id="cb241-12"><a href="risk-and-return.html#cb241-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cum_ret_EW_VW_bigfour) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Value-Weighted Return&quot;</span>, <span class="st">&quot;Equal-weighted Return&quot;</span>)</span>
<span id="cb241-13"><a href="risk-and-return.html#cb241-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb241-14"><a href="risk-and-return.html#cb241-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the relationship</span></span>
<span id="cb241-15"><a href="risk-and-return.html#cb241-15" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(cum_ret_EW_VW_bigfour) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>index,<span class="at">y=</span> value, <span class="at">color=</span>series)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb241-16"><a href="risk-and-return.html#cb241-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;goldenrod&quot;</span>, <span class="st">&quot;dodgerblue4&quot;</span>,</span>
<span id="cb241-17"><a href="risk-and-return.html#cb241-17" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;dodgerblue1&quot;</span>, <span class="st">&quot;darkorchid4&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb241-18"><a href="risk-and-return.html#cb241-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">&quot;Cumulative Returns&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Cumulative Return of the Big Four from 1988 to 2000&quot;</span>) <span class="sc">+</span></span>
<span id="cb241-19"><a href="risk-and-return.html#cb241-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Cumulative Return&#39;</span>) <span class="sc">+</span></span>
<span id="cb241-20"><a href="risk-and-return.html#cb241-20" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb241-21"><a href="risk-and-return.html#cb241-21" aria-hidden="true" tabindex="-1"></a><span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb241-22"><a href="risk-and-return.html#cb241-22" aria-hidden="true" tabindex="-1"></a><span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb241-23"><a href="risk-and-return.html#cb241-23" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb241-24"><a href="risk-and-return.html#cb241-24" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb241-25"><a href="risk-and-return.html#cb241-25" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb241-26"><a href="risk-and-return.html#cb241-26" aria-hidden="true" tabindex="-1"></a><span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb241-27"><a href="risk-and-return.html#cb241-27" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb241-28"><a href="risk-and-return.html#cb241-28" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb241-29"><a href="risk-and-return.html#cb241-29" aria-hidden="true" tabindex="-1"></a><span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-155-1.png" width="672" /></p>
</div>
<div id="timing-of-returns" class="section level3" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> Timing of Returns</h3>
<p>An interesting property of returns is their timing character. That is, depending on when you invest, it may take you longer to derive a positive profit from your investment than in other times.</p>
<p>To see this, we can easily consult the cumulative return metrics again. Note from theory that we understand a positive profit to be once the cumulative return is larger than 1 for a given time period.</p>
<p>For instance, we may ask how long it takes us to derive a positive return if we had invested right before the financial crisis, in May 2007.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="risk-and-return.html#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s create the cum return series for both value- and equal-weighted portfolios of the big four. </span></span>
<span id="cb242-2"><a href="risk-and-return.html#cb242-2" aria-hidden="true" tabindex="-1"></a>cum_ret_EW_Financial <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> bigfour_EW_ret_ts[<span class="st">&#39;2007-06-01/2021-02-26&#39;</span>])</span>
<span id="cb242-3"><a href="risk-and-return.html#cb242-3" aria-hidden="true" tabindex="-1"></a>cum_ret_VW_Financial <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(<span class="dv">1</span> <span class="sc">+</span> bigfour_VW_ret_ts[<span class="st">&#39;2007-06-01/2021-02-26&#39;</span>])</span>
<span id="cb242-4"><a href="risk-and-return.html#cb242-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-5"><a href="risk-and-return.html#cb242-5" aria-hidden="true" tabindex="-1"></a><span class="co"># This command reports all values which were in this time above 1, so higher than the initial return on the beginning of the financial crisis </span></span>
<span id="cb242-6"><a href="risk-and-return.html#cb242-6" aria-hidden="true" tabindex="-1"></a>EW_Positive_After_Financial <span class="ot">&lt;-</span> <span class="fu">subset</span>(cum_ret_EW_Financial, cum_ret_EW_Financial <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb242-7"><a href="risk-and-return.html#cb242-7" aria-hidden="true" tabindex="-1"></a>VW_Positive_After_Financial <span class="ot">&lt;-</span> <span class="fu">subset</span>(cum_ret_VW_Financial, cum_ret_EW_Financial <span class="sc">&gt;=</span> <span class="dv">1</span>)</span>
<span id="cb242-8"><a href="risk-and-return.html#cb242-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-9"><a href="risk-and-return.html#cb242-9" aria-hidden="true" tabindex="-1"></a><span class="co"># This command returns the first of said values </span></span>
<span id="cb242-10"><a href="risk-and-return.html#cb242-10" aria-hidden="true" tabindex="-1"></a>EW_First_Positive_After_Financial <span class="ot">&lt;-</span> EW_Positive_After_Financial[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>),<span class="dv">1</span>]</span>
<span id="cb242-11"><a href="risk-and-return.html#cb242-11" aria-hidden="true" tabindex="-1"></a>VW_First_Positive_After_Financial <span class="ot">&lt;-</span> VW_Positive_After_Financial[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>),<span class="dv">1</span>]</span>
<span id="cb242-12"><a href="risk-and-return.html#cb242-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-13"><a href="risk-and-return.html#cb242-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we get the dates for both returns</span></span>
<span id="cb242-14"><a href="risk-and-return.html#cb242-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;When investing just before the Financial Crisis, the EW Big Four portfolio reaches its first positive return on &quot;</span>, <span class="fu">as.Date</span>(<span class="fu">as.POSIXct</span>(EW_Positive_After_Financial[<span class="dv">1</span>,<span class="dv">0</span>])),</span>
<span id="cb242-15"><a href="risk-and-return.html#cb242-15" aria-hidden="true" tabindex="-1"></a>             <span class="st">&quot;. When investing just before the Financial Crisis, the VW Big Four portfolio reaches its first positive return on &quot;</span>, <span class="fu">as.Date</span>(<span class="fu">as.POSIXct</span>(VW_Positive_After_Financial[<span class="dv">1</span>,<span class="dv">0</span>]))))</span></code></pre></div>
<pre><code>## [1] &quot;When investing just before the Financial Crisis, the EW Big Four portfolio reaches its first positive return on 2014-02-28. When investing just before the Financial Crisis, the VW Big Four portfolio reaches its first positive return on 2014-02-28&quot;</code></pre>
</div>
<div id="nominal-vs.-real-returns" class="section level3" number="3.3.4">
<h3><span class="header-section-number">3.3.4</span> Nominal vs. Real Returns</h3>
<p>The concept of inflation plays an important role in asset management. Inflation is regarded as a hidden cost variable, since it indirectly reduces the overall return by adding a factor for price developments. In other words, inflation decides how much worth your money has, to put it bluntly. If inflation is positive, then prices increase and, as such, for CHF 1.- you can consume less. On the other hand, if inflation is negative, then CHF 1.- can get you a higher consumption and thus is worth more.</p>
<p>As inflation is not measurable directly, we need to use some proxies that we believe adequately represent the pricing adjustments. One such method is to use available <strong>Consumer Price Index data</strong>. The CPI measures the change in prices of goods and services which are representative of the private households’ consumption in Switzerland. It indicates how much consumers have to increase or to decrease their expenditure to maintain the same volume of consumption, despite the variations in prices.</p>
<p>Consequently, by analysing the CPI, we can proxy inflation levels for Switzerland. To do so, we need to calculate the returns of the CPI. That is:</p>
<p><span class="math display">\[
Inflation_{i,t} = \frac{CPI_{i,t}}{CPI_{i,t-1}} - 1
\]</span></p>
<p>Whereas <span class="math inline">\(Inflation_{i,t}\)</span> is the inflation of country i at time t and <span class="math inline">\(CPI_{i,t}\)</span> is the Consumer Price Index of country i at time t.</p>
<p>Using CPI-adjustments is important to understand the difference between <strong>nominal returns</strong> and <strong>real returns</strong>.</p>
<ul>
<li>The nominal return on an investment is the money made without factoring expenses, such as inflation, taxes, and fees.</li>
<li>The real return on an investment is the return made on an investment after subtracting costs, such as inflation, taxes, and fees.</li>
</ul>
<p>In general, we derive the real return by subtracting non-avoidable expenses that mitigate the actual return of our investment from the pure financial return we would hypothetically have achieved if no other costs had occurred.</p>
<p>Real and Nominal Returns have the followinf mathematical relationship:</p>
<p><span class="math display">\[
R_{p,t}^{Real} = \frac{1+R_{p,t}}{1+Inflation_{i,t}} - 1
\]</span></p>
<p>Whereas <span class="math inline">\(R_{p,t}\)</span> is the nominal portfolio return of portfolio p at time t, <span class="math inline">\(Inflation_{i,t}\)</span> is the inflation of country i at time t and <span class="math inline">\(R_{p,t}^{Real}\)</span> is the corresponding real return.</p>
<p>To understand how inflation works in our asset management setting, it is important to calculate and visualize the different portfolio returns.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="risk-and-return.html#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, load the consumer price index data</span></span>
<span id="cb244-2"><a href="risk-and-return.html#cb244-2" aria-hidden="true" tabindex="-1"></a>CPI_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;/Users/nikolasanic/Desktop/Master UZH/Data/A1_dataset_05_Ex_Session.txt&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb244-3"><a href="risk-and-return.html#cb244-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-4"><a href="risk-and-return.html#cb244-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a time-series object</span></span>
<span id="cb244-5"><a href="risk-and-return.html#cb244-5" aria-hidden="true" tabindex="-1"></a>CPI_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(CPI_data[,<span class="dv">1</span>])</span>
<span id="cb244-6"><a href="risk-and-return.html#cb244-6" aria-hidden="true" tabindex="-1"></a>CPI_data_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(CPI_data[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> CPI_date)</span>
<span id="cb244-7"><a href="risk-and-return.html#cb244-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-8"><a href="risk-and-return.html#cb244-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the returns of the CPI (to calculate the inflation yearly as (CPI_t - CPI_{t-1})/ CPI_{t-1})</span></span>
<span id="cb244-9"><a href="risk-and-return.html#cb244-9" aria-hidden="true" tabindex="-1"></a>Inflation <span class="ot">&lt;-</span> <span class="fu">Return.calculate</span>(CPI_data_ts, <span class="at">method =</span> <span class="st">&quot;discrete&quot;</span>)</span>
<span id="cb244-10"><a href="risk-and-return.html#cb244-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-11"><a href="risk-and-return.html#cb244-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Only take the specific column we are interested in and delete the first row</span></span>
<span id="cb244-12"><a href="risk-and-return.html#cb244-12" aria-hidden="true" tabindex="-1"></a>Inflation <span class="ot">&lt;-</span> Inflation[<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>]</span>
<span id="cb244-13"><a href="risk-and-return.html#cb244-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-14"><a href="risk-and-return.html#cb244-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the real return, inflation adjusted</span></span>
<span id="cb244-15"><a href="risk-and-return.html#cb244-15" aria-hidden="true" tabindex="-1"></a>Inflation_Adjusted_bigfour_EW_ret_ts <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> bigfour_EW_ret_ts[<span class="st">&#39;1988-07-29/2000-12-29&#39;</span>]) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> Inflation[<span class="st">&#39;1988-07-29/2000-12-29&#39;</span>]) <span class="sc">-</span><span class="dv">1</span></span>
<span id="cb244-16"><a href="risk-and-return.html#cb244-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-17"><a href="risk-and-return.html#cb244-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the cumulative product again</span></span>
<span id="cb244-18"><a href="risk-and-return.html#cb244-18" aria-hidden="true" tabindex="-1"></a>Bigfour_cp_EW_real <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">+</span>Inflation_Adjusted_bigfour_EW_ret_ts[<span class="st">&#39;1988-07-29/2000-12-29&#39;</span>])</span>
<span id="cb244-19"><a href="risk-and-return.html#cb244-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-20"><a href="risk-and-return.html#cb244-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we can plot the underlying relationship</span></span>
<span id="cb244-21"><a href="risk-and-return.html#cb244-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-22"><a href="risk-and-return.html#cb244-22" aria-hidden="true" tabindex="-1"></a><span class="do">## First, get the cumprod() of the inflation to understand the behaviour over time</span></span>
<span id="cb244-23"><a href="risk-and-return.html#cb244-23" aria-hidden="true" tabindex="-1"></a>inflation_cp <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">+</span>Inflation[<span class="st">&#39;1988-07-29/2000-12-29&#39;</span>])</span>
<span id="cb244-24"><a href="risk-and-return.html#cb244-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-25"><a href="risk-and-return.html#cb244-25" aria-hidden="true" tabindex="-1"></a><span class="do">## Then merge the dataframes and assign correct names</span></span>
<span id="cb244-26"><a href="risk-and-return.html#cb244-26" aria-hidden="true" tabindex="-1"></a>inflation_data <span class="ot">&lt;-</span> <span class="fu">merge.xts</span>(Bigfour_cp_EW[<span class="st">&#39;1988-07-29/2000-12-29&#39;</span>], Bigfour_cp_EW_real[<span class="st">&#39;1988-07-29/2000-12-29&#39;</span>], inflation_cp[<span class="st">&#39;1988-07-29/2000-12-29&#39;</span>])</span>
<span id="cb244-27"><a href="risk-and-return.html#cb244-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-28"><a href="risk-and-return.html#cb244-28" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(inflation_data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Nominal Return&quot;</span>, <span class="st">&quot;Real Return&quot;</span>, <span class="st">&quot;Inflation&quot;</span>)</span>
<span id="cb244-29"><a href="risk-and-return.html#cb244-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-30"><a href="risk-and-return.html#cb244-30" aria-hidden="true" tabindex="-1"></a><span class="do">##  Plot the relationship</span></span>
<span id="cb244-31"><a href="risk-and-return.html#cb244-31" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(inflation_data) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>index,<span class="at">y=</span> value, <span class="at">color=</span>series)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb244-32"><a href="risk-and-return.html#cb244-32" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;goldenrod&quot;</span>, <span class="st">&quot;dodgerblue1&quot;</span>,</span>
<span id="cb244-33"><a href="risk-and-return.html#cb244-33" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;darkorchid4&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb244-34"><a href="risk-and-return.html#cb244-34" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">&quot;Cumulative Returns&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Cumulative Return of the Big Four from 1988 to 2000, Real and Nominal&quot;</span>) <span class="sc">+</span></span>
<span id="cb244-35"><a href="risk-and-return.html#cb244-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Cumulative Return&#39;</span>) <span class="sc">+</span></span>
<span id="cb244-36"><a href="risk-and-return.html#cb244-36" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb244-37"><a href="risk-and-return.html#cb244-37" aria-hidden="true" tabindex="-1"></a><span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb244-38"><a href="risk-and-return.html#cb244-38" aria-hidden="true" tabindex="-1"></a><span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb244-39"><a href="risk-and-return.html#cb244-39" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb244-40"><a href="risk-and-return.html#cb244-40" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb244-41"><a href="risk-and-return.html#cb244-41" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb244-42"><a href="risk-and-return.html#cb244-42" aria-hidden="true" tabindex="-1"></a><span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb244-43"><a href="risk-and-return.html#cb244-43" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb244-44"><a href="risk-and-return.html#cb244-44" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb244-45"><a href="risk-and-return.html#cb244-45" aria-hidden="true" tabindex="-1"></a><span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-157-1.png" width="672" /></p>
<p>As we can see, the increase in the difference between nominal and real return is explained by the increase in Inflation for the period from approximately 1992 on.</p>
</div>
</div>
<div id="individual-security-risk" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Individual Security Risk</h2>
<p>Risk is the other major concept in Asset Management. In essence, risk defines the extent to which the exact level of our return is uncertain. This is also known as level of <strong>volatility</strong> that individual assets have. Most investments inherently contain some level of risk. As regular individual investors, we are unlikely to take advantage of any mispricing in the market and create arbitrage profits. Consequently, there is no financial instrument with a non-zero risk component. The closest instrument to a truly risk-free security is a short maturity US Treasury security. This is because the likelihood of the US government defaulting on very short-term obligations is extremely low and other risks, such as inflation risk and liquidity risk, are also negligible for very short maturities.</p>
<div id="standard-deviation-and-variance" class="section level3" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> Standard Deviation and Variance</h3>
<p>Although we can fairly easily understand the notion of risk, it is quite impossible to find a truly unbiased metric to quantify it. As such, a measure that quantifies all attributes of risk still eludes us. Thus, the measures of risk we use today, including those we discuss in this chapter, are all imperfect measures of risk.</p>
<p>Despite this, two of the most important metrics in quantifying the risk of an asset that comes from its underlying volatility are <strong>Variance</strong> and <strong>Standard Deviation</strong>.</p>
<p>We already discusses both metrics in Chapter 1, so we will only look at their application in a portfolio context here. Remember that the volatility is calculated as the average, squared difference between individual security returns and its mean return. As such, it is the average distance that each datapoint has to its corresponding “center”. We square the distance because we say that both positive and negative deviations from the expected value are considered risk (although sometimes we only care for negative deviations).</p>
<p>The Variance is calculated as:</p>
<p><span class="math display">\[
\sigma_i^2 = \frac{1}{T-1}\sum_{t=1}^T (R_{i,t} - \bar{R_i})^2
\]</span></p>
<p>And the Standard Deviation is defined as its square root, <span class="math inline">\(\sigma = \sqrt{\sigma^2}\)</span></p>
<p>In order to calculate the variance and standard deviation, we just use the functions <code>var()</code> and <code>sd()</code></p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="risk-and-return.html#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s take the Roche example again</span></span>
<span id="cb245-2"><a href="risk-and-return.html#cb245-2" aria-hidden="true" tabindex="-1"></a>variance_roche <span class="ot">&lt;-</span> <span class="fu">var</span>(A1_return_Roche_function_ts, <span class="at">na.rm =</span> T)</span>
<span id="cb245-3"><a href="risk-and-return.html#cb245-3" aria-hidden="true" tabindex="-1"></a>sd_roche <span class="ot">&lt;-</span> <span class="fu">sd</span>(A1_return_Roche_function_ts, <span class="at">na.rm =</span> T)</span></code></pre></div>
<p>As with returns, it is important to understand how we work with different periodicities of the underlying risk variables. To recap what we have seen in the lecture related to different time horizons, we understand that <strong>as number of periods (T) increases the variance of the total return increases linearly</strong> and <strong>Standard deviation increases by</strong> <span class="math inline">\(\sqrt{T}\)</span>.</p>
<p>This is due to the additivity property we have seen. This implies that if we have identically (the bets are the same) and independent returns (the outcome of the bet today has no impact on the outcome of the bet in the next period) over time, then the overall variance <span class="math inline">\(\sum_{i=1}^T R_{i}\)</span> of total return will increase in periods:</p>
<p><span class="math display">\[
\begin{align}
Var(\sum_{t=1}^T R_{i}) &amp;= \sum_{i=1}^T \sum_{j=1}^T \sigma_{i,j} \\ 
&amp;= \sum_{t=1}^T\sigma_i^2 &amp;&amp; \text{Independence Property: whenever i is not equal to j, then } \sigma_{ij} = 0 \text{ (as no covariation)}\\
&amp;= T\sigma_i^2 &amp;&amp; \text{Identically Distributed Property: } \sigma_i = \sigma_j
\end{align}
\]</span></p>
<p>Given this notion, we understand that, in case of IID settings, we can annualise the standard deviation from daily as is:</p>
<p><span class="math display">\[
\sigma_i^{Annual} = \sigma_i*\sqrt{365}
\]</span></p>
</div>
</div>
<div id="rolling-risk-characteristics" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Rolling Risk Characteristics</h2>
<p>Another important property of risk and return is dynamic factorisation of the underlying metrics. Although this sounds difficult, it actually is quite straight-forward. In essence, we use rolling measures of risk if we have a time series and want the standard deviation for a moving window.</p>
<p>Transforming properties into a moving window roots in the idea of time-series dependence of returns. In general, we need to account for the fact that future returns are somehow related to past returns. However, we do not know how strong this relation is and how long this relation goes. As the market characteristics change constantly, we cannot ensure that returns from five years ago, when measured daily, have a material effect on current returns. Consequently, we need to account for the fact that time-series dependencies are limited and that returns that are too distant in the past may pose no real explanatory potential any longer. Exactly this idea is what then motivates us to use a rolling, or moving, approach when calculating portfolio metrics.</p>
<p>In essence, when calculating a metric on a rolling basis, we define the time horizon, or width, of the function. Then, instead of taking the entire time-series up to the current date to calculate the metric, we just take a time-series of width T. Like that, we only take the T most recent observations to calculate the current measure. Then, for the next day, we shift by one day and calculate the metric for the new day accordingly.</p>
<p>As such, a rolling risk metric is nothing else than a risk metric that is defined based on a shorter past time horizon. To use something in a rolling fashion implies to use it more dynamically than we would when considering the entire time horizon. We implement rolling risk metrics with the <code>roll()</code> package. This is a package that provides fast and efficient computation of rolling and expanding statistics for time-series data.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="risk-and-return.html#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To show the roll function, let&#39;s take the Big Four data again:</span></span>
<span id="cb246-2"><a href="risk-and-return.html#cb246-2" aria-hidden="true" tabindex="-1"></a>bigfour_EW_ret_ts_sd <span class="ot">&lt;-</span> <span class="fu">roll_sd</span>(bigfour_EW_ret_ts, <span class="at">width =</span> <span class="dv">6</span>, <span class="at">na_restore =</span> T)</span>
<span id="cb246-3"><a href="risk-and-return.html#cb246-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-4"><a href="risk-and-return.html#cb246-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">as.data.frame</span>(bigfour_EW_ret_ts_sd), <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##                    V1
## 1988-07-29         NA
## 1988-08-31         NA
## 1988-09-30         NA
## 1988-10-31         NA
## 1988-11-30         NA
## 1988-12-30 0.02169773
## 1989-01-31 0.02133929
## 1989-02-28 0.03430699
## 1989-03-31 0.03639847
## 1989-04-28 0.03715299</code></pre>
<p>What appears here is that the first five observations are all NA. This is intuitive, as the standard deviation consists of the five most recent returns only and then is updated each period accordingly. As a consequence, we only have a sufficient amount of observations from period 6 on. Thereby, R has not enough observations in Periods one to five and thus assigns a NA output.</p>
<p>As a side note, you can use the package to calculate any type of rolling metric, such as <code>roll_mean()</code>, <code>roll_var()</code> <code>roll_cov()</code>, <code>roll_lm()</code> or <code>roll_quantile()</code>, to name a few. In order to get the entire options of the package, visit .</p>
</div>
<div id="portfolio-risk" class="section level2" number="3.6">
<h2><span class="header-section-number">3.6</span> Portfolio Risk</h2>
<p>The previous section discusses how to calculate risk for an individual security. However, most investments are done in the context of a portfolio of securities. To understand portfolio risk, it is important to comprehend the fundamental notion of portfolio covariation based on the dependence structure of the underlying assets.</p>
<p>Recapitulate quickly Chapter 3. In the Matrix Algebra section, we have seen that the <strong>covariance</strong> is important when assessing risk in the context of a portfolio. We stated that, unless assets are independent of each other, the covariance will contribute a certain part to the overall portfolio risk. In Chapter 3.2.6.2 we derived how to calculate the variance of a linear combination of random vectors. Then, in Chapter 3.2.7 we saw how to apply this linear combination within a portfolio setting.</p>
<div id="portfolio-risk-of-two-securities" class="section level3" number="3.6.1">
<h3><span class="header-section-number">3.6.1</span> Portfolio Risk of two securities</h3>
<p>To apply the theory from Chapter 3 to the portfolio setting, it is easiest if we start with the two asset case. As we derived, the risk of a portfolio with two assets is:</p>
<p><span class="math display">\[
\sigma_p^2 = w_1^2\sigma_1^2 + w_2^2\sigma_2^2 + 2w_1w_2\sigma_{12}
\]</span></p>
<p>Whereas <span class="math inline">\(\sigma_{12}\)</span> is the covariance coefficient between both assets and is calculated as: <span class="math inline">\(\sigma_{12} = \rho_{12}\sigma_1\sigma_2\)</span>. Further <span class="math inline">\(w_i\)</span> is the respective portfolio weight and <span class="math inline">\(\sigma_i^2\)</span> is the respective variance of the security.</p>
<p>As with the return, we can calculate the risk characteristic in two different ways: With summation or with Matrix Algebra.</p>
<p>We start again with the summation case:</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="risk-and-return.html#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First we take the Big Four PF but we only take the Roche_Holding and the Nestle_PS columns</span></span>
<span id="cb248-2"><a href="risk-and-return.html#cb248-2" aria-hidden="true" tabindex="-1"></a>NR_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(A1_bigfour_ret_ts[,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">7</span>)])</span>
<span id="cb248-3"><a href="risk-and-return.html#cb248-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-4"><a href="risk-and-return.html#cb248-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we calculate the respective standard deviation and covariance metrics</span></span>
<span id="cb248-5"><a href="risk-and-return.html#cb248-5" aria-hidden="true" tabindex="-1"></a>NR_df_N_sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(NR_df<span class="sc">$</span>Nestle_PS)</span>
<span id="cb248-6"><a href="risk-and-return.html#cb248-6" aria-hidden="true" tabindex="-1"></a>NR_df_R_sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(NR_df<span class="sc">$</span>Roche_Holding)</span>
<span id="cb248-7"><a href="risk-and-return.html#cb248-7" aria-hidden="true" tabindex="-1"></a>NR_df_cov <span class="ot">&lt;-</span> <span class="fu">cov</span>(NR_df<span class="sc">$</span>Nestle_PS, NR_df<span class="sc">$</span>Roche_Holding)</span>
<span id="cb248-8"><a href="risk-and-return.html#cb248-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-9"><a href="risk-and-return.html#cb248-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we calculate the PF risk according to the formula above</span></span>
<span id="cb248-10"><a href="risk-and-return.html#cb248-10" aria-hidden="true" tabindex="-1"></a>NR_PF_Risk_EW <span class="ot">&lt;-</span> NR_df_N_sd<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="fl">0.5</span><span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> NR_df_R_sd<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span><span class="fl">0.5</span><span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span><span class="fl">0.5</span><span class="sc">*</span><span class="fl">0.5</span><span class="sc">*</span>NR_df_cov</span>
<span id="cb248-11"><a href="risk-and-return.html#cb248-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-12"><a href="risk-and-return.html#cb248-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Lastly, we annualise it from monthly observations</span></span>
<span id="cb248-13"><a href="risk-and-return.html#cb248-13" aria-hidden="true" tabindex="-1"></a>NR_PF_Risk_EW_ann <span class="ot">&lt;-</span> NR_PF_Risk_EW<span class="sc">*</span><span class="fu">sqrt</span>(<span class="dv">12</span>)</span></code></pre></div>
<p>We can also calculate this in Matrix Form. To recapitulate, we derived that the general portfolio variance is calculated as:</p>
<p><span class="math display">\[
\begin{align}
var(\textbf{w}&#39;\textbf{R}) &amp;= w&#39;\Sigma w 
\end{align}
\]</span>
Note that we deliberately use w instead of x to acknowledge that this is the <em>weighted portfolio risk</em> formula.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="risk-and-return.html#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First we take the Big Four PF but we only take the Roche_Holding and the Nestle_PS columns</span></span>
<span id="cb249-2"><a href="risk-and-return.html#cb249-2" aria-hidden="true" tabindex="-1"></a>NR_df <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(A1_bigfour_ret_ts[,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">7</span>)])</span>
<span id="cb249-3"><a href="risk-and-return.html#cb249-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-4"><a href="risk-and-return.html#cb249-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we calculate the respective covariance metrics</span></span>
<span id="cb249-5"><a href="risk-and-return.html#cb249-5" aria-hidden="true" tabindex="-1"></a>NR_df_cov <span class="ot">&lt;-</span> <span class="fu">cov</span>(NR_df)</span>
<span id="cb249-6"><a href="risk-and-return.html#cb249-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-7"><a href="risk-and-return.html#cb249-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we can create a vector consisting of average weights. Here, we have two securities, so each return will be multiplied with 1/2. </span></span>
<span id="cb249-8"><a href="risk-and-return.html#cb249-8" aria-hidden="true" tabindex="-1"></a>weight_vector <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">length</span>(NR_df[<span class="dv">1</span>,]),<span class="at">each=</span><span class="fu">length</span>(NR_df[<span class="dv">1</span>,])), <span class="dv">1</span>)</span>
<span id="cb249-9"><a href="risk-and-return.html#cb249-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-10"><a href="risk-and-return.html#cb249-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Lastly, we take the formula above and calculate the portfolio risk</span></span>
<span id="cb249-11"><a href="risk-and-return.html#cb249-11" aria-hidden="true" tabindex="-1"></a>NR_PF_Risk_EW_matmul <span class="ot">&lt;-</span> weight_vector <span class="sc">%*%</span> NR_df_cov <span class="sc">%*%</span> <span class="fu">t</span>(weight_vector)</span>
<span id="cb249-12"><a href="risk-and-return.html#cb249-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-13"><a href="risk-and-return.html#cb249-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s see again if they are identical:</span></span>
<span id="cb249-14"><a href="risk-and-return.html#cb249-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="fu">round</span>(NR_PF_Risk_EW_matmul,<span class="dv">7</span>) <span class="sc">==</span> <span class="fu">round</span>(NR_PF_Risk_EW,<span class="dv">7</span>), <span class="st">&quot;Both calculations are identical&quot;</span>, <span class="dv">0</span>)</span></code></pre></div>
<pre><code>##      [,1]                             
## [1,] &quot;Both calculations are identical&quot;</code></pre>
<p>As we can see, both ways to derive the portfolio risk are identical.</p>
</div>
<div id="portfolio-risk-for-multiple-assets" class="section level3" number="3.6.2">
<h3><span class="header-section-number">3.6.2</span> Portfolio Risk for Multiple Assets</h3>
<p>We can easily extend the idea behind portfolio risk for the general case of N variables by simply using the exactly same formulas as for the two assets case. However, when we start introducing a larger portfolio, we may notice something interesting. In particular, when we add assets that are not perfectly correlated with the securities in our portfolio, the overall risk of the portfolio decreases.This evidence was first introduced by Markowitz in 1950 and is known as <strong>Diversification</strong>. It constitutes one of the <strong>fundamental theorems of Portfolio Theory</strong>. Consequently, the risk of a well-diversified portfolio is lower than that of its individual counterparts. To understand the logic behind this, it is handy to look at the mathematical formulation. Let’s start again with the portfolio variance in the general case of N (not perfectly correlated) assets:</p>
<p><span class="math display">\[
\begin{align}
var(\textbf{w}&#39;\textbf{R}) &amp;= w&#39;\Sigma w \\
&amp;= \underbrace{\sum_{i=1}^N w_i\sigma_i^2}_{\text{sum of the weighted variances}} + \underbrace{\sum_{i=1}^N\sum_{j = 1, i \neq j}^N w_iw_j\sigma_{ij}}_{\text{sum of the weighted covariances}}
\end{align}
\]</span>
As we understand, the variance of a portfolio consists of the weighted sum of its constituents as well as its covariance, given the assumption that the movements of the stocks are not independent from each other. Rephrasing of the Equation above results in Markowitz’s (1950) famous formula for portfolio risk.</p>
<p><span class="math display">\[
\begin{align}
var(\textbf{w}&#39;\textbf{R}) &amp;= \frac{1}{n}\bar{\sigma_i}^2 + \frac{n-1}{n}\bar{\sigma}_{ij} \\
&amp;= \underbrace{\frac{1}{n}\bar{\sigma_i}^2}_{\text{Average Variance}} + \underbrace{\left(1 - \frac{1}{n}\right)\bar{\sigma}_{ij}}_{\text{Average scaled covariance}}
\end{align}
\]</span>
Here, we can see the Average Variance as well as the Average scaled Covariance. In general notion, these two terms are the <strong>Idiosyncratic</strong> as well as the <strong>Systematic</strong> part of portfolio risk. To understand why both parts are called accordingly, it is important to define the portfolio risk regarding its dependence on the portfolio size N. As we can see, both parts depend on the number of securities within a portfolio. Consequently, once we increase N, (=as N approaches infinity), the first term gradually approaches zero, whereas the latter increases monotonically.</p>
<p>As such, the Average Variance will approach zero and is thus called the <strong>Idiosyncratic Part</strong> of the portfolio risk, since it can be <strong>diversified away</strong> with an increasing portfolio size. However, the latter part will, in the extreme case of <span class="math inline">\(n \rightarrow \infty\)</span>, be exactly the average covariance between the assets. This is thus called the <strong>Systematic Part</strong> of the portfolio risk, since it <strong>cannot</strong> be diversified away with increasing portfolio size. Thereby, this latter term only depends on portfolio selection abilities, as a well-diversified portfolio of the manager, in theory, aims at reducing the co-dependence of its constituents to decrease overall volatility.</p>
<p>To see this principle in action, let’s take the Big Four portfolio again. Here, we will see a small example that enables you to understand how an increasing portfolio size leads to a lower portfolio risk. Note that I will make use of for loops here as there is much repetition in the code otherwise. But don’t worry, I’ll explain every step.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="risk-and-return.html#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, we need to delete the first column as this has so few observations that we cannot coerce it with any other values. </span></span>
<span id="cb251-2"><a href="risk-and-return.html#cb251-2" aria-hidden="true" tabindex="-1"></a>A4_returns_cap <span class="ot">&lt;-</span> A4_returns[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb251-3"><a href="risk-and-return.html#cb251-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-4"><a href="risk-and-return.html#cb251-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We start by defining the following for loop:</span></span>
<span id="cb251-5"><a href="risk-and-return.html#cb251-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-6"><a href="risk-and-return.html#cb251-6" aria-hidden="true" tabindex="-1"></a><span class="do">## As we know the usual form of a loop is given by: for(i in ... ) {</span></span>
<span id="cb251-7"><a href="risk-and-return.html#cb251-7" aria-hidden="true" tabindex="-1"></a> <span class="do">## some conditions </span></span>
<span id="cb251-8"><a href="risk-and-return.html#cb251-8" aria-hidden="true" tabindex="-1"></a><span class="do">## }</span></span>
<span id="cb251-9"><a href="risk-and-return.html#cb251-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-10"><a href="risk-and-return.html#cb251-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(A4_returns_cap)){ </span>
<span id="cb251-11"><a href="risk-and-return.html#cb251-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb251-12"><a href="risk-and-return.html#cb251-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Here, we say we go through each column of the A4_returns_cap data frame. That is, we tell R to loop through each column of that data frame to get the PF risk for each column. </span></span>
<span id="cb251-13"><a href="risk-and-return.html#cb251-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb251-14"><a href="risk-and-return.html#cb251-14" aria-hidden="true" tabindex="-1"></a>  weight_vector <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">length</span>(A4_returns_cap[<span class="dv">1</span>, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>i)]),<span class="at">each=</span><span class="fu">length</span>(A4_returns_cap[<span class="dv">1</span>, <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>i)])), <span class="dv">1</span>)</span>
<span id="cb251-15"><a href="risk-and-return.html#cb251-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb251-16"><a href="risk-and-return.html#cb251-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remember we want to calculate the PF risk according to the matrix algebra formula from above. To do so, we first need the weight vector. This is done as we did it before. </span></span>
<span id="cb251-17"><a href="risk-and-return.html#cb251-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb251-18"><a href="risk-and-return.html#cb251-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># That is: </span></span>
<span id="cb251-19"><a href="risk-and-return.html#cb251-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb251-20"><a href="risk-and-return.html#cb251-20" aria-hidden="true" tabindex="-1"></a>    <span class="do">## 1) We create a matrix by entering repeated fractions (e.g. if we have two, then we get 1/length(A4_returns_cap[1, c(1:2)]) = 1/2 and repeat this fraction: length(A4_returns_cap[1, c(1:2)])) = 2 times --&gt; giving the vector [0.5, 0.5])</span></span>
<span id="cb251-21"><a href="risk-and-return.html#cb251-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb251-22"><a href="risk-and-return.html#cb251-22" aria-hidden="true" tabindex="-1"></a>    <span class="do">## 2) Since we want to see how the PF risk changes when adding more stocks, we need to do this for an increasing stock combination. That is what [1, c(1:i)] does. The c(1:i) defines how many columns should be used to calculate the weight vector. Since we defined i as being each number of column elements (in our case: 1,2,3,4,5), we can easily loop over each column and thereby include one column more in each loop. </span></span>
<span id="cb251-23"><a href="risk-and-return.html#cb251-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb251-24"><a href="risk-and-return.html#cb251-24" aria-hidden="true" tabindex="-1"></a>  cov_matrix <span class="ot">&lt;-</span> <span class="fu">cov</span>(<span class="fu">na.omit</span>(A4_returns_cap[,<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span>i)]))</span>
<span id="cb251-25"><a href="risk-and-return.html#cb251-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb251-26"><a href="risk-and-return.html#cb251-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Here, we copy the logic from above but just calculate the covariance matrix. Note that, in order not to get a matrix full of NA&#39;s, you need to use na.omit() before defining the frame you want to calculate your covariance matrix on. </span></span>
<span id="cb251-27"><a href="risk-and-return.html#cb251-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb251-28"><a href="risk-and-return.html#cb251-28" aria-hidden="true" tabindex="-1"></a>  df_temp_var <span class="ot">&lt;-</span> weight_vector <span class="sc">%*%</span> cov_matrix <span class="sc">%*%</span> <span class="fu">t</span>(weight_vector)</span>
<span id="cb251-29"><a href="risk-and-return.html#cb251-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb251-30"><a href="risk-and-return.html#cb251-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Here, we just calculate the respective PF Risk consisting of the Variance of the Portfolio (we do not take the square root here).</span></span>
<span id="cb251-31"><a href="risk-and-return.html#cb251-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb251-32"><a href="risk-and-return.html#cb251-32" aria-hidden="true" tabindex="-1"></a>  col_name_pf_risk <span class="ot">&lt;-</span> <span class="fu">paste0</span>(i, <span class="st">&quot;_Fold_PF&quot;</span>)</span>
<span id="cb251-33"><a href="risk-and-return.html#cb251-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb251-34"><a href="risk-and-return.html#cb251-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This is to define the column names for the dataframe in which we combine all the results from all the loops.</span></span>
<span id="cb251-35"><a href="risk-and-return.html#cb251-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb251-36"><a href="risk-and-return.html#cb251-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Now, we defined all the functions and are able to create them through the loop structure. We must now just define how R should output all results (preferably in a data frame with defined column names to see the progress of the loop structure). </span></span>
<span id="cb251-37"><a href="risk-and-return.html#cb251-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb251-38"><a href="risk-and-return.html#cb251-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">colnames</span>(A4_returns_cap)[i] <span class="sc">==</span> <span class="st">&quot;Nestle_PS&quot;</span>) {</span>
<span id="cb251-39"><a href="risk-and-return.html#cb251-39" aria-hidden="true" tabindex="-1"></a>    df_final_temp_var <span class="ot">&lt;-</span> df_temp_var </span>
<span id="cb251-40"><a href="risk-and-return.html#cb251-40" aria-hidden="true" tabindex="-1"></a>    col_name_pf_risk_final <span class="ot">&lt;-</span> col_name_pf_risk</span>
<span id="cb251-41"><a href="risk-and-return.html#cb251-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb251-42"><a href="risk-and-return.html#cb251-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This here is where we create the output structure. Since we are operating in a loop, we tell R to do the same thing for just other combinations of data. In order to summarise and output everything on the same page, we need to define how R should handle this output. </span></span>
<span id="cb251-43"><a href="risk-and-return.html#cb251-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb251-44"><a href="risk-and-return.html#cb251-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Let&#39;s start with the first output. This is the first column the loop is running through. By defining if (colnames(A4_returns_cap)[i] == &quot;Nestle_PS&quot;) ..., we state that if the column name is Nestle_PS (which is the column name of the FIRST column), then R should assign the PF Risk quantity of the first PF as well as its respective column name to two distinct lists. That is the first element of the lists then. </span></span>
<span id="cb251-45"><a href="risk-and-return.html#cb251-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb251-46"><a href="risk-and-return.html#cb251-46" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb251-47"><a href="risk-and-return.html#cb251-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb251-48"><a href="risk-and-return.html#cb251-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb251-49"><a href="risk-and-return.html#cb251-49" aria-hidden="true" tabindex="-1"></a>    df_final_temp_var <span class="ot">&lt;-</span> <span class="fu">cbind</span>(df_final_temp_var, df_temp_var)</span>
<span id="cb251-50"><a href="risk-and-return.html#cb251-50" aria-hidden="true" tabindex="-1"></a>    col_name_pf_risk_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(col_name_pf_risk_final, col_name_pf_risk)</span>
<span id="cb251-51"><a href="risk-and-return.html#cb251-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb251-52"><a href="risk-and-return.html#cb251-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Now, we define what to do with all other elements in the list (e.g. what to do with the output of the second loop onward). There, we just say that we need to column bind (cbind) the output of PF risk as well as its respective column name. That is, we create a list of columns to which then the outputs of each loop are subsequently added. </span></span>
<span id="cb251-53"><a href="risk-and-return.html#cb251-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb251-54"><a href="risk-and-return.html#cb251-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Like that, we create an output structure for our loop. </span></span>
<span id="cb251-55"><a href="risk-and-return.html#cb251-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb251-56"><a href="risk-and-return.html#cb251-56" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb251-57"><a href="risk-and-return.html#cb251-57" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb251-58"><a href="risk-and-return.html#cb251-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-59"><a href="risk-and-return.html#cb251-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Here, we then define the dataframe and assign column as well as row name(s) to the final, looped output. </span></span>
<span id="cb251-60"><a href="risk-and-return.html#cb251-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-61"><a href="risk-and-return.html#cb251-61" aria-hidden="true" tabindex="-1"></a>df_final_temp_var <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(df_final_temp_var)</span>
<span id="cb251-62"><a href="risk-and-return.html#cb251-62" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df_final_temp_var) <span class="ot">&lt;-</span> col_name_pf_risk_final</span>
<span id="cb251-63"><a href="risk-and-return.html#cb251-63" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(df_final_temp_var) <span class="ot">&lt;-</span> <span class="st">&quot;PF Risk (Variance)&quot;</span></span>
<span id="cb251-64"><a href="risk-and-return.html#cb251-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-65"><a href="risk-and-return.html#cb251-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Lastly, we define an output of annualised PF Risk. </span></span>
<span id="cb251-66"><a href="risk-and-return.html#cb251-66" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb251-67"><a href="risk-and-return.html#cb251-67" aria-hidden="true" tabindex="-1"></a>df_final_temp_var_annual <span class="ot">&lt;-</span> df_final_temp_var<span class="sc">*</span><span class="dv">12</span></span>
<span id="cb251-68"><a href="risk-and-return.html#cb251-68" aria-hidden="true" tabindex="-1"></a>df_final_temp_var_annual</span></code></pre></div>
<pre><code>##                    1_Fold_PF    2_Fold_PF   3_Fold_PF   4_Fold_PF   5_Fold_PF  6_Fold_PF
## PF Risk (Variance) 0.0033307 0.0008791039 0.002016565 0.001518059 0.001018889 0.00125058</code></pre>
<p>As is applicable, we can see that the portfolio risk, given the chosen metric, is decreasing with increasing portfolio constituents. As such, it can be shown that, as N approaches infinity, overall risk (given as portfolio variance) gradually declines until it only depends on the covariance of the individual securities (only systematic risk components). By adding more stocks, the portfolio risk in terms of variance will decline, as it no longer depends on idiosyncratic, but solely systematic risk components, which is a good sign for its accuracy. However, factors which cannot be diminished by diversification are thus not accurately accounted for. Especially, since the variance or standard deviation are a mean, it masks extreme situations, understating systemic events. As a consequence, this form of risk is a necessary, but not fully sufficient measure of overall portfolio risk.</p>
</div>
</div>
<div id="risk-in-extremes-and-alternative-risk-measures" class="section level2" number="3.7">
<h2><span class="header-section-number">3.7</span> Risk in Extremes and Alternative Risk Measures</h2>
<p>We already talked in the lecture about the insufficiencies of variances and standard deviations and stressed the need for different assessment tools. Note that we just mentioned that, since both metrics are a mean, they automatically mask extreme situations and understate systematic events. As such, although they may be able to quantify volatility in normal times, risk in extremes should be quantified by other measures.</p>
<div id="value-at-risk-var" class="section level3" number="3.7.1">
<h3><span class="header-section-number">3.7.1</span> Value at Risk (VaR)</h3>
<p>A popular measure of the risk of loss in a portfolio is Value-at-Risk or VaR. VaR measures the loss in our portfolio over a pre-specified time horizon, assuming some level of probability. That is, it states what the maximum loss of a portfolio is expected with a certain probability. Although we are free to decide which level of probability we want to choose, the usual terms are 1% as well as 5% levels. Therein, we will use the market convention of representing VaR as a positive number and using the significance level.</p>
<p>In order to apply the VaR measures, we follow two strategies: Gaussian VaR and Historical VaR. The former assumes that the data follow a normal or Gaussian distribution, while the latter uses the distributional properties of the actual data. As such, Historical VaR requires more data to implement and Gaussian VaR requires less data to implement</p>
<div id="gaussian-var" class="section level4" number="3.7.1.1">
<h4><span class="header-section-number">3.7.1.1</span> Gaussian VaR</h4>
<p>One of the simplest approaches to estimate VaR is to assume that the portfolio returns follow a normal distribution. Hence, this approach is called Gaussian VaR. Because of the distributional assumption, we only need at least 1 year of daily returns data, which is approximately 252 observations.
Then, we compute the the VaR at a given level of <span class="math inline">\(\alpha\)</span> by following standard test statistic calculations:</p>
<p><span class="math display">\[
VaR_\alpha = -(\mu - \sigma Z_\alpha)I
\]</span></p>
<p>whereas <span class="math inline">\(\alpha\)</span> is the significance level of the VaR, <span class="math inline">\(\mu, \sigma\)</span> are the portfolio return and standard deviation, respectively, <span class="math inline">\(Z_\alpha\)</span> is the z-score based on the VaR significance level, and I is the current portfolio value. The Z-score is calculated using the function <code>qnorm()</code>. You may recall this from the Reading of Week 1. Note that there were the functions for distribution calculations (d, p, q, r). Therein, we stated that q defines the value of a certain quantile, given the underlying distribution and property assumptions. This is the function that returns the inverse values of the CDF. It takes thus an argument at the desired level of significance and gives you the number which corresponds to this quantile level in the CDF, thereby telling you which value incorporates exactly <span class="math inline">\(\alpha\)</span> percent of the probability mass.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="risk-and-return.html#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s use the equal-weighted return of the big four here: bigfour_EW_ret_ts</span></span>
<span id="cb253-2"><a href="risk-and-return.html#cb253-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-3"><a href="risk-and-return.html#cb253-3" aria-hidden="true" tabindex="-1"></a><span class="co"># We first calculate mean and standard deviation</span></span>
<span id="cb253-4"><a href="risk-and-return.html#cb253-4" aria-hidden="true" tabindex="-1"></a>bf_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(bigfour_EW_ret_ts, <span class="at">na.rm =</span> T)</span>
<span id="cb253-5"><a href="risk-and-return.html#cb253-5" aria-hidden="true" tabindex="-1"></a>bf_sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(bigfour_EW_ret_ts, <span class="at">na.rm =</span> T)</span>
<span id="cb253-6"><a href="risk-and-return.html#cb253-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-7"><a href="risk-and-return.html#cb253-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Also assume that our PF had a value of 1&#39;000&#39;000</span></span>
<span id="cb253-8"><a href="risk-and-return.html#cb253-8" aria-hidden="true" tabindex="-1"></a>I <span class="ot">=</span> <span class="dv">1000000</span></span>
<span id="cb253-9"><a href="risk-and-return.html#cb253-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-10"><a href="risk-and-return.html#cb253-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we just use the formula above to get the respective VaR at given levels of alpha</span></span>
<span id="cb253-11"><a href="risk-and-return.html#cb253-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-12"><a href="risk-and-return.html#cb253-12" aria-hidden="true" tabindex="-1"></a>VaR_5 <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">round</span>((bf_mean <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.05</span>)<span class="sc">*</span>bf_sd)<span class="sc">*</span>I,<span class="dv">1</span>))</span>
<span id="cb253-13"><a href="risk-and-return.html#cb253-13" aria-hidden="true" tabindex="-1"></a>VaR_1 <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">round</span>((bf_mean <span class="sc">+</span> <span class="fu">qnorm</span>(<span class="fl">0.01</span>)<span class="sc">*</span>bf_sd)<span class="sc">*</span>I,<span class="dv">1</span>))</span>
<span id="cb253-14"><a href="risk-and-return.html#cb253-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-15"><a href="risk-and-return.html#cb253-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s print it to see the maximum loss at a given level of confidence, given a Normal Distribution assumptions</span></span>
<span id="cb253-16"><a href="risk-and-return.html#cb253-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-17"><a href="risk-and-return.html#cb253-17" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;The VaR at an alpha level of 5% is: &quot;</span>, VaR_5, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">The VaR at an alpha level of 1% is: &quot;</span>, VaR_1)</span></code></pre></div>
<pre><code>## The VaR at an alpha level of 5% is:  168787.7 
## The VaR at an alpha level of 1% is:  243931.9</code></pre>
</div>
<div id="historical-var" class="section level4" number="3.7.1.2">
<h4><span class="header-section-number">3.7.1.2</span> Historical VaR</h4>
<p>Historical VaR uses a mix of current weights in the portfolio and a simulation of historical returns of the securities in the portfolio to construct a simulated series of portfolio profits and losses. Given its use of historical returns data, Historical VaR works better when we have lots of data. Typically, 3–5 years of data is recommended for this approach.</p>
<p>The main difference in it is that, instead of assuming a given distribution of the underlying returns of the portfolio, we derive the return assumptions by looking at the historical distirbution of the returns and assuming that the future distribution will be similar. This is done using the <code>quantile()</code> function.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="risk-and-return.html#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Also assume that our PF had a value of 1&#39;000&#39;000</span></span>
<span id="cb255-2"><a href="risk-and-return.html#cb255-2" aria-hidden="true" tabindex="-1"></a>I <span class="ot">=</span> <span class="dv">1000000</span></span>
<span id="cb255-3"><a href="risk-and-return.html#cb255-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-4"><a href="risk-and-return.html#cb255-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the appropriate metrics</span></span>
<span id="cb255-5"><a href="risk-and-return.html#cb255-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-6"><a href="risk-and-return.html#cb255-6" aria-hidden="true" tabindex="-1"></a>VaR_1_hist <span class="ot">&lt;-</span> <span class="fu">round</span>((<span class="fu">quantile</span>(bigfour_EW_ret_ts,<span class="fl">0.99</span>))<span class="sc">*</span>I,<span class="dv">1</span>)</span>
<span id="cb255-7"><a href="risk-and-return.html#cb255-7" aria-hidden="true" tabindex="-1"></a>VaR_5_hist <span class="ot">&lt;-</span> <span class="fu">round</span>((<span class="fu">quantile</span>(bigfour_EW_ret_ts,<span class="fl">0.95</span>))<span class="sc">*</span>I,<span class="dv">1</span>)</span>
<span id="cb255-8"><a href="risk-and-return.html#cb255-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb255-9"><a href="risk-and-return.html#cb255-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s print it to see the maximum loss at a given level of confidence, given a Normal Distribution assumptions</span></span>
<span id="cb255-10"><a href="risk-and-return.html#cb255-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">&quot;The VaR at an alpha level of 5% is: &quot;</span>, VaR_5_hist, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">The VaR at an alpha level of 1% is: &quot;</span>, VaR_1_hist)</span></code></pre></div>
<pre><code>## The VaR at an alpha level of 5% is:  83360.6 
## The VaR at an alpha level of 1% is:  129017.6</code></pre>
</div>
<div id="plotting-var" class="section level4" number="3.7.1.3">
<h4><span class="header-section-number">3.7.1.3</span> Plotting VaR</h4>
<p>Sometimes it may be easier for us to visualize the data by plotting (i) the density of the simulated portfolio profits and losses, (ii) the normal distribution of profits and losses based on the mean and standard deviation of the simulated portfolio profits and losses, and (iii) our estimates of the 1 and 5% 1-Day Historical VaR. This gives us a better overview of</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="risk-and-return.html#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First define the density of the simulated portfolio profits and losses</span></span>
<span id="cb257-2"><a href="risk-and-return.html#cb257-2" aria-hidden="true" tabindex="-1"></a>density_bf <span class="ot">&lt;-</span> bigfour_EW_ret_ts<span class="sc">*</span>I</span>
<span id="cb257-3"><a href="risk-and-return.html#cb257-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-4"><a href="risk-and-return.html#cb257-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, define the normal distribution of the portfolio values based on the mean and standard deviation of the simulated portfolio profits and losses. </span></span>
<span id="cb257-5"><a href="risk-and-return.html#cb257-5" aria-hidden="true" tabindex="-1"></a>norm_bf <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">392</span>, <span class="at">mean =</span> bf_mean<span class="sc">*</span>I, <span class="at">sd =</span> bf_sd<span class="sc">*</span>I)</span>
<span id="cb257-6"><a href="risk-and-return.html#cb257-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-7"><a href="risk-and-return.html#cb257-7" aria-hidden="true" tabindex="-1"></a>VaR_dist <span class="ot">&lt;-</span> <span class="fu">merge.xts</span>(<span class="fu">cbind</span>(density_bf, norm_bf))</span>
<span id="cb257-8"><a href="risk-and-return.html#cb257-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-9"><a href="risk-and-return.html#cb257-9" aria-hidden="true" tabindex="-1"></a>var_dist_melt <span class="ot">&lt;-</span> <span class="fu">melt</span>(<span class="fu">data.frame</span>(VaR_dist))</span></code></pre></div>
<pre><code>## No id variables; using all as measure variables</code></pre>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="risk-and-return.html#cb259-1" aria-hidden="true" tabindex="-1"></a>var_dist_melt <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>value, <span class="at">fill =</span> variable)) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb259-2"><a href="risk-and-return.html#cb259-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;goldenrod&quot;</span>, <span class="st">&quot;dodgerblue1&quot;</span>,</span>
<span id="cb259-3"><a href="risk-and-return.html#cb259-3" aria-hidden="true" tabindex="-1"></a>                               <span class="st">&quot;darkorchid4&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb259-4"><a href="risk-and-return.html#cb259-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>( <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;goldenrod&quot;</span>, <span class="st">&quot;dodgerblue1&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb259-5"><a href="risk-and-return.html#cb259-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">&quot;Density&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Portfolio Profit&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Density of Simulated Portfolio Profit and 1% and 5% 1−Day Historical (VaR)&quot;</span>) <span class="sc">+</span></span>
<span id="cb259-6"><a href="risk-and-return.html#cb259-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="sc">-</span><span class="fu">quantile</span>(<span class="sc">-</span>VaR_dist<span class="sc">$</span>density_bf, <span class="fl">0.99</span>), <span class="at">col =</span> <span class="st">&quot;dodgerblue1&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb259-7"><a href="risk-and-return.html#cb259-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="sc">-</span><span class="fu">quantile</span>(<span class="sc">-</span>VaR_dist<span class="sc">$</span>density_bf, <span class="fl">0.95</span>), <span class="at">col =</span> <span class="st">&quot;darkorchid4&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb259-8"><a href="risk-and-return.html#cb259-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Cumulative Return&#39;</span>) <span class="sc">+</span></span>
<span id="cb259-9"><a href="risk-and-return.html#cb259-9" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb259-10"><a href="risk-and-return.html#cb259-10" aria-hidden="true" tabindex="-1"></a><span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb259-11"><a href="risk-and-return.html#cb259-11" aria-hidden="true" tabindex="-1"></a><span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb259-12"><a href="risk-and-return.html#cb259-12" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb259-13"><a href="risk-and-return.html#cb259-13" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb259-14"><a href="risk-and-return.html#cb259-14" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb259-15"><a href="risk-and-return.html#cb259-15" aria-hidden="true" tabindex="-1"></a><span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb259-16"><a href="risk-and-return.html#cb259-16" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb259-17"><a href="risk-and-return.html#cb259-17" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb259-18"><a href="risk-and-return.html#cb259-18" aria-hidden="true" tabindex="-1"></a><span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-165-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="market-efficiency-and-independence-of-risk-and-return" class="section level2" number="3.8">
<h2><span class="header-section-number">3.8</span> Market Efficiency and independence of risk and return</h2>
<p>We have seen in the lecture that we primarily assume that returns are IID. That is, they are independent of each other and identically distributed. The first argument thus implies that the return of this period should not influence returns of the next periods. Consequently, the outcome of the second bet is unaffected by the outcome of the first. This is also an important notion of the efficient markets hypothesis (EMH). In it, we state that it is very difficult to develop a consistently profitable trading strategy. The EMH says that market prices fully reflect available information and prices should be unpredictable. To make this clear, this does not imply that the EMH states prices can never be predicted. What the EMH means is that any predictability will be competed away quickly by traders and any actionable mispricing will disappear.</p>
<p>In order to understand whether returns are indeed independent of each other, it is therefore necessary to conduct a test of independence. There are numerous tests to depict such independence, but we’ll cover the following.</p>
<div id="variance-ratio-test" class="section level3" number="3.8.1">
<h3><span class="header-section-number">3.8.1</span> Variance Ratio Test</h3>
<p>One such test is based on the examination of variances of different horizons. This is also known as Variance Ratio test and was first introduced by Poterba and Summers (1988). They create <strong>tests for serial correlation in stock returns using variance ratios</strong>. By assessing different ratios, they can understand whether the variances of different time horizons are proportional to each other. Especially, they test:</p>
<p><span class="math display">\[
VR(k) = \frac{Var(R_t^k)}{k} / \frac{Var(R_t^{12})}{12}
\]</span></p>
<p>whereas <span class="math inline">\(\frac{Var(R_t^k)}{k}\)</span> is the variance of a k month return, scaled by the months of the return.</p>
<p>They state that, if the EMH holds and returns are independent of each other, then the ratio of the variance between two periods should be not significantly different from each other (it should be equal to one). The logic behind this ratio follows suit the idea we elaborated on previously, when we assessed how <strong>risk behaves under our IID assumptions over time</strong>.</p>
<p>Let’s further explore the idea behind the VR. We start by assuming a random walk theory process. That is, the stock price of securities follows a random walk that depends on an IID error term that is normally distributed with mean zero and variance <span class="math inline">\(\sigma^2\)</span>: <span class="math inline">\(N(0, \sigma^2)\)</span>. This is the underlying idea of independence, and thus market efficiency. Now remember the IID properties and what they imply for calculating t-period risk. If we assume independence of returns, we define that the covariance between returns is zero (no serial correlation). Further assuming that the variances are identically distributed, we obtain an linear increase of the variance of total returns with the number of observational periods (k), implying that: <span class="math inline">\(Var(R_t^k) = \frac{k}{1}Var(R_t^1)\)</span>. This is just what we derived earlier. Now, let’s transfer this observation to the VR. Looking at the ratio, we first could write <span class="math inline">\(Var(R_t^k)\)</span> in terms of <span class="math inline">\(Var(R_t^12)\)</span>. Under the <em>assumption of independence</em>, the k’th period variance is nothing else than the 12-period variance scaled by a factor of k/12: <span class="math inline">\(Var(R_t^k) = \frac{k}{12}Var(R_t^{12})\)</span>. This is also why we wrote <span class="math inline">\(\frac{k}{1}\)</span> in the formula above to show you the proportion of going from 1 period to 12 periods. Now, if we add this relation between the k’th and 12’th period variance under the assumption of independence into our formula, then we realize that it will <strong>cancel each other out</strong>.</p>
<p><span class="math display">\[
\begin{align}
VR(k) &amp;= \frac{Var(R_t^k)}{k} / \frac{Var(R_t^{12})}{12} \\
&amp;= \frac{\frac{k}{12}Var(R_t^{12})}{k} / \frac{Var(R_t^{12})}{12} &amp;&amp; \text{Assumption of Independence = Proportionality to k}\\
&amp;=  \frac{Var(R_t^{12})}{12} /  \frac{Var(R_t^{12})}{12} &amp;&amp; \text{k cancels each other out}\\
&amp;= 1
\end{align}
\]</span></p>
<p>As such, we found that, under independence assumption, the variances of different periods are proportional by a factor of k. If this factor is indeed k, then the VR components will cancel each other out and result in a VR equal to 1 (or at least not materially different from 1). However, in a mean-reverting case, the previous returns inversely impact subsequent ones, implying an under-proportional spread. As such, k period variance is smaller than the k/12 one year variance, implying a remaining factor in the denominator. Thus, mean reversion will render the VR below one.</p>
<p>Consequently, we were able to show mathematically that the VR output is able to determine, or test, the independence assumption.</p>
<p>Let’s understand how we can transform this idea into our empirical setting. This is done by using the <code>rollapply()</code> function in combination with the <code>var()</code> function.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="risk-and-return.html#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For this, we will calculate the Variance Ratios for four different periods. I will follow a similar approach by looping. Just now, it is up to you to understand what the loop does in which parts. </span></span>
<span id="cb260-2"><a href="risk-and-return.html#cb260-2" aria-hidden="true" tabindex="-1"></a>NR_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(A1_bigfour_ret_ts[,<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">7</span>)])</span>
<span id="cb260-3"><a href="risk-and-return.html#cb260-3" aria-hidden="true" tabindex="-1"></a><span class="co"># To understand the VR implications, let&#39;s take the return of Nestle and Roche again</span></span>
<span id="cb260-4"><a href="risk-and-return.html#cb260-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-5"><a href="risk-and-return.html#cb260-5" aria-hidden="true" tabindex="-1"></a><span class="do">## We define the annual variance through &quot;roll applying&quot; the cumulative product of returns throughout a period of 12, then take the variance of t_i. That is, we:</span></span>
<span id="cb260-6"><a href="risk-and-return.html#cb260-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-7"><a href="risk-and-return.html#cb260-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1) apply a rolling function on the cumulative return of 12 periods to get 1-year rolling returns</span></span>
<span id="cb260-8"><a href="risk-and-return.html#cb260-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 2) take the variance of the respective 1-year rolling returns to get the 12-period horizon variance. </span></span>
<span id="cb260-9"><a href="risk-and-return.html#cb260-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-10"><a href="risk-and-return.html#cb260-10" aria-hidden="true" tabindex="-1"></a>EW_Var_12_N <span class="ot">&lt;-</span> <span class="fu">var</span>(<span class="fu">rollapply</span>(NR_df<span class="sc">$</span>Nestle_PS ,<span class="dv">12</span>,<span class="cf">function</span>(x) <span class="fu">prod</span>(x<span class="sc">+</span><span class="dv">1</span>)<span class="sc">-</span><span class="dv">1</span>), <span class="at">na.rm =</span> T)</span>
<span id="cb260-11"><a href="risk-and-return.html#cb260-11" aria-hidden="true" tabindex="-1"></a>EW_Var_12_R <span class="ot">&lt;-</span> <span class="fu">var</span>(<span class="fu">rollapply</span>(NR_df<span class="sc">$</span>Roche_Holding ,<span class="dv">12</span>,<span class="cf">function</span>(x) <span class="fu">prod</span>(x<span class="sc">+</span><span class="dv">1</span>)<span class="sc">-</span><span class="dv">1</span>), <span class="at">na.rm =</span> T)</span>
<span id="cb260-12"><a href="risk-and-return.html#cb260-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-13"><a href="risk-and-return.html#cb260-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Then, we define different time horizons (k) to set the 12-period variance into proportion to the k-period variances. </span></span>
<span id="cb260-14"><a href="risk-and-return.html#cb260-14" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb260-15"><a href="risk-and-return.html#cb260-15" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">24</span>,<span class="dv">36</span>,<span class="dv">48</span>)</span>
<span id="cb260-16"><a href="risk-and-return.html#cb260-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-17"><a href="risk-and-return.html#cb260-17" aria-hidden="true" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: We do not comment the loop as precisely as above, since the loop technique and syntax is the same as for the loops before. As such, only the input function(s) change, which we comment accordingly. </span></span>
<span id="cb260-18"><a href="risk-and-return.html#cb260-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-19"><a href="risk-and-return.html#cb260-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> times){ <span class="co"># Applying the VR function in a loop for the respective time periods. </span></span>
<span id="cb260-20"><a href="risk-and-return.html#cb260-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb260-21"><a href="risk-and-return.html#cb260-21" aria-hidden="true" tabindex="-1"></a>  EW_Var_N <span class="ot">&lt;-</span> <span class="fu">var</span>(<span class="fu">rollapply</span>(NR_df<span class="sc">$</span>Nestle_PS ,i,<span class="cf">function</span>(x) <span class="fu">prod</span>(x<span class="sc">+</span><span class="dv">1</span>)<span class="sc">-</span><span class="dv">1</span>), <span class="at">na.rm =</span> T)</span>
<span id="cb260-22"><a href="risk-and-return.html#cb260-22" aria-hidden="true" tabindex="-1"></a>  EW_VR_N <span class="ot">&lt;-</span> (EW_Var_N<span class="sc">/</span>i)<span class="sc">/</span>(EW_Var_12_N<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb260-23"><a href="risk-and-return.html#cb260-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb260-24"><a href="risk-and-return.html#cb260-24" aria-hidden="true" tabindex="-1"></a>  EW_Var_R <span class="ot">&lt;-</span> <span class="fu">var</span>(<span class="fu">rollapply</span>(NR_df<span class="sc">$</span>Roche_Holding ,i,<span class="cf">function</span>(x) <span class="fu">prod</span>(x<span class="sc">+</span><span class="dv">1</span>)<span class="sc">-</span><span class="dv">1</span>), <span class="at">na.rm =</span> T)</span>
<span id="cb260-25"><a href="risk-and-return.html#cb260-25" aria-hidden="true" tabindex="-1"></a>  EW_VR_R <span class="ot">&lt;-</span> (EW_Var_R<span class="sc">/</span>i)<span class="sc">/</span>(EW_Var_12_R<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb260-26"><a href="risk-and-return.html#cb260-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb260-27"><a href="risk-and-return.html#cb260-27" aria-hidden="true" tabindex="-1"></a>  col_name_EW <span class="ot">&lt;-</span> <span class="fu">paste0</span>(i, <span class="st">&quot;_Month&quot;</span>)</span>
<span id="cb260-28"><a href="risk-and-return.html#cb260-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb260-29"><a href="risk-and-return.html#cb260-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="dv">1</span>){ <span class="co"># Define the condition(s) to create a new dataframe and bind the columns</span></span>
<span id="cb260-30"><a href="risk-and-return.html#cb260-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb260-31"><a href="risk-and-return.html#cb260-31" aria-hidden="true" tabindex="-1"></a>    EW_VR_final_N <span class="ot">&lt;-</span> EW_VR_N</span>
<span id="cb260-32"><a href="risk-and-return.html#cb260-32" aria-hidden="true" tabindex="-1"></a>    EW_VR_final_R <span class="ot">&lt;-</span> EW_VR_R</span>
<span id="cb260-33"><a href="risk-and-return.html#cb260-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb260-34"><a href="risk-and-return.html#cb260-34" aria-hidden="true" tabindex="-1"></a>    col_name_EW_final <span class="ot">&lt;-</span> col_name_EW</span>
<span id="cb260-35"><a href="risk-and-return.html#cb260-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb260-36"><a href="risk-and-return.html#cb260-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb260-37"><a href="risk-and-return.html#cb260-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb260-38"><a href="risk-and-return.html#cb260-38" aria-hidden="true" tabindex="-1"></a>    EW_VR_final_N <span class="ot">&lt;-</span> <span class="fu">cbind</span>(EW_VR_final_N,EW_VR_N) <span class="co"># Conditions to bind the remaining columns instead of overwriting the loop</span></span>
<span id="cb260-39"><a href="risk-and-return.html#cb260-39" aria-hidden="true" tabindex="-1"></a>    EW_VR_final_R <span class="ot">&lt;-</span> <span class="fu">cbind</span>(EW_VR_final_R,EW_VR_R) </span>
<span id="cb260-40"><a href="risk-and-return.html#cb260-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb260-41"><a href="risk-and-return.html#cb260-41" aria-hidden="true" tabindex="-1"></a>    col_name_EW_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(col_name_EW_final, col_name_EW)</span>
<span id="cb260-42"><a href="risk-and-return.html#cb260-42" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb260-43"><a href="risk-and-return.html#cb260-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb260-44"><a href="risk-and-return.html#cb260-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb260-45"><a href="risk-and-return.html#cb260-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-46"><a href="risk-and-return.html#cb260-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dataframe</span></span>
<span id="cb260-47"><a href="risk-and-return.html#cb260-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-48"><a href="risk-and-return.html#cb260-48" aria-hidden="true" tabindex="-1"></a>data_frame_ratios <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(EW_VR_final_N, EW_VR_final_R))</span>
<span id="cb260-49"><a href="risk-and-return.html#cb260-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-50"><a href="risk-and-return.html#cb260-50" aria-hidden="true" tabindex="-1"></a>Annual_Var <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(EW_Var_12_N, EW_Var_12_R))</span>
<span id="cb260-51"><a href="risk-and-return.html#cb260-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-52"><a href="risk-and-return.html#cb260-52" aria-hidden="true" tabindex="-1"></a>data_frame_ratios <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(Annual_Var, data_frame_ratios))</span>
<span id="cb260-53"><a href="risk-and-return.html#cb260-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-54"><a href="risk-and-return.html#cb260-54" aria-hidden="true" tabindex="-1"></a>col_name_EW_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="st">&quot;Annual Variance&quot;</span>, col_name_EW_final)</span>
<span id="cb260-55"><a href="risk-and-return.html#cb260-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-56"><a href="risk-and-return.html#cb260-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the according names for the dataframe (columns and rows)</span></span>
<span id="cb260-57"><a href="risk-and-return.html#cb260-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-58"><a href="risk-and-return.html#cb260-58" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_frame_ratios) <span class="ot">=</span> col_name_EW_final</span>
<span id="cb260-59"><a href="risk-and-return.html#cb260-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-60"><a href="risk-and-return.html#cb260-60" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(data_frame_ratios) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Nestle&quot;</span>, <span class="st">&quot;Roche&quot;</span>)</span>
<span id="cb260-61"><a href="risk-and-return.html#cb260-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-62"><a href="risk-and-return.html#cb260-62" aria-hidden="true" tabindex="-1"></a>data_frame_ratios </span></code></pre></div>
<pre><code>##        Annual Variance   1_Month 24_Month 36_Month 48_Month
## Nestle      0.04587189 0.8072486 1.018228 1.500078 2.599945
## Roche       0.05745538 0.6762157 1.564237 2.555434 3.630698</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="the-programming-environment.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="beta.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/NikolasAnic/Advanced_Empirical_Finance_UZH_2022/edit/master/03-Risk_Return.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/NikolasAnic/Advanced_Empirical_Finance_UZH_2022/blob/master/03-Risk_Return.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
