<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Portfolio Theory: Mean-Variance Optimisation and the CAPM | Advanced Empirical Finance</title>
  <meta name="description" content="Chapter 7 Portfolio Theory: Mean-Variance Optimisation and the CAPM | Advanced Empirical Finance" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Portfolio Theory: Mean-Variance Optimisation and the CAPM | Advanced Empirical Finance" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Portfolio Theory: Mean-Variance Optimisation and the CAPM | Advanced Empirical Finance" />
  
  
  

<meta name="author" content="Nikolas Anic &amp; Lorenz Gassmann" />


<meta name="date" content="2022-02-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="beta.html"/>
<link rel="next" href="factor-models.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Empirical Finance - Lab Course</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction to the course objectives and organisation of the course</a></li>
<li class="chapter" data-level="2" data-path="the-programming-environment.html"><a href="the-programming-environment.html"><i class="fa fa-check"></i><b>2</b> The Programming Environment</a>
<ul>
<li class="chapter" data-level="2.1" data-path="the-programming-environment.html"><a href="the-programming-environment.html#markdown-files"><i class="fa fa-check"></i><b>2.1</b> Markdown Files</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="the-programming-environment.html"><a href="the-programming-environment.html#how-to-create-a-markdown-file"><i class="fa fa-check"></i><b>2.1.1</b> How to create a Markdown File</a></li>
<li class="chapter" data-level="2.1.2" data-path="the-programming-environment.html"><a href="the-programming-environment.html#the-r-markdown-structure"><i class="fa fa-check"></i><b>2.1.2</b> The R Markdown Structure</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="the-programming-environment.html"><a href="the-programming-environment.html#coding-in-r---a-concise-overview"><i class="fa fa-check"></i><b>2.2</b> Coding In R - A concise overview</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="the-programming-environment.html"><a href="the-programming-environment.html#introduction"><i class="fa fa-check"></i><b>2.2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2.2" data-path="the-programming-environment.html"><a href="the-programming-environment.html#vectors"><i class="fa fa-check"></i><b>2.2.2</b> Vectors</a></li>
<li class="chapter" data-level="2.2.3" data-path="the-programming-environment.html"><a href="the-programming-environment.html#data-types"><i class="fa fa-check"></i><b>2.2.3</b> Data Types</a></li>
<li class="chapter" data-level="2.2.4" data-path="the-programming-environment.html"><a href="the-programming-environment.html#data-frames"><i class="fa fa-check"></i><b>2.2.4</b> Data Frames</a></li>
<li class="chapter" data-level="2.2.5" data-path="the-programming-environment.html"><a href="the-programming-environment.html#importing-data"><i class="fa fa-check"></i><b>2.2.5</b> Importing Data</a></li>
<li class="chapter" data-level="2.2.6" data-path="the-programming-environment.html"><a href="the-programming-environment.html#data-manipulation"><i class="fa fa-check"></i><b>2.2.6</b> Data Manipulation</a></li>
<li class="chapter" data-level="2.2.7" data-path="the-programming-environment.html"><a href="the-programming-environment.html#data-reshaping"><i class="fa fa-check"></i><b>2.2.7</b> Data Reshaping</a></li>
<li class="chapter" data-level="2.2.8" data-path="the-programming-environment.html"><a href="the-programming-environment.html#beautiful-graphs-with-ggplot2"><i class="fa fa-check"></i><b>2.2.8</b> Beautiful Graphs with <code>ggplot2</code></a></li>
<li class="chapter" data-level="2.2.9" data-path="the-programming-environment.html"><a href="the-programming-environment.html#dates-and-times"><i class="fa fa-check"></i><b>2.2.9</b> Dates and Times</a></li>
<li class="chapter" data-level="2.2.10" data-path="the-programming-environment.html"><a href="the-programming-environment.html#string-manipulations-in-r-the-stringr-package"><i class="fa fa-check"></i><b>2.2.10</b> String Manipulations in R: The <code>stringr()</code> package</a></li>
<li class="chapter" data-level="2.2.11" data-path="the-programming-environment.html"><a href="the-programming-environment.html#database-queries"><i class="fa fa-check"></i><b>2.2.11</b> Database Queries</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="statistical-properties.html"><a href="statistical-properties.html"><i class="fa fa-check"></i><b>3</b> Statistical Properties</a>
<ul>
<li class="chapter" data-level="3.1" data-path="statistical-properties.html"><a href="statistical-properties.html#random-variables-and-probability-distributions-introdcution"><i class="fa fa-check"></i><b>3.1</b> Random Variables and Probability Distributions: Introdcution</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="statistical-properties.html"><a href="statistical-properties.html#the-concept-of-probability-important-notions-and-definitions"><i class="fa fa-check"></i><b>3.1.1</b> The concept of Probability: Important Notions and Definitions</a></li>
<li class="chapter" data-level="3.1.2" data-path="statistical-properties.html"><a href="statistical-properties.html#random-variables"><i class="fa fa-check"></i><b>3.1.2</b> Random Variables</a></li>
<li class="chapter" data-level="3.1.3" data-path="statistical-properties.html"><a href="statistical-properties.html#discrete-random-variables-and-distributions"><i class="fa fa-check"></i><b>3.1.3</b> Discrete Random Variables and Distributions</a></li>
<li class="chapter" data-level="3.1.4" data-path="statistical-properties.html"><a href="statistical-properties.html#continuous-random-variables-and-distributions"><i class="fa fa-check"></i><b>3.1.4</b> Continuous Random Variables and Distributions</a></li>
<li class="chapter" data-level="3.1.5" data-path="statistical-properties.html"><a href="statistical-properties.html#the-cumulative-distribution"><i class="fa fa-check"></i><b>3.1.5</b> The cumulative Distribution</a></li>
<li class="chapter" data-level="3.1.6" data-path="statistical-properties.html"><a href="statistical-properties.html#continuous-distributions-with-appealing-properties"><i class="fa fa-check"></i><b>3.1.6</b> Continuous Distributions with Appealing Properties</a></li>
<li class="chapter" data-level="3.1.7" data-path="statistical-properties.html"><a href="statistical-properties.html#moments-and-properties-of-bivariate-distributions"><i class="fa fa-check"></i><b>3.1.7</b> Moments and Properties of bivariate distributions</a></li>
<li class="chapter" data-level="3.1.8" data-path="statistical-properties.html"><a href="statistical-properties.html#moments-of-probability-distributions"><i class="fa fa-check"></i><b>3.1.8</b> Moments of Probability Distributions</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="statistical-properties.html"><a href="statistical-properties.html#matrix-algebra-introduction"><i class="fa fa-check"></i><b>3.2</b> Matrix Algebra: Introduction</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="statistical-properties.html"><a href="statistical-properties.html#matrices-and-vectors"><i class="fa fa-check"></i><b>3.2.1</b> Matrices and Vectors</a></li>
<li class="chapter" data-level="3.2.2" data-path="statistical-properties.html"><a href="statistical-properties.html#basic-matrix-operations"><i class="fa fa-check"></i><b>3.2.2</b> Basic Matrix Operations</a></li>
<li class="chapter" data-level="3.2.3" data-path="statistical-properties.html"><a href="statistical-properties.html#summation-notation-in-matrix-form"><i class="fa fa-check"></i><b>3.2.3</b> Summation Notation in Matrix Form</a></li>
<li class="chapter" data-level="3.2.4" data-path="statistical-properties.html"><a href="statistical-properties.html#systems-of-linear-equations"><i class="fa fa-check"></i><b>3.2.4</b> Systems of Linear Equations</a></li>
<li class="chapter" data-level="3.2.5" data-path="statistical-properties.html"><a href="statistical-properties.html#positive-definite-pd-matrix"><i class="fa fa-check"></i><b>3.2.5</b> Positive Definite (PD) Matrix</a></li>
<li class="chapter" data-level="3.2.6" data-path="statistical-properties.html"><a href="statistical-properties.html#multivariate-probability-distributions"><i class="fa fa-check"></i><b>3.2.6</b> Multivariate Probability Distributions</a></li>
<li class="chapter" data-level="3.2.7" data-path="statistical-properties.html"><a href="statistical-properties.html#portfolio-construction-and-mathematical-properties-using-matrix-algebra"><i class="fa fa-check"></i><b>3.2.7</b> Portfolio Construction and Mathematical Properties using Matrix Algebra</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html"><i class="fa fa-check"></i><b>4</b> Inductive Statistics and Regression Analysis Fundamentals</a>
<ul>
<li class="chapter" data-level="4.1" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#inductive-statistics"><i class="fa fa-check"></i><b>4.1</b> Inductive Statistics</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#point-estimators"><i class="fa fa-check"></i><b>4.1.1</b> Point Estimators</a></li>
<li class="chapter" data-level="4.1.2" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#confidence-intervals"><i class="fa fa-check"></i><b>4.1.2</b> Confidence Intervals</a></li>
<li class="chapter" data-level="4.1.3" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#hypothesis-testing"><i class="fa fa-check"></i><b>4.1.3</b> Hypothesis Testing</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#introduction-to-regression-analysis"><i class="fa fa-check"></i><b>4.2</b> Introduction to Regression Analysis</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#the-role-of-correlation"><i class="fa fa-check"></i><b>4.2.1</b> The role of correlation</a></li>
<li class="chapter" data-level="4.2.2" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#the-simple-univariate-regression-model"><i class="fa fa-check"></i><b>4.2.2</b> The simple / univariate regression model</a></li>
<li class="chapter" data-level="4.2.3" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#the-multivariate-regression-model"><i class="fa fa-check"></i><b>4.2.3</b> The multivariate regression model</a></li>
<li class="chapter" data-level="4.2.4" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#goodness-of-fit"><i class="fa fa-check"></i><b>4.2.4</b> Goodness of Fit</a></li>
<li class="chapter" data-level="4.2.5" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#assumption-and-diagnostic-tests-of-ols"><i class="fa fa-check"></i><b>4.2.5</b> Assumption and diagnostic tests of OLS</a></li>
<li class="chapter" data-level="4.2.6" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#properties-of-the-ols-estimator"><i class="fa fa-check"></i><b>4.2.6</b> Properties of the OLS Estimator</a></li>
<li class="chapter" data-level="4.2.7" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#expected-value-and-variance-of-the-multivarite-ols-estimator-if-the-assumptions-hold"><i class="fa fa-check"></i><b>4.2.7</b> Expected Value and Variance of the multivarite OLS estimator if the assumptions hold:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="risk-and-return.html"><a href="risk-and-return.html"><i class="fa fa-check"></i><b>5</b> Risk and Return</a>
<ul>
<li class="chapter" data-level="5.1" data-path="risk-and-return.html"><a href="risk-and-return.html#the-time-series-of-returns---transformations-in-r-1"><i class="fa fa-check"></i><b>5.1</b> The time-series of Returns - Transformations in R</a></li>
<li class="chapter" data-level="5.2" data-path="risk-and-return.html"><a href="risk-and-return.html#security-returns"><i class="fa fa-check"></i><b>5.2</b> Security Returns</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="risk-and-return.html"><a href="risk-and-return.html#simple-returns"><i class="fa fa-check"></i><b>5.2.1</b> Simple Returns</a></li>
<li class="chapter" data-level="5.2.2" data-path="risk-and-return.html"><a href="risk-and-return.html#logarithmic-returns"><i class="fa fa-check"></i><b>5.2.2</b> Logarithmic Returns</a></li>
<li class="chapter" data-level="5.2.3" data-path="risk-and-return.html"><a href="risk-and-return.html#accounting-for-dividends-total-returns"><i class="fa fa-check"></i><b>5.2.3</b> Accounting for Dividends: Total Returns</a></li>
<li class="chapter" data-level="5.2.4" data-path="risk-and-return.html"><a href="risk-and-return.html#truncating-the-data"><i class="fa fa-check"></i><b>5.2.4</b> Truncating the data</a></li>
<li class="chapter" data-level="5.2.5" data-path="risk-and-return.html"><a href="risk-and-return.html#arithmetic-vs.-geometric-returns"><i class="fa fa-check"></i><b>5.2.5</b> Arithmetic vs. Geometric Returns</a></li>
<li class="chapter" data-level="5.2.6" data-path="risk-and-return.html"><a href="risk-and-return.html#cumulative-returns"><i class="fa fa-check"></i><b>5.2.6</b> Cumulative Returns</a></li>
<li class="chapter" data-level="5.2.7" data-path="risk-and-return.html"><a href="risk-and-return.html#periodic-transformation-of-returns"><i class="fa fa-check"></i><b>5.2.7</b> Periodic Transformation of Returns</a></li>
<li class="chapter" data-level="5.2.8" data-path="risk-and-return.html"><a href="risk-and-return.html#annualising-returns"><i class="fa fa-check"></i><b>5.2.8</b> Annualising Returns</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="risk-and-return.html"><a href="risk-and-return.html#portfolio-returns"><i class="fa fa-check"></i><b>5.3</b> Portfolio Returns</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="risk-and-return.html"><a href="risk-and-return.html#equal-weighted-returns"><i class="fa fa-check"></i><b>5.3.1</b> Equal-weighted Returns</a></li>
<li class="chapter" data-level="5.3.2" data-path="risk-and-return.html"><a href="risk-and-return.html#value-weighted-returns"><i class="fa fa-check"></i><b>5.3.2</b> Value-weighted Returns</a></li>
<li class="chapter" data-level="5.3.3" data-path="risk-and-return.html"><a href="risk-and-return.html#timing-of-returns"><i class="fa fa-check"></i><b>5.3.3</b> Timing of Returns</a></li>
<li class="chapter" data-level="5.3.4" data-path="risk-and-return.html"><a href="risk-and-return.html#nominal-vs.-real-returns"><i class="fa fa-check"></i><b>5.3.4</b> Nominal vs. Real Returns</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="risk-and-return.html"><a href="risk-and-return.html#individual-security-risk"><i class="fa fa-check"></i><b>5.4</b> Individual Security Risk</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="risk-and-return.html"><a href="risk-and-return.html#standard-deviation-and-variance"><i class="fa fa-check"></i><b>5.4.1</b> Standard Deviation and Variance</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="risk-and-return.html"><a href="risk-and-return.html#rolling-risk-characteristics"><i class="fa fa-check"></i><b>5.5</b> Rolling Risk Characteristics</a></li>
<li class="chapter" data-level="5.6" data-path="risk-and-return.html"><a href="risk-and-return.html#portfolio-risk"><i class="fa fa-check"></i><b>5.6</b> Portfolio Risk</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="risk-and-return.html"><a href="risk-and-return.html#portfolio-risk-of-two-securities"><i class="fa fa-check"></i><b>5.6.1</b> Portfolio Risk of two securities</a></li>
<li class="chapter" data-level="5.6.2" data-path="risk-and-return.html"><a href="risk-and-return.html#portfolio-risk-for-multiple-assets"><i class="fa fa-check"></i><b>5.6.2</b> Portfolio Risk for Multiple Assets</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="risk-and-return.html"><a href="risk-and-return.html#risk-in-extremes-and-alternative-risk-measures"><i class="fa fa-check"></i><b>5.7</b> Risk in Extremes and Alternative Risk Measures</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="risk-and-return.html"><a href="risk-and-return.html#value-at-risk-var"><i class="fa fa-check"></i><b>5.7.1</b> Value at Risk (VaR)</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="risk-and-return.html"><a href="risk-and-return.html#market-efficiency-and-independence-of-risk-and-return"><i class="fa fa-check"></i><b>5.8</b> Market Efficiency and independence of risk and return</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="risk-and-return.html"><a href="risk-and-return.html#variance-ratio-test"><i class="fa fa-check"></i><b>5.8.1</b> Variance Ratio Test</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="beta.html"><a href="beta.html"><i class="fa fa-check"></i><b>6</b> Beta</a>
<ul>
<li class="chapter" data-level="6.1" data-path="beta.html"><a href="beta.html#application-of-regression-analysis-beta-analysis-in-financial-market-settings"><i class="fa fa-check"></i><b>6.1</b> Application of Regression Analysis: <span class="math inline">\(\beta\)</span> analysis in Financial Market Settings</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="beta.html"><a href="beta.html#the-single-index-model"><i class="fa fa-check"></i><b>6.1.1</b> The Single Index Model</a></li>
<li class="chapter" data-level="6.1.2" data-path="beta.html"><a href="beta.html#estimation-of-the-sim"><i class="fa fa-check"></i><b>6.1.2</b> Estimation of the SIM</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><i class="fa fa-check"></i><b>7</b> Portfolio Theory: Mean-Variance Optimisation and the CAPM</a>
<ul>
<li class="chapter" data-level="7.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#markowitz-portfolio-theory-with-two-risky-assets"><i class="fa fa-check"></i><b>7.1</b> Markowitz Portfolio Theory with two Risky Assets</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-case-of-portfolios"><i class="fa fa-check"></i><b>7.1.1</b> The case of portfolios</a></li>
<li class="chapter" data-level="7.1.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-set-of-attainable-portfolios"><i class="fa fa-check"></i><b>7.1.2</b> The set of attainable portfolios</a></li>
<li class="chapter" data-level="7.1.3" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-minimum-variance-portfolio"><i class="fa fa-check"></i><b>7.1.3</b> The Minimum-Variance Portfolio</a></li>
<li class="chapter" data-level="7.1.4" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-role-of-correlation-on-the-frontier-of-portfolios"><i class="fa fa-check"></i><b>7.1.4</b> The role of correlation on the frontier of portfolios</a></li>
<li class="chapter" data-level="7.1.5" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#efficient-portfolios-with-two-risky-assets"><i class="fa fa-check"></i><b>7.1.5</b> Efficient Portfolios with two risky assets</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#markowitz-portfolio-theory-with-a-risky-and-a-risk-free-asset"><i class="fa fa-check"></i><b>7.2</b> Markowitz Portfolio Theory with a Risky and a Risk-Free Asset</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-capital-allocation-line-cal"><i class="fa fa-check"></i><b>7.2.1</b> The Capital Allocation Line (CAL)</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#markowitz-portfolio-theory-with-two-risky-and-a-risk-free-asset"><i class="fa fa-check"></i><b>7.3</b> Markowitz Portfolio Theory with two Risky and a Risk-Free Asset</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#tangency-portfolio"><i class="fa fa-check"></i><b>7.3.1</b> Tangency Portfolio</a></li>
<li class="chapter" data-level="7.3.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#mutual-fund-theorem-and-derivation-of-the-capital-market-line-cml"><i class="fa fa-check"></i><b>7.3.2</b> Mutual Fund Theorem and Derivation of the Capital Market Line (CML)</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#markowitz-portfolio-theory-with-n-risky-assets"><i class="fa fa-check"></i><b>7.4</b> Markowitz Portfolio Theory with N Risky Assets</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-theoretical-foundations-of-n-assets"><i class="fa fa-check"></i><b>7.4.1</b> The theoretical foundations of N Assets</a></li>
<li class="chapter" data-level="7.4.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-minimum-variance-portfolio-for-n-assets"><i class="fa fa-check"></i><b>7.4.2</b> The Minimum Variance Portfolio for N assets</a></li>
<li class="chapter" data-level="7.4.3" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-efficient-frontier-for-n-assets"><i class="fa fa-check"></i><b>7.4.3</b> The Efficient Frontier for N assets</a></li>
<li class="chapter" data-level="7.4.4" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-efficient-and-feasible-portfolio-cal-of-n-risky-assets-and-a-risk-free-asset"><i class="fa fa-check"></i><b>7.4.4</b> The Efficient and Feasible Portfolio CAL of N risky Assets and a risk-free Asset</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-capital-asset-pricing-model"><i class="fa fa-check"></i><b>7.5</b> The Capital Asset Pricing Model</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#intuition-of-the-capm"><i class="fa fa-check"></i><b>7.5.1</b> Intuition of the CAPM</a></li>
<li class="chapter" data-level="7.5.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#mathematical-derivation-of-the-security-market-line-sml"><i class="fa fa-check"></i><b>7.5.2</b> Mathematical Derivation of the Security Market Line (SML)</a></li>
<li class="chapter" data-level="7.5.3" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#similarity-of-the-cml-and-sml"><i class="fa fa-check"></i><b>7.5.3</b> Similarity of the CML and SML</a></li>
<li class="chapter" data-level="7.5.4" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#diagnostic-tests-of-the-capm"><i class="fa fa-check"></i><b>7.5.4</b> Diagnostic Tests of the CAPM</a></li>
<li class="chapter" data-level="7.5.5" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#fama-macbeth-1973-approach"><i class="fa fa-check"></i><b>7.5.5</b> Fama-MacBeth (1973) approach</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="factor-models.html"><a href="factor-models.html"><i class="fa fa-check"></i><b>8</b> Factor Models</a>
<ul>
<li class="chapter" data-level="8.1" data-path="factor-models.html"><a href="factor-models.html#the-idea-behind-factor-models"><i class="fa fa-check"></i><b>8.1</b> The idea behind factor models</a></li>
<li class="chapter" data-level="8.2" data-path="factor-models.html"><a href="factor-models.html#the-quest-of-detecting-anomalies"><i class="fa fa-check"></i><b>8.2</b> The quest of detecting anomalies</a></li>
<li class="chapter" data-level="8.3" data-path="factor-models.html"><a href="factor-models.html#the-fama-french-three-factor-model"><i class="fa fa-check"></i><b>8.3</b> The Fama-French Three Factor Model</a></li>
<li class="chapter" data-level="8.4" data-path="factor-models.html"><a href="factor-models.html#testing-for-factor-validity"><i class="fa fa-check"></i><b>8.4</b> Testing for factor validity</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="factor-models.html"><a href="factor-models.html#portfolio-sorts"><i class="fa fa-check"></i><b>8.4.1</b> Portfolio Sorts</a></li>
<li class="chapter" data-level="8.4.2" data-path="factor-models.html"><a href="factor-models.html#factor-construction"><i class="fa fa-check"></i><b>8.4.2</b> Factor Construction</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="factor-models.html"><a href="factor-models.html#create-your-own-factors-a-step-by-step-example"><i class="fa fa-check"></i><b>8.5</b> Create your own factors: A step-by-step example</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="factor-models.html"><a href="factor-models.html#setting-up-the-wrds-proxy"><i class="fa fa-check"></i><b>8.5.1</b> Setting up the WRDS proxy</a></li>
<li class="chapter" data-level="8.5.2" data-path="factor-models.html"><a href="factor-models.html#factors-of-interest"><i class="fa fa-check"></i><b>8.5.2</b> Factors of interest</a></li>
<li class="chapter" data-level="8.5.3" data-path="factor-models.html"><a href="factor-models.html#get-the-data-to-construct-the-factors"><i class="fa fa-check"></i><b>8.5.3</b> Get the data to construct the factors</a></li>
<li class="chapter" data-level="8.5.4" data-path="factor-models.html"><a href="factor-models.html#portfolio-sorts-for-different-factors"><i class="fa fa-check"></i><b>8.5.4</b> Portfolio Sorts for different factors</a></li>
<li class="chapter" data-level="8.5.5" data-path="factor-models.html"><a href="factor-models.html#double-sorted-portfolios"><i class="fa fa-check"></i><b>8.5.5</b> Double-sorted Portfolios</a></li>
<li class="chapter" data-level="8.5.6" data-path="factor-models.html"><a href="factor-models.html#the-importance-of-data-selection"><i class="fa fa-check"></i><b>8.5.6</b> The importance of data selection</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced Empirical Finance</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="portfolio-theory-mean-variance-optimisation-and-the-capm" class="section level1" number="7">
<h1><span class="header-section-number">Chapter 7</span> Portfolio Theory: Mean-Variance Optimisation and the CAPM</h1>
<p>In the previous chapters we focused on the introduction of risk and return properties for individual assets as well as portfolios. Further, we introduced the concept of co-dependence both between individual assets as well between an asset and its underlying market structure. Therein, we derived important notions on the statistical requirements to draw causal conclusions. Within these chapters, we focused exclusively on the relationship between risk and return. Naturally, one definition we made was that risk must be compensated for with an appropriate rate of return. Noted as risk parity hypothesis, we created measures that put both factors into relation to each other and compared these ratios throughout a number of asset classes. In this chapter, we now take the underlying model on asset returns, the ideas on risk and return characteristics of portfolios as well as the statistical properties introduced and combine them to form the basis of empirical portfolio analysis frameworks. Specifically, we present the well-known Mean-Variance portfolio analysis concept for optimal asset allocations, first presented by Henry Markowitz (1959). This theory serves as fundament for most modern asset management classes. The framework uses concepts and assumptions we introduced in previous chapters. As such, it is assumed that the asset returns are normally distributed and investor preferences solely depend on risk and return characteristics. According to the risk parity hypothesis, additional risk must be compensated for by higher returns. Consequently, investors are favorable towards portfolios with high returns and unfavorable towards such with higher variances. As risk and return appear to be positively correlated, investors face a trade-off of these metrics between individual portfolios. Markowitz proposes a framework which quantifies this mean-variance trade off and creates a method to define the optimal portfolio choice.</p>
<p>Henceforth, in this chapter we provide the theoretical foundations as well as the practical application to the Markowitz portfolio optimisation framework. Therein, we first cover the case of two risky and one risk-free asset. We will use this setting to facilitate the main notions as well as replicate the major results and implications of Markowitz’s ideas, both graphically as well with forms of matrix algebra. Later on, we will generalise the simple model into a setting with multiple risky assets. Building on this, we introduce the concept of short sales contracts and, eventually, give rise to the notion of portfolio risk budgeting.</p>
<div id="markowitz-portfolio-theory-with-two-risky-assets" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Markowitz Portfolio Theory with two Risky Assets</h2>
<div id="the-case-of-portfolios" class="section level3" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> The case of portfolios</h3>
<p>In chapter two, we already discussed the concept of risk and return. Therein, we defined what a portfolio return is, how we can calculate different forms of returns, what co-dependence properties are and how we can quantify them in order to calculate the appropriate amount of risk for a portfolio. These definitions led us to the concept of portfolio risk and return relationships, where we defined the following:</p>
<p><span class="math display">\[
\begin{align*}
\mu_P = E[R_P] &amp;= x_AR_A + x_BR_B \\
\sigma_P^2 &amp;= x_A^2\sigma_A^2 + x_B^2\sigma_B^2 + 2x_Ax_B\sigma_{AB}\\
\sigma_{AB} &amp;= \rho_{AB}\sigma_A\sigma_B \\
x_A + x_B &amp;= 1 \\
R_P &amp;\sim N(\mu_P, \sigma_P^2)
\end{align*}
\]</span></p>
<p>where we derived each concept in the previous chapters. Regarding the co-dependence property, we stated that a non perfectly correlated portfolio will reduce overall portfolio risk, due to the concept of diversification. Thus finding assets with non-perfectly positively correlated returns can be beneficial when forming portfolios because risk, as measured by portfolio standard deviation, can be reduced. We also derived this property in the linear algebra introduction. This concepts proves that a risk reduction effect is evident in long-only, two and multiple asset cases when forming portfolios, with the exact amount of reduction quantified by the correlation coefficient, <span class="math inline">\(\rho_{AB}\)</span>.</p>
</div>
<div id="the-set-of-attainable-portfolios" class="section level3" number="7.1.2">
<h3><span class="header-section-number">7.1.2</span> The set of attainable portfolios</h3>
<p>Looking at portfolios, we also introduced the concept of weights. We stated that, in order to create portfolios, we need to define which assets receive which weights and how this weight distribution, or allocation, can influence both risk and return characteristics. Naturally, putting more weight on assets with higher volatility and higher returns will increase both the expected return as well as the risk of a portfolio. Throughout, we specified two weighting concepts: Equally-Weighted as well as Value-Weighted portfolios, whereas the former uses a 1/N weighting ratio, while the latter uses the inverse of the market capitalisation ratio to define weights of individual assets.</p>
<p>However, in theory, we could use any weighting scheme we want in order to form portfolio, as long as the sum of all weights add up to one. This brings us to the next theory. The <strong>set of all attainable, or feasible, portfolios is defined as all portfolios that can be created by changing the portfolio weights of the individual assets, as long as their sum adds up to one</strong>.</p>
<p>This theorem creates the well-known, parabola shaped relationship of risk and return for a portfolio when varying the weights of its components. Without going too deep into the mathematics, let’s visualize this relationship for the case of a portfolio consisting of two assets.</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First define some return and risk characteristics</span></span>
<span id="cb418-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-2" aria-hidden="true" tabindex="-1"></a>mu_A <span class="ot">=</span> <span class="fl">0.149</span></span>
<span id="cb418-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-3" aria-hidden="true" tabindex="-1"></a>sigma_A <span class="ot">=</span> <span class="fl">0.265</span></span>
<span id="cb418-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-4" aria-hidden="true" tabindex="-1"></a>mu_B <span class="ot">=</span> <span class="fl">0.067</span></span>
<span id="cb418-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-5" aria-hidden="true" tabindex="-1"></a>sigma_B <span class="ot">=</span> <span class="fl">0.167</span></span>
<span id="cb418-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-6" aria-hidden="true" tabindex="-1"></a>rho_AB <span class="ot">=</span> <span class="sc">-</span><span class="fl">0.135</span></span>
<span id="cb418-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-7" aria-hidden="true" tabindex="-1"></a>sigma_AB <span class="ot">=</span> sigma_B<span class="sc">*</span>sigma_A<span class="sc">*</span>rho_AB</span>
<span id="cb418-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb418-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we also define a sequence of 30 portfolio weights for A and B</span></span>
<span id="cb418-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-10" aria-hidden="true" tabindex="-1"></a>x_A <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="sc">-</span><span class="fl">0.8</span>, <span class="at">to=</span><span class="fl">2.2</span>, <span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb418-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-11" aria-hidden="true" tabindex="-1"></a>x_B <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> x_A</span>
<span id="cb418-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb418-13"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the expected return as well as the variance and standard deviation of each portfolios</span></span>
<span id="cb418-14"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-14" aria-hidden="true" tabindex="-1"></a>mu_AB <span class="ot">=</span> x_A<span class="sc">*</span>mu_A <span class="sc">+</span> x_B<span class="sc">*</span>mu_B</span>
<span id="cb418-15"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-15" aria-hidden="true" tabindex="-1"></a>var_AB <span class="ot">=</span> x_A<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_A<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> x_B<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_B<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>x_A<span class="sc">*</span>x_B<span class="sc">*</span>sigma_AB</span>
<span id="cb418-16"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-16" aria-hidden="true" tabindex="-1"></a>sd_AB <span class="ot">=</span> <span class="fu">sqrt</span>(var_AB)</span>
<span id="cb418-17"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb418-18"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame for the relationship</span></span>
<span id="cb418-19"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-19" aria-hidden="true" tabindex="-1"></a>risk_return_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(mu_AB, sd_AB, x_A, x_B))</span>
<span id="cb418-20"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-20" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(risk_return_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Portfolio_Return&quot;</span>, <span class="st">&quot;Portfolio_Risk&quot;</span>, <span class="st">&quot;Weight_A&quot;</span>, <span class="st">&quot;Weight_B&quot;</span>)</span>
<span id="cb418-21"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb418-22"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s visualise the relationship</span></span>
<span id="cb418-23"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-23" aria-hidden="true" tabindex="-1"></a>risk_return_df <span class="sc">%&gt;%</span> </span>
<span id="cb418-24"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span> </span>
<span id="cb418-25"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb418-26"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(risk_return_df, Weight_A <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">&amp;</span> Weight_B <span class="sc">&gt;=</span> <span class="dv">0</span>), <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb418-27"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(risk_return_df, Portfolio_Risk <span class="sc">==</span> <span class="fu">min</span>(Portfolio_Risk)), <span class="at">color =</span> <span class="st">&quot;dodgerblue3&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb418-28"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(risk_return_df, Weight_A <span class="sc">==</span> <span class="dv">1</span>), <span class="at">color =</span> <span class="st">&quot;springgreen4&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span> </span>
<span id="cb418-29"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(risk_return_df, Weight_B <span class="sc">==</span> <span class="dv">1</span>), <span class="at">color =</span> <span class="st">&quot;darkorchid1&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb418-30"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.22</span> ,<span class="at">y =</span> <span class="fl">0.16</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&#39;PF of Asset A only&#39;</span>), <span class="at">size =</span> <span class="dv">3</span>,  <span class="at">color =</span> <span class="st">&quot;springgreen4&quot;</span>) <span class="sc">+</span></span>
<span id="cb418-31"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.22</span> ,<span class="at">y =</span> <span class="fl">0.07</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&#39;PF of Asset B only&#39;</span>), <span class="at">size =</span> <span class="dv">3</span>,  <span class="at">color =</span> <span class="st">&quot;darkorchid1&quot;</span>) <span class="sc">+</span></span>
<span id="cb418-32"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(mu[p])) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="fu">expression</span>(sigma[p])) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Portfolio Frontier for 30 PFs formed with differing weights of two assets&quot;</span>) <span class="sc">+</span></span>
<span id="cb418-33"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb418-34"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb418-35"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb418-36"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb418-37"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb418-38"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb418-39"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb418-40"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb418-41"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb418-42"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb418-43"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb418-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-225-1.png" width="672" /></p>
<p>This plot is referred to as <strong>Markowitz Bullet</strong>. The black dots represent 30 distinct risk and return combinations, created by varying the individual constituent weights. The golden, purple, green and blue dots represent long-only portfolios. The black dots represent long-short strategies of two assets. Further, the purple and the green dot represent portfolios consisting of only the Asset B and A, respectively. Moreover, the blue dot represents the global minimum variance portfolio, a notion which we will cover in more detail later.</p>
<p>This shape is vital for the portfolio management theory as it displays the concept of diversification quite clearly. The idea that we just visualised behind the diversification potential can be understood as follows. Suppose we first have an investment in Asset B only. We can diversify and improve our portfolio metrics by rebalancing the portfolio such that we now include some of Asset A. This is indicated by th golden dots. As we can see, diversification increases the expected return while simultaneously decreasing the risk associated. Consequently, these portfolios are superior to the B only case. This is achieved until we reach the blue dot, which displays the minimum variance of a portfolio. This is also known as <strong>minimum-variance portfolio</strong>. Following this portfolio, we see that both risk and return increase monotonically. Consequently, the “optimal” portfolio in these cases depend on the <strong>investor preferences</strong>. We then follow a long-only strategy until we reach the green dot, which only consists of portfolio A. Afterwards, we follow with a long-A and short-B strategy.</p>
</div>
<div id="the-minimum-variance-portfolio" class="section level3" number="7.1.3">
<h3><span class="header-section-number">7.1.3</span> The Minimum-Variance Portfolio</h3>
<p>The Minimum-Variance (MV) Portfolio is a key concept in Markowitz’s Portfolio optimisation. It is used to give you an intuition on how to form weights on the portfolio frontier. It can be derived using a <strong>constrained optimisation problem</strong>.</p>
<p>We make a small exercise in calculus, using the <strong>substitution method</strong>, to derive the weight of the MV portfolio. As a side note, you can also use the Lagrangian method to determine the weights.</p>
<p>To get the MV portfolio, we use the minimisation of the portfolio variance, subject to the fact that both weights must add up to 1.</p>
<p><span class="math display">\[
\begin{align}
\min_{x_A, x_B} \sigma_P^2 &amp;= x_A\sigma_A^2 + x_B\sigma_B^2 + 2x_Ax_B\sigma_{AB} \\
\text{s.t. } x_a + x_B &amp;= 1
\end{align}
\]</span>
Let’s start with the optimisation. If we substitute <span class="math inline">\(x_B = 1 - x_A\)</span>, we obtain</p>
<p><span class="math display">\[
\begin{align}
\min_{x_A} \sigma_P^2 &amp;= x_A\sigma_A^2 + x_B\sigma_B^2 + 2x_Ax_B\sigma_{AB} \\
&amp;= x_A^2\sigma_A^2 +(1-x_A)^2\sigma_B^2 + 2x_A(1-x_A)\sigma_{AB} &amp;&amp; x_B = 1-x_A \\
\frac{d\sigma_P^2}{dx_A} = 0 &amp;= 2x_A\sigma_A^2 - 2(1-x_A)\sigma_B^2 + 2\sigma_{AB} -4x_A\sigma_{AB} \\
&amp;= 2x_A\sigma_A^2 - 2(1-x_A)\sigma_B^2 + 2\sigma_{AB}(1-x_A)
\end{align}
\]</span></p>
<p>If we now solve for <span class="math inline">\(x_A\)</span>, we obtain the optimal weight of Asset A and Asset B for the MV portfolio as:</p>
<p><span class="math display">\[
\begin{align}
x_A &amp;= \frac{\sigma_B^2 - \sigma_{AB}}{\sigma_A^2 + \sigma_B^2 - 2\sigma_{AB}}\\
x_B &amp;= 1 - x_A
\end{align}
\]</span></p>
<p>In the case of our assets, let’s quickly calculate the respective weights:</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb419-1" aria-hidden="true" tabindex="-1"></a>x_A_MV <span class="ot">=</span> (sigma_B<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> sigma_AB)<span class="sc">/</span>(sigma_A<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sigma_B<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>sigma_AB)</span>
<span id="cb419-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb419-2" aria-hidden="true" tabindex="-1"></a>x_B_MV <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> x_A_MV </span>
<span id="cb419-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb419-3" aria-hidden="true" tabindex="-1"></a>mu_MV <span class="ot">=</span> mu_A<span class="sc">*</span>x_A_MV <span class="sc">+</span> mu_B<span class="sc">*</span>x_B_MV </span>
<span id="cb419-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb419-4" aria-hidden="true" tabindex="-1"></a>sd_MV <span class="ot">=</span> <span class="fu">sqrt</span>(sigma_A<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>x_A_MV<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> sigma_B<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>x_B_MV<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>x_A_MV<span class="sc">*</span>x_B_MV<span class="sc">*</span>sigma_AB)</span>
<span id="cb419-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb419-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb419-6" aria-hidden="true" tabindex="-1"></a>MV_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(x_A_MV, x_B_MV, mu_MV, sd_MV))</span>
<span id="cb419-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb419-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(MV_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Weight Asset A&quot;</span>, <span class="st">&quot;Weight Asset B&quot;</span>, <span class="st">&quot;Expected Return&quot;</span>, <span class="st">&quot;Volatility (StD)&quot;</span>)</span>
<span id="cb419-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb419-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb419-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb419-9" aria-hidden="true" tabindex="-1"></a>MV_df</span></code></pre></div>
<pre><code>##   Weight Asset A Weight Asset B Expected Return Volatility (StD)
## 1      0.3076735      0.6923265      0.09222923        0.1321746</code></pre>
</div>
<div id="the-role-of-correlation-on-the-frontier-of-portfolios" class="section level3" number="7.1.4">
<h3><span class="header-section-number">7.1.4</span> The role of correlation on the frontier of portfolios</h3>
<p>As we said, the portfolio frontier shows the correlation properties between assets and can therein display the diversification potential. As such, it is interesting to see how the portfolio changes with varying correlations. In order to show this, we need to slightly adjust the formula for the variance such that we are able to write the formula in terms of the correlation coefficient, <span class="math inline">\(\rho_{AB}\)</span>.</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s define the variance as follows: </span></span>
<span id="cb421-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-2" aria-hidden="true" tabindex="-1"></a><span class="co"># First define some return and risk characteristics</span></span>
<span id="cb421-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-3" aria-hidden="true" tabindex="-1"></a>mu_A <span class="ot">=</span> <span class="fl">0.149</span></span>
<span id="cb421-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-4" aria-hidden="true" tabindex="-1"></a>sigma_A <span class="ot">=</span> <span class="fl">0.265</span></span>
<span id="cb421-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-5" aria-hidden="true" tabindex="-1"></a>mu_B <span class="ot">=</span> <span class="fl">0.067</span></span>
<span id="cb421-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-6" aria-hidden="true" tabindex="-1"></a>sigma_B <span class="ot">=</span> <span class="fl">0.167</span></span>
<span id="cb421-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we also define a sequence of 30 portfolio weights for A and B</span></span>
<span id="cb421-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-9" aria-hidden="true" tabindex="-1"></a>x_A <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="sc">-</span><span class="fl">0.8</span>, <span class="at">to=</span><span class="fl">2.2</span>, <span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb421-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-10" aria-hidden="true" tabindex="-1"></a>x_B <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> x_A</span>
<span id="cb421-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the mean return (the same for all as it does not depend on the rho&#39;s)</span></span>
<span id="cb421-13"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-13" aria-hidden="true" tabindex="-1"></a>mu_AB <span class="ot">=</span> x_A<span class="sc">*</span>mu_A <span class="sc">+</span> x_B<span class="sc">*</span>mu_B</span>
<span id="cb421-14"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-15"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a list with rho&#39;s</span></span>
<span id="cb421-16"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-16" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="dv">0</span>, <span class="fl">0.5</span>, <span class="dv">1</span>)</span>
<span id="cb421-17"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-18"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the different standard deviations</span></span>
<span id="cb421-19"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> rho){</span>
<span id="cb421-20"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-20" aria-hidden="true" tabindex="-1"></a>  cov_AB <span class="ot">=</span> sigma_B<span class="sc">*</span>sigma_A<span class="sc">*</span>i</span>
<span id="cb421-21"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-21" aria-hidden="true" tabindex="-1"></a>  var_AB <span class="ot">=</span> x_A<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_A<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> x_B<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_B<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>x_A<span class="sc">*</span>x_B<span class="sc">*</span>cov_AB</span>
<span id="cb421-22"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-22" aria-hidden="true" tabindex="-1"></a>  sd_AB <span class="ot">=</span> <span class="fu">sqrt</span>(var_AB)</span>
<span id="cb421-23"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb421-24"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>){</span>
<span id="cb421-25"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-25" aria-hidden="true" tabindex="-1"></a>    sd_AB_final <span class="ot">&lt;-</span> sd_AB</span>
<span id="cb421-26"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb421-27"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb421-28"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-28" aria-hidden="true" tabindex="-1"></a>    sd_AB_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(sd_AB_final, sd_AB)</span>
<span id="cb421-29"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb421-30"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb421-31"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-32"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-32" aria-hidden="true" tabindex="-1"></a>sd_AB_final_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(mu_AB, sd_AB_final))</span>
<span id="cb421-33"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-33" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(sd_AB_final_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Return&quot;</span>, <span class="st">&quot;rho_1_neg&quot;</span>,  <span class="st">&quot;rho_0.5_neg&quot;</span>, <span class="st">&quot;rho0&quot;</span>, <span class="st">&quot;rho0.5&quot;</span>, <span class="st">&quot;rho1&quot;</span>)</span>
<span id="cb421-34"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb421-35"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualise the relationship</span></span>
<span id="cb421-36"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-36" aria-hidden="true" tabindex="-1"></a>sd_AB_final_df <span class="sc">%&gt;%</span> </span>
<span id="cb421-37"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> rho_1_neg, <span class="at">y =</span> Return)) <span class="sc">+</span> </span>
<span id="cb421-38"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb421-39"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>() <span class="sc">+</span> </span>
<span id="cb421-40"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;darkorange2&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> rho_0<span class="fl">.5</span>_neg, <span class="at">y =</span> Return)) <span class="sc">+</span></span>
<span id="cb421-41"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">color =</span> <span class="st">&quot;darkorange2&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> rho_0<span class="fl">.5</span>_neg, <span class="at">y =</span> Return)) <span class="sc">+</span> </span>
<span id="cb421-42"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;darkorchid1&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> rho0, <span class="at">y =</span> Return)) <span class="sc">+</span></span>
<span id="cb421-43"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">color =</span> <span class="st">&quot;darkorchid1&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> rho0, <span class="at">y =</span> Return)) <span class="sc">+</span> </span>
<span id="cb421-44"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;dodgerblue1&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> rho0<span class="fl">.5</span>, <span class="at">y =</span> Return)) <span class="sc">+</span></span>
<span id="cb421-45"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">color =</span> <span class="st">&quot;dodgerblue1&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> rho0<span class="fl">.5</span>, <span class="at">y =</span> Return)) <span class="sc">+</span> </span>
<span id="cb421-46"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;springgreen3&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> rho1, <span class="at">y =</span> Return)) <span class="sc">+</span></span>
<span id="cb421-47"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">color =</span> <span class="st">&quot;springgreen3&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> rho1, <span class="at">y =</span> Return)) <span class="sc">+</span> </span>
<span id="cb421-48"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.70</span> ,<span class="at">y =</span> <span class="fl">0.19</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&#39;rho = -1&#39;</span>), <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb421-49"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.70</span> ,<span class="at">y =</span> <span class="fl">0.175</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&#39;rho = -0.5&#39;</span>), <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">&quot;darkorange2&quot;</span>) <span class="sc">+</span></span>
<span id="cb421-50"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.70</span> ,<span class="at">y =</span> <span class="fl">0.16</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&#39;rho = 0&#39;</span>), <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">&quot;darkorchid1&quot;</span>) <span class="sc">+</span></span>
<span id="cb421-51"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.70</span> ,<span class="at">y =</span> <span class="fl">0.14</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&#39;rho = 0.5&#39;</span>), <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">&quot;dodgerblue1&quot;</span>) <span class="sc">+</span></span>
<span id="cb421-52"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.70</span> ,<span class="at">y =</span> <span class="fl">0.125</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&#39;rho = 1&#39;</span>), <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">&quot;springgreen3&quot;</span>) <span class="sc">+</span></span>
<span id="cb421-53"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(mu[p])) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="fu">expression</span>(sigma[p])) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Portfolio Frontier for 30 PFs for different correlation coefficients&quot;</span>) <span class="sc">+</span></span>
<span id="cb421-54"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb421-55"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb421-56"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb421-57"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb421-58"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb421-59"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb421-60"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb421-61"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb421-62"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb421-63"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb421-64"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb421-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-227-1.png" width="672" /></p>
</div>
<div id="efficient-portfolios-with-two-risky-assets" class="section level3" number="7.1.5">
<h3><span class="header-section-number">7.1.5</span> Efficient Portfolios with two risky assets</h3>
<p>As we have seen, the bullet shape of each portfolio combination splits the portfolio set horizontally into two regions, based on their respective risk and return relation. To be precise, we can observe that, for a quasi identical level of risk we can attain two vastly different levels of expected portfolio return. Based on this observation, we can sort the portfolio into two regions: Efficient and Inefficient portfolios.</p>
<ul>
<li><p>Efficient Portfolios are the set of all attainable portfolios that have the highest return for any given level of risk (measured by its standard deviation). Graphically, these are all the portfolios that are at or above the MV portfolio.</p></li>
<li><p>Inefficient Portfolios are the set of all attainable portfolios that do not have the highest return for any given level of risk (measured by its standard deviation). Graphically, these are all the portfolios that are at or below the MV portfolio.</p></li>
</ul>
<p>We can visually depict this as follows:</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First define some return and risk characteristics</span></span>
<span id="cb422-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-2" aria-hidden="true" tabindex="-1"></a>mu_A <span class="ot">=</span> <span class="fl">0.149</span></span>
<span id="cb422-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-3" aria-hidden="true" tabindex="-1"></a>sigma_A <span class="ot">=</span> <span class="fl">0.265</span></span>
<span id="cb422-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-4" aria-hidden="true" tabindex="-1"></a>mu_B <span class="ot">=</span> <span class="fl">0.067</span></span>
<span id="cb422-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-5" aria-hidden="true" tabindex="-1"></a>sigma_B <span class="ot">=</span> <span class="fl">0.167</span></span>
<span id="cb422-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-6" aria-hidden="true" tabindex="-1"></a>rho_AB <span class="ot">=</span> <span class="sc">-</span><span class="fl">0.135</span></span>
<span id="cb422-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-7" aria-hidden="true" tabindex="-1"></a>sigma_AB <span class="ot">=</span> sigma_B<span class="sc">*</span>sigma_A<span class="sc">*</span>rho_AB</span>
<span id="cb422-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we also define a sequence of 30 portfolio weights for A and B</span></span>
<span id="cb422-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-10" aria-hidden="true" tabindex="-1"></a>x_A <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="sc">-</span><span class="fl">0.8</span>, <span class="at">to=</span><span class="fl">2.2</span>, <span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb422-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-11" aria-hidden="true" tabindex="-1"></a>x_B <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> x_A</span>
<span id="cb422-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-13"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the expected return as well as the variance and standard deviation of each portfolios</span></span>
<span id="cb422-14"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-14" aria-hidden="true" tabindex="-1"></a>mu_AB <span class="ot">=</span> x_A<span class="sc">*</span>mu_A <span class="sc">+</span> x_B<span class="sc">*</span>mu_B</span>
<span id="cb422-15"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-15" aria-hidden="true" tabindex="-1"></a>var_AB <span class="ot">=</span> x_A<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_A<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> x_B<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_B<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>x_A<span class="sc">*</span>x_B<span class="sc">*</span>sigma_AB</span>
<span id="cb422-16"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-16" aria-hidden="true" tabindex="-1"></a>sd_AB <span class="ot">=</span> <span class="fu">sqrt</span>(var_AB)</span>
<span id="cb422-17"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-18"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame for the relationship</span></span>
<span id="cb422-19"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-19" aria-hidden="true" tabindex="-1"></a>risk_return_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(mu_AB, sd_AB, x_A, x_B))</span>
<span id="cb422-20"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-20" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(risk_return_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Portfolio_Return&quot;</span>, <span class="st">&quot;Portfolio_Risk&quot;</span>, <span class="st">&quot;Weight_A&quot;</span>, <span class="st">&quot;Weight_B&quot;</span>)</span>
<span id="cb422-21"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-22"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s visualise the relationship</span></span>
<span id="cb422-23"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-23" aria-hidden="true" tabindex="-1"></a>risk_return_df <span class="sc">%&gt;%</span> </span>
<span id="cb422-24"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span> </span>
<span id="cb422-25"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb422-26"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(risk_return_df, Portfolio_Return <span class="sc">&gt;=</span> <span class="fl">0.0916</span>), <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb422-27"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(risk_return_df, Portfolio_Return <span class="sc">&lt;</span> <span class="fl">0.0916</span>), <span class="at">color =</span> <span class="st">&quot;dodgerblue2&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb422-28"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(mu[p])) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="fu">expression</span>(sigma[p])) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Portfolio Frontier for 30 PFs - Efficient and Inefficient PFs&quot;</span>) <span class="sc">+</span></span>
<span id="cb422-29"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">0.385</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb422-30"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.42</span> ,<span class="at">y =</span> <span class="fl">0.17</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&#39;Efficient PF&#39;</span>), <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span></span>
<span id="cb422-31"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.424</span> ,<span class="at">y =</span> <span class="fl">0.02</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&#39;Inefficient PF&#39;</span>), <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">&quot;dodgerblue2&quot;</span>) <span class="sc">+</span></span>
<span id="cb422-32"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb422-33"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb422-34"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb422-35"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb422-36"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb422-37"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb422-38"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb422-39"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb422-40"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb422-41"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb422-42"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb422-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-228-1.png" width="672" /></p>
</div>
</div>
<div id="markowitz-portfolio-theory-with-a-risky-and-a-risk-free-asset" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Markowitz Portfolio Theory with a Risky and a Risk-Free Asset</h2>
<p>In the previous chapters we also introduced the concept of a risk-free asset. In essence, risk-free assets are such assets that always have the same pay-off, irrespective of the state of the world. Thus, their volatility structure is constant. As a consequence, they have a quasi-zero variance and standard deviation. Prominent examples of risk-free assets are the Swiss 1 Year Government Bond with which we have worked throughout the class or the US T-Bills.</p>
<p>These notions imply the following properties of risk free assets, <span class="math inline">\(r_f\)</span>:</p>
<p><span class="math display">\[
\begin{align}
E[r_f] &amp;= r_f \\
\sigma_f^2 &amp;= 0 \\
cov(r_A, r_f) &amp;= 0
\end{align}
\]</span></p>
<p>If we introduce the risk-free asset, into the portfolio theory, our portfolio return becomes:</p>
<p><span class="math display">\[
R_P = x_fr_f + x_Ar_A = (1-x_A)r_f + x_Ar_A = r_f + x_A(r_A - r_f) 
\]</span></p>
<p>whereas <span class="math inline">\(x_A(r_A - r_f)\)</span> is the <strong>weighted excess return of the risky asset over the risk-free asset</strong>. Consistent with the risk parity hypothesis, we expect this excess return to be positive, as rational investors expect a higher return when incorporating riskier assets to compensate for said increase in risk.</p>
<p>In said case, we can calculate both the portfolio expected return as well as the variance as:</p>
<p><span class="math display">\[
\begin{align}
\mu_P &amp;= r_f + x_A(\mu_A - r_f) \\
\sigma_P &amp;= x_A\sigma_A
\end{align}
\]</span>
In case of a risky and a risk-free asset, we can draw the portfolio frontier in a similar fashion to the frontier assuming that we have two perfectly negatively correlated assets:</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First define some return and risk characteristics</span></span>
<span id="cb423-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-2" aria-hidden="true" tabindex="-1"></a>mu_A <span class="ot">=</span> <span class="fl">0.149</span></span>
<span id="cb423-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-3" aria-hidden="true" tabindex="-1"></a>sigma_A <span class="ot">=</span> <span class="fl">0.265</span></span>
<span id="cb423-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-4" aria-hidden="true" tabindex="-1"></a>mu_f <span class="ot">=</span> <span class="fl">0.035</span></span>
<span id="cb423-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-5" aria-hidden="true" tabindex="-1"></a>sigma_f <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb423-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-6" aria-hidden="true" tabindex="-1"></a>rho_Af <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb423-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-7" aria-hidden="true" tabindex="-1"></a>sigma_Af <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb423-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we also define a sequence of 30 portfolio weights for A and B</span></span>
<span id="cb423-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-10" aria-hidden="true" tabindex="-1"></a>x_A <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="sc">-</span><span class="fl">0.8</span>, <span class="at">to=</span><span class="fl">2.2</span>, <span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb423-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-11" aria-hidden="true" tabindex="-1"></a>x_f <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> x_A</span>
<span id="cb423-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-13"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the expected return as well as the variance and standard deviation of each portfolios</span></span>
<span id="cb423-14"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-14" aria-hidden="true" tabindex="-1"></a>mu_Af <span class="ot">=</span> x_A<span class="sc">*</span>mu_A <span class="sc">+</span> x_f<span class="sc">*</span>mu_f</span>
<span id="cb423-15"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-15" aria-hidden="true" tabindex="-1"></a>var_Af <span class="ot">=</span> x_A<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_A<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> x_f<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_f<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>x_A<span class="sc">*</span>x_f<span class="sc">*</span>sigma_Af</span>
<span id="cb423-16"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-16" aria-hidden="true" tabindex="-1"></a>sd_Af <span class="ot">=</span> <span class="fu">sqrt</span>(var_Af)</span>
<span id="cb423-17"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame for the relationship</span></span>
<span id="cb423-18"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-18" aria-hidden="true" tabindex="-1"></a>risk_return_df_rf <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(mu_Af, sd_Af, x_A, x_f))</span>
<span id="cb423-19"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-19" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(risk_return_df_rf) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Portfolio_Return&quot;</span>, <span class="st">&quot;Portfolio_Risk&quot;</span>, <span class="st">&quot;Weight_A&quot;</span>, <span class="st">&quot;Weight_B&quot;</span>)</span>
<span id="cb423-20"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s visualise the relationship</span></span>
<span id="cb423-21"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-21" aria-hidden="true" tabindex="-1"></a>risk_return_df_rf <span class="sc">%&gt;%</span> </span>
<span id="cb423-22"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span> </span>
<span id="cb423-23"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb423-24"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(risk_return_df_rf, Portfolio_Return <span class="sc">&gt;=</span> <span class="fl">0.0350</span>), <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb423-25"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(risk_return_df_rf, Portfolio_Return <span class="sc">&lt;</span> <span class="fl">0.0350</span>), <span class="at">color =</span> <span class="st">&quot;dodgerblue2&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb423-26"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(risk_return_df_rf, Weight_A <span class="sc">&gt;=</span> <span class="dv">1</span>), <span class="at">color =</span> <span class="st">&quot;darkorchid1&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb423-27"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="sc">-</span><span class="fl">0.02</span> ,<span class="at">y =</span> <span class="fl">0.05</span>, <span class="at">label =</span> <span class="st">&quot;risk-free&quot;</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb423-28"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>, <span class="at">x =</span> <span class="fl">0.32</span> ,<span class="at">y =</span> <span class="fl">0.14</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&#39;Risky Asset PF&#39;</span>), <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">&quot;darkorchid1&quot;</span>) <span class="sc">+</span></span>
<span id="cb423-29"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(mu[p])) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="fu">expression</span>(sigma[p])) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Portfolio Frontier for 30 PFs - Efficient and Inefficient PFss&quot;</span>) <span class="sc">+</span></span>
<span id="cb423-30"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fl">0.0350</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span> </span>
<span id="cb423-31"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb423-32"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb423-33"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb423-34"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb423-35"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb423-36"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb423-37"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb423-38"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb423-39"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb423-40"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb423-41"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb423-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-229-1.png" width="672" /></p>
<div id="the-capital-allocation-line-cal" class="section level3" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> The Capital Allocation Line (CAL)</h3>
<p>As we can see, we again obtain two straight lines, consisting of inefficient and efficient portfolios.</p>
<p>Under the assumption that <span class="math inline">\(x &gt; 0\)</span> (no short sales) we can use the variance equation and solve for x:</p>
<p><span class="math display">\[
x_A = \frac{\sigma_P} {\sigma_A}
\]</span></p>
<p>This implies that the optimal weight of the risky asset is given by the variance of the asset relative to the variance of the portfolio. As such, the return of the risky asset is weighted by the inverse of the asset risk relative to the overall portfolio risk. If we now substitute this result into the expected return, we obtain:</p>
<p><span class="math display">\[
\mu_P = r_f + \frac{\mu_A - r_f}{\sigma_A}\cdot \sigma_P
\]</span></p>
<p>This variable is called the <strong>Capital Allocation Line (CAL)</strong>. This is exactly the line that consists of the dots we just displayed. It describes how the investment is allocated between the risk-free asset and the risky asset. For dots in close proximity to the risk-free asset, we understand that most of the capital is allocated in riskless assets (consequently, the return is close to the risk-free). The further we deviate from the risk-free asset, the more we allocate into the risky assets, with the (theoretical) maximum of a portfolio consisting only of the risky asset. The purple dots represent long-short portfolios where the risk-free asset is shorted to invest in additional quantities of the risky asset.</p>
<p>The slope of the CAL is familiar to us. If we take the derivative w.r.t <span class="math inline">\(\sigma_P\)</span>, we obtain:</p>
<p><span class="math display">\[
\frac{d\mu_P}{d\sigma_P} = \frac{\mu_A - r_f}{\sigma_A}
\]</span></p>
<p>Note from the previous chapters that it puts an excess return in relation to the risk. This is also known as <strong>Sharpe Ratio</strong>, which measures the <strong>risk premium per additional unit of risk</strong>. The Sharpe ratio ultimately quantifies the efficiency of different risky and risk-free portfolio combinations. In essence, we understand that the <strong>portfolio with the higher Sharpe Ratio is more efficient than the portfolio with the lower ratio</strong>. Consequently, these portfolio variations according to weight assignments will induce a <strong>steeper slope</strong>. This is the reason for the appeal of the Sharpe Ratio in investment assessments.</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First define some return and risk characteristics</span></span>
<span id="cb424-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-2" aria-hidden="true" tabindex="-1"></a>mu_A <span class="ot">=</span> <span class="fl">0.149</span></span>
<span id="cb424-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-3" aria-hidden="true" tabindex="-1"></a>sigma_A <span class="ot">=</span> <span class="fl">0.265</span></span>
<span id="cb424-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-4" aria-hidden="true" tabindex="-1"></a>mu_B <span class="ot">=</span> <span class="fl">0.074</span></span>
<span id="cb424-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-6" aria-hidden="true" tabindex="-1"></a>mu_B <span class="ot">=</span> <span class="fl">0.067</span></span>
<span id="cb424-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-7" aria-hidden="true" tabindex="-1"></a>sigma_B <span class="ot">=</span> <span class="fl">0.167</span></span>
<span id="cb424-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-9" aria-hidden="true" tabindex="-1"></a>mu_f <span class="ot">=</span> <span class="fl">0.035</span></span>
<span id="cb424-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-10" aria-hidden="true" tabindex="-1"></a>sigma_f <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb424-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-12" aria-hidden="true" tabindex="-1"></a>rho_Af <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb424-13"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-13" aria-hidden="true" tabindex="-1"></a>sigma_Af <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb424-14"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-15"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-15" aria-hidden="true" tabindex="-1"></a>rho_Bf <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb424-16"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-16" aria-hidden="true" tabindex="-1"></a>sigma_Bf <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb424-17"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-18"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we also define a sequence of 30 portfolio weights for A and B</span></span>
<span id="cb424-19"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-19" aria-hidden="true" tabindex="-1"></a>x_A <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="sc">-</span><span class="fl">0.8</span>, <span class="at">to=</span><span class="fl">2.2</span>, <span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb424-20"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-20" aria-hidden="true" tabindex="-1"></a>x_f <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> x_A</span>
<span id="cb424-21"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-22"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the expected return as well as the variance and standard deviation of each portfolios</span></span>
<span id="cb424-23"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-23" aria-hidden="true" tabindex="-1"></a>mu_Af <span class="ot">=</span> x_A<span class="sc">*</span>mu_A <span class="sc">+</span> x_f<span class="sc">*</span>mu_f</span>
<span id="cb424-24"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-24" aria-hidden="true" tabindex="-1"></a>var_Af <span class="ot">=</span> x_A<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_A<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> x_f<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_f<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>x_A<span class="sc">*</span>x_f<span class="sc">*</span>sigma_Af</span>
<span id="cb424-25"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-25" aria-hidden="true" tabindex="-1"></a>sd_Af <span class="ot">=</span> <span class="fu">sqrt</span>(var_Af)</span>
<span id="cb424-26"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-27"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Do the same for PF B</span></span>
<span id="cb424-28"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-28" aria-hidden="true" tabindex="-1"></a>x_B <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="sc">-</span><span class="fl">0.8</span>, <span class="at">to=</span><span class="fl">2.2</span>, <span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb424-29"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-29" aria-hidden="true" tabindex="-1"></a>x_f <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> x_B</span>
<span id="cb424-30"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-31"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-31" aria-hidden="true" tabindex="-1"></a>mu_Bf <span class="ot">=</span> x_B<span class="sc">*</span>mu_B <span class="sc">+</span> x_f<span class="sc">*</span>mu_f</span>
<span id="cb424-32"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-32" aria-hidden="true" tabindex="-1"></a>var_Bf <span class="ot">=</span> x_B<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_B<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> x_f<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_f<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>x_B<span class="sc">*</span>x_f<span class="sc">*</span>sigma_Bf</span>
<span id="cb424-33"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-33" aria-hidden="true" tabindex="-1"></a>sd_Bf <span class="ot">=</span> <span class="fu">sqrt</span>(var_Bf)</span>
<span id="cb424-34"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-35"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame for the relationship</span></span>
<span id="cb424-36"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-36" aria-hidden="true" tabindex="-1"></a>risk_return_df_rf <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(mu_Af, sd_Af, mu_Bf, sd_Bf, x_A, x_f))</span>
<span id="cb424-37"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-37" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(risk_return_df_rf) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Portfolio_Return_A&quot;</span>, <span class="st">&quot;Portfolio_Risk_A&quot;</span>, <span class="st">&quot;Portfolio_Return_B&quot;</span>, <span class="st">&quot;Portfolio_Risk_B&quot;</span>, <span class="st">&quot;Weight_A&quot;</span>, <span class="st">&quot;Weight_B&quot;</span>)</span>
<span id="cb424-38"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-39"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset with only efficient PFs</span></span>
<span id="cb424-40"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-40" aria-hidden="true" tabindex="-1"></a>risk_return_df_rf_sub <span class="ot">&lt;-</span> <span class="fu">subset</span>(risk_return_df_rf, Weight_A <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb424-41"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-42"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s visualise the relationship</span></span>
<span id="cb424-43"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-43" aria-hidden="true" tabindex="-1"></a>risk_return_df_rf_sub <span class="sc">%&gt;%</span> </span>
<span id="cb424-44"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk_A, <span class="at">y =</span> Portfolio_Return_A)) <span class="sc">+</span> </span>
<span id="cb424-45"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>,) <span class="sc">+</span> </span>
<span id="cb424-46"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;dodgerblue2&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk_B, <span class="at">y =</span> Portfolio_Return_B)) <span class="sc">+</span></span>
<span id="cb424-47"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.35</span> ,<span class="at">y =</span> <span class="fl">0.16</span>, <span class="at">label =</span> <span class="st">&quot;Portfolio A CAL&quot;</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span></span>
<span id="cb424-48"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.25</span> ,<span class="at">y =</span> <span class="fl">0.065</span>, <span class="at">label =</span> <span class="st">&quot;Portfolio B CAL&quot;</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">&quot;dodgerblue2&quot;</span>) <span class="sc">+</span></span>
<span id="cb424-49"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="sc">-</span><span class="fl">0.02</span> ,<span class="at">y =</span> <span class="fl">0.05</span>, <span class="at">label =</span> <span class="st">&quot;risk-free&quot;</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb424-50"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(mu[p])) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="fu">expression</span>(sigma[p])) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Portfolio Frontier for 30 PFs - Comparison of risk-free and risky portfolios&quot;</span>) <span class="sc">+</span></span>
<span id="cb424-51"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb424-52"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb424-53"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb424-54"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb424-55"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb424-56"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb424-57"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb424-58"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb424-59"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb424-60"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb424-61"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb424-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-230-1.png" width="672" /></p>
<p>As we can see, the Slope of PF A is higher than the slope of PF B. Accordingly, for each unit of risk, we have a superior excess return profile. We can also quantify this by calculating the Sharpe Ratio directly. In our case, this is the following.</p>
<pre><code>## [1] &quot;The Sharpe Ratio of Asset A is 0.43 and the Sharpe Ratio of Asset B is 0.27&quot;</code></pre>
</div>
</div>
<div id="markowitz-portfolio-theory-with-two-risky-and-a-risk-free-asset" class="section level2" number="7.3">
<h2><span class="header-section-number">7.3</span> Markowitz Portfolio Theory with two Risky and a Risk-Free Asset</h2>
<p>In a next step, we can try to quantify a portfolio consisting of three assets, whereas two are risky and one is risk-free. From earlier results we understand that any linear combination of two portfolios consisting of a risky and the same risk-free asset will also follow a linear slope. Given the two different CALs of portfolio A and B in the previous chapter, it is logical that a weighted average of both returns and risk will quantify the slope of the resulting portfolio. Consequently, the efficient set of portfolios will be a straight line with intercept in <span class="math inline">\(r_f\)</span>. Further, we need to understand whether a linear combination of the assets induces a more efficient portfolio, compared to if we would only invest in one risky asset and the risk-free. As such, we can derive that the three-piece portfolio must have the <strong>maximum slope while it still incorporates any linear combination of risky assets</strong>. Consequently, we need to solve for a <strong>constrained maximisation of the Sharpe Ratio</strong> to obtain the optimal, or most efficient, slope and derive the optimal weighting of the individual assets. In order to find this, we need to define the <strong>Tangency Portfolio</strong>.</p>
<div id="tangency-portfolio" class="section level3" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> Tangency Portfolio</h3>
<p>The <strong>Tangency Portfolio</strong> represents the portfolio in which the <strong>CAL of the three-piece portfolio is exactly tangent to the set of differently weighted risky asset only portfolios</strong>. In essence, it is the portfolio which is a combination of the two risky and the risk-free assets such that it is in the set of feasible risky assets and maximises the slope of the CAL. It is the portfolio which has the best possible excess return per additional unit of risk. Geometrically speaking, this is the “steepest sloped”, or most efficient, portfolio combination we can attain conditional on the fact that the portfolio must consist of a linear combination of the assets under consideration. As a consequence, portfolios consisting of the risk-free asset as well as the tangency portfolio are the efficient portfolio consisting of risk-free and risky assets.</p>
<p>Let’s visually depict this in more detail below.</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First define some return and risk characteristics</span></span>
<span id="cb426-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-2" aria-hidden="true" tabindex="-1"></a>mu_A <span class="ot">=</span> <span class="fl">0.149</span></span>
<span id="cb426-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-3" aria-hidden="true" tabindex="-1"></a>sigma_A <span class="ot">=</span> <span class="fl">0.265</span></span>
<span id="cb426-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-4" aria-hidden="true" tabindex="-1"></a>mu_B <span class="ot">=</span> <span class="fl">0.074</span></span>
<span id="cb426-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-6" aria-hidden="true" tabindex="-1"></a>mu_B <span class="ot">=</span> <span class="fl">0.067</span></span>
<span id="cb426-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-7" aria-hidden="true" tabindex="-1"></a>sigma_B <span class="ot">=</span> <span class="fl">0.167</span></span>
<span id="cb426-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-9" aria-hidden="true" tabindex="-1"></a>mu_f <span class="ot">=</span> <span class="fl">0.035</span></span>
<span id="cb426-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-10" aria-hidden="true" tabindex="-1"></a>sigma_f <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb426-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-12" aria-hidden="true" tabindex="-1"></a>rho_Af <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb426-13"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-13" aria-hidden="true" tabindex="-1"></a>sigma_Af <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb426-14"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-15"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-15" aria-hidden="true" tabindex="-1"></a>rho_Bf <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb426-16"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-16" aria-hidden="true" tabindex="-1"></a>sigma_Bf <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb426-17"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-18"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we also define a sequence of 30 portfolio weights for A and B</span></span>
<span id="cb426-19"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-19" aria-hidden="true" tabindex="-1"></a>x_A <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="sc">-</span><span class="fl">0.8</span>, <span class="at">to=</span><span class="fl">2.2</span>, <span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb426-20"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-20" aria-hidden="true" tabindex="-1"></a>x_f <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> x_A</span>
<span id="cb426-21"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-22"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the expected return as well as the variance and standard deviation of each portfolios</span></span>
<span id="cb426-23"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-23" aria-hidden="true" tabindex="-1"></a>mu_Af <span class="ot">=</span> x_A<span class="sc">*</span>mu_A <span class="sc">+</span> x_f<span class="sc">*</span>mu_f</span>
<span id="cb426-24"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-24" aria-hidden="true" tabindex="-1"></a>var_Af <span class="ot">=</span> x_A<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_A<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> x_f<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_f<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>x_A<span class="sc">*</span>x_f<span class="sc">*</span>sigma_Af</span>
<span id="cb426-25"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-25" aria-hidden="true" tabindex="-1"></a>sd_Af <span class="ot">=</span> <span class="fu">sqrt</span>(var_Af)</span>
<span id="cb426-26"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-27"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Do the same for PF B</span></span>
<span id="cb426-28"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-28" aria-hidden="true" tabindex="-1"></a>x_B <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="sc">-</span><span class="fl">0.8</span>, <span class="at">to=</span><span class="fl">2.2</span>, <span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb426-29"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-29" aria-hidden="true" tabindex="-1"></a>x_f <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> x_B</span>
<span id="cb426-30"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-31"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-31" aria-hidden="true" tabindex="-1"></a>mu_Bf <span class="ot">=</span> x_B<span class="sc">*</span>mu_B <span class="sc">+</span> x_f<span class="sc">*</span>mu_f</span>
<span id="cb426-32"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-32" aria-hidden="true" tabindex="-1"></a>var_Bf <span class="ot">=</span> x_B<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_B<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> x_f<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_f<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>x_B<span class="sc">*</span>x_f<span class="sc">*</span>sigma_Bf</span>
<span id="cb426-33"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-33" aria-hidden="true" tabindex="-1"></a>sd_Bf <span class="ot">=</span> <span class="fu">sqrt</span>(var_Bf)</span>
<span id="cb426-34"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-35"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame for the relationship</span></span>
<span id="cb426-36"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-36" aria-hidden="true" tabindex="-1"></a>risk_return_df_rf <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(mu_Af, sd_Af, mu_Bf, sd_Bf, x_A, x_f))</span>
<span id="cb426-37"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-37" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(risk_return_df_rf) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Portfolio_Return_A&quot;</span>, <span class="st">&quot;Portfolio_Risk_A&quot;</span>, <span class="st">&quot;Portfolio_Return_B&quot;</span>, <span class="st">&quot;Portfolio_Risk_B&quot;</span>, <span class="st">&quot;Weight_A&quot;</span>, <span class="st">&quot;Weight_B&quot;</span>)</span>
<span id="cb426-38"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-39"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset with only efficient PFs</span></span>
<span id="cb426-40"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-40" aria-hidden="true" tabindex="-1"></a>risk_return_df_rf_sub <span class="ot">&lt;-</span> <span class="fu">subset</span>(risk_return_df_rf, Weight_A <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb426-41"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-42"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s visualise the relationship</span></span>
<span id="cb426-43"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-43" aria-hidden="true" tabindex="-1"></a>risk_return_df_rf_sub <span class="sc">%&gt;%</span> </span>
<span id="cb426-44"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk_A, <span class="at">y =</span> Portfolio_Return_A)) <span class="sc">+</span> </span>
<span id="cb426-45"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span> </span>
<span id="cb426-46"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> risk_return_df, <span class="fu">aes</span>(<span class="at">x =</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span> </span>
<span id="cb426-47"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;dodgerblue2&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk_B, <span class="at">y =</span> Portfolio_Return_B)) <span class="sc">+</span></span>
<span id="cb426-48"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.35</span> ,<span class="at">y =</span> <span class="fl">0.22</span>, <span class="at">label =</span> <span class="st">&quot;Portfolio A CAL&quot;</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span></span>
<span id="cb426-49"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.35</span> ,<span class="at">y =</span> <span class="fl">0.08</span>, <span class="at">label =</span> <span class="st">&quot;Portfolio B CAL&quot;</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">&quot;dodgerblue2&quot;</span>) <span class="sc">+</span></span>
<span id="cb426-50"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="sc">-</span><span class="fl">0.02</span> ,<span class="at">y =</span> <span class="fl">0.05</span>, <span class="at">label =</span> <span class="st">&quot;risk-free&quot;</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb426-51"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.55</span> ,<span class="at">y =</span> <span class="fl">0.19</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&#39;Set of Risky Asset portfolios&#39;</span>), <span class="at">size =</span> <span class="dv">3</span>,  <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb426-52"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(risk_return_df, Weight_A <span class="sc">==</span> <span class="dv">1</span>), <span class="at">color =</span> <span class="st">&quot;springgreen4&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span> </span>
<span id="cb426-53"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(risk_return_df, Weight_B <span class="sc">==</span> <span class="dv">1</span>), <span class="at">color =</span> <span class="st">&quot;darkorchid1&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb426-54"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(risk_return_df, Weight_B <span class="sc">==</span> <span class="fl">0.7</span>), <span class="at">color =</span> <span class="st">&quot;firebrick3&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span> </span>
<span id="cb426-55"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.22</span> ,<span class="at">y =</span> <span class="fl">0.16</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&#39;PF of Asset A only&#39;</span>), <span class="at">size =</span> <span class="dv">3</span>,  <span class="at">color =</span> <span class="st">&quot;springgreen4&quot;</span>) <span class="sc">+</span></span>
<span id="cb426-56"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.25</span> ,<span class="at">y =</span> <span class="fl">0.065</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&#39;PF of Asset B only&#39;</span>), <span class="at">size =</span> <span class="dv">3</span>,  <span class="at">color =</span> <span class="st">&quot;darkorchid1&quot;</span>) <span class="sc">+</span></span>
<span id="cb426-57"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.065</span> ,<span class="at">y =</span> <span class="fl">0.09</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&#39;PF of Asset A and B&#39;</span>), <span class="at">size =</span> <span class="dv">3</span>,  <span class="at">color =</span> <span class="st">&quot;firebrick3&quot;</span>) <span class="sc">+</span></span>
<span id="cb426-58"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(mu[p])) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="fu">expression</span>(sigma[p])) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Efficient portfolios, risky asset portfolios and the CAL&quot;</span>) <span class="sc">+</span></span>
<span id="cb426-59"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb426-60"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb426-61"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb426-62"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb426-63"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb426-64"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb426-65"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb426-66"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb426-67"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb426-68"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-68" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb426-69"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb426-69" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-232-1.png" width="672" /></p>
<p>This shows well the constrained optimisation problem. In essence, we need to find a portfolio such that we can have the maximal slope of the CAL of the linear combination of the assets while still be in the set of feasible portfolios, which is defined by the set of risky asset portfolios. Consequently, the resulting portfolio must either cross or be tangent to the weighted risky asset portfolio path. As we can see, this is currently only the case for three weighted portfolios. The first is indicated with a purple dot, displaying the portfolio of only investing in Asset B. The second is the green dot, displaying the portfolio of only investing in Asset A. The third one is the red dot, displaying the portfolio for investing in both Asset A and B (In our case, this is a 30-70 split in Asset A and B, respectively). As we can already see graphically, the red and green portfolio are more efficient than the purple portfolio, and red and green have the same efficiency. We already calculated the individual Sharpe Ratios in the previous chapter.</p>
<pre><code>## [1] &quot;The Sharpe Ratio of Asset A of Asset AB is 0.43 and the Sharpe Ratio of Asset B is 0.27&quot;</code></pre>
<p>However, we can further improve the slope of the CAL and thus induce a more efficient portfolio combination by only slightly “touching” the set of feasible risky assets. That is, we can find a slope such that we are tangent to this set. This can be achieved by <strong>solving for the tangency portfolio</strong>.</p>
<p>Mathematically, we do so by solving a <em>constrained maximisation problem</em>. This problem looks as follows:</p>
<p><span class="math display">\[
\begin{align}
\max_{x_A, x_B} \frac{\mu_P - r_f}{\sigma_P} s.t. \\
\mu_P &amp;= x_A\mu_A + x_B\mu_B \\
\sigma_P &amp;= \sqrt{x_A^2\sigma_A^2 + x_B^2\sigma_B^2 + 2x_Ax_B\sigma_{AB}}\\
x_A + x_B &amp;= 1
\end{align}
\]</span></p>
<p>As we already did in the risky assets only case, we can now perform substitution of <span class="math inline">\(x_B = 1 - x_A\)</span> and insert the conditions into the maximisation problem and then solve w.r.t <span class="math inline">\(x_A\)</span>. Without going into the derivation based on straight-forward calculus methods, when performing all these steps we obtain:</p>
<p><span class="math display">\[
\begin{align}
x_A^{t} &amp;= \frac{(\mu_A - r_f)\sigma_B^2 - (\mu_B - r_f)\sigma_{AB}}{(\mu_A - r_f)\sigma_B^2 + (\mu_B - r_f)\sigma_A^2 - (\mu_A + \mu_B - 2r_f)\sigma_{AB}} \\
x_B^{t} &amp;= 1 - x_A^{t}
\end{align}
\]</span></p>
<p>With this formula, we obtain the optimal weights for both the risky assets such that we have a three-piece portfolio with the steepest efficient and attainable slope that maximises the excess return per additional unit of risk.</p>
<p>Let’s quickly calculate this.</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the tangency portfolio weights</span></span>
<span id="cb428-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-2" aria-hidden="true" tabindex="-1"></a>x_t_A <span class="ot">=</span> ((mu_A <span class="sc">-</span> mu_f)<span class="sc">*</span>sigma_B<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> (mu_B <span class="sc">-</span> mu_f)<span class="sc">*</span>sigma_AB) <span class="sc">/</span> ((mu_A <span class="sc">-</span> mu_f)<span class="sc">*</span>sigma_B<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (mu_B <span class="sc">-</span> mu_f)<span class="sc">*</span>sigma_A<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> (mu_A <span class="sc">+</span> mu_B <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>mu_f)<span class="sc">*</span>sigma_AB)</span>
<span id="cb428-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-3" aria-hidden="true" tabindex="-1"></a>x_t_B <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> x_t_A</span>
<span id="cb428-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the mean return and standard deviation</span></span>
<span id="cb428-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-6" aria-hidden="true" tabindex="-1"></a>mu_t_AB <span class="ot">&lt;-</span> x_t_A<span class="sc">*</span>mu_A <span class="sc">+</span> x_t_B<span class="sc">*</span>mu_B</span>
<span id="cb428-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-7" aria-hidden="true" tabindex="-1"></a>sigma_t_AB <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(x_t_A<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_A<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> x_t_B<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_B<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>x_t_A<span class="sc">*</span>x_t_B<span class="sc">*</span>sigma_AB)</span>
<span id="cb428-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the Sharpe Ratio</span></span>
<span id="cb428-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-10" aria-hidden="true" tabindex="-1"></a>SR_t_AB <span class="ot">&lt;-</span> (mu_t_AB <span class="sc">-</span> mu_f) <span class="sc">/</span> sigma_t_AB</span>
<span id="cb428-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame for all three combinations</span></span>
<span id="cb428-13"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-13" aria-hidden="true" tabindex="-1"></a>df_t_AB <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(x_t_A, x_t_B, mu_t_AB, sigma_t_AB, SR_t_AB))</span>
<span id="cb428-14"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df_t_AB) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Weight A&quot;</span>, <span class="st">&quot;Weight B&quot;</span>, <span class="st">&quot;Expected Return&quot;</span>, <span class="st">&quot;Standard Deviation&quot;</span>, <span class="st">&quot;Sharpe Ratio&quot;</span>)</span>
<span id="cb428-15"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-15" aria-hidden="true" tabindex="-1"></a>df_A <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(<span class="dv">1</span>, <span class="dv">0</span>, mu_A, sigma_A, SR_A))</span>
<span id="cb428-16"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-16" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df_A) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Weight A&quot;</span>, <span class="st">&quot;Weight B&quot;</span>, <span class="st">&quot;Expected Return&quot;</span>, <span class="st">&quot;Standard Deviation&quot;</span>, <span class="st">&quot;Sharpe Ratio&quot;</span>)</span>
<span id="cb428-17"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-17" aria-hidden="true" tabindex="-1"></a>df_B <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(<span class="dv">0</span>, <span class="dv">1</span>, mu_B, sigma_B, SR_B))</span>
<span id="cb428-18"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-18" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df_B) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Weight A&quot;</span>, <span class="st">&quot;Weight B&quot;</span>, <span class="st">&quot;Expected Return&quot;</span>, <span class="st">&quot;Standard Deviation&quot;</span>, <span class="st">&quot;Sharpe Ratio&quot;</span>)</span>
<span id="cb428-19"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-20"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the frame </span></span>
<span id="cb428-21"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-21" aria-hidden="true" tabindex="-1"></a>df_total <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(<span class="fu">round</span>(df_t_AB,<span class="dv">3</span>), <span class="fu">round</span>(df_A,<span class="dv">3</span>), <span class="fu">round</span>(df_B, <span class="dv">3</span>)))</span>
<span id="cb428-22"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-22" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(df_total) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Tangency PF&quot;</span>, <span class="st">&quot;PF A&quot;</span>, <span class="st">&quot;PF B&quot;</span>)</span>
<span id="cb428-23"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-24"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the results</span></span>
<span id="cb428-25"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb428-25" aria-hidden="true" tabindex="-1"></a>df_total</span></code></pre></div>
<pre><code>##             Weight A Weight B Expected Return Standard Deviation Sharpe Ratio
## Tangency PF    0.535    0.465           0.111              0.152        0.499
## PF A           1.000    0.000           0.149              0.265        0.430
## PF B           0.000    1.000           0.067              0.167        0.192</code></pre>
<p>As we can see, a portfolio consisting of <strong>53.5 % of Asset A and 46.5% of Asset B</strong> induces the highest Sharpe Ratio and thus has the steepest CAL slope. Consequently, this portfolio is <strong>feasible and efficient</strong>, as we can visualise below:</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First define some return and risk characteristics</span></span>
<span id="cb430-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-2" aria-hidden="true" tabindex="-1"></a>mu_A <span class="ot">=</span> <span class="fl">0.149</span></span>
<span id="cb430-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-3" aria-hidden="true" tabindex="-1"></a>sigma_A <span class="ot">=</span> <span class="fl">0.265</span></span>
<span id="cb430-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-4" aria-hidden="true" tabindex="-1"></a>mu_B <span class="ot">=</span> <span class="fl">0.074</span></span>
<span id="cb430-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-6" aria-hidden="true" tabindex="-1"></a>mu_B <span class="ot">=</span> <span class="fl">0.067</span></span>
<span id="cb430-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-7" aria-hidden="true" tabindex="-1"></a>sigma_B <span class="ot">=</span> <span class="fl">0.167</span></span>
<span id="cb430-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-9" aria-hidden="true" tabindex="-1"></a>mu_f <span class="ot">=</span> <span class="fl">0.035</span></span>
<span id="cb430-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-10" aria-hidden="true" tabindex="-1"></a>sigma_f <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb430-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-12" aria-hidden="true" tabindex="-1"></a>rho_Af <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb430-13"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-13" aria-hidden="true" tabindex="-1"></a>sigma_Af <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb430-14"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-15"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-15" aria-hidden="true" tabindex="-1"></a>rho_Bf <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb430-16"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-16" aria-hidden="true" tabindex="-1"></a>sigma_Bf <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb430-17"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-18"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we also define a sequence of 30 portfolio weights for A and B</span></span>
<span id="cb430-19"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-19" aria-hidden="true" tabindex="-1"></a>x_A <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="sc">-</span><span class="fl">0.8</span>, <span class="at">to=</span><span class="fl">2.2</span>, <span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb430-20"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-20" aria-hidden="true" tabindex="-1"></a>x_f <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> x_A</span>
<span id="cb430-21"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-22"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the expected return as well as the variance and standard deviation of each portfolios</span></span>
<span id="cb430-23"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-23" aria-hidden="true" tabindex="-1"></a>mu_Af <span class="ot">=</span> x_A<span class="sc">*</span>mu_A <span class="sc">+</span> x_f<span class="sc">*</span>mu_f</span>
<span id="cb430-24"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-24" aria-hidden="true" tabindex="-1"></a>var_Af <span class="ot">=</span> x_A<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_A<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> x_f<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_f<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>x_A<span class="sc">*</span>x_f<span class="sc">*</span>sigma_Af</span>
<span id="cb430-25"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-25" aria-hidden="true" tabindex="-1"></a>sd_Af <span class="ot">=</span> <span class="fu">sqrt</span>(var_Af)</span>
<span id="cb430-26"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-27"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Do the same for PF B</span></span>
<span id="cb430-28"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-28" aria-hidden="true" tabindex="-1"></a>x_B <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="sc">-</span><span class="fl">0.8</span>, <span class="at">to=</span><span class="fl">2.2</span>, <span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb430-29"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-29" aria-hidden="true" tabindex="-1"></a>x_f <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> x_B</span>
<span id="cb430-30"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-31"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-31" aria-hidden="true" tabindex="-1"></a>mu_Bf <span class="ot">=</span> x_B<span class="sc">*</span>mu_B <span class="sc">+</span> x_f<span class="sc">*</span>mu_f</span>
<span id="cb430-32"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-32" aria-hidden="true" tabindex="-1"></a>var_Bf <span class="ot">=</span> x_B<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_B<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> x_f<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_f<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>x_B<span class="sc">*</span>x_f<span class="sc">*</span>sigma_Bf</span>
<span id="cb430-33"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-33" aria-hidden="true" tabindex="-1"></a>sd_Bf <span class="ot">=</span> <span class="fu">sqrt</span>(var_Bf)</span>
<span id="cb430-34"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-35"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame for the relationship</span></span>
<span id="cb430-36"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-36" aria-hidden="true" tabindex="-1"></a>risk_return_df_rf <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(mu_Af, sd_Af, mu_Bf, sd_Bf, x_A, x_f))</span>
<span id="cb430-37"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-37" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(risk_return_df_rf) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Portfolio_Return_A&quot;</span>, <span class="st">&quot;Portfolio_Risk_A&quot;</span>, <span class="st">&quot;Portfolio_Return_B&quot;</span>, <span class="st">&quot;Portfolio_Risk_B&quot;</span>, <span class="st">&quot;Weight_A&quot;</span>, <span class="st">&quot;Weight_B&quot;</span>)</span>
<span id="cb430-38"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-39"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset with only efficient PFs</span></span>
<span id="cb430-40"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-40" aria-hidden="true" tabindex="-1"></a>risk_return_df_rf_sub <span class="ot">&lt;-</span> <span class="fu">subset</span>(risk_return_df_rf, Weight_A <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb430-41"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-42"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s visualise the relationship</span></span>
<span id="cb430-43"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-43" aria-hidden="true" tabindex="-1"></a>risk_return_df_rf_sub <span class="sc">%&gt;%</span> </span>
<span id="cb430-44"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk_A, <span class="at">y =</span> Portfolio_Return_A)) <span class="sc">+</span> </span>
<span id="cb430-45"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span> </span>
<span id="cb430-46"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> risk_return_df, <span class="fu">aes</span>(<span class="at">x =</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span> </span>
<span id="cb430-47"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;dodgerblue2&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk_B, <span class="at">y =</span> Portfolio_Return_B)) <span class="sc">+</span></span>
<span id="cb430-48"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.55</span> ,<span class="at">y =</span> <span class="fl">0.25</span>, <span class="at">label =</span> <span class="st">&quot;Portfolio A CAL&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span></span>
<span id="cb430-49"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.35</span> ,<span class="at">y =</span> <span class="fl">0.08</span>, <span class="at">label =</span> <span class="st">&quot;Portfolio B CAL&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">&quot;dodgerblue2&quot;</span>) <span class="sc">+</span></span>
<span id="cb430-50"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="sc">-</span><span class="fl">0.02</span> ,<span class="at">y =</span> <span class="fl">0.05</span>, <span class="at">label =</span> <span class="st">&quot;risk-free&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb430-51"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.55</span> ,<span class="at">y =</span> <span class="fl">0.19</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&#39;Set of Risky Asset portfolios&#39;</span>), <span class="at">size =</span> <span class="dv">3</span>,  <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb430-52"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(risk_return_df, Weight_A <span class="sc">==</span> <span class="dv">1</span>), <span class="at">color =</span> <span class="st">&quot;springgreen4&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span> </span>
<span id="cb430-53"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(risk_return_df, Weight_B <span class="sc">==</span> <span class="dv">1</span>), <span class="at">color =</span> <span class="st">&quot;darkorchid1&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb430-54"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>sigma_t_AB, <span class="at">y =</span> mu_t_AB), <span class="at">color =</span> <span class="st">&quot;darkorange3&quot;</span>) <span class="sc">+</span> </span>
<span id="cb430-55"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.085</span> ,<span class="at">y =</span> <span class="fl">0.12</span>, <span class="at">label =</span> <span class="st">&quot;Tangency portfolio&quot;</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">&quot;darkorange3&quot;</span>) <span class="sc">+</span></span>
<span id="cb430-56"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(mu[p])) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="fu">expression</span>(sigma[p])) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Tangency portfolio, efficient and feasible portfolios&quot;</span>) <span class="sc">+</span></span>
<span id="cb430-57"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb430-58"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb430-59"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb430-60"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb430-61"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb430-62"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb430-63"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb430-64"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb430-65"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb430-66"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb430-67"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb430-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-235-1.png" width="672" /></p>
</div>
<div id="mutual-fund-theorem-and-derivation-of-the-capital-market-line-cml" class="section level3" number="7.3.2">
<h3><span class="header-section-number">7.3.2</span> Mutual Fund Theorem and Derivation of the Capital Market Line (CML)</h3>
<p>We now obtained a calculative method to get the weights of both risky assets such that we can maximise the sharpe ratio and obtain efficient and feasible portfolios. Now, we still need to incorporate the risk-free asset into our portfolio. We stated that the efficient portfolios are a combination of risk-free assets and the tangency portfolio. Consequently, they can lie on the line with <strong>intercept of the risk-free rate and slope of the Sharpe Ratio of the tangency portfolio</strong>. Thus, we can derive the formula for the efficient and feasible set of portfolios in the same way as we did for the usual CAL.</p>
<p>To do so, we first calculate the expected return as well as standard deviation of a portfolio consisting of the tangency portfolio and the risk-free asset.</p>
<p><span class="math display">\[
\begin{align}
\mu_P^e &amp;= x_{tan}\cdot \mu_{tan} + (1-x_{tan})\cdot r_f = r_f + x_{tan}\cdot (\mu_{tan} - r_f) \\
\sigma_P^e &amp;= x_{tan}\cdot \sigma_{tan}
\end{align}
\]</span></p>
<p>whereas <span class="math inline">\(x_{tan}\)</span> is the weight we want to invest in the tangency portfolio (similar to the CAL in which we defined the weight into the risky asset). In this case, the tangency portfolio can be considered as a <strong>mutual fund</strong> two risky assets.</p>
<p>The optimal allocation of risky and risk-free assets in this case depends on so-called <strong>investor preferences</strong>. If the investor is <strong>risk-averse</strong>, then she will choose portfolios with a low volatility, implying a larger investment share in the risk-free asset. If she is <strong>risk-seeking</strong>, then she will choose portfolios with a higher volatility, implying a larger investment share in the risky asset. However, all the weighted portfolios of the risk-free asset and the tangency portfolio are efficient and feasible.</p>
<p>The CAL which combines all these portfolios is also called the <strong>Capital Market Line (CML)</strong>. The slope of the CML is the maximum Sharpe Ratio. Consequently, we can derive the expected return by combining both formulas.</p>
<p><span class="math display">\[
x_{tan} = \frac{\sigma_P^e} {\sigma_{tan}}
\]</span></p>
<p>This implies again that the optimal weight is proportional to the relative standard deviations of the tangency portfolio (= optimal risky portfolio) and the overall portfolio. Substituting again gives us then the <strong>CML</strong> as:</p>
<p><span class="math display">\[
\mu_P^e = r_f + \frac{\sigma_P^e}{\sigma_{tan}} \cdot(\mu_{tan} - r_f)
\]</span></p>
<p>In this case, we can again take the first derivative of the portfolio return, <span class="math inline">\(\mu_P^e\)</span>, w.r.t the risk of the portfolio, <span class="math inline">\(\sigma_P^e\)</span>, and obtain the slope of the efficient and feasible CAL, which is the <strong>Sharpe Ratio of the Tangency Portfolio</strong>:</p>
<p><span class="math display">\[
\frac{\delta \mu_P^e}{\delta \sigma_P^e} = SR_{tan} = \frac{\mu_{tan} - r_f}{\sigma_{tan}}
\]</span></p>
<p>Similar to the CAL before, this is the excess return per additional unit of risk. In the case of the tangency portfolio, this is both efficient and feasible, implying that it has the best ratio of all weighted portfolios. This makes sense, given the theoretical foundations we discussed earlier.</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First define some return and risk characteristics</span></span>
<span id="cb431-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-2" aria-hidden="true" tabindex="-1"></a>mu_A <span class="ot">=</span> <span class="fl">0.149</span></span>
<span id="cb431-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-3" aria-hidden="true" tabindex="-1"></a>sigma_A <span class="ot">=</span> <span class="fl">0.265</span></span>
<span id="cb431-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-4" aria-hidden="true" tabindex="-1"></a>mu_B <span class="ot">=</span> <span class="fl">0.074</span></span>
<span id="cb431-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-6" aria-hidden="true" tabindex="-1"></a>mu_B <span class="ot">=</span> <span class="fl">0.067</span></span>
<span id="cb431-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-7" aria-hidden="true" tabindex="-1"></a>sigma_B <span class="ot">=</span> <span class="fl">0.167</span></span>
<span id="cb431-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-9" aria-hidden="true" tabindex="-1"></a>mu_f <span class="ot">=</span> <span class="fl">0.035</span></span>
<span id="cb431-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-10" aria-hidden="true" tabindex="-1"></a>sigma_f <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb431-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-12" aria-hidden="true" tabindex="-1"></a>rho_Af <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb431-13"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-13" aria-hidden="true" tabindex="-1"></a>sigma_Af <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb431-14"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-15"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-15" aria-hidden="true" tabindex="-1"></a>rho_Bf <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb431-16"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-16" aria-hidden="true" tabindex="-1"></a>sigma_Bf <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb431-17"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-18"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we also define a sequence of 30 portfolio weights for A and B</span></span>
<span id="cb431-19"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-19" aria-hidden="true" tabindex="-1"></a>x_A <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="sc">-</span><span class="fl">0.8</span>, <span class="at">to=</span><span class="fl">2.2</span>, <span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb431-20"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-20" aria-hidden="true" tabindex="-1"></a>x_f <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> x_A</span>
<span id="cb431-21"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-22"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the expected return as well as the variance and standard deviation of each portfolios</span></span>
<span id="cb431-23"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-23" aria-hidden="true" tabindex="-1"></a>mu_Af <span class="ot">=</span> x_A<span class="sc">*</span>mu_A <span class="sc">+</span> x_f<span class="sc">*</span>mu_f</span>
<span id="cb431-24"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-24" aria-hidden="true" tabindex="-1"></a>var_Af <span class="ot">=</span> x_A<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_A<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> x_f<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_f<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>x_A<span class="sc">*</span>x_f<span class="sc">*</span>sigma_Af</span>
<span id="cb431-25"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-25" aria-hidden="true" tabindex="-1"></a>sd_Af <span class="ot">=</span> <span class="fu">sqrt</span>(var_Af)</span>
<span id="cb431-26"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-27"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Do the same for PF B</span></span>
<span id="cb431-28"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-28" aria-hidden="true" tabindex="-1"></a>x_B <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="sc">-</span><span class="fl">0.8</span>, <span class="at">to=</span><span class="fl">2.2</span>, <span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb431-29"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-29" aria-hidden="true" tabindex="-1"></a>x_f <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> x_B</span>
<span id="cb431-30"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-31"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-31" aria-hidden="true" tabindex="-1"></a>mu_Bf <span class="ot">=</span> x_B<span class="sc">*</span>mu_B <span class="sc">+</span> x_f<span class="sc">*</span>mu_f</span>
<span id="cb431-32"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-32" aria-hidden="true" tabindex="-1"></a>var_Bf <span class="ot">=</span> x_B<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_B<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> x_f<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_f<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>x_B<span class="sc">*</span>x_f<span class="sc">*</span>sigma_Bf</span>
<span id="cb431-33"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-33" aria-hidden="true" tabindex="-1"></a>sd_Bf <span class="ot">=</span> <span class="fu">sqrt</span>(var_Bf)</span>
<span id="cb431-34"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-35"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the tangency portfolio</span></span>
<span id="cb431-36"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-37"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-37" aria-hidden="true" tabindex="-1"></a><span class="do">## Define the sequence</span></span>
<span id="cb431-38"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-38" aria-hidden="true" tabindex="-1"></a>x_tan <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="sc">-</span><span class="fl">0.8</span>, <span class="at">to=</span><span class="fl">2.2</span>, <span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb431-39"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-39" aria-hidden="true" tabindex="-1"></a>x_f <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> x_tan</span>
<span id="cb431-40"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-41"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-41" aria-hidden="true" tabindex="-1"></a><span class="do">## Define the expected return and std of the tangency pf</span></span>
<span id="cb431-42"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-42" aria-hidden="true" tabindex="-1"></a>mu_tan <span class="ot">&lt;-</span> df_t_AB<span class="sc">$</span><span class="st">`</span><span class="at">Expected Return</span><span class="st">`</span></span>
<span id="cb431-43"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-43" aria-hidden="true" tabindex="-1"></a>sigma_tan <span class="ot">&lt;-</span> df_t_AB<span class="sc">$</span><span class="st">`</span><span class="at">Standard Deviation</span><span class="st">`</span></span>
<span id="cb431-44"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-45"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-45" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate the metrics</span></span>
<span id="cb431-46"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-46" aria-hidden="true" tabindex="-1"></a>mu_tanf <span class="ot">=</span> x_tan<span class="sc">*</span>mu_tan <span class="sc">+</span> x_f<span class="sc">*</span>mu_f</span>
<span id="cb431-47"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-47" aria-hidden="true" tabindex="-1"></a>var_tanf <span class="ot">=</span> x_tan<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_tan<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> x_f<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_f<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>x_tan<span class="sc">*</span>x_f<span class="sc">*</span>sigma_Af</span>
<span id="cb431-48"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-48" aria-hidden="true" tabindex="-1"></a>sd_tanf <span class="ot">=</span> <span class="fu">sqrt</span>(var_tanf)</span>
<span id="cb431-49"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-50"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame for the relationship</span></span>
<span id="cb431-51"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-51" aria-hidden="true" tabindex="-1"></a>risk_return_df_rf <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(mu_Af, sd_Af, mu_Bf, sd_Bf, mu_tanf, sd_tanf, x_A, x_f))</span>
<span id="cb431-52"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-52" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(risk_return_df_rf) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Portfolio_Return_A&quot;</span>, <span class="st">&quot;Portfolio_Risk_A&quot;</span>, <span class="st">&quot;Portfolio_Return_B&quot;</span>, <span class="st">&quot;Portfolio_Risk_B&quot;</span>, <span class="st">&quot;Portfolio_Return_Tangency_PF&quot;</span>, <span class="st">&quot;Portfolio_Risk_Tangency_PF&quot;</span>, <span class="st">&quot;Weight_A&quot;</span>, <span class="st">&quot;Weight_B&quot;</span>)</span>
<span id="cb431-53"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-54"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset with only efficient PFs</span></span>
<span id="cb431-55"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-55" aria-hidden="true" tabindex="-1"></a>risk_return_df_rf_sub <span class="ot">&lt;-</span> <span class="fu">subset</span>(risk_return_df_rf, Weight_A <span class="sc">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb431-56"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb431-57"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s visualise the relationship</span></span>
<span id="cb431-58"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-58" aria-hidden="true" tabindex="-1"></a>risk_return_df_rf_sub <span class="sc">%&gt;%</span> </span>
<span id="cb431-59"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk_A, <span class="at">y =</span> Portfolio_Return_A)) <span class="sc">+</span> </span>
<span id="cb431-60"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span> </span>
<span id="cb431-61"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span> </span>
<span id="cb431-62"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> risk_return_df, <span class="fu">aes</span>(<span class="at">x =</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span> </span>
<span id="cb431-63"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> risk_return_df, <span class="fu">aes</span>(<span class="at">x =</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span> </span>
<span id="cb431-64"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;dodgerblue2&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk_B, <span class="at">y =</span> Portfolio_Return_B)) <span class="sc">+</span></span>
<span id="cb431-65"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">color =</span> <span class="st">&quot;dodgerblue2&quot;</span>, <span class="fu">aes</span>(<span class="at">x =</span> Portfolio_Risk_B, <span class="at">y =</span> Portfolio_Return_B)) <span class="sc">+</span> </span>
<span id="cb431-66"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.55</span> ,<span class="at">y =</span> <span class="fl">0.25</span>, <span class="at">label =</span> <span class="st">&quot;Portfolio A CAL&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span></span>
<span id="cb431-67"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.35</span> ,<span class="at">y =</span> <span class="fl">0.08</span>, <span class="at">label =</span> <span class="st">&quot;Portfolio B CAL&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">&quot;dodgerblue2&quot;</span>) <span class="sc">+</span></span>
<span id="cb431-68"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="sc">-</span><span class="fl">0.02</span> ,<span class="at">y =</span> <span class="fl">0.05</span>, <span class="at">label =</span> <span class="st">&quot;risk-free&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb431-69"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.55</span> ,<span class="at">y =</span> <span class="fl">0.19</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&#39;Set of Risky Asset portfolios&#39;</span>), <span class="at">size =</span> <span class="dv">3</span>,  <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb431-70"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(risk_return_df, Weight_A <span class="sc">==</span> <span class="dv">1</span>), <span class="at">color =</span> <span class="st">&quot;springgreen4&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span> </span>
<span id="cb431-71"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(risk_return_df, Weight_B <span class="sc">==</span> <span class="dv">1</span>), <span class="at">color =</span> <span class="st">&quot;darkorchid1&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb431-72"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>sigma_t_AB, <span class="at">y =</span> mu_t_AB),  <span class="at">color =</span> <span class="st">&quot;darkorange3&quot;</span>) <span class="sc">+</span> </span>
<span id="cb431-73"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.085</span> ,<span class="at">y =</span> <span class="fl">0.12</span>, <span class="at">label =</span> <span class="st">&quot;Tangency portfolio&quot;</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">&quot;darkorange3&quot;</span>) <span class="sc">+</span></span>
<span id="cb431-74"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;aquamarine4&quot;</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk_Tangency_PF, <span class="at">y =</span> Portfolio_Return_Tangency_PF)) <span class="sc">+</span></span>
<span id="cb431-75"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">color =</span> <span class="st">&quot;aquamarine4&quot;</span>, <span class="fu">aes</span>(<span class="at">x =</span> Portfolio_Risk_Tangency_PF, <span class="at">y =</span> Portfolio_Return_Tangency_PF)) <span class="sc">+</span> </span>
<span id="cb431-76"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.22</span> ,<span class="at">y =</span> <span class="fl">0.23</span>, <span class="at">label =</span> <span class="st">&quot;Capital Market Line (CML) </span><span class="sc">\n</span><span class="st"> = Efficient &amp; Feasible CAL&quot;</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">&quot;aquamarine4&quot;</span>) <span class="sc">+</span></span>
<span id="cb431-77"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(mu[p])) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="fu">expression</span>(sigma[p])) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Tangency portfolio, efficient and feasible portfolios, CML&quot;</span>) <span class="sc">+</span></span>
<span id="cb431-78"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb431-79"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb431-80"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-80" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb431-81"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-81" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb431-82"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-82" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb431-83"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-83" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb431-84"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-84" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb431-85"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-85" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb431-86"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-86" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb431-87"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-87" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb431-88"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb431-88" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-236-1.png" width="672" /></p>
<p>The concept of the CML as efficient and feasible CAL is an important concept when considering asset returns in the case of the CAPM. The major difference is that</p>
<ul>
<li>the CAPM uses the systematic risk component (the covariance of the security with the market relative to the variance of the market) as factor which quantifies the excess return per additional unit of risk</li>
<li>the CAPM uses a Market portfolio instead of the tangency portfolio to account for the risk associated.</li>
</ul>
<p>However, we understand that a Market Portfolio is nothing else than a portfolio consisting of multiple assets. Consequently, before we can dive into the CAPM derivation, it is useful to consider MV optimisation cases in a general setting. That is, in settings in which we have N assets.</p>
</div>
</div>
<div id="markowitz-portfolio-theory-with-n-risky-assets" class="section level2" number="7.4">
<h2><span class="header-section-number">7.4</span> Markowitz Portfolio Theory with N Risky Assets</h2>
<p>In this chapter, we generalise the mean-variance optimisation of Markowitz. That is, we allow to incorporate a non-sparse model configuration of N assets, whereas N can be any potentially large number. Such a generalisation allows us to assess the MV portoflio allocation in real-world settings, and to comprehend whether a general allocation technique follows the same principles as the two-asset case. Further, by introducing the general case we can extend the idea of Markowitz one step further and draw a market portfolio consisting of these N assets. This will become especially handy when trying to bridge the idea of MV optimising investors related to systematic and idiosyncratic risk components, one of the foundations of the Capital Asset Pricing Model (CAPM).</p>
<p>However, generalising the two asset case into N assets poses mathematical difficulties. For instance when working with large portfolios, the algebraic representation of portfolios becomes quite burdensome and heavy to comprehend. However, as we have seen in the matrix algebra repetition, the use of linear algebra manipulations can greatly simplify the calculations in larger dimensional spaces. Further, they allow for an efficient computation of the portfolios, as they use faster paths to perform the respective operations (such as matrix multiplications). As such, they both facilitate improved views and speed to the portfolio construction. As a consequence, when considering general cases of portfolio construction, we will work with linear algebra.</p>
<div id="the-theoretical-foundations-of-n-assets" class="section level3" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> The theoretical foundations of N Assets</h3>
<p>We start again with the basic configuration of any portfolio. That is, we assume that the returns are IID and follow an approximately normal distribution, as we already did in the last chapter on the SIM. Further, we consider a portfolio consisting of N assets, whereas N can be any arbitrary number (e.g. 100’000). Moreover, <span class="math inline">\(R_i\)</span> is the return of asset i. In this case, we assume that the following holds for each asset i:</p>
<p><span class="math display">\[
\begin{align}
R_i &amp;\sim N(\mu_i, \sigma_i^2)\\
cov(R_i,R_j) &amp;= \sigma_{ij}
\end{align}
\]</span></p>
<p>For any portfolio consisting of the N assets, we assume that the following holds:</p>
<p><span class="math display">\[
\begin{align}
\mu_p &amp;= \sum_{i=1}^Nx_i\mu_i\\
\sigma_p^2 &amp;= \sum_{i=1}^Nx_i^2\sigma_i^2 + 2\sum_{i=1}^n\sum_{i \neq j}x_ix_j\sigma_{ij} \\
\sum_{i=1}^N x_i &amp;= 1
\end{align}
\]</span></p>
<p>whereas <span class="math inline">\(x_i\)</span> represents the weights allocated to asset i, which is <strong>not constrained</strong> to short-selling. That is, we allow for <span class="math inline">\(x_i\)</span> to also include negative weights. We will extend this idea later on.</p>
<p>As we have seen, the <strong>variance of the portfolio</strong> depends on:</p>
<ul>
<li>N individual variance terms</li>
<li>N(N-1) individual covariance terms</li>
</ul>
<p>To illustrate this. A portfolio consisting of 100’000 assets has a variance consisting of N = 100’000 variance terms and N(N-1) = 100’000*99’999 = 9’999’900’000 covariance terms. You already notice that trying to write this down in non matrix notation is quite impossible.</p>
<div id="repetition-of-the-matrix-notation" class="section level4" number="7.4.1.1">
<h4><span class="header-section-number">7.4.1.1</span> Repetition of the Matrix Notation</h4>
<p>Let’s quickly recap the main portfolio moments in matrix notation.</p>
<p>We first define the return structure. To do so, we create a <span class="math inline">\(N \times 1\)</span> vector containing the asset returns as well as a <span class="math inline">\(N \times 1\)</span> vector of weights for any period. That is:</p>
<p><span class="math display">\[
\textbf{R} = 
\begin{pmatrix}
R_1 \\ \vdots \\ R_N
\end{pmatrix}, 
\textbf{x} = 
\begin{pmatrix}
x_1 \\ \vdots \\ x_N
\end{pmatrix}
\]</span></p>
<p>As we understand it, the vector  is a <strong>random vector</strong>. We know that the probability distribution of any random vector is just the joint probability distribution of its individual constituents. Further, we know that a linear transformation of this vector still follows the same, linearly adjusted, joint probability distribution. As the Markowitz model assumes joint normality and since this distribution is characterised entirely by its mean, variance and covariance properties, we can easily express the entire framework with two matrices.</p>
<p>First, let’s define the matrix of <strong>expected returns</strong>.</p>
<p><span class="math display">\[
\textbf{R} = 
E\left[\begin{pmatrix}
R_1 \\ \vdots \\ R_N
\end{pmatrix}\right] = 
\begin{pmatrix}
E[R_1] \\ \vdots \\E[R_N]
\end{pmatrix} = 
\begin{pmatrix}
\mu_1 \\ \vdots \\ \mu_N
\end{pmatrix} = 
\mu
\]</span></p>
<p>Then, we can define the <span class="math inline">\(N \times N\)</span> <strong>variance-covariance</strong> matrix.</p>
<p><span class="math display">\[
\begin{align}
var(\textbf{R}) &amp;= 
\begin{pmatrix}
var(R_1) &amp; cov(R_1,R_2) &amp; \dots &amp; cov(R_1, R_N) \\
cov(R_2, R_1) &amp; var(R_2) &amp; \dots &amp; cov(R_2, R_N) \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
cov(R_N, R_1) &amp; cov(R_N, R_2) &amp; \dots &amp; var(R_N)
\end{pmatrix} \\ 
&amp;= 
\begin{pmatrix}
\sigma_1^2 &amp; \sigma_{12} &amp; \dots &amp; \sigma_{1N} \\
\sigma_{21} &amp; \sigma_2^2 &amp; \dots &amp; \sigma_{2N} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
\sigma_{N1} &amp; \sigma_{N2} &amp; \dots &amp; \sigma_N^2
\end{pmatrix}\\
&amp;= \Sigma
\end{align}
\]</span></p>
<p>which is a symmetric and positive definite matrix given that <strong>no perfect multicollinearity</strong> exists an <strong>no random variable is a constant</strong>.</p>
<p>Based on these two formulations, we can now calculate the expected portfolio return and variance.</p>
<p>The expected portfolio return is calculated as the matrix product of the weights and the expected returns :</p>
<p><span class="math display">\[
\mu_P = E[\textbf{x}&#39;\textbf{R}] = \textbf{x}&#39;\mu = 
\begin{pmatrix}
x_1 &amp; \dots &amp; x_N
\end{pmatrix} \cdot
\begin{pmatrix}
\mu_1 \\ \vdots \\ \mu_N
\end{pmatrix} = 
x_1\mu_1 + \dots + x_N\mu_N
\]</span></p>
<p>Also, we have shown that the variance of a linear combination of random vectors <span class="math inline">\(var(\textbf{x}&#39;\textbf{R})\)</span> can be written as <span class="math inline">\(\textbf{x}&#39;\Sigma\textbf{x}\)</span>.
<span class="math display">\[
\begin{align}
var(\textbf{x}&#39;\textbf{R}) = \textbf{x}&#39;\Sigma\textbf{x} &amp;= 
\begin{pmatrix}
x_1 &amp; \dots &amp; x_N
\end{pmatrix} \cdot
\begin{pmatrix}
\sigma_1^2 &amp; \sigma_{12} &amp; \dots &amp; \sigma_{1N} \\
\sigma_{21} &amp; \sigma_2^2 &amp; \dots &amp; \sigma_{2N} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
\sigma_{N1} &amp; \sigma_{N2} &amp; \dots &amp; \sigma_N^2
\end{pmatrix} \cdot
\begin{pmatrix}
x_1 \\ \vdots \\ x_N
\end{pmatrix} \\
&amp;= \sum_{i=1}^Nx_i^2\sigma_i^2 + 2\sum_{i=1}^n\sum_{i \neq j}x_ix_j\sigma_{ij}
\end{align} 
\]</span></p>
<p>Lastly, the covariance of the returns on portfolio x and portfolio y can be calculated according to the repetition on the covariance between linear combination of two random vectors. For instance, if we have portfolio x and y with different weights such that <span class="math inline">\(x \neq y\)</span>, the transformation property allows us to calculate their portfolio covariance matrix as:</p>
<p><span class="math display">\[
\begin{align}
var(\textbf{x}&#39;\textbf{R}) = \textbf{x}&#39;\Sigma\textbf{y} &amp;= 
\begin{pmatrix}
x_1 &amp; \dots &amp; x_N
\end{pmatrix} \cdot
\begin{pmatrix}
\sigma_1^2 &amp; \sigma_{12} &amp; \dots &amp; \sigma_{1N} \\
\sigma_{21} &amp; \sigma_2^2 &amp; \dots &amp; \sigma_{2N} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
\sigma_{N1} &amp; \sigma_{N2} &amp; \dots &amp; \sigma_N^2
\end{pmatrix} \cdot
\begin{pmatrix}
y_1 \\ \vdots \\ y_N
\end{pmatrix} 
\end{align} 
\]</span></p>
</div>
<div id="application-to-the-swiss-market-index" class="section level4" number="7.4.1.2">
<h4><span class="header-section-number">7.4.1.2</span> Application to the Swiss Market Index</h4>
<p>We can now start working with real-world portfolio applications.</p>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-1" aria-hidden="true" tabindex="-1"></a>A1 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;~/Desktop/Master UZH/Data/A1_dataset_01.txt&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>,  <span class="at">dec =</span> <span class="st">&#39;.&#39;</span>)</span>
<span id="cb432-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-3" aria-hidden="true" tabindex="-1"></a>date <span class="ot">=</span> <span class="fu">as.Date</span>(A1[,<span class="dv">1</span>]) </span>
<span id="cb432-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Here, we first assign a date format to the date variable, otherwise the xts package cannot read it. </span></span>
<span id="cb432-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Other forms of transformation (as.POSIXct etc.) would certainly also work. </span></span>
<span id="cb432-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-8" aria-hidden="true" tabindex="-1"></a>A1ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> A1[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> date)</span>
<span id="cb432-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-10" aria-hidden="true" tabindex="-1"></a>A1_return <span class="ot">&lt;-</span> <span class="fu">Return.calculate</span>(A1ts, <span class="at">method =</span> <span class="st">&#39;discrete&#39;</span>) <span class="co"># Calculation of Returns</span></span>
<span id="cb432-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-11" aria-hidden="true" tabindex="-1"></a>A1_returnts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> A1_return, <span class="at">order.by =</span> date)</span>
<span id="cb432-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-13"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Only take some of the companies</span></span>
<span id="cb432-14"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-14" aria-hidden="true" tabindex="-1"></a>A6_ts_ret <span class="ot">&lt;-</span> A1_returnts[, <span class="fu">c</span>(<span class="st">&quot;ABB&quot;</span>, <span class="st">&quot;Actelion&quot;</span>, <span class="st">&quot;Adecco&quot;</span>, <span class="st">&quot;Credit_Suisse_Group&quot;</span>, <span class="st">&quot;Compagnie_Financiere_Richemont&quot;</span>, <span class="st">&quot;Geberit&quot;</span>, <span class="st">&quot;Givaudan&quot;</span>, <span class="st">&quot;Julius_Baer_Group&quot;</span>, <span class="st">&quot;LafargeHolcim&quot;</span>, <span class="st">&quot;Nestle_PS&quot;</span>, <span class="st">&quot;Novartis_N&quot;</span>, <span class="st">&quot;Roche_Holding&quot;</span>, <span class="st">&quot;SGS&quot;</span>, <span class="st">&quot;The_Swatch_Group_I&quot;</span>, <span class="st">&quot;Swiss_Re&quot;</span>, <span class="st">&quot;Swisscom&quot;</span>, <span class="st">&quot;Syngenta&quot;</span>, <span class="st">&quot;Transocean&quot;</span>, <span class="st">&quot;Zurich_Insurance_Group_N&quot;</span>)][<span class="sc">-</span><span class="dv">1</span>,][<span class="st">&#39;2013-01-31/2016-12-31&#39;</span>]</span>
<span id="cb432-15"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-16"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the mean vector and covariance matrix</span></span>
<span id="cb432-17"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-17" aria-hidden="true" tabindex="-1"></a>mean_ret <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(A6_ts_ret, <span class="at">na.rm =</span> T)</span>
<span id="cb432-18"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-18" aria-hidden="true" tabindex="-1"></a>cvar_ret <span class="ot">&lt;-</span> <span class="fu">cov</span>(<span class="fu">na.omit</span>(A6_ts_ret))</span>
<span id="cb432-19"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-20"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate individual weights </span></span>
<span id="cb432-21"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">colnames</span>(A6_ts_ret)[<span class="sc">-</span><span class="dv">19</span>]){</span>
<span id="cb432-22"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-22" aria-hidden="true" tabindex="-1"></a>  weight <span class="ot">=</span> <span class="fu">runif</span>(<span class="dv">10000</span>, <span class="at">min=</span><span class="sc">-</span><span class="fl">1.5</span>, <span class="at">max=</span><span class="fl">1.5</span>) </span>
<span id="cb432-23"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-23" aria-hidden="true" tabindex="-1"></a>  names <span class="ot">=</span> <span class="fu">paste0</span>(i,<span class="st">&quot;_weight&quot;</span>)</span>
<span id="cb432-24"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb432-25"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="st">&quot;ABB&quot;</span>){</span>
<span id="cb432-26"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-26" aria-hidden="true" tabindex="-1"></a>    weight_final <span class="ot">=</span> weight</span>
<span id="cb432-27"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-27" aria-hidden="true" tabindex="-1"></a>    names_final <span class="ot">=</span> names</span>
<span id="cb432-28"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-28" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb432-29"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb432-30"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-30" aria-hidden="true" tabindex="-1"></a>    weight_final <span class="ot">=</span> <span class="fu">cbind</span>(weight_final, weight)</span>
<span id="cb432-31"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-31" aria-hidden="true" tabindex="-1"></a>    names_final <span class="ot">=</span> <span class="fu">cbind</span>(names_final, names)</span>
<span id="cb432-32"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb432-33"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb432-34"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-35"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the dataframe and matrix on the weights</span></span>
<span id="cb432-36"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-36" aria-hidden="true" tabindex="-1"></a>weight_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(weight_final)</span>
<span id="cb432-37"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-37" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(weight_df) <span class="ot">&lt;-</span> names_final</span>
<span id="cb432-38"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-39"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-39" aria-hidden="true" tabindex="-1"></a>weight_df<span class="sc">$</span>sum <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(weight_df)</span>
<span id="cb432-40"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-40" aria-hidden="true" tabindex="-1"></a>weight_df<span class="sc">$</span>Zurich_Insurance_Group_N <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> weight_df<span class="sc">$</span>sum </span>
<span id="cb432-41"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-41" aria-hidden="true" tabindex="-1"></a>weight_df<span class="sc">$</span>sum <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb432-42"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-43"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-43" aria-hidden="true" tabindex="-1"></a>matrix_weights <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(weight_df)</span>
<span id="cb432-44"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-45"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the feasible expected returns and standard deviations</span></span>
<span id="cb432-46"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-46" aria-hidden="true" tabindex="-1"></a>feasible_pf_mu <span class="ot">=</span> matrix_weights<span class="sc">%*%</span>mean_ret</span>
<span id="cb432-47"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-47" aria-hidden="true" tabindex="-1"></a>feasible_pf_sd <span class="ot">=</span> <span class="fu">apply</span>(matrix_weights, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="fu">sqrt</span>(<span class="fu">t</span>(x) <span class="sc">%*%</span> cvar_ret <span class="sc">%*%</span> x))</span>
<span id="cb432-48"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-49"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Construct the feasible dataframe, consisting of 100 differently weighted risk and return combinations</span></span>
<span id="cb432-50"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-50" aria-hidden="true" tabindex="-1"></a>feasible_pf <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(feasible_pf_mu, feasible_pf_sd))  </span>
<span id="cb432-51"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-51" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(feasible_pf) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Portfolio_Return&quot;</span>, <span class="st">&quot;Portfolio_Risk&quot;</span>)</span>
<span id="cb432-52"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-53"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s visualise the relationship</span></span>
<span id="cb432-54"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-54" aria-hidden="true" tabindex="-1"></a>feasible_pf <span class="sc">%&gt;%</span> </span>
<span id="cb432-55"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span> </span>
<span id="cb432-56"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>) <span class="sc">+</span> </span>
<span id="cb432-57"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(feasible_pf, Portfolio_Risk <span class="sc">&lt;=</span> <span class="fl">0.12</span> <span class="sc">&amp;</span> Portfolio_Return <span class="sc">&gt;=</span> <span class="dv">0</span>), <span class="at">color =</span> <span class="st">&quot;darkorchid3&quot;</span>, <span class="at">shape =</span> <span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb432-58"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(feasible_pf, Portfolio_Risk <span class="sc">&gt;</span> <span class="fl">0.12</span> <span class="sc">&amp;</span> Portfolio_Risk <span class="sc">&lt;=</span> <span class="fl">0.14</span> <span class="sc">&amp;</span> Portfolio_Return <span class="sc">&gt;=</span> <span class="fl">0.07</span>), <span class="at">color =</span> <span class="st">&quot;darkorchid3&quot;</span>, <span class="at">shape =</span> <span class="dv">1</span>,<span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb432-59"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(feasible_pf, Portfolio_Risk <span class="sc">&gt;</span> <span class="fl">0.14</span> <span class="sc">&amp;</span> Portfolio_Risk <span class="sc">&lt;=</span> <span class="fl">0.16</span> <span class="sc">&amp;</span> Portfolio_Return <span class="sc">&gt;=</span> <span class="fl">0.09</span>), <span class="at">color =</span> <span class="st">&quot;darkorchid3&quot;</span>, <span class="at">shape =</span> <span class="dv">1</span>,<span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb432-60"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(feasible_pf, Portfolio_Risk <span class="sc">&gt;</span> <span class="fl">0.16</span> <span class="sc">&amp;</span> Portfolio_Risk <span class="sc">&lt;=</span> <span class="fl">0.18</span> <span class="sc">&amp;</span> Portfolio_Return <span class="sc">&gt;=</span> <span class="fl">0.1</span>), <span class="at">color =</span> <span class="st">&quot;darkorchid3&quot;</span>, <span class="at">shape =</span> <span class="dv">1</span>,<span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb432-61"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(feasible_pf, Portfolio_Risk <span class="sc">&gt;</span> <span class="fl">0.18</span> <span class="sc">&amp;</span> Portfolio_Risk <span class="sc">&lt;=</span> <span class="fl">0.20</span> <span class="sc">&amp;</span> Portfolio_Return <span class="sc">&gt;=</span> <span class="fl">0.11</span>), <span class="at">color =</span> <span class="st">&quot;darkorchid3&quot;</span>,<span class="at">shape =</span> <span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb432-62"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(feasible_pf, Portfolio_Risk <span class="sc">&gt;</span> <span class="fl">0.2</span> <span class="sc">&amp;</span> Portfolio_Risk <span class="sc">&lt;=</span> <span class="fl">0.22</span> <span class="sc">&amp;</span> Portfolio_Return <span class="sc">&gt;=</span> <span class="fl">0.11</span>), <span class="at">color =</span> <span class="st">&quot;darkorchid3&quot;</span>, <span class="at">shape =</span> <span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb432-63"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(mu[p])) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="fu">expression</span>(sigma[p])) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Porfolio Frontier of SMI PF for 10&#39;000 different weights&quot;</span>) <span class="sc">+</span></span>
<span id="cb432-64"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb432-65"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb432-66"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb432-67"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb432-68"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-68" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb432-69"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-69" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb432-70"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-70" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb432-71"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-71" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb432-72"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb432-73"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb432-74"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb432-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-237-1.png" width="672" /></p>
<p>When we introduce a large number (e.g. 10’000) different weightings for a portfolio consisting of a large fraction of Swiss bluechip companies, then we can see that the outlines are similar to the Markowitz Bullet we encountered in the two-asset case. That is, the outer boundaries of this combination appear to be similar to the set of feasible portfolios when only considering two assets, with the tip of the distribution representing the <strong>Minimum Variance portfolio</strong>. Further, recall that, in the case of a bullet shape, the set of <strong>efficient and feasible portfolios</strong> when considering only risky assets is represented by the outer boundary of portfolios <strong>at or above the minimum-variance portfolio</strong>, as they deliver the smallest possible risk for each unit of return. These portfolios are represented by the <strong>purple bounded dots</strong>.</p>
<p>The results show that a portfolio consisting of N assets follows approximately the same intuition and distribution as we have observed in the two-asset case, which is handy for generalisation purposes.</p>
</div>
</div>
<div id="the-minimum-variance-portfolio-for-n-assets" class="section level3" number="7.4.2">
<h3><span class="header-section-number">7.4.2</span> The Minimum Variance Portfolio for N assets</h3>
<p>Next, we start to define efficient portfolios by first determining the constitution of weights for the minimum-variance portfolio. As we said, we can do this by following some matrix algebra properties that are also given in the repetition part.</p>
<p>Note again that the definition of the minimum-variance portfolio is a constrained optimisation problem. That is, we want to find a weight vector such that the variance of the portfolio is minimised, conditional that all weights add up to 1.</p>
<p>That is, we define again the variance-covariance matrix and matrix-multiply it with its respective, optimal weights, to obtain a scalar which quantifies the smallest possible standard deviation.</p>
<p>We do this by defining the following problem:</p>
<p><span class="math display">\[
\begin{align}
\min_{x} \sigma_p^2 = \textbf{x&#39;}\Sigma\textbf{x} &amp;&amp; \text{ s.t. } \textbf{x&#39;}\textbf{1} = 1
\end{align}
\]</span>
In order to solve this, we need to make use of the <strong>Lagrangian</strong> formula. The Lagrangian is a commonly used tool to define constrained optimisation problems. In essence, we define two functions in which the constraint is set equal to zero. That is, we define the following:</p>
<p><span class="math display">\[
L(\textbf{x}, \lambda) = \textbf{x&#39;}\Sigma\textbf{x} + \lambda(\textbf{x&#39;}\textbf{1} - 1)
\]</span></p>
<p>We now take the FOC’s for both x and <span class="math inline">\(\lambda\)</span> and obtain:</p>
<p><span class="math display">\[
\begin{align}
\frac{\delta L} {\delta \textbf{x}} &amp;= 2\Sigma\textbf{x} + \lambda1 \\
\frac{\delta L} {\delta \lambda} &amp;= \textbf{x&#39;}\textbf{1} - 1
\end{align}
\]</span></p>
<p>We can represent this is vector notation as:</p>
<p><span class="math display">\[
\begin{pmatrix}
2\Sigma &amp; \textbf{1} \\
\textbf{1&#39;} &amp; 0 
\end{pmatrix}
\begin{pmatrix}
\textbf{x} \\ \lambda
\end{pmatrix} =
\begin{pmatrix}
0 \\ 1
\end{pmatrix}
\]</span></p>
<p>This is nothing else than backinduction of the usual matrix multiplication:</p>
<p><span class="math display">\[
\begin{align}
2\Sigma \cdot \textbf{x} + \lambda\cdot \textbf{1} &amp;= 0\\
\textbf{1&#39;}\cdot \textbf{x} + 0\cdot \lambda &amp;= 1
\end{align}
\]</span></p>
<p>If you don’t know anymore what we did here, please refer to Chapter 3.2.4 (System of linear equations).</p>
<p>In general, this implies <span class="math inline">\(\textbf{A} \cdot \textbf{z} = \textbf{b}\)</span>, where:</p>
<p><span class="math display">\[
\textbf{A} = \begin{pmatrix}
2\Sigma &amp; \textbf{1} \\
\textbf{1&#39;} &amp; 0 
\end{pmatrix}, \textbf{z} = 
\begin{pmatrix}
\textbf{x} \\ \lambda
\end{pmatrix}, \textbf{b} = 
\begin{pmatrix}
0 \\ 1
\end{pmatrix}
\]</span></p>
<p>Note that we are interested in the weights for this system of linear equations. That is, we want to find out the vector of <span class="math inline">\(\textbf{x}\)</span>, as these minimise the global variance of our portfolio. In order to retrieve these weights, it is quite straight-forward to see that we need to take the inverse the matrix <span class="math inline">\(\textbf{A}\)</span> and multiply it with the matrix <span class="math inline">\(\textbf{b}\)</span>. This is only feasible if the matrix <span class="math inline">\(\textbf{A}\)</span> is invertible. As long as we can determine the elements in <span class="math inline">\(\textbf{A}^{-1}\)</span>, then we can solve for the values of x in the linear equations system of the vector <span class="math inline">\(\textbf{z}\)</span>. In this case, the first N elements of the vector <span class="math inline">\(\textbf{z}\)</span> will be the variance minimising weights.</p>
<p>Let’s do this for our portfolio:</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the matrix A. It consists of: </span></span>
<span id="cb433-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb433-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb433-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb433-3" aria-hidden="true" tabindex="-1"></a><span class="do">## - the covariance matrix multiplied by two</span></span>
<span id="cb433-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb433-4" aria-hidden="true" tabindex="-1"></a><span class="do">## - a column right to the covariance matrix, consisting of 1&#39;s</span></span>
<span id="cb433-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb433-5" aria-hidden="true" tabindex="-1"></a><span class="do">## - a row right below the covariance matrix and the additional column, consisting of 1&#39;s and one zero (the zero is in the right-bottom of the resulting matrix)</span></span>
<span id="cb433-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb433-6" aria-hidden="true" tabindex="-1"></a>mat_A <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">cbind</span>(<span class="dv">2</span><span class="sc">*</span>cvar_ret, <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">dim</span>(cvar_ret)[<span class="dv">1</span>])), <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">dim</span>(cvar_ret)[<span class="dv">1</span>]), <span class="dv">0</span>))</span>
<span id="cb433-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb433-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb433-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb433-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb433-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb433-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the vector b as vector of zeros with dimension of the covariance matrix (19 in this case) and one 1 at the bottom</span></span>
<span id="cb433-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb433-10" aria-hidden="true" tabindex="-1"></a>vec_b <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">dim</span>(cvar_ret)[<span class="dv">1</span>]), <span class="dv">1</span>)</span>
<span id="cb433-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb433-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb433-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb433-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the inverse and perform matrix multiplication to get the vector z</span></span>
<span id="cb433-13"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb433-13" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">solve</span>(mat_A)<span class="sc">%*%</span>vec_b</span>
<span id="cb433-14"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb433-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb433-15"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb433-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Derive the first N elements of the vector to retrieve the actual values </span></span>
<span id="cb433-16"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb433-16" aria-hidden="true" tabindex="-1"></a>x_MV <span class="ot">&lt;-</span> z[<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(cvar_ret)[<span class="dv">1</span>]]</span>
<span id="cb433-17"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb433-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb433-18"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb433-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Check that the sum adds up to 1</span></span>
<span id="cb433-19"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb433-19" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(x_MV)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>Now, we got the appropriate weights per company of our portfolio. Let’s calculate the expected return as well as the standard deviation.</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the expected return: </span></span>
<span id="cb435-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb435-2" aria-hidden="true" tabindex="-1"></a>mu_MV <span class="ot">&lt;-</span> x_MV <span class="sc">%*%</span> mean_ret</span>
<span id="cb435-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb435-3" aria-hidden="true" tabindex="-1"></a>sd_MV <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">t</span>(x_MV) <span class="sc">%*%</span> cvar_ret <span class="sc">%*%</span> x_MV)</span>
<span id="cb435-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb435-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb435-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb435-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the appropriate dataframe</span></span>
<span id="cb435-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb435-6" aria-hidden="true" tabindex="-1"></a>MV_PF <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(mu_MV, sd_MV, <span class="fu">t</span>(x_MV)))</span>
<span id="cb435-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb435-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(MV_PF) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Mu_MV&quot;</span>, <span class="st">&quot;Sd_MV&quot;</span>,names_final, <span class="st">&quot;Zurich_Insurance_Group_Weight&quot;</span>)</span>
<span id="cb435-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb435-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb435-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb435-9" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(<span class="fu">t</span>(MV_PF))</span></code></pre></div>
<pre><code>##                                                V1
## Mu_MV                                  0.02126306
## Sd_MV                                  0.02321974
## ABB_weight                             0.09286278
## Actelion_weight                        0.15521845
## Adecco_weight                          0.46741548
## Credit_Suisse_Group_weight            -0.21374129
## Compagnie_Financiere_Richemont_weight  0.07482529
## Geberit_weight                         0.18564346
## Givaudan_weight                       -0.10473719
## Julius_Baer_Group_weight               0.16461766
## LafargeHolcim_weight                  -0.11800013
## Nestle_PS_weight                       0.38496885
## Novartis_N_weight                      0.32945099
## Roche_Holding_weight                   0.21882863
## SGS_weight                             0.14659400
## The_Swatch_Group_I_weight             -0.44283485
## Swiss_Re_weight                        0.01692448
## Swisscom_weight                        0.09185468
## Syngenta_weight                       -0.01166684
## Transocean_weight                     -0.02403974
## Zurich_Insurance_Group_Weight         -0.41418471</code></pre>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s visualise the relationship</span></span>
<span id="cb437-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-2" aria-hidden="true" tabindex="-1"></a>feasible_pf <span class="sc">%&gt;%</span> </span>
<span id="cb437-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span> </span>
<span id="cb437-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>) <span class="sc">+</span></span>
<span id="cb437-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This is just to colour in the &quot;optimal PFs&quot;</span></span>
<span id="cb437-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(feasible_pf, Portfolio_Risk <span class="sc">&lt;=</span> <span class="fl">0.12</span> <span class="sc">&amp;</span> Portfolio_Return <span class="sc">&gt;=</span> <span class="fl">0.02</span>), <span class="at">color =</span> <span class="st">&quot;darkorchid3&quot;</span>, <span class="at">shape =</span> <span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb437-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(feasible_pf, Portfolio_Risk <span class="sc">&gt;</span> <span class="fl">0.12</span> <span class="sc">&amp;</span> Portfolio_Risk <span class="sc">&lt;=</span> <span class="fl">0.14</span> <span class="sc">&amp;</span> Portfolio_Return <span class="sc">&gt;=</span> <span class="fl">0.07</span>), <span class="at">color =</span> <span class="st">&quot;darkorchid3&quot;</span>, <span class="at">shape =</span> <span class="dv">1</span>,<span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb437-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(feasible_pf, Portfolio_Risk <span class="sc">&gt;</span> <span class="fl">0.14</span> <span class="sc">&amp;</span> Portfolio_Risk <span class="sc">&lt;=</span> <span class="fl">0.16</span> <span class="sc">&amp;</span> Portfolio_Return <span class="sc">&gt;=</span> <span class="fl">0.09</span>), <span class="at">color =</span> <span class="st">&quot;darkorchid3&quot;</span>, <span class="at">shape =</span> <span class="dv">1</span>,<span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb437-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(feasible_pf, Portfolio_Risk <span class="sc">&gt;</span> <span class="fl">0.16</span> <span class="sc">&amp;</span> Portfolio_Risk <span class="sc">&lt;=</span> <span class="fl">0.18</span> <span class="sc">&amp;</span> Portfolio_Return <span class="sc">&gt;=</span> <span class="fl">0.1</span>), <span class="at">color =</span> <span class="st">&quot;darkorchid3&quot;</span>, <span class="at">shape =</span> <span class="dv">1</span>,<span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb437-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(feasible_pf, Portfolio_Risk <span class="sc">&gt;</span> <span class="fl">0.18</span> <span class="sc">&amp;</span> Portfolio_Risk <span class="sc">&lt;=</span> <span class="fl">0.20</span> <span class="sc">&amp;</span> Portfolio_Return <span class="sc">&gt;=</span> <span class="fl">0.11</span>), <span class="at">color =</span> <span class="st">&quot;darkorchid3&quot;</span>,<span class="at">shape =</span> <span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb437-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(feasible_pf, Portfolio_Risk <span class="sc">&gt;</span> <span class="fl">0.2</span> <span class="sc">&amp;</span> Portfolio_Risk <span class="sc">&lt;=</span> <span class="fl">0.22</span> <span class="sc">&amp;</span> Portfolio_Return <span class="sc">&gt;=</span> <span class="fl">0.11</span>), <span class="at">color =</span> <span class="st">&quot;darkorchid3&quot;</span>, <span class="at">shape =</span> <span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb437-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate and plot the Minimum Variance PF</span></span>
<span id="cb437-13"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>,  <span class="fu">aes</span>(<span class="at">x=</span> MV_PF<span class="sc">$</span>Sd_MV, <span class="at">y =</span> MV_PF<span class="sc">$</span>Mu_MV), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb437-14"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="sc">-</span><span class="fl">0.01</span> ,<span class="at">y =</span> <span class="sc">-</span><span class="fl">0.014</span>, <span class="at">label =</span> <span class="st">&quot;Minimum Variance PF&quot;</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span></span>
<span id="cb437-15"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(mu[p])) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="fu">expression</span>(sigma[p])) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Minimum Variance portfolio&quot;</span>) <span class="sc">+</span></span>
<span id="cb437-16"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb437-17"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="fl">0.10</span>, <span class="fl">0.75</span>) <span class="sc">+</span> </span>
<span id="cb437-18"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb437-19"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.43</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb437-20"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb437-21"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb437-22"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb437-23"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb437-24"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb437-25"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb437-26"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb437-27"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb437-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-240-1.png" width="672" /></p>
</div>
<div id="the-efficient-frontier-for-n-assets" class="section level3" number="7.4.3">
<h3><span class="header-section-number">7.4.3</span> The Efficient Frontier for N assets</h3>
<div id="determining-efficient-portfolios" class="section level4" number="7.4.3.1">
<h4><span class="header-section-number">7.4.3.1</span> Determining Efficient Portfolios</h4>
<p>Now that we were able to determine the global minimum variance portfolio, we can go a step further and define the set of efficient portfolios under the assumption of N risky assets. In order to determine the set of risky assets that are efficient, we can follow the same strategy as we already did with 2 assets.</p>
<p>In the case of 1 or 2 assets, the investment opportunity set is graph or a hyperbola (bullet), respectively. However, in the N assets case, the opportunity set is given by values that do not follow a clear trend. This is due to the fact that their risk properties largely depend solely on the covariance between the assets (remember the proof we made in the risk and return chapter?). In essence, when we try to plot a graph as we did in the 2 asset case, this is the result due to the covariances <span class="math inline">\(\sigma_{ij}\)</span>.</p>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-241-1.png" width="672" /></p>
<p>In the N asset case, we understand that deriving a clear structure that incorporates the position and behaviour of each constituent portfolio, as the covariance properties do not allow for any clearly visible trends. However, as we stated earlier, we do not need to care about every single relation within our portfolio set. Under the assumption that investors want to maximise return given a level of risk or, equivalently, minimise risk given a level of return, we can simplify the asset allocation to only incorporate the set of efficient and feasible portfolios, which are characterised by the purple dots. As it is depicted graphically, the efficient portfolios are the most outer portfolios at or above the minimum variance portfolio. S</p>
<p>imilar to the two-asset case, these are Analogously, these are the portfolios that, for a <strong>given level of return, induce the lowest risk</strong>.</p>
<p>In essence, we need to find the portfolios with the best possible risk-return trade-off. We can define these portfolios throughout a constrained optimisation problem in two distinct ways. First, we need to find the portfolios that, for a <strong>given level of risk, induce the highest return</strong>. This is the case when:</p>
<p><span class="math display">\[
\begin{align}
\max_x \mu_P = \textbf{x&#39;}\mu &amp;&amp; \text{s.t. } \sigma_P^2 = \textbf{x&#39;}\Sigma\textbf{x} = \sigma_{P, Spec}^2\text{ and } \textbf{x&#39;}1 = 1
\end{align}
\]</span>
whereas <span class="math inline">\(\sigma_{P, Spec}\)</span> defines a given, specific level of risk.</p>
<p>Second, we need to find the portfolios that, for a <strong>given level of return, induce the lowest risk</strong>. This is the case when:</p>
<p><span class="math display">\[
\begin{align}
\min_x \sigma_P^2 =  \textbf{x&#39;}\Sigma\textbf{x}  &amp;&amp; \text{s.t. } \mu_{P}^2 = \textbf{x&#39;}\mu = \mu_{P,Spec} \text{ and } \textbf{x&#39;}1 = 1
\end{align}
\]</span></p>
<p>whereas <span class="math inline">\(\mu_{P, Spec}\)</span> defines a given, specific level of return.</p>
<p>In reality, we often solve for the second constrained optimisation problem, because investors can better define given levels of return than given levels of risk. Just as in the two asset case, the resulting efficient frontier will resemble one side of an hyperbola and is often called the “Markowitz bullet”.</p>
<p>As such, we can solve the optimisation problem again with the <strong>Lagrangian</strong> function. That is, we get:</p>
<p><span class="math display">\[
L(x, \lambda_1, \lambda_2) = \textbf{x&#39;}\Sigma\textbf{x} + \lambda_1(\textbf{x&#39;}\mu - \mu_{P,Spec}) + \lambda_2(\textbf{x&#39;}1  - 1)
\]</span></p>
<p>We can solve this problem by taking three partial derivatives w.r.t. their individual components:</p>
<p><span class="math display">\[
\begin{align}
\frac{\delta L}{\delta x} &amp;= 2\Sigma\textbf{x} + \lambda_1\mu + \lambda_2\textbf{1} = 0 \\
\frac{\delta L}{\delta \lambda_1} &amp;= \textbf{x&#39;}\mu - \mu_{P,Spec} = 0 \\
\frac{\delta L}{\delta \lambda_2} &amp;= \textbf{x&#39;}1  - 1 = 0
\end{align}
\]</span></p>
<p>Again, we can represent this system of linear equations as follows:</p>
<p>$$
<em>{}

</em>{}
=
_{}</p>
<p>$$</p>
<p>Now, we can again take the inverse of <span class="math inline">\(\textbf{A}\)</span> and calculate the vector <span class="math inline">\(\textbf{z}\)</span> through matrix multiplication. Lastly, we take the first N elements from this vector to obtain the weights that <strong>minimise the risk of a portfolio for a given level of expected return</strong>.</p>
<p>Let’s now try to replicate this idea for the underlying portfolio. Note that in order to be able to solve this portfolio, we need to <strong>specify a given level of return first which then can be used to minimise the risk associated</strong>.</p>
<p>Let’s make this easy in our case. Let’s just say we want to have the return of the company Givaudan the portfolio under consideration.</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb438-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We first define again the Matrix A </span></span>
<span id="cb438-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb438-2" aria-hidden="true" tabindex="-1"></a>mat_A_EF <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">cbind</span>(<span class="dv">2</span><span class="sc">*</span>cvar_ret, mean_ret,  <span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">dim</span>(cvar_ret)[<span class="dv">1</span>])), </span>
<span id="cb438-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb438-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">cbind</span>(<span class="fu">t</span>(mean_ret), <span class="dv">0</span>, <span class="dv">0</span>), </span>
<span id="cb438-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb438-4" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">cbind</span>(<span class="fu">t</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">dim</span>(cvar_ret)[<span class="dv">1</span>])), <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb438-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb438-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb438-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb438-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we define the vector b</span></span>
<span id="cb438-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb438-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Define the EW return</span></span>
<span id="cb438-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb438-8" aria-hidden="true" tabindex="-1"></a>mu_spec <span class="ot">&lt;-</span> mean_ret[<span class="dv">7</span>]</span>
<span id="cb438-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb438-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Define the vector b</span></span>
<span id="cb438-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb438-10" aria-hidden="true" tabindex="-1"></a>vec_b_EF <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">dim</span>(cvar_ret)[<span class="dv">1</span>]), mu_spec, <span class="dv">1</span>)</span>
<span id="cb438-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb438-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb438-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb438-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we can solve for the respective weights</span></span>
<span id="cb438-13"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb438-13" aria-hidden="true" tabindex="-1"></a>z_EF <span class="ot">&lt;-</span> <span class="fu">solve</span>(mat_A_EF)<span class="sc">%*%</span>vec_b_EF</span>
<span id="cb438-14"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb438-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb438-15"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb438-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we take the first N elements to get the respective weights</span></span>
<span id="cb438-16"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb438-16" aria-hidden="true" tabindex="-1"></a>x_EF <span class="ot">&lt;-</span> z_EF[<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(cvar_ret)[<span class="dv">1</span>]]</span>
<span id="cb438-17"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb438-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb438-18"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb438-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Check that the sum adds up to 1</span></span>
<span id="cb438-19"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb438-19" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(x_EF)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>Perfect. We now can take these weights again and calculate the respective risk for the given level of return.</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb440-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sanity Check: See if the matrix multiplication of the weights and the mean returns indeed gives us the average return again </span></span>
<span id="cb440-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb440-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb440-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb440-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ifelse</span>(<span class="fu">round</span>(x_EF<span class="sc">%*%</span>mean_ret, <span class="dv">4</span>) <span class="sc">==</span> <span class="fu">round</span>(mu_spec, <span class="dv">4</span>), <span class="st">&quot;The Sanity Check passes as we get that the expected return is equal to the specified return!&quot;</span>, <span class="dv">0</span>)</span></code></pre></div>
<pre><code>##      [,1]                                                                                          
## [1,] &quot;The Sanity Check passes as we get that the expected return is equal to the specified return!&quot;</code></pre>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb442-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s calculate the risk</span></span>
<span id="cb442-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb442-2" aria-hidden="true" tabindex="-1"></a>sd_EF <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">t</span>(x_EF) <span class="sc">%*%</span> cvar_ret <span class="sc">%*%</span> x_EF)</span>
<span id="cb442-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb442-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb442-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb442-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Further, calculate the risk under the EW strategy</span></span>
<span id="cb442-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb442-5" aria-hidden="true" tabindex="-1"></a>EW_weights <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">/</span><span class="fu">dim</span>(cvar_ret)[<span class="dv">1</span>], <span class="fu">dim</span>(cvar_ret)[<span class="dv">1</span>])</span>
<span id="cb442-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb442-6" aria-hidden="true" tabindex="-1"></a>sd_EW <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">t</span>(EW_weights) <span class="sc">%*%</span> cvar_ret <span class="sc">%*%</span> EW_weights)</span>
<span id="cb442-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb442-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb442-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb442-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we can take these results and compare them with each other: </span></span>
<span id="cb442-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb442-9" aria-hidden="true" tabindex="-1"></a>EF_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(<span class="fu">round</span>(mu_spec,<span class="dv">4</span>), <span class="fu">round</span>(sd_EF,<span class="dv">4</span>), <span class="fu">round</span>(sd_EW,<span class="dv">4</span>)))</span>
<span id="cb442-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb442-10" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(EF_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Return EW PF&quot;</span>, <span class="st">&quot;Risk Optimised&quot;</span>, <span class="st">&quot;Risk EW PF&quot;</span>)</span>
<span id="cb442-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb442-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb442-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb442-12" aria-hidden="true" tabindex="-1"></a>EF_df</span></code></pre></div>
<pre><code>##          Return EW PF Risk Optimised Risk EW PF
## Givaudan       0.0149         0.0239     0.0414</code></pre>
<p>Great, as we can see, we can greatly improve the risk associated with a given level of return.</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s visualise the relationship</span></span>
<span id="cb444-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-2" aria-hidden="true" tabindex="-1"></a>feasible_pf <span class="sc">%&gt;%</span> </span>
<span id="cb444-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span> </span>
<span id="cb444-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>) <span class="sc">+</span></span>
<span id="cb444-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This is just to colour in the &quot;optimal PFs&quot;</span></span>
<span id="cb444-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(feasible_pf, Portfolio_Risk <span class="sc">&lt;=</span> <span class="fl">0.12</span> <span class="sc">&amp;</span> Portfolio_Return <span class="sc">&gt;=</span> <span class="dv">0</span>), <span class="at">color =</span> <span class="st">&quot;darkorchid3&quot;</span>, <span class="at">shape =</span> <span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb444-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(feasible_pf, Portfolio_Risk <span class="sc">&gt;</span> <span class="fl">0.12</span> <span class="sc">&amp;</span> Portfolio_Risk <span class="sc">&lt;=</span> <span class="fl">0.14</span> <span class="sc">&amp;</span> Portfolio_Return <span class="sc">&gt;=</span> <span class="fl">0.07</span>), <span class="at">color =</span> <span class="st">&quot;darkorchid3&quot;</span>, <span class="at">shape =</span> <span class="dv">1</span>,<span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb444-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(feasible_pf, Portfolio_Risk <span class="sc">&gt;</span> <span class="fl">0.14</span> <span class="sc">&amp;</span> Portfolio_Risk <span class="sc">&lt;=</span> <span class="fl">0.16</span> <span class="sc">&amp;</span> Portfolio_Return <span class="sc">&gt;=</span> <span class="fl">0.09</span>), <span class="at">color =</span> <span class="st">&quot;darkorchid3&quot;</span>, <span class="at">shape =</span> <span class="dv">1</span>,<span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb444-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(feasible_pf, Portfolio_Risk <span class="sc">&gt;</span> <span class="fl">0.16</span> <span class="sc">&amp;</span> Portfolio_Risk <span class="sc">&lt;=</span> <span class="fl">0.18</span> <span class="sc">&amp;</span> Portfolio_Return <span class="sc">&gt;=</span> <span class="fl">0.1</span>), <span class="at">color =</span> <span class="st">&quot;darkorchid3&quot;</span>, <span class="at">shape =</span> <span class="dv">1</span>,<span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb444-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(feasible_pf, Portfolio_Risk <span class="sc">&gt;</span> <span class="fl">0.18</span> <span class="sc">&amp;</span> Portfolio_Risk <span class="sc">&lt;=</span> <span class="fl">0.20</span> <span class="sc">&amp;</span> Portfolio_Return <span class="sc">&gt;=</span> <span class="fl">0.11</span>), <span class="at">color =</span> <span class="st">&quot;darkorchid3&quot;</span>,<span class="at">shape =</span> <span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb444-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(feasible_pf, Portfolio_Risk <span class="sc">&gt;</span> <span class="fl">0.2</span> <span class="sc">&amp;</span> Portfolio_Risk <span class="sc">&lt;=</span> <span class="fl">0.22</span> <span class="sc">&amp;</span> Portfolio_Return <span class="sc">&gt;=</span> <span class="fl">0.11</span>), <span class="at">color =</span> <span class="st">&quot;darkorchid3&quot;</span>, <span class="at">shape =</span> <span class="dv">1</span>, <span class="fu">aes</span>(<span class="at">x=</span> Portfolio_Risk, <span class="at">y =</span> Portfolio_Return)) <span class="sc">+</span></span>
<span id="cb444-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate and plot the Minimum Variance PF</span></span>
<span id="cb444-13"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-13" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>,  <span class="fu">aes</span>(<span class="at">x=</span> MV_PF<span class="sc">$</span>Sd_MV, <span class="at">y =</span> MV_PF<span class="sc">$</span>Mu_MV), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb444-14"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate and plot the optimal PF for a given level of risk</span></span>
<span id="cb444-15"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(EF_df, <span class="st">`</span><span class="at">Return EW PF</span><span class="st">`</span> <span class="sc">==</span> <span class="fl">0.0149</span> <span class="sc">&amp;</span> <span class="st">`</span><span class="at">Risk Optimised</span><span class="st">`</span> <span class="sc">==</span> <span class="fl">0.0239</span>), <span class="at">color =</span> <span class="st">&quot;dodgerblue1&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="fu">aes</span>(<span class="at">x=</span><span class="st">`</span><span class="at">Risk Optimised</span><span class="st">`</span> , <span class="at">y=</span> <span class="st">`</span><span class="at">Return EW PF</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb444-16"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">subset</span>(EF_df, <span class="st">`</span><span class="at">Return EW PF</span><span class="st">`</span> <span class="sc">==</span> <span class="fl">0.0149</span> <span class="sc">&amp;</span> <span class="st">`</span><span class="at">Risk EW PF</span><span class="st">`</span> <span class="sc">==</span> <span class="fl">0.0414</span>), <span class="at">color =</span> <span class="st">&quot;dodgerblue3&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="fu">aes</span>(<span class="at">x=</span><span class="st">`</span><span class="at">Risk EW PF</span><span class="st">`</span> , <span class="at">y=</span> <span class="st">`</span><span class="at">Return EW PF</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb444-17"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.0</span> ,<span class="at">y =</span> <span class="fl">0.072</span>, <span class="at">label =</span> <span class="st">&quot;Minimum Variance PF&quot;</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span></span>
<span id="cb444-18"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="sc">-</span><span class="fl">0.01</span> ,<span class="at">y =</span> <span class="fl">0.056</span>, <span class="at">label =</span> <span class="st">&quot;Efficient Frontier PF&quot;</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">&quot;dodgerblue1&quot;</span>) <span class="sc">+</span></span>
<span id="cb444-19"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="sc">-</span><span class="fl">0.04</span> ,<span class="at">y =</span> <span class="fl">0.040</span>, <span class="at">label =</span> <span class="st">&quot;Givaudan PF&quot;</span>, <span class="at">size =</span> <span class="fl">3.5</span>, <span class="at">color =</span> <span class="st">&quot;dodgerblue4&quot;</span>) <span class="sc">+</span></span>
<span id="cb444-20"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(mu[p])) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="fu">expression</span>(sigma[p])) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Minimum Variance PF, Efficient Frontier PF and Equally Weighted PF&quot;</span>) <span class="sc">+</span></span>
<span id="cb444-21"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb444-22"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="fl">0.10</span>, <span class="fl">0.75</span>) <span class="sc">+</span> </span>
<span id="cb444-23"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb444-24"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb444-25"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb444-26"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb444-27"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb444-28"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb444-29"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb444-30"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb444-31"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb444-32"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb444-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-245-1.png" width="672" /></p>
</div>
<div id="determining-the-efficient-frontier" class="section level4" number="7.4.3.2">
<h4><span class="header-section-number">7.4.3.2</span> Determining the Efficient Frontier</h4>
<p>Although we now have a way to compare and compute the efficient portfolio for any given level of return (e.g. the risk minimising portfolio at each expected return level), we may find it still cumbersome to actually compute the entire efficient frontier. This is because it may simply be unfeasible to calculate the appropriate minimum level of risk for each potential return level, as it would require us to perform potentially hundreds of thousand of individual calculations that, aggregated, would form the Markowitz bullet of efficient and feasible portfolios we require.</p>
<p>Luckily, Markowitz showed that there is a simpler way to compute the efficient frontier. Without going much into the details here, he showed that <strong>any minimum variance portfolio can be formed through a linear combination of any two minimum variance portfolios with different, specified returns</strong>. Given that the resulting return on the created portfolio exceeds the return of the global minimum variance portfolio, then the resulting portfolio is located on the efficient frontier. Consequently, to retrieve the Efficient frontier in a general case of N assets, we simply need to define <strong>two efficient portfolios</strong> and then express the <strong>remaining efficient portfolios as linear combinations</strong> of these two.</p>
<p>Let’s quickly dive into the math of this result. To do so, we now assume that both <span class="math inline">\(\textbf{x}\)</span> and <span class="math inline">\(\textbf{y}\)</span> are two efficient portfolios with different specified returns. That is, for their respective level of return they display the smallest standard deviation. Mathematically, this implies:</p>
<p><span class="math display">\[
\begin{align}
\min_x \sigma_{P,x}^2 =  \textbf{x&#39;}\Sigma\textbf{x}  &amp;&amp; \text{s.t. } \mu_{P,x}^2 = \textbf{x&#39;}\mu = \mu_{P,Spec-x} \text{ and } \textbf{x&#39;}1 = 1\\
\min_y \sigma_{P,y}^2 =  \textbf{y&#39;}\Sigma\textbf{y}  &amp;&amp; \text{s.t. } \mu_{P,y}^2 = \textbf{y&#39;}\mu = \mu_{P,Spec-y} \text{ and } \textbf{y&#39;}1 = 1
\end{align}
\]</span></p>
<p>Further, we define <span class="math inline">\(\alpha\)</span> as a constant which puts individual weights on both efficient portfolios <span class="math inline">\(\textbf{x}\)</span> and <span class="math inline">\(\textbf{y}\)</span>. Further, let <span class="math inline">\(\textbf{z}\)</span> define the linear combination portfolio consisting on <span class="math inline">\(\alpha\)</span> weighted portfolios of <span class="math inline">\(\textbf{x}\)</span> and <span class="math inline">\(\textbf{y}\)</span>. That is, if we get:</p>
<p><span class="math display">\[
\textbf{z} = \alpha\textbf{x} + (1- \alpha)\textbf{y}
\]</span></p>
<p>then we can show that the following must hold:</p>
<p><span class="math display">\[
\begin{align}
\mu_{P,z} &amp;= \alpha\mu_{P,x} + (1-\alpha)\mu_{P,y} \\
\sigma_{P,z}^2 &amp;= \alpha^2\sigma_{P,x}^2 + (1-\alpha)^2\sigma_{P,y}^2 + 2\alpha(1-\alpha)\sigma_{P,xy}
\end{align}
\]</span></p>
<p>whereas <span class="math inline">\(\sigma_{P,x}^2 = \textbf{x&#39;}\Sigma\textbf{x}\)</span>, <span class="math inline">\(\sigma_{P,y}^2 = \textbf{y&#39;}\Sigma\textbf{y}\)</span> and <span class="math inline">\(\sigma_{P,xy} = \textbf{x&#39;}\Sigma\textbf{y}\)</span>.</p>
<p>To put this in words. What we do here is nothing else than defining the expected return for the minimum variance portfolios on x and y and calculate the minimum variances for both portfolios. This is what we did in the previous chapter. Further, we need to compute the covariance between these two portfolios, which is defined as <span class="math inline">\(\sigma_{P,xy}\)</span>. Once we have all these, we can again vary the <span class="math inline">\(\alpha\)</span> levels and calculate the respective expected return and risk combinations that are efficient and feasible through this linear transformation step.</p>
<p>Let’s show this quickly:</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First we calculate the first Efficient Portfolio</span></span>
<span id="cb445-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb445-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the EW return</span></span>
<span id="cb445-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-4" aria-hidden="true" tabindex="-1"></a>mu_spec_x <span class="ot">&lt;-</span> mu_MV</span>
<span id="cb445-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-5" aria-hidden="true" tabindex="-1"></a>mu_spec_y <span class="ot">&lt;-</span> <span class="fl">0.125</span></span>
<span id="cb445-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb445-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-7" aria-hidden="true" tabindex="-1"></a><span class="co"># We first define again the Matrix A </span></span>
<span id="cb445-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-8" aria-hidden="true" tabindex="-1"></a>mat_A_EF <span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="fu">cbind</span>(<span class="dv">2</span><span class="sc">*</span>cvar_ret, mean_ret,  <span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">dim</span>(cvar_ret)[<span class="dv">1</span>])), </span>
<span id="cb445-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-9" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">cbind</span>(<span class="fu">t</span>(mean_ret), <span class="dv">0</span>, <span class="dv">0</span>), </span>
<span id="cb445-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-10" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">cbind</span>(<span class="fu">t</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">dim</span>(cvar_ret)[<span class="dv">1</span>])), <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb445-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb445-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we define the vector b</span></span>
<span id="cb445-13"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-13" aria-hidden="true" tabindex="-1"></a>vec_b_EF_x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">dim</span>(cvar_ret)[<span class="dv">1</span>]), mu_spec_x, <span class="dv">1</span>)</span>
<span id="cb445-14"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-14" aria-hidden="true" tabindex="-1"></a>vec_b_EF_y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">dim</span>(cvar_ret)[<span class="dv">1</span>]), mu_spec_y, <span class="dv">1</span>)</span>
<span id="cb445-15"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb445-16"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we can solve for the respective weights</span></span>
<span id="cb445-17"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-17" aria-hidden="true" tabindex="-1"></a>z_EF_x <span class="ot">&lt;-</span> <span class="fu">solve</span>(mat_A_EF)<span class="sc">%*%</span>vec_b_EF_x</span>
<span id="cb445-18"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-18" aria-hidden="true" tabindex="-1"></a>z_EF_y <span class="ot">&lt;-</span> <span class="fu">solve</span>(mat_A_EF)<span class="sc">%*%</span>vec_b_EF_y</span>
<span id="cb445-19"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb445-20"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we take the first N elements to get the respective weights</span></span>
<span id="cb445-21"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-21" aria-hidden="true" tabindex="-1"></a>x_EF <span class="ot">&lt;-</span> z_EF_x[<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(cvar_ret)[<span class="dv">1</span>]]</span>
<span id="cb445-22"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-22" aria-hidden="true" tabindex="-1"></a>y_EF <span class="ot">&lt;-</span> z_EF_y[<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(cvar_ret)[<span class="dv">1</span>]]</span>
<span id="cb445-23"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb445-24"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s calculate the risk</span></span>
<span id="cb445-25"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-25" aria-hidden="true" tabindex="-1"></a>sd_EF_x <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">t</span>(x_EF) <span class="sc">%*%</span> cvar_ret <span class="sc">%*%</span> x_EF)</span>
<span id="cb445-26"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-26" aria-hidden="true" tabindex="-1"></a>sd_EF_y <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">t</span>(y_EF) <span class="sc">%*%</span> cvar_ret <span class="sc">%*%</span> y_EF)</span>
<span id="cb445-27"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb445-27" aria-hidden="true" tabindex="-1"></a>sd_EF_xy <span class="ot">&lt;-</span> <span class="fu">t</span>(x_EF) <span class="sc">%*%</span> cvar_ret <span class="sc">%*%</span> y_EF</span></code></pre></div>
<p>Now, we can compute the individual weights</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb446-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lastly, compute the weights and results</span></span>
<span id="cb446-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb446-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="dv">0</span>, <span class="at">to=</span><span class="dv">1</span>, <span class="at">by=</span><span class="fl">0.05</span>) </span>
<span id="cb446-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb446-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb446-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the expected return as well as the variance and standard deviation of each portfolios</span></span>
<span id="cb446-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb446-5" aria-hidden="true" tabindex="-1"></a>mu_z <span class="ot">=</span> a<span class="sc">*</span>mu_spec_x <span class="sc">+</span> (<span class="dv">1</span><span class="sc">-</span>a)<span class="sc">*</span>mu_spec_y</span>
<span id="cb446-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb446-6" aria-hidden="true" tabindex="-1"></a>sd_z <span class="ot">=</span> <span class="fu">sqrt</span>(a<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sd_EF_x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (<span class="dv">1</span><span class="sc">-</span>a)<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sd_EF_y<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>a<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>a)<span class="sc">*</span>sd_EF_xy)</span>
<span id="cb446-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb446-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb446-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb446-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataframe consisting of different weights</span></span>
<span id="cb446-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb446-10" aria-hidden="true" tabindex="-1"></a>z <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>,  <span class="fu">length</span>(a), <span class="dv">19</span>) </span>
<span id="cb446-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb446-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb446-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(a)){</span>
<span id="cb446-13"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb446-13" aria-hidden="true" tabindex="-1"></a>  z[i, ] <span class="ot">=</span> a[i]<span class="sc">*</span>x_EF <span class="sc">+</span> (<span class="dv">1</span><span class="sc">-</span>a[i])<span class="sc">*</span>y_EF</span>
<span id="cb446-14"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb446-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb446-15"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb446-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb446-16"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb446-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataframe consisting of only the efficient linear transformation portfolios</span></span>
<span id="cb446-17"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb446-17" aria-hidden="true" tabindex="-1"></a>z_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(mu_z, sd_z))</span>
<span id="cb446-18"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb446-18" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(z_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Efficient_PF_Return&quot;</span>, <span class="st">&quot;Efficient_PF_Risk&quot;</span>)</span></code></pre></div>
<p>And finally we can calculate the Efficient Frontier</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb447-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s visualise the relationship</span></span>
<span id="cb447-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb447-2" aria-hidden="true" tabindex="-1"></a>z_df <span class="sc">%&gt;%</span> </span>
<span id="cb447-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb447-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> Efficient_PF_Risk, <span class="at">y =</span> Efficient_PF_Return), <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span> </span>
<span id="cb447-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb447-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb447-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb447-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>() <span class="sc">+</span> </span>
<span id="cb447-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb447-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(mu[p])) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="fu">expression</span>(sigma[p])) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;The Efficient Frontier for the Swiss Market Portfolio&quot;</span>) <span class="sc">+</span></span>
<span id="cb447-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb447-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb447-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb447-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb447-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb447-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb447-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb447-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb447-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb447-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb447-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb447-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb447-13"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb447-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb447-14"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb447-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb447-15"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb447-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb447-16"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb447-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb447-17"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb447-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-248-1.png" width="672" /></p>
</div>
</div>
<div id="the-efficient-and-feasible-portfolio-cal-of-n-risky-assets-and-a-risk-free-asset" class="section level3" number="7.4.4">
<h3><span class="header-section-number">7.4.4</span> The Efficient and Feasible Portfolio CAL of N risky Assets and a risk-free Asset</h3>
<p>We showed in the two-asset case that the efficient and feasible portfolios are those that have the highest Sharpe Ratio, which is indicated by the tangency portfolio. Based on this result, we derived the CML, which is the efficient and feasible CAL. Further, we showed that, depending on risk preferences, investors choose to invest more into risky or risk-free assets. Now we can show that the same results hold when generalising the case to incorporate N assets.
#### Tangency Portfolio Calculation with N Assets</p>
<p>Remember, to obtain the efficient and feasible portfolio CAL, we need first to obtain the portfolio which is tangent to the set of risky assets. In the N-dimensional case, this implies we need to find a line which “slightly touches” the outer boundary of the feasible set of risky portfolios. This will maximise the slope of the resulting, constrained CAL. Subsequently, since the slope of the CAL is defined as the Sharpe Ratio, we need to conditionally maximise this metric. The portfolio which we require to do so is thereby called the tangency portfolio.</p>
<p>In essence, we need to:</p>
<p><span class="math display">\[
\begin{align}
\max{x} = \frac{\mu^{tan}_P - r_f}{\sigma_P^{tan}} =  \frac{\textbf{x&#39;}\mu_P - r_f}{(\textbf{x&#39;}\Sigma_P\textbf{x})^{1/2}} &amp;&amp; \text{ s.t. } \textbf{x&#39;1}=1
\end{align}
\]</span></p>
<p>Let’s calculate the Lagrangian again for this constrained optimisation problem. This will be:</p>
<p><span class="math display">\[
L(\textbf{x}, \lambda_1) = \frac{\textbf{x&#39;}\mu_P - r_f}{(\textbf{x&#39;}\Sigma_P\textbf{x})^{1/2}} + \lambda_1(\textbf{x&#39;1} - 1)
\]</span></p>
<p>The resulting FOCs from this optimisation are then:</p>
<p><span class="math display">\[
\begin{align}
\frac{\delta L}{\delta \textbf{x}} &amp;= \mu_P(\textbf{x&#39;}\Sigma_P\textbf{x})^{-1/2} - (\textbf{x&#39;}\mu_P - r_f)(\textbf{x&#39;}\Sigma_P\textbf{x})^{-3/2}\Sigma_P\textbf{x} + \textbf{1} = 0 \\
\frac{\delta L}{\delta \lambda_1} &amp;= \textbf{x&#39;1} = 1
\end{align}
\]</span></p>
<p>Based on this, we can use the same, although definitively more complicated, approach to solving the system of linear equations. However, exactly calculating would excedd the aim of this course as this requires an in-depth understanding of linear algebra concepts. Consequently, we will simply show you that the formula to calculate the weight vector of a tangency portfolio which maximises the respective Sharpe Ratio is:</p>
<p><span class="math display">\[
\textbf{x&#39;}_{tan} = \frac{\Sigma^{-1}(\mu_P - r_f\cdot \textbf{1})}{\textbf{1&#39;}\Sigma^{-1}(\mu_P - r_f\cdot \textbf{1})}
\]</span></p>
<p>In general, we are always able to derive an exact solution for each of the properties we defined so far. However, given the computational complexity of large matrices, it is important to understand how to retrieve these properties in a non-calculus, but more algebraic fashion.</p>
<p>However, if we now insert this formula to retrieve the optimal weights, we will get the following:</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb448-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the TP</span></span>
<span id="cb448-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb448-2" aria-hidden="true" tabindex="-1"></a>mu_f <span class="ot">=</span> <span class="fu">mean</span>(A2_ts_1_year_monthly[<span class="st">&#39;2013-01-31/2016-12-31&#39;</span>])</span>
<span id="cb448-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb448-3" aria-hidden="true" tabindex="-1"></a><span class="do">## First the numerator and denominator </span></span>
<span id="cb448-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb448-4" aria-hidden="true" tabindex="-1"></a>numerator_T_N <span class="ot">&lt;-</span> <span class="fu">inv</span>(cvar_ret)<span class="sc">%*%</span>(mean_ret <span class="sc">-</span> mu_f<span class="sc">*</span><span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(mean_ret)))</span>
<span id="cb448-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb448-5" aria-hidden="true" tabindex="-1"></a>denominator_T_N <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(mean_ret)))<span class="sc">%*%</span><span class="fu">inv</span>(cvar_ret)<span class="sc">%*%</span>(mean_ret <span class="sc">-</span> mu_f<span class="sc">*</span><span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(mean_ret)))</span>
<span id="cb448-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb448-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Then the weights</span></span>
<span id="cb448-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb448-7" aria-hidden="true" tabindex="-1"></a>weights_T_N <span class="ot">&lt;-</span> numerator_T_N[,<span class="dv">1</span>] <span class="sc">/</span> denominator_T_N</span></code></pre></div>
<pre><code>## Warning in numerator_T_N[, 1]/denominator_T_N: Recycling array of length 1 in vector-array arithmetic is deprecated.
##   Use c() or as.vector() instead.</code></pre>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb450-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Check if the weights sum up to 1</span></span>
<span id="cb450-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb450-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(weights_T_N)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>Great, this is the formula for calculating the weights for the tangency portfolio. We can now calculate the respective risk and return and visualise this in the plot.</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the risk and return metrics</span></span>
<span id="cb452-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-2" aria-hidden="true" tabindex="-1"></a>mu_T_N <span class="ot">&lt;-</span> weights_T_N <span class="sc">%*%</span>mean_ret</span>
<span id="cb452-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-3" aria-hidden="true" tabindex="-1"></a>sd_T_N <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">t</span>(weights_T_N)<span class="sc">%*%</span>cvar_ret<span class="sc">%*%</span>weights_T_N)</span>
<span id="cb452-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create another dataframe</span></span>
<span id="cb452-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-6" aria-hidden="true" tabindex="-1"></a>mu_sd_T_N_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(mu_T_N, sd_T_N))</span>
<span id="cb452-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(mu_sd_T_N_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;mu_T_N&quot;</span>, <span class="st">&quot;sd_T_N&quot;</span>)</span>
<span id="cb452-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb452-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s visualise the relationship</span></span>
<span id="cb452-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-10" aria-hidden="true" tabindex="-1"></a>z_df <span class="sc">%&gt;%</span> </span>
<span id="cb452-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> Efficient_PF_Risk, <span class="at">y =</span> Efficient_PF_Return), <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span> </span>
<span id="cb452-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb452-13"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>() <span class="sc">+</span> </span>
<span id="cb452-14"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> mu_sd_T_N_df, <span class="fu">aes</span>(<span class="at">x=</span> sd_T_N, <span class="at">y =</span> mu_T_N), <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span> </span>
<span id="cb452-15"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(mu[p])) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="fu">expression</span>(sigma[p])) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;The Tangency Portfolio on the EF for the Swiss Market Portfolio&quot;</span>) <span class="sc">+</span></span>
<span id="cb452-16"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb452-17"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb452-18"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb452-19"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb452-20"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb452-21"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb452-22"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb452-23"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb452-24"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb452-25"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb452-26"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb452-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-250-1.png" width="672" /></p>
<div id="calculating-of-the-cml-through-the-mutual-fund-theorem" class="section level4" number="7.4.4.1">
<h4><span class="header-section-number">7.4.4.1</span> Calculating of the CML through the Mutual Fund Theorem</h4>
<p>Recall the mutual fund theorem. It states that, if a risk-free asset is given, then the optimal allocation of portfolios lies on the efficient and feasible CAL, which is defined by having the slope of the Sharpe Ratio and touching the set of risky securities at the tangency portfolio. Consequently, as we did in the two-asset case, we can compute the expected return and standard deviation of these portfolios as follows:</p>
<p><span class="math display">\[
\begin{align}
\mu_P^e &amp;= x_{tan}\mu_P^{tan} + (1-x_{tan})r_f = r_f + x_{tan}(\mu_P^{tan} - r_f)\\
\sigma_P^e &amp;= x_{tan}\sigma_P^{tan}
\end{align}
\]</span></p>
<p>The optimal allocation of risky and risk-free assets in this case again depends on so-called <strong>investor preferences</strong>. If the investor is <strong>risk-averse</strong>, then she will choose portfolios with a low volatility, implying a larger investment share in the risk-free asset. If she is <strong>risk-seeking</strong>, then she will choose portfolios with a higher volatility, implying a larger investment share in the risky asset. However, all the weighted portfolios of the risk-free asset and the tangency portfolio are efficient and feasible.</p>
<p>The CAL which combines all these portfolios is again called the <strong>Capital Market Line (CML)</strong>, just now in a general case of N assets. The slope of the CML is the maximum Sharpe Ratio. Consequently, we can derive the expected return by combining both formulas as we did in the two-asset case.</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb453-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the tangency portfolio</span></span>
<span id="cb453-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb453-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb453-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Define the sequence</span></span>
<span id="cb453-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb453-4" aria-hidden="true" tabindex="-1"></a>x_tan <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from=</span><span class="sc">-</span><span class="fl">0.8</span>, <span class="at">to=</span><span class="fl">2.2</span>, <span class="at">by=</span><span class="fl">0.1</span>)</span>
<span id="cb453-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb453-5" aria-hidden="true" tabindex="-1"></a>x_f <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> x_tan</span>
<span id="cb453-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb453-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb453-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate the metrics</span></span>
<span id="cb453-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb453-8" aria-hidden="true" tabindex="-1"></a>mu_tanf <span class="ot">=</span> x_tan<span class="sc">*</span>mu_T_N <span class="sc">+</span> x_f<span class="sc">*</span>mu_f</span>
<span id="cb453-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb453-9" aria-hidden="true" tabindex="-1"></a>var_tanf <span class="ot">=</span> x_tan<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sd_T_N<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> x_f<span class="sc">^</span><span class="dv">2</span><span class="sc">*</span>sigma_f<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>x_tan<span class="sc">*</span>x_f<span class="sc">*</span>sigma_Af</span>
<span id="cb453-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb453-10" aria-hidden="true" tabindex="-1"></a>sd_tanf <span class="ot">=</span> <span class="fu">sqrt</span>(var_tanf)</span>
<span id="cb453-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb453-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb453-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Only get the &quot;positive returns&quot; from the r_f on</span></span>
<span id="cb453-13"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb453-13" aria-hidden="true" tabindex="-1"></a>mu_tanf_real <span class="ot">&lt;-</span> mu_tanf[<span class="dv">9</span><span class="sc">:</span><span class="dv">31</span>]</span>
<span id="cb453-14"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb453-14" aria-hidden="true" tabindex="-1"></a>sd_tanf_real <span class="ot">&lt;-</span> sd_tanf[<span class="dv">9</span><span class="sc">:</span><span class="dv">31</span>]</span>
<span id="cb453-15"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb453-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a df</span></span>
<span id="cb453-16"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb453-16" aria-hidden="true" tabindex="-1"></a>cml_N <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(mu_tanf_real, sd_tanf_real))</span>
<span id="cb453-17"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb453-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(cml_N) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;MU_CML&quot;</span>, <span class="st">&quot;SD_CML&quot;</span>)</span>
<span id="cb453-18"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb453-18" aria-hidden="true" tabindex="-1"></a>mu_sd_T_N_df</span></code></pre></div>
<pre><code>##       mu_T_N     sd_T_N
## 1 0.05273657 0.03641726</code></pre>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s visualise the relationship</span></span>
<span id="cb455-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-2" aria-hidden="true" tabindex="-1"></a>z_df <span class="sc">%&gt;%</span> </span>
<span id="cb455-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span> Efficient_PF_Risk, <span class="at">y =</span> Efficient_PF_Return), <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span> </span>
<span id="cb455-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb455-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>() <span class="sc">+</span> </span>
<span id="cb455-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> cml_N, <span class="fu">aes</span>(<span class="at">x =</span> SD_CML, <span class="at">y =</span> MU_CML), <span class="at">color =</span> <span class="st">&quot;aquamarine4&quot;</span>) <span class="sc">+</span> </span>
<span id="cb455-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> cml_N, <span class="fu">aes</span>(<span class="at">x =</span> SD_CML, <span class="at">y =</span> MU_CML), <span class="at">color =</span> <span class="st">&quot;aquamarine4&quot;</span>) <span class="sc">+</span> </span>
<span id="cb455-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> mu_sd_T_N_df, <span class="fu">aes</span>(<span class="at">x=</span> sd_T_N, <span class="at">y =</span> mu_T_N), <span class="at">color =</span> <span class="st">&quot;darkorange3&quot;</span>) <span class="sc">+</span> </span>
<span id="cb455-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="sc">-</span><span class="fl">0.0002970927</span>), <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span> </span>
<span id="cb455-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.087</span> ,<span class="at">y =</span> <span class="fl">0.10</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&#39;Efficient Frontier&#39;</span>), <span class="at">size =</span> <span class="dv">3</span>,  <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb455-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.063</span> ,<span class="at">y =</span> <span class="fl">0.11</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&#39;Capital Market Line&#39;</span>), <span class="at">size =</span> <span class="dv">3</span>,  <span class="at">color =</span> <span class="st">&quot;aquamarine4&quot;</span>) <span class="sc">+</span></span>
<span id="cb455-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="fl">0.026</span> ,<span class="at">y =</span> <span class="fl">0.055</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&#39;Tangency Portfolio&#39;</span>), <span class="at">size =</span> <span class="dv">3</span>,  <span class="at">color =</span> <span class="st">&quot;darkorange3&quot;</span>) <span class="sc">+</span></span>
<span id="cb455-13"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>,<span class="at">x =</span> <span class="sc">-</span><span class="fl">0.005</span> ,<span class="at">y =</span> <span class="fl">0.005</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">&#39;Risk-Free&#39;</span>), <span class="at">size =</span> <span class="dv">3</span>,  <span class="at">color =</span> <span class="st">&quot;goldenrod&quot;</span>) <span class="sc">+</span></span>
<span id="cb455-14"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(mu[p])) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="fu">expression</span>(sigma[p])) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;The Tangency PF, CML and set of feasible PF for the Swiss Market&quot;</span>) <span class="sc">+</span></span>
<span id="cb455-15"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb455-16"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="fl">0.01</span>,<span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb455-17"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb455-18"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb455-19"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb455-20"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb455-21"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb455-22"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb455-23"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb455-24"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb455-25"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb455-26"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb455-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-251-1.png" width="672" /></p>
<p>Great, we now derived the idea behind the modern portfolio theory. Throughout, we showed the behaviour of the set of feasible portfolios, defined how to characterise the portfolio distribution solely by risk and return characteristics, calculated efficient and inefficient portfolios, derived the minimum variance portfolio and introduced risk-free assets. Therein, we then computed the efficient frontier and defined the Capital Allocation Line. Based on the slope of the CAL, we then derived a constrained optimisation problem to maximise the Sharpe Ratio such that it still touches the set of feasible and efficient portfolios, and defined the risk and return characteristics of this portfolio as tangency portfolio. Ultimately, we defined the Mutual Fund Theorem, stating that the set of efficient and feasible portfolios consisting of risky and risk-free assets is characterised by the graph connecting the risk-free rate with the tangency portfolio, and the slope of the tangency portfolio Sharpe Ratio. This is the entire idea behind Markowitz’s asset allocation theory.</p>
</div>
</div>
</div>
<div id="the-capital-asset-pricing-model" class="section level2" number="7.5">
<h2><span class="header-section-number">7.5</span> The Capital Asset Pricing Model</h2>
<div id="intuition-of-the-capm" class="section level3" number="7.5.1">
<h3><span class="header-section-number">7.5.1</span> Intuition of the CAPM</h3>
<p>We now have derived the fundamental notions of the modern portfolio theory. Especially, we were able to show an N-asset type result. This was not only important to show a generalisable result of the underlying relationship, but it also serves as basis to introduce the next fundament of modern portfolio theories.</p>
<p>By introducing a portfolio consisting of N assets, all stemming from the same market in this case, we also indirectly introduced the concept of a market portfolio. A market portfolio is a portfolio of assets that are able to characterise the return behaviour of an underlying market. So far, we characterised the portfolio return on the CML as a function which relates investor preferences to the weights in risky assets. As we have derived, the weights can be characterised as the standard deviation of the efficient portfolio, relative to the standard deviation of the optimal portfolio. The higher this fraction, the higher is the risk of the efficient, investor specific portfolio compared to the tangent, or optimal, portfolio. This is the idea behind the CML, which combines the risk-free asset with n risky assets, or with <strong>one risky market portfolio</strong>.</p>
<p>Now, we may be interested to understand what happens if we do not hold the market portfolio, but rather any arbitrary, but efficient, asset or portfolio. Especially, we may be eager to understand the connection between individual optimisation behaviour and the market behaviour when investors can draw on risky as well as risk-free assets. To do this, we can contrast the slope of the CML with a portfolio mix consisting of risky assets as well as the market portfolio. <strong>By the tangency property these two slopes must be equal</strong>. The intuition for this result is the following. We state that all investors are mean-variance optimisers, then they will all hold a combination of the risk-free asset and the tangency portfolio (Two-Fund Separation Theorem). Consequently, all individuals hold a certain fraction of risky assets as that of the tangency portfolio. Now, in equilibrium, when we assume that the market clears and all risky assets must be held, the market portfolio (being a linear combination of the individual portfolios) has the same fraction of assets as the tangency portfolio. This is because if we require to hold all assets then, on average, we will invest 100% of the funds into risky assets. Remember that, when investing 100% into risky and efficient assets, we retrieve the tangency portfolio. As the tangency portfolio maximises expected return for a given level of risk and since the investors are mean-variance optimisers, in equilibrium both slopes must cross the tangency portfolio (as only this maximises the Sharpe Ratio for both cases).</p>
</div>
<div id="mathematical-derivation-of-the-security-market-line-sml" class="section level3" number="7.5.2">
<h3><span class="header-section-number">7.5.2</span> Mathematical Derivation of the Security Market Line (SML)</h3>
<p>Based on this result, we can thus mathematically introduce the property which transforms the MV optimisation to the CAPM formula by solving for two constrained optimisation problems:</p>
<p><span class="math display">\[
\begin{align}
\max_{x_{tan}}\mu_P^e &amp;= x_{tan}\mu_P^{tan} + (1-x_{tan})r_f = r_f + x_{tan}(\mu_P^{tan} - r_f) &amp;&amp; \text{ s.t. } \sigma_P^e = x_{tan}\sigma_P^{tan}\\
\max_{x_{tan}} \mu_P &amp;= x_{tan}\mu_P^{i} + (1-x_{tan})\mu_m = r_m + x_{tan}(\mu_P^{i} - \mu_m) &amp;&amp; \text{ s.t. } \sigma_P^ = \sqrt{\sigma_i^2x_{tan}^2 + (1-x_{tan})^2\sigma_m^2 + 2x_{tan}(1-x_{tan})\sigma_{im}}
\end{align}
\]</span></p>
<p>By solving this optimisation problem, we substitute the fraction of variances as <span class="math inline">\(x_{tan}\)</span> and assume that none of the wealth is invested in the risk-free asset on average, we obtain the following:</p>
<p><span class="math display">\[
\begin{align}
\frac{\delta \mu_P^e}{\delta x_{tan}} &amp;= \frac{\mu_P^{tan} - r_f}{\sigma_P^{tan}} \\
\frac{\delta \mu_P}{\delta x_{tan}} &amp;= \frac{\mu_P^{i} - \mu_m}{\frac{\sigma_{im} - \sigma_m^2}{\sigma_m}}
\end{align}
\]</span></p>
<p>In a next step, we set both slopes equal to each other.</p>
<p><span class="math display">\[
\begin{align}
\frac{\mu_P^{tan} - r_f}{\sigma_P^{tan}} &amp;= \frac{\mu_P^{i} - \mu_m}{\frac{\sigma_{im} - \sigma_m^2}{\sigma_m}} \\
\frac{\mu_P^{tan} - r_f}{\sigma_P^{tan}} &amp;= \frac{(\mu_P^{i} - \mu_m)\sigma_m}{\sigma_{im} - \sigma_m^2} \\
(\mu_P^{tan} - r_f)(\sigma_{im} - \sigma_m^2) &amp;= \sigma_P^{tan}((\mu_P^{i} - \mu_m)\sigma_m) &amp;&amp; \text{Market Clearing: } \mu_P^{tan} = \mu_m, \sigma_P^{tan} = \sigma_m \\
\mu_m\sigma_{im} -r_f\sigma_{im} - \mu_m\sigma_m^2 + r_f\sigma_m^2 &amp;= \sigma_m^2\mu_p^i - \mu_m\sigma_m^2 \\
\sigma_{im}(\mu_m - r_f) &amp;= \sigma_m^2(\mu_p^i - r_f) (\sigma_P^{tan})
\end{align}
\]</span></p>
<p>Overall, this delivers the baseline result for <strong>Security Market Line (SML)</strong>, which characterises the CAPM, is the following:</p>
<p><span class="math display">\[
\mu_P^i = r_f + \beta_i(\mu_m - r_f)
\]</span></p>
<p>whereas <span class="math inline">\(\beta_i = \frac{\sigma_{im}}{\sigma_m^2}\)</span> is the relative risk, or volatility of any asset or portfolio compared to the risk of the underlying market. Note that, when we considered <span class="math inline">\(\beta\)</span> in earlier chapters, we did nothing else than define this coefficient as quantification of the movements of a dependent variable relative to the movements of any explanatory variable. Now, we specified this co-movement dependency by stating that the explanatory variable is the market portfolio return and the dependent variable is the individual security return.</p>
<p>In essence, the resulting formula for the SML allows us to draw an equivalent model, in which we define the <span class="math inline">\(\beta\)</span> coefficient on the x-axis and the subsequent expected return <span class="math inline">\(\mu_i\)</span> on the y axis. Basing the definition on the tangency, or market, portfolio we understand that a <span class="math inline">\(\beta\)</span> coefficient of 1implies that the security expected return equals the market return. This is intuitive, when stating that the SML compensates for additional risk encountered relative to the market risk.</p>
</div>
<div id="similarity-of-the-cml-and-sml" class="section level3" number="7.5.3">
<h3><span class="header-section-number">7.5.3</span> Similarity of the CML and SML</h3>
<p>In essence, the CML is the graph of the efficient frontier and the SML is the graph of the CAPM. The SML is derived from the CML. While the CML shows the rates of return for a specific portfolio, the SML represents the market’s risk and return at a given time, and shows the expected returns of individual assets.</p>
<p>As is evident, there is a clear similarity with the CML formula. The main difference is the coefficient for the multiplicative term which defines the slope of the curve. In terms of the CML, the slope is characterised as <span class="math inline">\(\frac{\sigma_P^e}{\sigma_P}\)</span>, and, in terms of the SML, as <span class="math inline">\(\frac{\sigma_{im}}{\sigma_m^2}\)</span>. Based on linearity properties, we can square the coefficient of the CML to have a better comparability. In this case, we understand that the denominator is the same. Consequently, we understand that both lines set a certain risk relative to the underlying market risk (defined by the tangency portfolio in equilibrium). In the case of the CML, in which we only assess risky assets and a risk free asset, this is the co-variation of the risky assets with themselves, because the covariance term with the risk-free asset is zero, resulting in only the variance of the portfolio. In the case of the SML, in which we assess risky assets and the (risky) market portfolio, this is the co-variation of the risky assets with the market portfolio, because the covariance term is not zero. However, the intuition is the same, namely that an increase in the variation relative to the underlying market risk is associated with an increase in expected returns.</p>
<p>Further, note that, by definition of the <span class="math inline">\(\beta\)</span> coefficient, we only consider <strong>systematic risk components</strong> in the case of the CAPM. This is intuitive, given that we consider the covariance of the asset with the market. Recall, we showed in earlier chapters that, as N approaches a large number, the portfolio risk is characterised entirely by its covariance structure. This is what we considered as diversification. Based on this diversification, we expect that investors already diversified any idiosyncratic risk away and thus are located on the efficient and feasible CAL, implying that, for any given level of return, they minimise the resulting risk. Consequently, the CAPM only considers the reimbursement for additional, systematic risk, relative to the underlying market risk. This “reimbursement” is quantified by the <span class="math inline">\(\beta\)</span> coefficient.</p>
<p>Besides similarities, it also makes sense to point out the main differences between both graphs.</p>
<ul>
<li>Initially, the <strong>CML</strong> examines the <strong>expected returns on efficient portfolios and their total risk</strong> (measured by standard deviation). The <strong>SML</strong> examines the <strong>expected returns on individual assets and their systematic risk</strong> (measured by beta). If the relationship between expected return and beta is valid for any individual securities, it must also be valid for portfolios constructed with any of these securities. So, the SML is valid for both efficient portfolios and individual assets.</li>
<li>Further, the slope of the <strong>CML</strong> is the <strong>market portfolio’s Sharpe ratio</strong> and the slope of the <strong>SML</strong> is the <strong>market risk premium</strong>s. We derived this result earlier by taking the first derivative w.r.t. the respective variables.</li>
<li>Lastly, it is important to note that <strong>all properly priced securities and efficient portfolios lie on the SML</strong>. However, only <strong>efficient portfolios lie on the CML</strong>.</li>
</ul>
</div>
<div id="diagnostic-tests-of-the-capm" class="section level3" number="7.5.4">
<h3><span class="header-section-number">7.5.4</span> Diagnostic Tests of the CAPM</h3>
<p>We understand that, according to the CAPM, the expected return of any security is characterised as the risk-free asset and a scaled factor of the Market Risk Premium, where the scale is quantified by the <span class="math inline">\(\beta\)</span> coefficient. We need to test whether the assumptions of the relationship being characterised by this coefficient hold empirically.</p>
</div>
<div id="fama-macbeth-1973-approach" class="section level3" number="7.5.5">
<h3><span class="header-section-number">7.5.5</span> Fama-MacBeth (1973) approach</h3>
<div id="intuition-and-computation-of-the-fm-approach" class="section level4" number="7.5.5.1">
<h4><span class="header-section-number">7.5.5.1</span> Intuition and Computation of the FM Approach</h4>
<p>The most common test to assess the validity of any factor model, including the CAPM, is to use the Fama-MacBeth (1973) (=FM) two-step regression approach. It is quite straight-forward and one can show that its asymptotic properties hold when slightly adjusting the covariance matrix. Hence, the results from the approach can be quantified and put into the usual hypothesis framework.</p>
<p>Throughout the FM approach, we conduct two distinct types of regressions. The first is a time-series regression and the second is a cross-sectional regression. Let’s assume that we have a portfolio consisting of N assets for a period of T months. In a first step, we run N time-series regressions of the individual security returns on the market risk. This is defined as:</p>
<p><span class="math display">\[
r_{i,t} - r_{ft} = \alpha_i + \beta_{i}(r_{mt} - r_{ft}) + \epsilon_{it}
\]</span></p>
<p>This will result in N <span class="math inline">\(\beta\)</span> coefficients. We call these <strong>Factor Loadings</strong>. We can also elaborate this step and take rolling regressions with a rolling window of W to obtain <span class="math inline">\(N\cdot (T - (W-1))\)</span> <span class="math inline">\(\beta\)</span> coefficients. This is because we start with a window W, implying that we need at least W observations to construct the first estimate. From this on, if we move the window by 1 unit W each time, and have T observations in total, we retrieve T-W coefficients for each security. If we have N securities, this is multiplied accordingly. As a small example, consider that we have 3 assets and a period of 20 months, with rolling window regression of 15 months. As such, the first <span class="math inline">\(\beta\)</span> coefficient is given in t = 15 (by taking regressions for t = 1-15). From then on, we take regressions for t=16 (t=2-16), t=17, t=18, t=19 and t=20. Overall, this gives us 6 coefficients for the entire window. Thus, T = 20, W = 15, and overall we get 20-(15-1) = 6 coefficients per stock. For three securities, we thus obtain <span class="math inline">\(6\cdot 3 = 18\)</span> <span class="math inline">\(\beta\)</span> coefficients.</p>
<p>Now, we take these coefficients and run a second, cross-sectional regression. This involves the following procedure. At each observational date, we run the cross-section of excess returns on the <span class="math inline">\(\beta\)</span> estimates. This is a cross-sectional regression because we get the returns for each asset at time t and run it on the respective factor loadings, thereby comparing the differences between assets at a given date. This will result in so-called <strong>Factor Risk Premia</strong>, which we define as <span class="math inline">\(\hat{\lambda}\)</span>:</p>
<p><span class="math display">\[
r_{i,t} - r_{f,t} = \lambda_{t,0} + \lambda_{t,1}\hat{\beta_i} + u_{i,t}
\]</span></p>
<p>In the case of rolling regressions, we would to the identical approach. But note that we now have the <span class="math inline">\(\beta\)</span> coefficients of rolling windows each representing a window W. As such, we would adjust the expected return to represent the average return of the respective window instead of the entire time period. Consequently, we would retrieve <span class="math inline">\(N\cdot (T - (W-1))\)</span> factor loadings, following the similar logic as above.</p>
<p>Notice that there are two ways to define the expected returns. Either, the second stage regression now involves the actual returns. Otherwise, research also used average excess returns. Although there is no clear solution to what should be taken, it is common to use the actual, not excess, returns.</p>
<p>To assess the statistical validity of the approach, consider the following approach. For each of the <span class="math inline">\(\lambda\)</span> factors, we have one estimate per time period, <span class="math inline">\(\hat{\lambda}_{i,t}\)</span>. For each of the factor loadings, we then take the time average to obtain <span class="math inline">\(\hat{\lambda}_{i}\)</span>. For instance, if we have only one average observation per time-series (because we take the entire time-series), then <span class="math inline">\(\hat{\lambda}_{i,t} = \hat{\lambda}_{i}\)</span>. For rolling window regressions, we take the average of all windows per factor loadings. Further, we take the standard error of each factor loading. Based on both estimates, we calculate the <strong>t-ratio</strong> as average of the expected value divided by its standard error.</p>
<p>The test statistic is then</p>
<p><span class="math display">\[
t_{\hat{\lambda_i}} = \sqrt{T}\frac{\hat\lambda_i}{\hat{\sigma_i}}
\]</span></p>
<p>which is asymptotically standard normal, or follows a t distribution with T − 1 DOF in finite samples.</p>
</div>
<div id="interpretation-of-the-fm-approach" class="section level4" number="7.5.5.2">
<h4><span class="header-section-number">7.5.5.2</span> Interpretation of the FM Approach</h4>
<p>Essentially, the CAPM says that <strong>stocks with higher betas are more risky and therefore should command higher average returns to compensate investors for that risk</strong>. This implies that, in the cross-section, which compares average returns of individual assets, securities with higher exposure towards <span class="math inline">\(\beta\)</span> should compensate for this by inducing a higher expected return.</p>
<p>If the CAPM is valid, then we would expect the following:</p>
<ul>
<li><span class="math inline">\(\lambda_0 = r_f\)</span></li>
<li><span class="math inline">\(\lambda_1 = r_m - r_f\)</span></li>
</ul>
<p>That is, to find support for the CAPM, we would expect to see the intercept estimate being close to the risk-free rate of interest and the slope being close to the market risk premium. To understand the reasoning for this, recall the drawing of the SML. Here, we state that the first derivative of the SML w.r.t. <span class="math inline">\(\beta\)</span> is the market risk premium, <span class="math inline">\(r_m - r_f\)</span>. Since the first derivative of a variable indicates its slope, we understand that the resulting coefficient of the second-pass regression should be equal to the market risk premium in order for the CAPM to hold empirically. As such, the two-stage regression is quite a useful instrument to assess the validity of an underlying asset pricing model, because it represents the factor of interest as explanatory variable (which is the variable on the x-axis) in the second-pass regression, which enables us to interpret an average behaviour of said variable, relative to an underlying, economic, theory (in our case, that the slope is equal to the market risk premium).</p>
<p>Furthermore, we can test two additional hypotheses:</p>
<ul>
<li>The individual return and <span class="math inline">\(\beta\)</span> relationship is linear</li>
<li>No other variables can explain the cross-sectional variation in returns</li>
</ul>
<p>We can test these implications by running the following, cross-sectional regression:</p>
<p><span class="math display">\[
r_{i,t} - r_{f,t} = \lambda_{t,0} + \lambda_{t,1}\hat{\beta_i} + \lambda_{t,2}\hat{\beta_i^2} + \lambda_{t,3}\hat{\sigma}_i^2 + v_{i,t}
\]</span></p>
<p>whereas <span class="math inline">\(\hat{\beta}_i^2\)</span> are the estimates of the squared beta for stock i and <span class="math inline">\(\hat{\sigma_}i^2\)</span> the variance of the residual term of the first stage regression. Here:</p>
<ul>
<li><span class="math inline">\(\beta_i^2\)</span> represents a non-linearity factor of a higher order (we could potentially increase the order to construct so-called “splines”)
. <span class="math inline">\(\sigma_i^2\)</span> represents a measure of idiosyncratic risk for stock i (which we assume should be zero since only systematic risk is represented)</li>
</ul>
<p>Consequently, we would argue that:</p>
<ul>
<li><span class="math inline">\(\lambda_2 = 0\)</span></li>
<li><span class="math inline">\(\lambda_3 = 0\)</span></li>
</ul>
</div>
<div id="application-of-the-fama-macbeth-approach" class="section level4" number="7.5.5.3">
<h4><span class="header-section-number">7.5.5.3</span> Application of the Fama-MacBeth Approach</h4>
<p>Let’s now use the idea and create the FM approach for the BigFour Portfolio</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Datasets A1 - A3: </span></span>
<span id="cb456-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb456-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-3" aria-hidden="true" tabindex="-1"></a>A1 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;~/Desktop/Master UZH/Data/A3_dataset_01.txt&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb456-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-4" aria-hidden="true" tabindex="-1"></a>A2 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;~/Desktop/Master UZH/Data/A3_dataset_02.txt&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb456-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-5" aria-hidden="true" tabindex="-1"></a>A3 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;~/Desktop/Master UZH/Data/A3_dataset_03.txt&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb456-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb456-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Again, we define a date to convert the data set into an xts object </span></span>
<span id="cb456-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-8" aria-hidden="true" tabindex="-1"></a><span class="co"># First, note that we need to set the date into an appropriate format such that the time series object is able to read it</span></span>
<span id="cb456-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-9" aria-hidden="true" tabindex="-1"></a>A1<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">as.Date</span>(A1<span class="sc">$</span>Date, <span class="at">format =</span> <span class="st">&quot;%d.%m.%Y&quot;</span>), <span class="st">&quot;%Y-%m-%d&quot;</span>)</span>
<span id="cb456-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-10" aria-hidden="true" tabindex="-1"></a>A1_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(A1<span class="sc">$</span>Date)</span>
<span id="cb456-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-11" aria-hidden="true" tabindex="-1"></a>A1_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> A1[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> A1_date)</span>
<span id="cb456-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb456-13"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we use the return calculate function to calculate the returns of each stock. Note that the method &quot;log&quot; defines the log returns calculation of the returns</span></span>
<span id="cb456-14"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-14" aria-hidden="true" tabindex="-1"></a>A1_ts_ret <span class="ot">&lt;-</span> <span class="fu">Return.calculate</span>(A1_ts, <span class="at">method =</span> <span class="st">&quot;log&quot;</span>)</span>
<span id="cb456-15"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-15" aria-hidden="true" tabindex="-1"></a>A1_ts_ret <span class="ot">&lt;-</span> A1_ts_ret[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb456-16"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb456-17"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-17" aria-hidden="true" tabindex="-1"></a><span class="co"># We now perform the same steps for the market returns</span></span>
<span id="cb456-18"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-18" aria-hidden="true" tabindex="-1"></a>A2<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">as.Date</span>(A2<span class="sc">$</span>Date, <span class="at">format =</span> <span class="st">&quot;%d.%m.%Y&quot;</span>), <span class="st">&quot;%Y-%m-%d&quot;</span>)</span>
<span id="cb456-19"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-19" aria-hidden="true" tabindex="-1"></a>A2_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(A2<span class="sc">$</span>Date)</span>
<span id="cb456-20"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-20" aria-hidden="true" tabindex="-1"></a>A2_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> A2[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> A2_date)</span>
<span id="cb456-21"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-21" aria-hidden="true" tabindex="-1"></a>A2_ts_ret <span class="ot">&lt;-</span> <span class="fu">Return.calculate</span>(A2_ts, <span class="at">method =</span> <span class="st">&quot;log&quot;</span>)</span>
<span id="cb456-22"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-22" aria-hidden="true" tabindex="-1"></a>A2_ts_ret <span class="ot">&lt;-</span> A2_ts_ret[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb456-23"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-23" aria-hidden="true" tabindex="-1"></a>A2_ts_ret <span class="ot">&lt;-</span> A2_ts_ret[<span class="st">&#39;2012-07-31/2017-04-28&#39;</span>]</span>
<span id="cb456-24"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb456-25"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we perform the same steps for the risk-free asset, defined as the 1 year Swiss Bond Yield </span></span>
<span id="cb456-26"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-26" aria-hidden="true" tabindex="-1"></a>A3<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">as.Date</span>(A3<span class="sc">$</span>Date, <span class="at">format =</span> <span class="st">&quot;%d.%m.%Y&quot;</span>), <span class="st">&quot;%Y-%m-%d&quot;</span>)</span>
<span id="cb456-27"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-27" aria-hidden="true" tabindex="-1"></a>A3_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(A3<span class="sc">$</span>Date)</span>
<span id="cb456-28"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-28" aria-hidden="true" tabindex="-1"></a>A3_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> A3[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> A3_date)</span>
<span id="cb456-29"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb456-30"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the time series for the individual bond yields </span></span>
<span id="cb456-31"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb456-32"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-32" aria-hidden="true" tabindex="-1"></a><span class="do">## First, since the data is given in percent, we need to adjust by a factor of 100</span></span>
<span id="cb456-33"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-33" aria-hidden="true" tabindex="-1"></a>A3_ts_yearly <span class="ot">&lt;-</span> A3_ts <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb456-34"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-34" aria-hidden="true" tabindex="-1"></a>A3_ts_1_year_monthly <span class="ot">&lt;-</span> ((<span class="dv">1</span> <span class="sc">+</span> A3_ts_yearly)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb456-35"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-35" aria-hidden="true" tabindex="-1"></a>A3_ts_1_year_monthly <span class="ot">&lt;-</span> <span class="fu">log</span>(<span class="dv">1</span><span class="sc">+</span>A3_ts_1_year_monthly)[<span class="st">&#39;2012-07-31/2017-04-28&#39;</span>]</span>
<span id="cb456-36"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb456-37"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, load the portfolio of returns</span></span>
<span id="cb456-38"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb456-38" aria-hidden="true" tabindex="-1"></a>bigfour_ret <span class="ot">&lt;-</span> A1_ts_ret[, <span class="fu">c</span>(<span class="st">&quot;Nestle_PS&quot;</span>, <span class="st">&quot;Novartis_N&quot;</span>, <span class="st">&quot;Roche_Holding&quot;</span>, <span class="st">&quot;UBS_N&quot;</span>)][<span class="st">&#39;2012-07-31/2017-04-28&#39;</span>]</span></code></pre></div>
<p>Based on this dataframe, we can now conduct the analysis</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the first stage regression</span></span>
<span id="cb457-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">colnames</span>(bigfour_ret)[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]){</span>
<span id="cb457-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Run the regression</span></span>
<span id="cb457-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-4" aria-hidden="true" tabindex="-1"></a>  first_pass_reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(bigfour_ret[<span class="st">&#39;2012-07-31/2017-04-28&#39;</span>,i] <span class="sc">-</span>  A3_ts_1_year_monthly[<span class="st">&#39;2012-07-31/2017-04-28&#39;</span>] <span class="sc">~</span> A2_ts_ret[<span class="st">&#39;2012-07-31/2017-04-28&#39;</span>] <span class="sc">-</span> A3_ts_1_year_monthly[<span class="st">&#39;2012-07-31/2017-04-28&#39;</span>])</span>
<span id="cb457-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the coefficient of interest</span></span>
<span id="cb457-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-6" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> <span class="fu">summary</span>(first_pass_reg)<span class="sc">$</span>coefficients[<span class="dv">2</span>,<span class="dv">1</span>]</span>
<span id="cb457-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-7" aria-hidden="true" tabindex="-1"></a>  comp_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;Beta_&quot;</span>,i) </span>
<span id="cb457-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create appropriate data frame </span></span>
<span id="cb457-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="st">&quot;Nestle_PS&quot;</span>){</span>
<span id="cb457-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-10" aria-hidden="true" tabindex="-1"></a>    beta_final <span class="ot">&lt;-</span> beta</span>
<span id="cb457-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-11" aria-hidden="true" tabindex="-1"></a>    comp_name_final <span class="ot">&lt;-</span> comp_name</span>
<span id="cb457-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb457-13"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb457-14"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-14" aria-hidden="true" tabindex="-1"></a>    beta_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(beta_final, beta)</span>
<span id="cb457-15"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-15" aria-hidden="true" tabindex="-1"></a>    comp_name_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(comp_name_final, comp_name)</span>
<span id="cb457-16"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb457-17"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb457-18"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-19"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-19" aria-hidden="true" tabindex="-1"></a><span class="co"># We now retrieve the Factor Loadings of each company. That is the Beta coefficient. </span></span>
<span id="cb457-20"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-21"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Based on the factor loadings, we now want to run a cross-sectional regression of the </span></span>
<span id="cb457-22"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-22" aria-hidden="true" tabindex="-1"></a><span class="co"># asset returns on these loadings at each time period, or date. </span></span>
<span id="cb457-23"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-24"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-24" aria-hidden="true" tabindex="-1"></a><span class="co"># In order to do so, we first need to transpose the list of all Betas such that we </span></span>
<span id="cb457-25"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-25" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain a &quot;long&quot; formatted data frame. </span></span>
<span id="cb457-26"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-27"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-27" aria-hidden="true" tabindex="-1"></a>betas <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(beta_final)</span>
<span id="cb457-28"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-28" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(betas) <span class="ot">&lt;-</span> comp_name_final</span>
<span id="cb457-29"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-29" aria-hidden="true" tabindex="-1"></a>betas <span class="ot">&lt;-</span> <span class="fu">t</span>(betas)</span>
<span id="cb457-30"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-30" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(betas) <span class="ot">&lt;-</span> <span class="st">&quot;MKT_RF&quot;</span> <span class="co"># We call the Beta factor here MKT_RF (Market Excess)</span></span>
<span id="cb457-31"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-32"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Based on this, we need to take the returns of the assets under consideration at each date</span></span>
<span id="cb457-33"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-33" aria-hidden="true" tabindex="-1"></a><span class="co"># and then transpose this list as well to get the same dimensions. Accordingly, we will </span></span>
<span id="cb457-34"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-34" aria-hidden="true" tabindex="-1"></a><span class="co"># obtain a data frame consisting of the factor loading for each company as well as the respective</span></span>
<span id="cb457-35"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-35" aria-hidden="true" tabindex="-1"></a><span class="co"># asset return corresponding to the factor loading at each date.</span></span>
<span id="cb457-36"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-37"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Note the dimensions here. </span></span>
<span id="cb457-38"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-38" aria-hidden="true" tabindex="-1"></a><span class="co"># We ran a time-series regression in the first-pass over 58 months (t=58) for 4 companies (N = 4). </span></span>
<span id="cb457-39"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-39" aria-hidden="true" tabindex="-1"></a><span class="co"># This provides us with 4 factor loadings (4 betas). At each time period, we now need to run the </span></span>
<span id="cb457-40"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-40" aria-hidden="true" tabindex="-1"></a><span class="co"># excess returns again on the factor loadings. As such, we need to create a data frame with </span></span>
<span id="cb457-41"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-41" aria-hidden="true" tabindex="-1"></a><span class="co"># 58 + k columns (k = number of factors used) (=59) and 4 rows and then iterate again the lm function through</span></span>
<span id="cb457-42"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-42" aria-hidden="true" tabindex="-1"></a><span class="co"># each column to get the cross-sectional returns at each date. </span></span>
<span id="cb457-43"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-44"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-44" aria-hidden="true" tabindex="-1"></a><span class="do">## As such, let&#39;s define a dataframe including both average return and beta</span></span>
<span id="cb457-45"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-45" aria-hidden="true" tabindex="-1"></a>average_returns <span class="ot">&lt;-</span> <span class="fu">t</span>(bigfour_ret[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>])</span>
<span id="cb457-46"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-46" aria-hidden="true" tabindex="-1"></a>beta_ret <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(betas, average_returns))</span>
<span id="cb457-47"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb457-47" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(beta_ret)</span></code></pre></div>
<pre><code>## [1]  4 59</code></pre>
<p>Great, we now were able to construct the dataframe required. Just to give you an insight to what it looks like in order to strengthen your intuition:</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb459-1" aria-hidden="true" tabindex="-1"></a>beta_ret</span></code></pre></div>
<pre><code>##                       MKT_RF  2012-07-31   2012-08-31    2012-09-28   2012-10-31 2012-11-30   2012-12-31 2013-01-31  2013-02-28  2013-03-29
## Beta_Nestle_PS     0.7710810  0.06005235 -0.011725427 -0.0008428151 -0.003378382 0.02588871 -0.017464061 0.06966379  0.02473078  0.04697099
## Beta_Novartis_N    1.0668244  0.07989728 -0.018494583  0.0228480941 -0.026409986 0.02292869  0.001742161 0.07621938  0.02626494  0.05798726
## Beta_Roche_Holding 0.9609108  0.05759977  0.002881016  0.0108727824  0.019166314 0.01825777  0.008733680 0.09035722  0.06394872  0.02892100
## Beta_UBS_N         1.2655581 -0.07125788  0.037200284  0.0696168965  0.198206367 0.03795255 -0.015989218 0.10058388 -0.06209116 -0.01906116
##                     2013-04-30    2013-05-31  2013-06-28   2013-07-31  2013-08-30 2013-09-30  2013-10-31  2013-11-29   2013-12-31   2014-01-31
## Beta_Nestle_PS     -0.03332408 -0.0454448623 -0.02392459  0.012033840 -0.02666825 0.03540193  0.03495502  0.01063032 -0.013688427 0.0076278020
## Beta_Novartis_N     0.02344430 -0.0007243753 -0.02792246 -0.007479466  0.01859481 0.02402737  0.01357649  0.01688992 -0.006300336 0.0083916576
## Beta_Roche_Holding  0.05029732  0.0284218495 -0.01729636 -0.030239885  0.01782268 0.04958999  0.02949113  0.00595358 -0.013947227 0.0004012036
## Beta_UBS_N          0.13181170  0.0243987110 -0.05622514  0.125492325 -0.01158634 0.02628848 -0.05214714 -0.01607382 -0.021053409 0.0613196938
##                    2014-02-28    2014-03-31   2014-04-30  2014-05-30   2014-06-30    2014-07-31 2014-08-29  2014-09-30   2014-10-31 2014-11-28
## Beta_Nestle_PS     0.01208474 -0.0007510327  0.020818596  0.03328817 -0.022311109 -0.0168811348 0.05332675 -0.01413451  0.002132955 0.03008272
## Beta_Novartis_N    0.02272043  0.0208832109  0.017184825  0.05109668  0.000000000 -0.0093838662 0.03459270  0.09049649 -0.009473462 0.04595995
## Beta_Roche_Holding 0.08493676 -0.0238639214 -0.026770241  0.02109378  0.003787883  0.0007558579 0.01126984  0.05593324  0.002117150 0.01989247
## Beta_UBS_N         0.04775731 -0.0328604842  0.007637789 -0.02309064 -0.099937108 -0.0375748649 0.04918514  0.01207744  0.002398083 0.03818379
##                      2014-12-31  2015-01-30 2015-02-27  2015-03-31   2015-04-30   2015-05-29  2015-06-30 2015-07-31  2015-08-31  2015-09-30
## Beta_Nestle_PS      0.005498296 -0.03487104 0.05455270 -0.01353201 -0.006835297  0.000000000 -0.07696104 0.08106782 -0.02629909  0.02698192
## Beta_Novartis_N    -0.012375730 -0.02411076 0.07786448 -0.01342995  0.005186734 -0.001553197 -0.04612532 0.08574452 -0.05844821 -0.05759332
## Beta_Roche_Holding -0.069758294 -0.08220634 0.04021038  0.03530448  0.004837219  0.024927977 -0.05278074 0.06322564 -0.05562104 -0.02687302
## Beta_UBS_N         -0.015099009 -0.10477555 0.08468031  0.08959510  0.029049918  0.069628936 -0.01947627 0.11514607 -0.10511086 -0.10630399
##                     2015-10-30   2015-11-30   2015-12-31  2016-01-29  2016-02-29   2016-03-31   2016-04-29  2016-05-31  2016-06-30   2016-07-29
## Beta_Nestle_PS     0.031578035  0.009871748 -0.023857990  0.00868119 -0.07022844  0.024657818 -0.004883163  0.02622649  0.02356218  0.033369141
## Beta_Novartis_N    0.005020931 -0.021373142 -0.013161850 -0.10050800 -0.09130547 -0.027592837  0.048995103  0.07498581  0.01571865  0.001869742
## Beta_Roche_Holding 0.043029673  0.026481871  0.003261463 -0.04627885 -0.02649416 -0.082282568  0.024208194  0.07313548 -0.01856920 -0.034157411
## Beta_UBS_N         0.093744167 -0.001517835 -0.011713910 -0.14827657 -0.09269921  0.009730858  0.069208041 -0.07763597 -0.20045371  0.060203362
##                      2016-08-31   2016-09-30  2016-10-31   2016-11-30  2016-12-30   2017-01-31  2017-02-28  2017-03-31   2017-04-28
## Beta_Nestle_PS      0.007692346 -0.022603481 -0.06475627 -0.047815030  0.06577131 -0.010320009  0.02661365  0.03441769 -0.002605865
## Beta_Novartis_N    -0.036782840 -0.013004084 -0.08178943 -0.002132955  0.05335522 -0.022518864  0.07892726 -0.05304025  0.029160449
## Beta_Roche_Holding -0.031605339  0.004991691 -0.05764670 -0.003522681  0.02569268  0.001718213  0.04899452  0.04436292  0.017438923
## Beta_UBS_N          0.063133040 -0.072162446  0.05657035  0.144100344 -0.01369884  0.001253133 -0.03180930  0.03555930  0.058751377</code></pre>
<p>This is what we meant by “performing a cross-sectional regression of the asset returns on the MKT_RF factor (our beta factor loading) for each date”. In essence, we now create a regression model which just runs through each date column and performs the regression. Note that this functional form may appear a little tricky to solve at first, but, in essence, it follows the same principle as the for loop we are usually working with. We just include this form here because it is</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">names</span>(beta_ret)[<span class="dv">2</span><span class="sc">:</span><span class="dv">59</span>]){</span>
<span id="cb461-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This is just the &quot;tidy&quot; version of regression. </span></span>
<span id="cb461-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-3" aria-hidden="true" tabindex="-1"></a>  second_pass_output <span class="ot">&lt;-</span> <span class="fu">lm</span>(beta_ret[,i] <span class="sc">~</span> beta_ret[, <span class="st">&quot;MKT_RF&quot;</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb461-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb461-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;$&#39;</span>(coef) <span class="sc">%&gt;%</span> </span>
<span id="cb461-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb461-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-7" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(Estimate)</span>
<span id="cb461-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="st">&quot;2012-07-31&quot;</span>){</span>
<span id="cb461-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-9" aria-hidden="true" tabindex="-1"></a>    second_pass_output_final <span class="ot">&lt;-</span> second_pass_output</span>
<span id="cb461-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb461-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>{</span>
<span id="cb461-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-12" aria-hidden="true" tabindex="-1"></a>    second_pass_output_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(second_pass_output_final, second_pass_output)</span>
<span id="cb461-13"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb461-14"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb461-15"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-16"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s create a data frame</span></span>
<span id="cb461-17"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-17" aria-hidden="true" tabindex="-1"></a>lambdas <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">t</span>(second_pass_output_final))</span>
<span id="cb461-18"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-18" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(lambdas) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Intercept&quot;</span>, <span class="st">&quot;MKT_RF&quot;</span>)</span>
<span id="cb461-19"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-19" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(lambdas) <span class="ot">&lt;-</span> <span class="fu">names</span>(beta_ret)[<span class="dv">2</span><span class="sc">:</span><span class="dv">59</span>]</span>
<span id="cb461-20"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-21"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we have the risk premia estimates for each factor at based on the cross-sectional </span></span>
<span id="cb461-22"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-22" aria-hidden="true" tabindex="-1"></a><span class="co"># regression at each date t. Based on this, we now create a dataframe with the average estimates,</span></span>
<span id="cb461-23"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-23" aria-hidden="true" tabindex="-1"></a><span class="co"># the standard deviation as well as the square root of the time-series observation amount. </span></span>
<span id="cb461-24"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-25"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-25" aria-hidden="true" tabindex="-1"></a><span class="co"># We can now calculate the respective t statistics</span></span>
<span id="cb461-26"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-26" aria-hidden="true" tabindex="-1"></a>T_Period <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">names</span>(beta_ret[,<span class="dv">2</span><span class="sc">:</span><span class="dv">59</span>]))</span>
<span id="cb461-27"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-27" aria-hidden="true" tabindex="-1"></a>average <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(lambdas, <span class="at">na.rm =</span> T)</span>
<span id="cb461-28"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-28" aria-hidden="true" tabindex="-1"></a>sd <span class="ot">&lt;-</span> <span class="fu">colStdevs</span>(lambdas, <span class="at">na.rm =</span> T)</span>
<span id="cb461-29"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-29" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> sd <span class="sc">/</span> <span class="fu">sqrt</span>(T_Period)</span>
<span id="cb461-30"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-30" aria-hidden="true" tabindex="-1"></a>t_value <span class="ot">&lt;-</span> average<span class="sc">/</span>se</span>
<span id="cb461-31"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-32"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a final data frame</span></span>
<span id="cb461-33"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-33" aria-hidden="true" tabindex="-1"></a>second_pass <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(average, se, t_value))</span>
<span id="cb461-34"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-34" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(second_pass) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Risk Premia Estimate&quot;</span>, <span class="st">&quot;Standard Error&quot;</span>, <span class="st">&quot;T-Stat&quot;</span>)</span>
<span id="cb461-35"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-36"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb461-36" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(second_pass, <span class="dv">4</span>)</span></code></pre></div>
<pre><code>##           Risk Premia Estimate Standard Error T-Stat
## Intercept               0.0032         0.0191 0.1675
## MKT_RF                  0.0035         0.0203 0.1734</code></pre>
<p>For completeness, we also have the way of doing this in an lapply setting again.</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Perform the second pass regression</span></span>
<span id="cb463-2"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-2" aria-hidden="true" tabindex="-1"></a><span class="do">### We define first that we only have one factor in the regression running</span></span>
<span id="cb463-3"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-3" aria-hidden="true" tabindex="-1"></a>factors <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb463-4"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-4" aria-hidden="true" tabindex="-1"></a><span class="do">### Here, we run the second-pass regression. That is, we &quot;apply&quot; the linear model (lm)</span></span>
<span id="cb463-5"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-5" aria-hidden="true" tabindex="-1"></a><span class="do">### formula on each date of the cross-sectional asset returns. That is, we have the paste </span></span>
<span id="cb463-6"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-6" aria-hidden="true" tabindex="-1"></a><span class="do">### function in which we say: &quot;Apply the pasted function f as an lm() based on the data provided. </span></span>
<span id="cb463-7"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-7" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">paste</span>(<span class="st">&quot;`&quot;</span>,<span class="fu">names</span>(beta_ret[,<span class="dv">2</span><span class="sc">:</span><span class="dv">59</span>]) , <span class="st">&quot;`&quot;</span>, <span class="st">&#39; ~ MKT_RF&#39;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb463-8"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-8" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(f){ <span class="fu">lm</span>(<span class="fu">as.formula</span>(f), <span class="at">data =</span> beta_ret) <span class="sc">%&gt;%</span>               <span class="co"># Call lm(.)</span></span>
<span id="cb463-9"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-9" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">summary</span>() <span class="sc">%&gt;%</span>                                    <span class="co"># Gather the output</span></span>
<span id="cb463-10"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-10" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;$&quot;</span>(coef) <span class="sc">%&gt;%</span>                                    <span class="co"># Keep only the coefs</span></span>
<span id="cb463-11"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-11" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span>                                 <span class="co"># Convert to dataframe</span></span>
<span id="cb463-12"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-12" aria-hidden="true" tabindex="-1"></a>                         dplyr<span class="sc">::</span><span class="fu">select</span>(Estimate)}                         <span class="co"># Keep only estimates</span></span>
<span id="cb463-13"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-13" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb463-14"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb463-15"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-15" aria-hidden="true" tabindex="-1"></a><span class="do">### This is then the same coefficient retrieval approach as before. </span></span>
<span id="cb463-16"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-16" aria-hidden="true" tabindex="-1"></a>lambdas <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">matrix</span>(<span class="fu">unlist</span>(models), <span class="at">ncol =</span> factors <span class="sc">+</span> <span class="dv">1</span>, <span class="at">byrow =</span> T))</span>
<span id="cb463-17"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb463-18"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-18" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(lambdas) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Constant&quot;</span>, <span class="st">&quot;MKT_RF&quot;</span>)</span>
<span id="cb463-19"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb463-20"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-20" aria-hidden="true" tabindex="-1"></a><span class="co"># We can now calculate the respective t statistics</span></span>
<span id="cb463-21"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-21" aria-hidden="true" tabindex="-1"></a>T_Period <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">names</span>(beta_ret[,<span class="dv">2</span><span class="sc">:</span><span class="dv">59</span>]))</span>
<span id="cb463-22"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-22" aria-hidden="true" tabindex="-1"></a>average <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(lambdas, <span class="at">na.rm =</span> T)</span>
<span id="cb463-23"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-23" aria-hidden="true" tabindex="-1"></a>sd <span class="ot">&lt;-</span> <span class="fu">colStdevs</span>(lambdas, <span class="at">na.rm =</span> T)</span>
<span id="cb463-24"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-24" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> sd <span class="sc">/</span> <span class="fu">sqrt</span>(T_Period)</span>
<span id="cb463-25"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-25" aria-hidden="true" tabindex="-1"></a>t_value <span class="ot">&lt;-</span> average<span class="sc">/</span>se</span>
<span id="cb463-26"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb463-27"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a final data frame</span></span>
<span id="cb463-28"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-28" aria-hidden="true" tabindex="-1"></a>second_pass <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(average, se, t_value))</span>
<span id="cb463-29"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-29" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(second_pass) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Risk Premia Estimate&quot;</span>, <span class="st">&quot;Standard Error&quot;</span>, <span class="st">&quot;T-Stat&quot;</span>)</span>
<span id="cb463-30"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb463-31"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#cb463-31" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(second_pass, <span class="dv">4</span>)</span></code></pre></div>
<pre><code>##          Risk Premia Estimate Standard Error T-Stat
## Constant               0.0032         0.0191 0.1675
## MKT_RF                 0.0035         0.0203 0.1734</code></pre>
<p>As we can see, both approaches are identical.</p>
<p>In accordance to the theoretical notions made above, we would expect the following here:</p>
<ul>
<li><span class="math inline">\(\lambda_0 = -0.3296\)</span></li>
<li><span class="math inline">\(\lambda_1 = 0.3360\)</span></li>
</ul>
<p>Whereas <span class="math inline">\(\lambda_0\)</span> is the average risk-free rate and <span class="math inline">\(\lambda_1\)</span> is the average market risk premium.</p>
<p>As is applicable from the regression output, neither hypothesis holds. Furthermore, we see that the coefficient on the factor loadings is statistically indistinguishable from zero at conventional levels. This implies that the average effect of the beta coefficients on the individual excess returns is not equal to the slope of the Security Market Line. Especially, we can observe that the slope, compared with the SML, is too flat. This is a result which we have discussed in the lecture already.</p>
<p>Let’s visually derive what we mean by this (we don’t need to talk about the statistical invalidity of the approach with only four observations. But this is just to show you the idea behind what we did):</p>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;
## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-257-1.png" width="672" /></p>
<p>This is the visual interpretation of the results. At first, we can see that the intercept as well as the slope of the SML are incorrect. Further, the slope is very imprecise, telling by the 95% Confidence Interval which is marked in gray. The CAPM implied Security Market Line is given in orange. This would be the theoretically correct SML. The purple dots would thus induce the theoretically accurate Mean Excess Returns for any given level of <span class="math inline">\(\beta\)</span>, such that the slope would constitute the market risk premium. However, we see that the dots are off to quite some extent, thereby invalidating the hypothesis that the CAPM is indeed a valid measure to quantify the average variation of security returns in the cross section.</p>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="beta.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="factor-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/NikolasAnic/Advanced_Empirical_Finance_UZH_2022/edit/master/06-CAPM.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/NikolasAnic/Advanced_Empirical_Finance_UZH_2022/blob/master/06-CAPM.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
