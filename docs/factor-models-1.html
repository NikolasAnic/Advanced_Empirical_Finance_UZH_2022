<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Factor Models | Empricial Finance and Statistical Analysis</title>
  <meta name="description" content="Chapter 9 Factor Models | Empricial Finance and Statistical Analysis" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Factor Models | Empricial Finance and Statistical Analysis" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Factor Models | Empricial Finance and Statistical Analysis" />
  
  
  

<meta name="author" content="Nikolas Anic &amp; Lorenz Gassmann" />


<meta name="date" content="2021-12-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="factor-models.html"/>

<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Empirical Finance and Statistical Analysis - Theory and Empirics Lab</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction to the course objectives and organisation of the course</a></li>
<li class="chapter" data-level="2" data-path="the-programming-environment.html"><a href="the-programming-environment.html"><i class="fa fa-check"></i><b>2</b> The Programming Environment</a>
<ul>
<li class="chapter" data-level="2.1" data-path="the-programming-environment.html"><a href="the-programming-environment.html#markdown-files"><i class="fa fa-check"></i><b>2.1</b> Markdown Files</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="the-programming-environment.html"><a href="the-programming-environment.html#how-to-create-a-markdown-file"><i class="fa fa-check"></i><b>2.1.1</b> How to create a Markdown File</a></li>
<li class="chapter" data-level="2.1.2" data-path="the-programming-environment.html"><a href="the-programming-environment.html#the-r-markdown-structure"><i class="fa fa-check"></i><b>2.1.2</b> The R Markdown Structure</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="the-programming-environment.html"><a href="the-programming-environment.html#coding-in-r---a-concise-overview"><i class="fa fa-check"></i><b>2.2</b> Coding In R - A concise overview</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="the-programming-environment.html"><a href="the-programming-environment.html#introduction"><i class="fa fa-check"></i><b>2.2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2.2" data-path="the-programming-environment.html"><a href="the-programming-environment.html#vectors"><i class="fa fa-check"></i><b>2.2.2</b> Vectors</a></li>
<li class="chapter" data-level="2.2.3" data-path="the-programming-environment.html"><a href="the-programming-environment.html#data-types"><i class="fa fa-check"></i><b>2.2.3</b> Data Types</a></li>
<li class="chapter" data-level="2.2.4" data-path="the-programming-environment.html"><a href="the-programming-environment.html#data-frames"><i class="fa fa-check"></i><b>2.2.4</b> Data Frames</a></li>
<li class="chapter" data-level="2.2.5" data-path="the-programming-environment.html"><a href="the-programming-environment.html#importing-data"><i class="fa fa-check"></i><b>2.2.5</b> Importing Data</a></li>
<li class="chapter" data-level="2.2.6" data-path="the-programming-environment.html"><a href="the-programming-environment.html#data-manipulation"><i class="fa fa-check"></i><b>2.2.6</b> Data Manipulation</a></li>
<li class="chapter" data-level="2.2.7" data-path="the-programming-environment.html"><a href="the-programming-environment.html#data-reshaping"><i class="fa fa-check"></i><b>2.2.7</b> Data Reshaping</a></li>
<li class="chapter" data-level="2.2.8" data-path="the-programming-environment.html"><a href="the-programming-environment.html#beautiful-graphs-with-ggplot2"><i class="fa fa-check"></i><b>2.2.8</b> Beautiful Graphs with <code>ggplot2</code></a></li>
<li class="chapter" data-level="2.2.9" data-path="the-programming-environment.html"><a href="the-programming-environment.html#dates-and-times"><i class="fa fa-check"></i><b>2.2.9</b> Dates and Times</a></li>
<li class="chapter" data-level="2.2.10" data-path="the-programming-environment.html"><a href="the-programming-environment.html#string-manipulations-in-r-the-stringr-package"><i class="fa fa-check"></i><b>2.2.10</b> String Manipulations in R: The <code>stringr()</code> package</a></li>
<li class="chapter" data-level="2.2.11" data-path="the-programming-environment.html"><a href="the-programming-environment.html#database-queries"><i class="fa fa-check"></i><b>2.2.11</b> Database Queries</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="statistical-properties.html"><a href="statistical-properties.html"><i class="fa fa-check"></i><b>3</b> Statistical Properties</a>
<ul>
<li class="chapter" data-level="3.1" data-path="statistical-properties.html"><a href="statistical-properties.html#random-variables-and-probability-distributions-introdcution"><i class="fa fa-check"></i><b>3.1</b> Random Variables and Probability Distributions: Introdcution</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="statistical-properties.html"><a href="statistical-properties.html#the-concept-of-probability-important-notions-and-definitions"><i class="fa fa-check"></i><b>3.1.1</b> The concept of Probability: Important Notions and Definitions</a></li>
<li class="chapter" data-level="3.1.2" data-path="statistical-properties.html"><a href="statistical-properties.html#random-variables"><i class="fa fa-check"></i><b>3.1.2</b> Random Variables</a></li>
<li class="chapter" data-level="3.1.3" data-path="statistical-properties.html"><a href="statistical-properties.html#discrete-random-variables-and-distributions"><i class="fa fa-check"></i><b>3.1.3</b> Discrete Random Variables and Distributions</a></li>
<li class="chapter" data-level="3.1.4" data-path="statistical-properties.html"><a href="statistical-properties.html#continuous-random-variables-and-distributions"><i class="fa fa-check"></i><b>3.1.4</b> Continuous Random Variables and Distributions</a></li>
<li class="chapter" data-level="3.1.5" data-path="statistical-properties.html"><a href="statistical-properties.html#the-cumulative-distribution"><i class="fa fa-check"></i><b>3.1.5</b> The cumulative Distribution</a></li>
<li class="chapter" data-level="3.1.6" data-path="statistical-properties.html"><a href="statistical-properties.html#continuous-distributions-with-appealing-properties"><i class="fa fa-check"></i><b>3.1.6</b> Continuous Distributions with Appealing Properties</a></li>
<li class="chapter" data-level="3.1.7" data-path="statistical-properties.html"><a href="statistical-properties.html#moments-and-properties-of-bivariate-distributions"><i class="fa fa-check"></i><b>3.1.7</b> Moments and Properties of bivariate distributions</a></li>
<li class="chapter" data-level="3.1.8" data-path="statistical-properties.html"><a href="statistical-properties.html#moments-of-probability-distributions"><i class="fa fa-check"></i><b>3.1.8</b> Moments of Probability Distributions</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="statistical-properties.html"><a href="statistical-properties.html#matrix-algebra-introduction"><i class="fa fa-check"></i><b>3.2</b> Matrix Algebra: Introduction</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="statistical-properties.html"><a href="statistical-properties.html#matrices-and-vectors"><i class="fa fa-check"></i><b>3.2.1</b> Matrices and Vectors</a></li>
<li class="chapter" data-level="3.2.2" data-path="statistical-properties.html"><a href="statistical-properties.html#basic-matrix-operations"><i class="fa fa-check"></i><b>3.2.2</b> Basic Matrix Operations</a></li>
<li class="chapter" data-level="3.2.3" data-path="statistical-properties.html"><a href="statistical-properties.html#summation-notation-in-matrix-form"><i class="fa fa-check"></i><b>3.2.3</b> Summation Notation in Matrix Form</a></li>
<li class="chapter" data-level="3.2.4" data-path="statistical-properties.html"><a href="statistical-properties.html#systems-of-linear-equations"><i class="fa fa-check"></i><b>3.2.4</b> Systems of Linear Equations</a></li>
<li class="chapter" data-level="3.2.5" data-path="statistical-properties.html"><a href="statistical-properties.html#positive-definite-pd-matrix"><i class="fa fa-check"></i><b>3.2.5</b> Positive Definite (PD) Matrix</a></li>
<li class="chapter" data-level="3.2.6" data-path="statistical-properties.html"><a href="statistical-properties.html#multivariate-probability-distributions"><i class="fa fa-check"></i><b>3.2.6</b> Multivariate Probability Distributions</a></li>
<li class="chapter" data-level="3.2.7" data-path="statistical-properties.html"><a href="statistical-properties.html#portfolio-construction-and-mathematical-properties-using-matrix-algebra"><i class="fa fa-check"></i><b>3.2.7</b> Portfolio Construction and Mathematical Properties using Matrix Algebra</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html"><i class="fa fa-check"></i><b>4</b> Inductive Statistics and Regression Analysis Fundamentals</a>
<ul>
<li class="chapter" data-level="4.1" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#inductive-statistics"><i class="fa fa-check"></i><b>4.1</b> Inductive Statistics</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#point-estimators"><i class="fa fa-check"></i><b>4.1.1</b> Point Estimators</a></li>
<li class="chapter" data-level="4.1.2" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#confidence-intervals"><i class="fa fa-check"></i><b>4.1.2</b> Confidence Intervals</a></li>
<li class="chapter" data-level="4.1.3" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#hypothesis-testing"><i class="fa fa-check"></i><b>4.1.3</b> Hypothesis Testing</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#introduction-to-regression-analysis"><i class="fa fa-check"></i><b>4.2</b> Introduction to Regression Analysis</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#the-role-of-correlation"><i class="fa fa-check"></i><b>4.2.1</b> The role of correlation</a></li>
<li class="chapter" data-level="4.2.2" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#the-simple-univariate-regression-model"><i class="fa fa-check"></i><b>4.2.2</b> The simple / univariate regression model</a></li>
<li class="chapter" data-level="4.2.3" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#the-multivariate-regression-model"><i class="fa fa-check"></i><b>4.2.3</b> The multivariate regression model</a></li>
<li class="chapter" data-level="4.2.4" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#goodness-of-fit"><i class="fa fa-check"></i><b>4.2.4</b> Goodness of Fit</a></li>
<li class="chapter" data-level="4.2.5" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#assumption-and-diagnostic-tests-of-ols"><i class="fa fa-check"></i><b>4.2.5</b> Assumption and diagnostic tests of OLS</a></li>
<li class="chapter" data-level="4.2.6" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#properties-of-the-ols-estimator"><i class="fa fa-check"></i><b>4.2.6</b> Properties of the OLS Estimator</a></li>
<li class="chapter" data-level="4.2.7" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#expected-value-and-variance-of-the-multivarite-ols-estimator-if-the-assumptions-hold"><i class="fa fa-check"></i><b>4.2.7</b> Expected Value and Variance of the multivarite OLS estimator if the assumptions hold:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="risk-and-return.html"><a href="risk-and-return.html"><i class="fa fa-check"></i><b>5</b> Risk and Return</a>
<ul>
<li class="chapter" data-level="5.1" data-path="risk-and-return.html"><a href="risk-and-return.html#the-time-series-of-returns---transformations-in-r-1"><i class="fa fa-check"></i><b>5.1</b> The time-series of Returns - Transformations in R</a></li>
<li class="chapter" data-level="5.2" data-path="risk-and-return.html"><a href="risk-and-return.html#security-returns"><i class="fa fa-check"></i><b>5.2</b> Security Returns</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="risk-and-return.html"><a href="risk-and-return.html#simple-returns"><i class="fa fa-check"></i><b>5.2.1</b> Simple Returns</a></li>
<li class="chapter" data-level="5.2.2" data-path="risk-and-return.html"><a href="risk-and-return.html#logarithmic-returns"><i class="fa fa-check"></i><b>5.2.2</b> Logarithmic Returns</a></li>
<li class="chapter" data-level="5.2.3" data-path="risk-and-return.html"><a href="risk-and-return.html#accounting-for-dividends-total-returns"><i class="fa fa-check"></i><b>5.2.3</b> Accounting for Dividends: Total Returns</a></li>
<li class="chapter" data-level="5.2.4" data-path="risk-and-return.html"><a href="risk-and-return.html#truncating-the-data"><i class="fa fa-check"></i><b>5.2.4</b> Truncating the data</a></li>
<li class="chapter" data-level="5.2.5" data-path="risk-and-return.html"><a href="risk-and-return.html#arithmetic-vs.-geometric-returns"><i class="fa fa-check"></i><b>5.2.5</b> Arithmetic vs. Geometric Returns</a></li>
<li class="chapter" data-level="5.2.6" data-path="risk-and-return.html"><a href="risk-and-return.html#cumulative-returns"><i class="fa fa-check"></i><b>5.2.6</b> Cumulative Returns</a></li>
<li class="chapter" data-level="5.2.7" data-path="risk-and-return.html"><a href="risk-and-return.html#periodic-transformation-of-returns"><i class="fa fa-check"></i><b>5.2.7</b> Periodic Transformation of Returns</a></li>
<li class="chapter" data-level="5.2.8" data-path="risk-and-return.html"><a href="risk-and-return.html#annualising-returns"><i class="fa fa-check"></i><b>5.2.8</b> Annualising Returns</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="risk-and-return.html"><a href="risk-and-return.html#portfolio-returns"><i class="fa fa-check"></i><b>5.3</b> Portfolio Returns</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="risk-and-return.html"><a href="risk-and-return.html#equal-weighted-returns"><i class="fa fa-check"></i><b>5.3.1</b> Equal-weighted Returns</a></li>
<li class="chapter" data-level="5.3.2" data-path="risk-and-return.html"><a href="risk-and-return.html#value-weighted-returns"><i class="fa fa-check"></i><b>5.3.2</b> Value-weighted Returns</a></li>
<li class="chapter" data-level="5.3.3" data-path="risk-and-return.html"><a href="risk-and-return.html#timing-of-returns"><i class="fa fa-check"></i><b>5.3.3</b> Timing of Returns</a></li>
<li class="chapter" data-level="5.3.4" data-path="risk-and-return.html"><a href="risk-and-return.html#nominal-vs.-real-returns"><i class="fa fa-check"></i><b>5.3.4</b> Nominal vs. Real Returns</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="risk-and-return.html"><a href="risk-and-return.html#individual-security-risk"><i class="fa fa-check"></i><b>5.4</b> Individual Security Risk</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="risk-and-return.html"><a href="risk-and-return.html#standard-deviation-and-variance"><i class="fa fa-check"></i><b>5.4.1</b> Standard Deviation and Variance</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="risk-and-return.html"><a href="risk-and-return.html#rolling-risk-characteristics"><i class="fa fa-check"></i><b>5.5</b> Rolling Risk Characteristics</a></li>
<li class="chapter" data-level="5.6" data-path="risk-and-return.html"><a href="risk-and-return.html#portfolio-risk"><i class="fa fa-check"></i><b>5.6</b> Portfolio Risk</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="risk-and-return.html"><a href="risk-and-return.html#portfolio-risk-of-two-securities"><i class="fa fa-check"></i><b>5.6.1</b> Portfolio Risk of two securities</a></li>
<li class="chapter" data-level="5.6.2" data-path="risk-and-return.html"><a href="risk-and-return.html#portfolio-risk-for-multiple-assets"><i class="fa fa-check"></i><b>5.6.2</b> Portfolio Risk for Multiple Assets</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="risk-and-return.html"><a href="risk-and-return.html#risk-in-extremes-and-alternative-risk-measures"><i class="fa fa-check"></i><b>5.7</b> Risk in Extremes and Alternative Risk Measures</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="risk-and-return.html"><a href="risk-and-return.html#value-at-risk-var"><i class="fa fa-check"></i><b>5.7.1</b> Value at Risk (VaR)</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="risk-and-return.html"><a href="risk-and-return.html#market-efficiency-and-independence-of-risk-and-return"><i class="fa fa-check"></i><b>5.8</b> Market Efficiency and independence of risk and return</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="risk-and-return.html"><a href="risk-and-return.html#variance-ratio-test"><i class="fa fa-check"></i><b>5.8.1</b> Variance Ratio Test</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="beta.html"><a href="beta.html"><i class="fa fa-check"></i><b>6</b> Beta</a>
<ul>
<li class="chapter" data-level="6.1" data-path="beta.html"><a href="beta.html#application-of-regression-analysis-beta-analysis-in-financial-market-settings"><i class="fa fa-check"></i><b>6.1</b> Application of Regression Analysis: <span class="math inline">\(\beta\)</span> analysis in Financial Market Settings</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="beta.html"><a href="beta.html#the-single-index-model"><i class="fa fa-check"></i><b>6.1.1</b> The Single Index Model</a></li>
<li class="chapter" data-level="6.1.2" data-path="beta.html"><a href="beta.html#estimation-of-the-sim"><i class="fa fa-check"></i><b>6.1.2</b> Estimation of the SIM</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><i class="fa fa-check"></i><b>7</b> Portfolio Theory: Mean-Variance Optimisation and the CAPM</a>
<ul>
<li class="chapter" data-level="7.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#markowitz-portfolio-theory-with-two-risky-assets"><i class="fa fa-check"></i><b>7.1</b> Markowitz Portfolio Theory with two Risky Assets</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-case-of-portfolios"><i class="fa fa-check"></i><b>7.1.1</b> The case of portfolios</a></li>
<li class="chapter" data-level="7.1.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-set-of-attainable-portfolios"><i class="fa fa-check"></i><b>7.1.2</b> The set of attainable portfolios</a></li>
<li class="chapter" data-level="7.1.3" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-minimum-variance-portfolio"><i class="fa fa-check"></i><b>7.1.3</b> The Minimum-Variance Portfolio</a></li>
<li class="chapter" data-level="7.1.4" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-role-of-correlation-on-the-frontier-of-portfolios"><i class="fa fa-check"></i><b>7.1.4</b> The role of correlation on the frontier of portfolios</a></li>
<li class="chapter" data-level="7.1.5" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#efficient-portfolios-with-two-risky-assets"><i class="fa fa-check"></i><b>7.1.5</b> Efficient Portfolios with two risky assets</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#markowitz-portfolio-theory-with-a-risky-and-a-risk-free-asset"><i class="fa fa-check"></i><b>7.2</b> Markowitz Portfolio Theory with a Risky and a Risk-Free Asset</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-capital-allocation-line-cal"><i class="fa fa-check"></i><b>7.2.1</b> The Capital Allocation Line (CAL)</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#markowitz-portfolio-theory-with-two-risky-and-a-risk-free-asset"><i class="fa fa-check"></i><b>7.3</b> Markowitz Portfolio Theory with two Risky and a Risk-Free Asset</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#tangency-portfolio"><i class="fa fa-check"></i><b>7.3.1</b> Tangency Portfolio</a></li>
<li class="chapter" data-level="7.3.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#mutual-fund-theorem-and-derivation-of-the-capital-market-line-cml"><i class="fa fa-check"></i><b>7.3.2</b> Mutual Fund Theorem and Derivation of the Capital Market Line (CML)</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#markowitz-portfolio-theory-with-n-risky-assets"><i class="fa fa-check"></i><b>7.4</b> Markowitz Portfolio Theory with N Risky Assets</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-theoretical-foundations-of-n-assets"><i class="fa fa-check"></i><b>7.4.1</b> The theoretical foundations of N Assets</a></li>
<li class="chapter" data-level="7.4.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-minimum-variance-portfolio-for-n-assets"><i class="fa fa-check"></i><b>7.4.2</b> The Minimum Variance Portfolio for N assets</a></li>
<li class="chapter" data-level="7.4.3" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-efficient-frontier-for-n-assets"><i class="fa fa-check"></i><b>7.4.3</b> The Efficient Frontier for N assets</a></li>
<li class="chapter" data-level="7.4.4" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-efficient-and-feasible-portfolio-cal-of-n-risky-assets-and-a-risk-free-asset"><i class="fa fa-check"></i><b>7.4.4</b> The Efficient and Feasible Portfolio CAL of N risky Assets and a risk-free Asset</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-capital-asset-pricing-model"><i class="fa fa-check"></i><b>7.5</b> The Capital Asset Pricing Model</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#intuition-of-the-capm"><i class="fa fa-check"></i><b>7.5.1</b> Intuition of the CAPM</a></li>
<li class="chapter" data-level="7.5.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#mathematical-derivation-of-the-security-market-line-sml"><i class="fa fa-check"></i><b>7.5.2</b> Mathematical Derivation of the Security Market Line (SML)</a></li>
<li class="chapter" data-level="7.5.3" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#similarity-of-the-cml-and-sml"><i class="fa fa-check"></i><b>7.5.3</b> Similarity of the CML and SML</a></li>
<li class="chapter" data-level="7.5.4" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#diagnostic-tests-of-the-capm"><i class="fa fa-check"></i><b>7.5.4</b> Diagnostic Tests of the CAPM</a></li>
<li class="chapter" data-level="7.5.5" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#fama-macbeth-1973-approach"><i class="fa fa-check"></i><b>7.5.5</b> Fama-MacBeth (1973) approach</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="factor-models.html"><a href="factor-models.html"><i class="fa fa-check"></i><b>8</b> Factor Models</a>
<ul>
<li class="chapter" data-level="8.1" data-path="factor-models.html"><a href="factor-models.html#the-idea-behind-factor-models"><i class="fa fa-check"></i><b>8.1</b> The idea behind factor models</a></li>
<li class="chapter" data-level="8.2" data-path="factor-models.html"><a href="factor-models.html#the-quest-of-detecting-anomalies"><i class="fa fa-check"></i><b>8.2</b> The quest of detecting anomalies</a></li>
<li class="chapter" data-level="8.3" data-path="factor-models.html"><a href="factor-models.html#the-fama-french-three-factor-model"><i class="fa fa-check"></i><b>8.3</b> The Fama-French Three Factor Model</a></li>
<li class="chapter" data-level="8.4" data-path="factor-models.html"><a href="factor-models.html#testing-for-factor-validity"><i class="fa fa-check"></i><b>8.4</b> Testing for factor validity</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="factor-models.html"><a href="factor-models.html#portfolio-sorts"><i class="fa fa-check"></i><b>8.4.1</b> Portfolio Sorts</a></li>
<li class="chapter" data-level="8.4.2" data-path="factor-models.html"><a href="factor-models.html#factor-construction"><i class="fa fa-check"></i><b>8.4.2</b> Factor Construction</a></li>
<li class="chapter" data-level="8.4.3" data-path="factor-models.html"><a href="factor-models.html#how-to-create-factors"><i class="fa fa-check"></i><b>8.4.3</b> How to create factors</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="factor-models-1.html"><a href="factor-models-1.html"><i class="fa fa-check"></i><b>9</b> Factor Models</a>
<ul>
<li class="chapter" data-level="9.1" data-path="factor-models-1.html"><a href="factor-models-1.html#the-idea-behind-factor-models-1"><i class="fa fa-check"></i><b>9.1</b> The idea behind factor models</a></li>
<li class="chapter" data-level="9.2" data-path="factor-models-1.html"><a href="factor-models-1.html#the-quest-of-detecting-anomalies-1"><i class="fa fa-check"></i><b>9.2</b> The quest of detecting anomalies</a></li>
<li class="chapter" data-level="9.3" data-path="factor-models-1.html"><a href="factor-models-1.html#the-fama-french-three-factor-model-1"><i class="fa fa-check"></i><b>9.3</b> The Fama-French Three Factor Model</a></li>
<li class="chapter" data-level="9.4" data-path="factor-models-1.html"><a href="factor-models-1.html#testing-for-factor-validity-1"><i class="fa fa-check"></i><b>9.4</b> Testing for factor validity</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="factor-models-1.html"><a href="factor-models-1.html#portfolio-sorts-1"><i class="fa fa-check"></i><b>9.4.1</b> Portfolio Sorts</a></li>
<li class="chapter" data-level="9.4.2" data-path="factor-models-1.html"><a href="factor-models-1.html#factor-construction-1"><i class="fa fa-check"></i><b>9.4.2</b> Factor Construction</a></li>
<li class="chapter" data-level="9.4.3" data-path="factor-models-1.html"><a href="factor-models-1.html#how-to-create-factors-1"><i class="fa fa-check"></i><b>9.4.3</b> How to create factors</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Empricial Finance and Statistical Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="factor-models-1" class="section level1" number="9">
<h1><span class="header-section-number">Chapter 9</span> Factor Models</h1>
<div id="the-idea-behind-factor-models-1" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> The idea behind factor models</h2>
<p>In the previous chapter, we looked at the Markowitz Mean-Variance optimisation and introduced its composition. Therein, we derived the model under the consideration of the mean, variance as well as covariance matrix between the individual, observed assets. In the case of n assets, we thus stated that we require n means, n variances and n(n-1)/2 covariances, resulting in a total of <strong>2n + n(n-1)/2</strong> parameters to describe the model. For instance, if we have 1000 assets, then we would require 501’500 parameters to describe the model inherently. Furthermore, we can show that attempting to estimate the model parameters with a sufficient precision is nearly unfeasible using historical price data over time. This is due to the fact that the precision of any variable within an iid setting depends on the square root of the number of observations. Consequently, if the number of observations is insufficiently large, confidence intervals to determine the accuracy of any expected variable value would be deemed redundant. Given the large number of parameters required to describe the model and the number of observations required to estimate the model parameters with sufficient precision, we understand that the Markowitz model is deemed to be a very <strong>data intensive</strong> model. As a consequence, we need to find simpler models which are less data intensive but can still capture a sufficient amount of the underlying, true asset variation.</p>
<p>Based on this notion, the term <strong>Factor Models</strong> was primed. These models assume that the <strong>correlation between any two assets is explained by systematic factors</strong>. That is, the underlying return structure of multiple assets depends on common components which can be represented by quantifiable proxies. Using this assumption, one can <strong>restrict attention to only K (non-diversifiable) factors.</strong></p>
<p>Factor models have the advantage that they drastically reduce the number of input variables. Further, they allow to estimate systematic risk components by analysing expected return structures. However, they are purely statistical models and rely on past data. Further, they all assume stationarity.</p>
<p>The aim of factor models is to understand the drivers of asset prices. Broadly speaking, the main concept behind factor investing is that the financial performance of firms depends on distinct factors, whether they are latent or macroeconomic, or related to intrinsic, firm-specific characteristics. Cochrane (2011) states that the first essential question is which characteristics really provide independent information about average returns. Understanding whether the exposure of assets towards common variable(s) can be used to help explain the cross-sectional variation in returns is therein the main emphasis of factor investing.</p>
<p>As we have covered in the lecture, factor models are natural extensions of the <strong>Arbitrage Pricing Theory</strong> model (APT) introduced by Ross (1976), who assumes that security returns return can be modeled as a linear combination of underlying factors <span class="math inline">\(f_k\)</span> and that investors operate in functioning security markets which do not allow for the persistence of arbitrage opportunities:</p>
<p><span class="math display">\[
r_{i,t} = \alpha_i + \sum_{i=1}^K \beta_{i,k}f_{t,k} + \epsilon_{i,t}
\]</span></p>
<p>Here, the usual IID setting econometric assumptions hold, implying that <span class="math inline">\(cov(\epsilon_{i,t},\epsilon_{j,t}) = 0\)</span> and <span class="math inline">\(cov(\epsilon_{i},f_{i}) = 0\)</span>.</p>
<p>A quasi factor-based model is The CAPM. The CAPM is a commonly used model to assess asset returns. Previously, we introduced both the theoretical intuition as well as the practical implementation of the model. We derived how the exposure towards market movements influence stock returns and showed how to compute the underlying framework. Further, we derived options to test the model’s validity and showed that the CAPM does not hold empirically. Consequently, we were able to present that the theoretical foundations of the CAPM are not sufficient to effectively explain the variation in asset returns. This implies that other factors are needed to help explain the remaining variation in asset returns unexplained by the market. To put it in other words, the existence of factors that can explain asset returns further contradicts the validity of the CAPM, which assumes that the variation solely depends on the market portfolio. Consequently, factors are also regarded as <strong>anomalies</strong>.
A quasi factor-based model is The CAPM. The CAPM is a commonly used model to assess asset returns. Previously, we introduced both the theoretical intuition as well as the practical implementation of the model. We derived how the exposure towards market movements influence stock returns and showed how to compute the underlying framework. Further, we derived options to test the model’s validity and showed that the CAPM does not hold empirically. Consequently, we were able to present that the theoretical foundations of the CAPM are not sufficient to effectively explain the variation in asset returns. This implies that other factors are needed to help explain the remaining variation in asset returns unexplained by the market. To put it in other words, the existence of factors that can explain asset returns further contradicts the validity of the CAPM, which assumes that the variation solely depends on the market portfolio. Consequently, factors are also regarded as <strong>anomalies</strong>.</p>
<p>Importantly, each factor portfolio is a tracking portfolio. That is, the returns on such a portfolio are tracked by the evolution of one particular source of risk but are uncorrelated with other sources of risk.</p>
</div>
<div id="the-quest-of-detecting-anomalies-1" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> The quest of detecting anomalies</h2>
<p>How can we thus find such anomalies? As we already mentioned, there is no clear theoretical foundation to the use of certain factors. Mostly, researchers or industry experts consider market movements and attempt to pin down these movements based on correlating characteristics (either micro- or macro-oriented) of the firms under consideration. Usually then, based on these observations, theoretical arguments which suit the given movements are constructed around the anomalies. For instance, Chen Roll and Ross introduced one of the most fundamental multifactor models in 1986 by incorporating macroeconomic variables such as Growth in industrial productiion, inflation expected changes or corporate rated bonds and found a significant effect in the cross-section of returns. Based on their research, Fama and French (1993) created their famous Size and Value portfolio strategies on the observations that small size (measured by market capitalisation) as well as value (measured by high book-to-market ratios) securities outperform their opposite counterparts. Further notable examples include the Momentum strategy (by Jegadeesh and Titman (1993) and Carhart (1997)), Profitability (by Fama and French (2015) and Bouchaud et al. (2019)), Investment (by Fama and French (2015) as well as Hou, Xue, and Zhang (2015)) as well as low-risk (by Frazzini and Pedersen (2014)) or Liquidity factor (by Acharya and Pedersen (2005)).While these factors (i.e., long-short portfolios) exhibit time-varying risk premia and are magnified by corporate news and announcements, it is well-documented (and accepted) that they deliver positive returns over long horizons.</p>
<p>In essence, factors that are shown to hold empirically are manifold. For instance, Chen and Zimmermann (2019) attempt to replicate the 300 most commonly cited factors introduced during the last 40 years and publish the final factors on their website called . Although their work greatly facilitates an improved accessibility of factor investment opportunities, they also show the inherent challenges associated with factor investing. These include, among others:</p>
<ul>
<li>The limited possibility to replicate the factor exposure</li>
<li>The dependence of the variational properties on data-specific idiosyncracies</li>
<li>The likelihood of p-hacking strategies</li>
<li>The time-wise dependence on factor exposure</li>
<li>The destruction of potentially valid factor premia may be due to herding</li>
<li>The fading of anomalies due to the publication and subsequent reduction of arbitrage opportunities (through re-investment of multiple market participants)</li>
</ul>
<p>Consequently, although the pool of potentially valid factors is quite large, several of these factors suffer from one or multiple of the aforementioned issues, thereby rendering their empirical validity at least partially questionable. As such, although a multitude of potential characteristics are able to explain asset returns both time-series wise and cross-sectionally, the large-scale use of high-dimensional factor models must be addressed critically.</p>
</div>
<div id="the-fama-french-three-factor-model-1" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> The Fama-French Three Factor Model</h2>
<p>The perhaps most famous factor model is the Fama-French three-factor model (1993). It was based on observations by the researchers which found that small size (measured by market capitalisation) as well as value (measured by high book-to-market ratios) securities outperform their opposite counterparts. The theoretical reasoning for this were mostly pinned down to risk-based anomalies. For instance, it was argued that small companies outperform their larger counterparts because they are exposed towards a higher liquidation, operational as well as credit based risk, implying that they need to compensate for said risk throughout a higher return structure. Furthermore, the value factor was usually explained through perceptions of future performance based on financing activities, which might also constitute as financial distress assessments.</p>
<p>Fama and French do not only highlight the importance of size and value, but they also <strong>develop a method to generate factor portfolios.</strong></p>
<p>Their main strategy is the following. They construct a portfolio of large firms and one of small firms. As break point they use the median size of the firms listed on NYSE to classify all stocks traded on NYSE, Amex and Nasdaq. These portfolios are value weighted. They then construct a zero net investment <strong>size factor portfolio</strong> by going long the small and going short the big stock portfolio. Further, they construct a Book-to-Market (B2M) exposure by sorting the stocks into low (bottom 30%), medium (middle 40%) and high (top 30%) groups based on B2M.</p>
<p>Based on this, they construct six portfolios based on the intersection of size and B/M sorts:</p>
<ul>
<li><p>S/L: Small Stocks with Low B2M</p></li>
<li><p>S/M: Small Stocks with Medium B2M</p></li>
<li><p>S/H: Small Stocks with High B2M</p></li>
<li><p>B/L: Big Stocks with Low B2M</p></li>
<li><p>B/M: Big Stocks with Medium B2M</p></li>
<li><p>B/H: Big Stocks with High B2M</p></li>
</ul>
<p>The returns of the zero-net-investment factors SMB (Small minus Big) and HML (High minus Low) are created from these portfolios</p>
<p><span class="math display">\[
\begin{align}
R_{SMB} &amp;= 1/3(R_{S/L} + R_{S/M} + R_{S/H}) - 1/3(R_{B/L} + R_{B/M} + R_{B/H}) \\
R_{HML} &amp;= 1/2(R_{S/H} + R_{B/H}) - 1/2(R_{S/L} + R_{B/L})
\end{align}
\]</span></p>
<p>Based on these factors, the factor betas of the stocks are calculated in a First Pass regression:</p>
<p><span class="math display">\[
E(R_i) - r_f = \alpha_i + \beta_i(E(R_M) - r_f) + \gamma_iE[R_{SMB}] + \delta_iE[R_{HML}]
\]</span></p>
<p>The method used of Fama-French to construct the factors is the most widely adopted approach to create factors. Most of the subsequent factors were created using said approach of sorting stocks into either <span class="math inline">\(2 \times 3\)</span> or <span class="math inline">\(2 \times 2\)</span> portfolios. For instance, to construct the Momentum Factor by Jegadeesh and Titman (1996) as well as Carhart (1997), you can use the same approach as for the HML factor, but just double-sort it based on size and the previous Up/Down movements.</p>
</div>
<div id="testing-for-factor-validity-1" class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> Testing for factor validity</h2>
<p>As we discovered, factor investing describes an investment strategy in which quantifiable corporate or macroeconomic data is considered. Therein, the variation in security returns is poised to depend collectively on these characteristics. In order to test for the validity of the underlying characteristic in determining asset returns, we thus need to set the asset returns in a relation to the factor under consideration. The industry surrounding this investment style poses several methods to test said validity, both within time-series as well as cross-sectional settings.</p>
<p>Throughout the subsequent chapter, we will go over the most common techniques to test for factor validity. Throughout, we will cover the theoretical underpinnings, the actual testing strategy as well as the intuition behind each approach. Further, we will illustrate each testing strategy by using code-based examples on the <strong>Size Factor</strong> first introduced by Fama and French (1993).</p>
<div id="portfolio-sorts-1" class="section level3" number="9.4.1">
<h3><span class="header-section-number">9.4.1</span> Portfolio Sorts</h3>
<p>This is the simplest and most widely applied form of factor testing. The idea is straight-forward: We sort portfolios based on the risk factor under consideration into percentiles (e.g. deciles, quintiles). Then, we look at the return and variance structure of each portfolio and compare their structure throughout the individual percentiles to observe whether we see significant differences between them.</p>
<p>In essence, on each date t, we perform the following steps:</p>
<ol style="list-style-type: decimal">
<li>Rank firms according to a criterion (e.g. Market Capitalisation)</li>
<li>Sort the firms into portfolios based on the criterion (e.g 10 portfolios for decile portfolios)</li>
<li>Calculate the weights (either equally or value-weighted)</li>
<li>Calculate the portfolio returns at t+1</li>
</ol>
<p>The resulting outcome is a time series of portfolio returns for each portfolio j, <span class="math inline">\(r_t^j\)</span>. Then, we identify an anomaly in the following way:</p>
<ol start="5" style="list-style-type: decimal">
<li>Construct a Long-Short portfolio strategy by buying the highest and selling the lowest portfolio percentile group</li>
<li>Conduct a t-test of the long-short strategy</li>
</ol>
<p>In essence, what we want to observe is the following:</p>
<ul>
<li>A monotonous (possibly significant) change (either increase or decrease) in average returns throughout the portfolio sorts</li>
<li>A significant t-value for the long-short strategy</li>
</ul>
<p>Based on the literature, if we can observe both, then we can strengthen our assumption that the factor materially affects security returns. The reasoning is the following. We hypothesise that asset returns depend on a common factor. As such, the larger the exposure of a security towards said factor is, the stronger the returns should be affected by the factor. Consequently, the return of assets in higher portfolios should behave differently to that in lower portfolios. Further, if we assume that the factor under consideration influences the return structure of all assets, then we would expect that the effect grows continuously when moving from one portfolio to the other, inducing a monotonous effect throughout our assets.</p>
<p>First, let’s calculate quintile portfolios based on the characteristic</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="factor-models-1.html#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the datasets</span></span>
<span id="cb472-2"><a href="factor-models-1.html#cb472-2" aria-hidden="true" tabindex="-1"></a>Prices_Adj <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;~/Desktop/Master UZH/Data/A4_dataset_01.txt&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb472-3"><a href="factor-models-1.html#cb472-3" aria-hidden="true" tabindex="-1"></a>Prices_Unadj <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;~/Desktop/Master UZH/Data/A4_dataset_04.txt&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb472-4"><a href="factor-models-1.html#cb472-4" aria-hidden="true" tabindex="-1"></a>Shares <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;~/Desktop/Master UZH/Data/A4_dataset_03.txt&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb472-5"><a href="factor-models-1.html#cb472-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-6"><a href="factor-models-1.html#cb472-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Time-Series objects</span></span>
<span id="cb472-7"><a href="factor-models-1.html#cb472-7" aria-hidden="true" tabindex="-1"></a>Prices_Adj_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> Prices_Adj[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> <span class="fu">as.Date</span>(<span class="fu">dmy</span>(Prices_Adj[,<span class="dv">1</span>])))</span>
<span id="cb472-8"><a href="factor-models-1.html#cb472-8" aria-hidden="true" tabindex="-1"></a>Prices_Unadj_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> Prices_Unadj[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> <span class="fu">as.Date</span>(<span class="fu">dmy</span>(Prices_Unadj[,<span class="dv">1</span>])))</span>
<span id="cb472-9"><a href="factor-models-1.html#cb472-9" aria-hidden="true" tabindex="-1"></a>Shares_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> Shares[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> <span class="fu">as.Date</span>(<span class="fu">dmy</span>(Shares[,<span class="dv">1</span>])))</span>
<span id="cb472-10"><a href="factor-models-1.html#cb472-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-11"><a href="factor-models-1.html#cb472-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the Returns</span></span>
<span id="cb472-12"><a href="factor-models-1.html#cb472-12" aria-hidden="true" tabindex="-1"></a>Returns_Adj_ts <span class="ot">&lt;-</span> <span class="fu">Return.calculate</span>(Prices_Adj_ts, <span class="at">method =</span> <span class="st">&quot;discrete&quot;</span>)</span>
<span id="cb472-13"><a href="factor-models-1.html#cb472-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-14"><a href="factor-models-1.html#cb472-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the market cap Time-Series</span></span>
<span id="cb472-15"><a href="factor-models-1.html#cb472-15" aria-hidden="true" tabindex="-1"></a>Market_Cap_ts <span class="ot">&lt;-</span> Shares_ts <span class="sc">*</span> Prices_Unadj_ts</span>
<span id="cb472-16"><a href="factor-models-1.html#cb472-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-17"><a href="factor-models-1.html#cb472-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform the decile portfolio sorts</span></span>
<span id="cb472-18"><a href="factor-models-1.html#cb472-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Take the quintile values</span></span>
<span id="cb472-19"><a href="factor-models-1.html#cb472-19" aria-hidden="true" tabindex="-1"></a>quintiles <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>)</span>
<span id="cb472-20"><a href="factor-models-1.html#cb472-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Create variables indicating the respective 20&#39;th, 40&#39;th, 60&#39;th, 80&#39;th quintile for each month</span></span>
<span id="cb472-21"><a href="factor-models-1.html#cb472-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> quintiles){</span>
<span id="cb472-22"><a href="factor-models-1.html#cb472-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="fu">paste0</span>(<span class="st">&quot;Market_Cap_Cutoff_&quot;</span>, i, <span class="st">&quot;_ts&quot;</span>), matrixStats<span class="sc">::</span><span class="fu">rowQuantiles</span>(<span class="fu">as.matrix</span>(Market_Cap_ts), <span class="at">probs =</span> i, <span class="at">na.rm =</span> T))</span>
<span id="cb472-23"><a href="factor-models-1.html#cb472-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb472-24"><a href="factor-models-1.html#cb472-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-25"><a href="factor-models-1.html#cb472-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the portfolio returns for each quintile </span></span>
<span id="cb472-26"><a href="factor-models-1.html#cb472-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">names</span>(Market_Cap_ts)){</span>
<span id="cb472-27"><a href="factor-models-1.html#cb472-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># First create the market capitalisation of each quintile</span></span>
<span id="cb472-28"><a href="factor-models-1.html#cb472-28" aria-hidden="true" tabindex="-1"></a>  Market_Cap_Q1 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Market_Cap_ts[,i] <span class="sc">&lt;=</span> Market_Cap_Cutoff_0<span class="fl">.2</span>_ts, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb472-29"><a href="factor-models-1.html#cb472-29" aria-hidden="true" tabindex="-1"></a>  Market_Cap_Q2 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_ts[,i] <span class="sc">&gt;</span> Market_Cap_Cutoff_0<span class="fl">.2</span>_ts) <span class="sc">&amp;</span> (Market_Cap_ts[,i] <span class="sc">&lt;=</span> Market_Cap_Cutoff_0<span class="fl">.4</span>_ts), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb472-30"><a href="factor-models-1.html#cb472-30" aria-hidden="true" tabindex="-1"></a>  Market_Cap_Q3 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_ts[,i] <span class="sc">&gt;</span> Market_Cap_Cutoff_0<span class="fl">.4</span>_ts) <span class="sc">&amp;</span> (Market_Cap_ts[,i] <span class="sc">&lt;=</span> Market_Cap_Cutoff_0<span class="fl">.6</span>_ts), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb472-31"><a href="factor-models-1.html#cb472-31" aria-hidden="true" tabindex="-1"></a>  Market_Cap_Q4 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_ts[,i] <span class="sc">&gt;</span> Market_Cap_Cutoff_0<span class="fl">.6</span>_ts) <span class="sc">&amp;</span> (Market_Cap_ts[,i] <span class="sc">&lt;=</span> Market_Cap_Cutoff_0<span class="fl">.8</span>_ts), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb472-32"><a href="factor-models-1.html#cb472-32" aria-hidden="true" tabindex="-1"></a>  Market_Cap_Q5 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Market_Cap_ts[,i] <span class="sc">&gt;</span> Market_Cap_Cutoff_0<span class="fl">.8</span>_ts, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb472-33"><a href="factor-models-1.html#cb472-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Then multiply the Market Cap quintile indicators with the secutity returns</span></span>
<span id="cb472-34"><a href="factor-models-1.html#cb472-34" aria-hidden="true" tabindex="-1"></a>  Return_Market_Cap_Q1  <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(Market_Cap_Q1, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>, i]</span>
<span id="cb472-35"><a href="factor-models-1.html#cb472-35" aria-hidden="true" tabindex="-1"></a>  Return_Market_Cap_Q2  <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(Market_Cap_Q2, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>, i]</span>
<span id="cb472-36"><a href="factor-models-1.html#cb472-36" aria-hidden="true" tabindex="-1"></a>  Return_Market_Cap_Q3  <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(Market_Cap_Q3, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>, i]</span>
<span id="cb472-37"><a href="factor-models-1.html#cb472-37" aria-hidden="true" tabindex="-1"></a>  Return_Market_Cap_Q4  <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(Market_Cap_Q4, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>, i]</span>
<span id="cb472-38"><a href="factor-models-1.html#cb472-38" aria-hidden="true" tabindex="-1"></a>  Return_Market_Cap_Q5  <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(Market_Cap_Q5, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>, i]</span>
<span id="cb472-39"><a href="factor-models-1.html#cb472-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb472-40"><a href="factor-models-1.html#cb472-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="st">&quot;NESN&quot;</span>){ </span>
<span id="cb472-41"><a href="factor-models-1.html#cb472-41" aria-hidden="true" tabindex="-1"></a>    Return_Market_Cap_Q1_final <span class="ot">&lt;-</span> Return_Market_Cap_Q1</span>
<span id="cb472-42"><a href="factor-models-1.html#cb472-42" aria-hidden="true" tabindex="-1"></a>    Return_Market_Cap_Q2_final <span class="ot">&lt;-</span> Return_Market_Cap_Q2</span>
<span id="cb472-43"><a href="factor-models-1.html#cb472-43" aria-hidden="true" tabindex="-1"></a>    Return_Market_Cap_Q3_final <span class="ot">&lt;-</span> Return_Market_Cap_Q3</span>
<span id="cb472-44"><a href="factor-models-1.html#cb472-44" aria-hidden="true" tabindex="-1"></a>    Return_Market_Cap_Q4_final <span class="ot">&lt;-</span> Return_Market_Cap_Q4</span>
<span id="cb472-45"><a href="factor-models-1.html#cb472-45" aria-hidden="true" tabindex="-1"></a>    Return_Market_Cap_Q5_final <span class="ot">&lt;-</span> Return_Market_Cap_Q5</span>
<span id="cb472-46"><a href="factor-models-1.html#cb472-46" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb472-47"><a href="factor-models-1.html#cb472-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb472-48"><a href="factor-models-1.html#cb472-48" aria-hidden="true" tabindex="-1"></a>    Return_Market_Cap_Q1_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Return_Market_Cap_Q1_final, Return_Market_Cap_Q1)</span>
<span id="cb472-49"><a href="factor-models-1.html#cb472-49" aria-hidden="true" tabindex="-1"></a>    Return_Market_Cap_Q2_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Return_Market_Cap_Q2_final, Return_Market_Cap_Q2)</span>
<span id="cb472-50"><a href="factor-models-1.html#cb472-50" aria-hidden="true" tabindex="-1"></a>    Return_Market_Cap_Q3_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Return_Market_Cap_Q3_final, Return_Market_Cap_Q3)</span>
<span id="cb472-51"><a href="factor-models-1.html#cb472-51" aria-hidden="true" tabindex="-1"></a>    Return_Market_Cap_Q4_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Return_Market_Cap_Q4_final, Return_Market_Cap_Q4)</span>
<span id="cb472-52"><a href="factor-models-1.html#cb472-52" aria-hidden="true" tabindex="-1"></a>    Return_Market_Cap_Q5_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Return_Market_Cap_Q5_final, Return_Market_Cap_Q5)</span>
<span id="cb472-53"><a href="factor-models-1.html#cb472-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb472-54"><a href="factor-models-1.html#cb472-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb472-55"><a href="factor-models-1.html#cb472-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-56"><a href="factor-models-1.html#cb472-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Create mean returns of each portfolio</span></span>
<span id="cb472-57"><a href="factor-models-1.html#cb472-57" aria-hidden="true" tabindex="-1"></a>Mean_Return_EW_Q1_final <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Return_Market_Cap_Q1_final, <span class="at">na.rm =</span> T)</span>
<span id="cb472-58"><a href="factor-models-1.html#cb472-58" aria-hidden="true" tabindex="-1"></a>Mean_Return_EW_Q2_final <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Return_Market_Cap_Q2_final, <span class="at">na.rm =</span> T)</span>
<span id="cb472-59"><a href="factor-models-1.html#cb472-59" aria-hidden="true" tabindex="-1"></a>Mean_Return_EW_Q3_final <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Return_Market_Cap_Q3_final, <span class="at">na.rm =</span> T)</span>
<span id="cb472-60"><a href="factor-models-1.html#cb472-60" aria-hidden="true" tabindex="-1"></a>Mean_Return_EW_Q4_final <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Return_Market_Cap_Q4_final, <span class="at">na.rm =</span> T)</span>
<span id="cb472-61"><a href="factor-models-1.html#cb472-61" aria-hidden="true" tabindex="-1"></a>Mean_Return_EW_Q5_final <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Return_Market_Cap_Q5_final, <span class="at">na.rm =</span> T)</span>
<span id="cb472-62"><a href="factor-models-1.html#cb472-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-63"><a href="factor-models-1.html#cb472-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the entire datatframe to one </span></span>
<span id="cb472-64"><a href="factor-models-1.html#cb472-64" aria-hidden="true" tabindex="-1"></a>Dates <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">dmy</span>(Prices_Adj[,<span class="dv">1</span>][<span class="dv">14</span><span class="sc">:</span><span class="dv">361</span>]))</span>
<span id="cb472-65"><a href="factor-models-1.html#cb472-65" aria-hidden="true" tabindex="-1"></a><span class="do">## For the normal returns</span></span>
<span id="cb472-66"><a href="factor-models-1.html#cb472-66" aria-hidden="true" tabindex="-1"></a>Mean_Return_EW_quintiles <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(Dates, </span>
<span id="cb472-67"><a href="factor-models-1.html#cb472-67" aria-hidden="true" tabindex="-1"></a>                                                Mean_Return_EW_Q1_final, </span>
<span id="cb472-68"><a href="factor-models-1.html#cb472-68" aria-hidden="true" tabindex="-1"></a>                                                Mean_Return_EW_Q2_final, </span>
<span id="cb472-69"><a href="factor-models-1.html#cb472-69" aria-hidden="true" tabindex="-1"></a>                                                Mean_Return_EW_Q3_final, </span>
<span id="cb472-70"><a href="factor-models-1.html#cb472-70" aria-hidden="true" tabindex="-1"></a>                                                Mean_Return_EW_Q4_final, </span>
<span id="cb472-71"><a href="factor-models-1.html#cb472-71" aria-hidden="true" tabindex="-1"></a>                                                Mean_Return_EW_Q5_final))</span>
<span id="cb472-72"><a href="factor-models-1.html#cb472-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-73"><a href="factor-models-1.html#cb472-73" aria-hidden="true" tabindex="-1"></a>Mean_Return_EW_quintiles_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> Mean_Return_EW_quintiles[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> Dates)</span>
<span id="cb472-74"><a href="factor-models-1.html#cb472-74" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Mean_Return_EW_quintiles_ts) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Quintile 1&quot;</span>, <span class="st">&quot;Quintile 2&quot;</span>, <span class="st">&quot;Quintile 3&quot;</span>, <span class="st">&quot;Quintile 4&quot;</span>, <span class="st">&quot;Quintile 5&quot;</span>)</span>
<span id="cb472-75"><a href="factor-models-1.html#cb472-75" aria-hidden="true" tabindex="-1"></a><span class="do">## For the cumulative returns</span></span>
<span id="cb472-76"><a href="factor-models-1.html#cb472-76" aria-hidden="true" tabindex="-1"></a>Mean_Return_EW_quintiles_cp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(Dates, </span>
<span id="cb472-77"><a href="factor-models-1.html#cb472-77" aria-hidden="true" tabindex="-1"></a>                                                <span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">+</span>Mean_Return_EW_Q1_final), </span>
<span id="cb472-78"><a href="factor-models-1.html#cb472-78" aria-hidden="true" tabindex="-1"></a>                                                <span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">+</span>Mean_Return_EW_Q2_final), </span>
<span id="cb472-79"><a href="factor-models-1.html#cb472-79" aria-hidden="true" tabindex="-1"></a>                                                <span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">+</span>Mean_Return_EW_Q3_final), </span>
<span id="cb472-80"><a href="factor-models-1.html#cb472-80" aria-hidden="true" tabindex="-1"></a>                                                <span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">+</span>Mean_Return_EW_Q4_final), </span>
<span id="cb472-81"><a href="factor-models-1.html#cb472-81" aria-hidden="true" tabindex="-1"></a>                                                <span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">+</span>Mean_Return_EW_Q5_final)))</span>
<span id="cb472-82"><a href="factor-models-1.html#cb472-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-83"><a href="factor-models-1.html#cb472-83" aria-hidden="true" tabindex="-1"></a>Mean_Return_EW_quintiles_cp_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> Mean_Return_EW_quintiles_cp[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> Dates)</span>
<span id="cb472-84"><a href="factor-models-1.html#cb472-84" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Mean_Return_EW_quintiles_cp_ts) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Quintile 1&quot;</span>, <span class="st">&quot;Quintile 2&quot;</span>, <span class="st">&quot;Quintile 3&quot;</span>, <span class="st">&quot;Quintile 4&quot;</span>, <span class="st">&quot;Quintile 5&quot;</span>)</span>
<span id="cb472-85"><a href="factor-models-1.html#cb472-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-86"><a href="factor-models-1.html#cb472-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Finally, we can plot the relationship </span></span>
<span id="cb472-87"><a href="factor-models-1.html#cb472-87" aria-hidden="true" tabindex="-1"></a>plot_ret <span class="ot">&lt;-</span> <span class="fu">tidy</span>(Mean_Return_EW_quintiles_ts) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>index,<span class="at">y=</span>value, <span class="at">color=</span>series)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb472-88"><a href="factor-models-1.html#cb472-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;tomato3&quot;</span>, <span class="st">&quot;khaki3&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>, <span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;violetred4&quot;</span>)) <span class="sc">+</span></span>
<span id="cb472-89"><a href="factor-models-1.html#cb472-89" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">&quot;Cumulative Returns&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Relationship of Normal Returns on Quintile PF based on Market Cap&quot;</span>) <span class="sc">+</span></span>
<span id="cb472-90"><a href="factor-models-1.html#cb472-90" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb472-91"><a href="factor-models-1.html#cb472-91" aria-hidden="true" tabindex="-1"></a><span class="at">hjust=</span><span class="fl">0.5</span>,</span>
<span id="cb472-92"><a href="factor-models-1.html#cb472-92" aria-hidden="true" tabindex="-1"></a><span class="at">lineheight=</span><span class="fl">1.2</span>), <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb472-93"><a href="factor-models-1.html#cb472-93" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb472-94"><a href="factor-models-1.html#cb472-94" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb472-95"><a href="factor-models-1.html#cb472-95" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb472-96"><a href="factor-models-1.html#cb472-96" aria-hidden="true" tabindex="-1"></a><span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb472-97"><a href="factor-models-1.html#cb472-97" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb472-98"><a href="factor-models-1.html#cb472-98" aria-hidden="true" tabindex="-1"></a><span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>)) </span>
<span id="cb472-99"><a href="factor-models-1.html#cb472-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-100"><a href="factor-models-1.html#cb472-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Finally, we can plot the relationship </span></span>
<span id="cb472-101"><a href="factor-models-1.html#cb472-101" aria-hidden="true" tabindex="-1"></a>plot_cumret <span class="ot">&lt;-</span> <span class="fu">tidy</span>(Mean_Return_EW_quintiles_cp_ts) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>index,<span class="at">y=</span>value, <span class="at">color=</span>series)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb472-102"><a href="factor-models-1.html#cb472-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;tomato3&quot;</span>, <span class="st">&quot;khaki3&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>, <span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;violetred4&quot;</span>)) <span class="sc">+</span></span>
<span id="cb472-103"><a href="factor-models-1.html#cb472-103" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">&quot;Cumulative Returns&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Relationship of Cumulative Returns on Quintile PF based on Market Cap&quot;</span>) <span class="sc">+</span></span>
<span id="cb472-104"><a href="factor-models-1.html#cb472-104" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb472-105"><a href="factor-models-1.html#cb472-105" aria-hidden="true" tabindex="-1"></a><span class="at">hjust=</span><span class="fl">0.5</span>,</span>
<span id="cb472-106"><a href="factor-models-1.html#cb472-106" aria-hidden="true" tabindex="-1"></a><span class="at">lineheight=</span><span class="fl">1.2</span>), <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb472-107"><a href="factor-models-1.html#cb472-107" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb472-108"><a href="factor-models-1.html#cb472-108" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb472-109"><a href="factor-models-1.html#cb472-109" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb472-110"><a href="factor-models-1.html#cb472-110" aria-hidden="true" tabindex="-1"></a><span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb472-111"><a href="factor-models-1.html#cb472-111" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb472-112"><a href="factor-models-1.html#cb472-112" aria-hidden="true" tabindex="-1"></a><span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>)) </span>
<span id="cb472-113"><a href="factor-models-1.html#cb472-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb472-114"><a href="factor-models-1.html#cb472-114" aria-hidden="true" tabindex="-1"></a>plot_ret</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-274-1.png" width="672" /></p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="factor-models-1.html#cb473-1" aria-hidden="true" tabindex="-1"></a>plot_cumret</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-274-2.png" width="672" /></p>
<p>As we can see, there appears to be a strictly increasing trend based on the quintile portfolios. We can confirm this trend by looking at the average returns and their standard deviations.</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="factor-models-1.html#cb474-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the mean returns</span></span>
<span id="cb474-2"><a href="factor-models-1.html#cb474-2" aria-hidden="true" tabindex="-1"></a>Mean_Return_EW_quintiles_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> Mean_Return_EW_quintiles[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> Dates)</span>
<span id="cb474-3"><a href="factor-models-1.html#cb474-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb474-4"><a href="factor-models-1.html#cb474-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">names</span>(Mean_Return_EW_quintiles_ts)){</span>
<span id="cb474-5"><a href="factor-models-1.html#cb474-5" aria-hidden="true" tabindex="-1"></a>  Mean_Return_EW <span class="ot">&lt;-</span> <span class="fu">mean</span>(Mean_Return_EW_quintiles_ts[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>, i])</span>
<span id="cb474-6"><a href="factor-models-1.html#cb474-6" aria-hidden="true" tabindex="-1"></a>  SD_Return_EW <span class="ot">&lt;-</span> <span class="fu">sd</span>(Mean_Return_EW_quintiles_ts[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>, i])</span>
<span id="cb474-7"><a href="factor-models-1.html#cb474-7" aria-hidden="true" tabindex="-1"></a>  n_Return_EW <span class="ot">&lt;-</span> <span class="fu">length</span>(Mean_Return_EW_quintiles_ts[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>, i])</span>
<span id="cb474-8"><a href="factor-models-1.html#cb474-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb474-9"><a href="factor-models-1.html#cb474-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="st">&quot;Mean_Return_EW_Q1_final&quot;</span>){</span>
<span id="cb474-10"><a href="factor-models-1.html#cb474-10" aria-hidden="true" tabindex="-1"></a>    Mean_Return_EW_final <span class="ot">&lt;-</span> Mean_Return_EW</span>
<span id="cb474-11"><a href="factor-models-1.html#cb474-11" aria-hidden="true" tabindex="-1"></a>    SD_Return_EW_final <span class="ot">&lt;-</span> SD_Return_EW</span>
<span id="cb474-12"><a href="factor-models-1.html#cb474-12" aria-hidden="true" tabindex="-1"></a>    n_Return_EW_final <span class="ot">&lt;-</span> n_Return_EW</span>
<span id="cb474-13"><a href="factor-models-1.html#cb474-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb474-14"><a href="factor-models-1.html#cb474-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb474-15"><a href="factor-models-1.html#cb474-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb474-16"><a href="factor-models-1.html#cb474-16" aria-hidden="true" tabindex="-1"></a>    Mean_Return_EW_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Mean_Return_EW_final, Mean_Return_EW)</span>
<span id="cb474-17"><a href="factor-models-1.html#cb474-17" aria-hidden="true" tabindex="-1"></a>    SD_Return_EW_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(SD_Return_EW_final, SD_Return_EW)</span>
<span id="cb474-18"><a href="factor-models-1.html#cb474-18" aria-hidden="true" tabindex="-1"></a>    n_Return_EW_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(n_Return_EW_final, n_Return_EW)</span>
<span id="cb474-19"><a href="factor-models-1.html#cb474-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb474-20"><a href="factor-models-1.html#cb474-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb474-21"><a href="factor-models-1.html#cb474-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb474-22"><a href="factor-models-1.html#cb474-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the final dataframe</span></span>
<span id="cb474-23"><a href="factor-models-1.html#cb474-23" aria-hidden="true" tabindex="-1"></a>Mean_SD_Size_EW_Quintile_PF <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">rbind</span>(Mean_Return_EW_final, SD_Return_EW_final, n_Return_EW_final))</span>
<span id="cb474-24"><a href="factor-models-1.html#cb474-24" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Mean_SD_Size_EW_Quintile_PF) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Quintile_1&quot;</span>, <span class="st">&quot;Quintile_2&quot;</span>, <span class="st">&quot;Quintile_3&quot;</span>, <span class="st">&quot;Quintile_4&quot;</span>, <span class="st">&quot;Quintile_5&quot;</span>)</span>
<span id="cb474-25"><a href="factor-models-1.html#cb474-25" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(Mean_SD_Size_EW_Quintile_PF) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Average Return&quot;</span>, <span class="st">&quot;SD Return&quot;</span>, <span class="st">&quot;N Observations&quot;</span>)</span>
<span id="cb474-26"><a href="factor-models-1.html#cb474-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb474-27"><a href="factor-models-1.html#cb474-27" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(Mean_SD_Size_EW_Quintile_PF,<span class="dv">4</span>)</span></code></pre></div>
<pre><code>##                Quintile_1 Quintile_2 Quintile_3 Quintile_4 Quintile_5
## Average Return     0.0060     0.0054     0.0066     0.0067     0.0075
## SD Return          0.0436     0.0406     0.0450     0.0446     0.0482
## N Observations   348.0000   348.0000   348.0000   348.0000   348.0000</code></pre>
<p>Finally, we can compute the t-test to check if the average return is statistically different</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="factor-models-1.html#cb476-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s create a simple function to calculate the t-test for the average difference</span></span>
<span id="cb476-2"><a href="factor-models-1.html#cb476-2" aria-hidden="true" tabindex="-1"></a>t_test_mean_diff <span class="ot">&lt;-</span> <span class="cf">function</span>(mean_a, mean_b, sd_a, sd_b, n_a, n_b) {</span>
<span id="cb476-3"><a href="factor-models-1.html#cb476-3" aria-hidden="true" tabindex="-1"></a>  t_test <span class="ot">&lt;-</span> (mean_a <span class="sc">-</span> mean_b) <span class="sc">/</span> <span class="fu">sqrt</span>(sd_a<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_a <span class="sc">+</span> sd_b<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>n_b)</span>
<span id="cb476-4"><a href="factor-models-1.html#cb476-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(t_test)</span>
<span id="cb476-5"><a href="factor-models-1.html#cb476-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb476-6"><a href="factor-models-1.html#cb476-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb476-7"><a href="factor-models-1.html#cb476-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Try out the formula</span></span>
<span id="cb476-8"><a href="factor-models-1.html#cb476-8" aria-hidden="true" tabindex="-1"></a><span class="fu">t_test_mean_diff</span>(Mean_SD_Size_EW_Quintile_PF<span class="sc">$</span>Quintile_5[<span class="dv">1</span>], </span>
<span id="cb476-9"><a href="factor-models-1.html#cb476-9" aria-hidden="true" tabindex="-1"></a>                 Mean_SD_Size_EW_Quintile_PF<span class="sc">$</span>Quintile_1[<span class="dv">1</span>], </span>
<span id="cb476-10"><a href="factor-models-1.html#cb476-10" aria-hidden="true" tabindex="-1"></a>                 Mean_SD_Size_EW_Quintile_PF<span class="sc">$</span>Quintile_5[<span class="dv">2</span>], </span>
<span id="cb476-11"><a href="factor-models-1.html#cb476-11" aria-hidden="true" tabindex="-1"></a>                 Mean_SD_Size_EW_Quintile_PF<span class="sc">$</span>Quintile_1[<span class="dv">2</span>], </span>
<span id="cb476-12"><a href="factor-models-1.html#cb476-12" aria-hidden="true" tabindex="-1"></a>                 Mean_SD_Size_EW_Quintile_PF<span class="sc">$</span>Quintile_5[<span class="dv">3</span>], </span>
<span id="cb476-13"><a href="factor-models-1.html#cb476-13" aria-hidden="true" tabindex="-1"></a>                 Mean_SD_Size_EW_Quintile_PF<span class="sc">$</span>Quintile_1[<span class="dv">3</span>])</span></code></pre></div>
<pre><code>## [1] 0.444822</code></pre>
<p>As we can see, there is no significant difference between the average returns of the high and the low portfolio. This implies, given the IID considerations and the baseline statistical properties assumed, the difference in average returns between the smallest and largest stock portfolio is statistically indistinguishable from zero at conventional levels. Thus, the hypothesis that the average returns are not different from each other cannot be rejected.</p>
</div>
<div id="factor-construction-1" class="section level3" number="9.4.2">
<h3><span class="header-section-number">9.4.2</span> Factor Construction</h3>
<p>The second approach constitutes the creation of so-called <strong>risk-factor mimicking portfolios</strong>. These are portfolios which are sorted based on the risk factor of interest but are put relative to each other, depending on the exposure towards the characteristic under consideration. Consequently, we follow a quite similar approach to the portfolio sorts. That is, we:</p>
<ul>
<li>First single-sort the assts based on specific characteristics in usually 2 or 3 portfolios</li>
<li>Double-sort the assets based on the portfolio allocations of the first sort (e.g. Small and Low B2M assets) to obtain the risk-factor mimicking portfolios</li>
<li>Take the difference between the double-sorted portfolios which are more and which are less exposed towards the given risk factor</li>
</ul>
<p>The most usual approaches include forming bivariate sorts and aggregating several portfolios together, as in the original contribution of Fama and French (1993). However, some papers also only single-sort the portfolios based on only the respective risk factor. Seldomly, but sometimes appearing, practitioners use n-fold sorting approaches, implying they sort the assets according to n-folds. However, an important caveat with this strategy is the scalability. For instance, let’s look at the n = 3 case, in which we would sort portfolios based on Size, B2M and previous return (used for the Momentum factor). Let’s assume we would sort portfolios based on each characteristics according to above and below median values. In that case, we would create <span class="math inline">\(2 \times 2 \times 2 = 8\)</span> sorts. For instance, the SMB factor would be:</p>
<p><span class="math display">\[
\begin{equation}
SMB = 1/4(R_{SLU} + R_{SHU} + R_{SLD} + R_{SHD}) -  1/4(R_{BLU} + R_{BHU} + R_{BLD} + R_{BHD})
\end{equation}
\]</span></p>
<p>With this strategy, we now interacted the assets based on each characteristic under consideration. For instance, <span class="math inline">\(R_{SHU}\)</span> is the return of the Small-High-Up portfolio, implying lower than median market capitalisation, higher than median B2M ratio and higher than average past return. It is easy to see that operating on high-dimensional regression settings would quickly render this approach infeasible as the resulting number of created portfolios grows by a factor of <span class="math inline">\(2^n\)</span> if a complete interaction is to be maintained. And this is if we only keep to sort the portfolios based on median values. Given the large amount of factors that have been proposed throughout the last two decades (currently there are over 300 factors that are argued to explain the return structure of US equities), such an approach would require substantial computational power to enable a high-dimensional factor analysis.</p>
<p>Consequently, let’s follow two approaches in the subsequent factor creation.</p>
<ul>
<li>First, we single-sort portfolios based on their market capitalisation and then take their difference to create a Long-Short (LS) Size Portfolio</li>
<li>Then, we recreate the Fama-French SMB factor for the Swiss market by using the formula that was discussed in the lecture</li>
</ul>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="factor-models-1.html#cb478-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the datasets</span></span>
<span id="cb478-2"><a href="factor-models-1.html#cb478-2" aria-hidden="true" tabindex="-1"></a>Prices_Adj <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;~/Desktop/Master UZH/Data/A4_dataset_01.txt&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb478-3"><a href="factor-models-1.html#cb478-3" aria-hidden="true" tabindex="-1"></a>Prices_Unadj <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;~/Desktop/Master UZH/Data/A4_dataset_04.txt&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb478-4"><a href="factor-models-1.html#cb478-4" aria-hidden="true" tabindex="-1"></a>Shares <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;~/Desktop/Master UZH/Data/A4_dataset_03.txt&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb478-5"><a href="factor-models-1.html#cb478-5" aria-hidden="true" tabindex="-1"></a>Book <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;~/Desktop/Master UZH/Data/A4_dataset_02.txt&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb478-6"><a href="factor-models-1.html#cb478-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-7"><a href="factor-models-1.html#cb478-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Time-Series objects</span></span>
<span id="cb478-8"><a href="factor-models-1.html#cb478-8" aria-hidden="true" tabindex="-1"></a>Prices_Adj_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> Prices_Adj[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> <span class="fu">as.Date</span>(<span class="fu">dmy</span>(Prices_Adj[,<span class="dv">1</span>])))</span>
<span id="cb478-9"><a href="factor-models-1.html#cb478-9" aria-hidden="true" tabindex="-1"></a>Prices_Unadj_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> Prices_Unadj[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> <span class="fu">as.Date</span>(<span class="fu">dmy</span>(Prices_Unadj[,<span class="dv">1</span>])))</span>
<span id="cb478-10"><a href="factor-models-1.html#cb478-10" aria-hidden="true" tabindex="-1"></a>Shares_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> Shares[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> <span class="fu">as.Date</span>(<span class="fu">dmy</span>(Shares[,<span class="dv">1</span>])))</span>
<span id="cb478-11"><a href="factor-models-1.html#cb478-11" aria-hidden="true" tabindex="-1"></a>Book_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> Book[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> <span class="fu">as.Date</span>(<span class="fu">dmy</span>(Book[,<span class="dv">1</span>])))</span>
<span id="cb478-12"><a href="factor-models-1.html#cb478-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-13"><a href="factor-models-1.html#cb478-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the Returns</span></span>
<span id="cb478-14"><a href="factor-models-1.html#cb478-14" aria-hidden="true" tabindex="-1"></a>Returns_Adj_ts <span class="ot">&lt;-</span> <span class="fu">Return.calculate</span>(Prices_Adj_ts, <span class="at">method =</span> <span class="st">&quot;discrete&quot;</span>)</span>
<span id="cb478-15"><a href="factor-models-1.html#cb478-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-16"><a href="factor-models-1.html#cb478-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the market cap Time-Series</span></span>
<span id="cb478-17"><a href="factor-models-1.html#cb478-17" aria-hidden="true" tabindex="-1"></a>Market_Cap_ts <span class="ot">&lt;-</span> Shares_ts <span class="sc">*</span> Prices_Unadj_ts</span>
<span id="cb478-18"><a href="factor-models-1.html#cb478-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-19"><a href="factor-models-1.html#cb478-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the Book-to-Market ratio</span></span>
<span id="cb478-20"><a href="factor-models-1.html#cb478-20" aria-hidden="true" tabindex="-1"></a>B2M_ts <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(Book_ts, <span class="dv">6</span>) <span class="sc">/</span> Market_Cap_ts</span>
<span id="cb478-21"><a href="factor-models-1.html#cb478-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-22"><a href="factor-models-1.html#cb478-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the cut-off points of each factor composite </span></span>
<span id="cb478-23"><a href="factor-models-1.html#cb478-23" aria-hidden="true" tabindex="-1"></a>Market_Cap_ts_Median_Cutoff <span class="ot">&lt;-</span> matrixStats<span class="sc">::</span><span class="fu">rowMedians</span>(Market_Cap_ts, <span class="at">na.rm =</span> T)</span>
<span id="cb478-24"><a href="factor-models-1.html#cb478-24" aria-hidden="true" tabindex="-1"></a>B2M_Low_Cutoff <span class="ot">&lt;-</span> matrixStats<span class="sc">::</span><span class="fu">rowQuantiles</span>(<span class="fu">as.matrix</span>(B2M_ts), <span class="at">probs =</span> <span class="fl">0.3</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb478-25"><a href="factor-models-1.html#cb478-25" aria-hidden="true" tabindex="-1"></a>B2M_High_Cutoff <span class="ot">&lt;-</span> matrixStats<span class="sc">::</span><span class="fu">rowQuantiles</span>(<span class="fu">as.matrix</span>(B2M_ts), <span class="at">probs =</span> <span class="fl">0.7</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb478-26"><a href="factor-models-1.html#cb478-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-27"><a href="factor-models-1.html#cb478-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Based on the Cutoff values, generate dummies that indicate whether a certain data point is within a given cutoff level</span></span>
<span id="cb478-28"><a href="factor-models-1.html#cb478-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-29"><a href="factor-models-1.html#cb478-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">names</span>(Market_Cap_ts)){</span>
<span id="cb478-30"><a href="factor-models-1.html#cb478-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the indicator variables</span></span>
<span id="cb478-31"><a href="factor-models-1.html#cb478-31" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For the Market Cap</span></span>
<span id="cb478-32"><a href="factor-models-1.html#cb478-32" aria-hidden="true" tabindex="-1"></a>  Market_Cap_Small <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Market_Cap_ts[, i] <span class="sc">&lt;=</span> Market_Cap_ts_Median_Cutoff, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb478-33"><a href="factor-models-1.html#cb478-33" aria-hidden="true" tabindex="-1"></a>  Market_Cap_Big <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Market_Cap_ts[, i] <span class="sc">&gt;</span> Market_Cap_ts_Median_Cutoff, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb478-34"><a href="factor-models-1.html#cb478-34" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For the B2M Ratio</span></span>
<span id="cb478-35"><a href="factor-models-1.html#cb478-35" aria-hidden="true" tabindex="-1"></a>  B2M_Low <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(B2M_ts[, i] <span class="sc">&lt;=</span> B2M_Low_Cutoff, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb478-36"><a href="factor-models-1.html#cb478-36" aria-hidden="true" tabindex="-1"></a>  B2M_Mid <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((B2M_ts[, i] <span class="sc">&gt;</span> B2M_Low_Cutoff) <span class="sc">&amp;</span> (B2M_ts[, i] <span class="sc">&lt;=</span> B2M_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb478-37"><a href="factor-models-1.html#cb478-37" aria-hidden="true" tabindex="-1"></a>  B2M_High <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(B2M_ts[, i] <span class="sc">&gt;</span> B2M_High_Cutoff, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb478-38"><a href="factor-models-1.html#cb478-38" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For the interaction indicator variables to get S/L, S/M, S/H &amp; B/L, B/M, B/H</span></span>
<span id="cb478-39"><a href="factor-models-1.html#cb478-39" aria-hidden="true" tabindex="-1"></a>  Assets_SL <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_ts[, i] <span class="sc">&lt;=</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (B2M_ts[, i] <span class="sc">&lt;=</span> B2M_Low_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb478-40"><a href="factor-models-1.html#cb478-40" aria-hidden="true" tabindex="-1"></a>  Assets_SM <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_ts[, i] <span class="sc">&lt;=</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (B2M_ts[, i] <span class="sc">&gt;</span> B2M_Low_Cutoff) <span class="sc">&amp;</span> (B2M_ts[, i] <span class="sc">&lt;=</span> B2M_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb478-41"><a href="factor-models-1.html#cb478-41" aria-hidden="true" tabindex="-1"></a>  Assets_SH <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_ts[, i] <span class="sc">&lt;=</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (B2M_ts[, i] <span class="sc">&gt;</span> B2M_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb478-42"><a href="factor-models-1.html#cb478-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb478-43"><a href="factor-models-1.html#cb478-43" aria-hidden="true" tabindex="-1"></a>  Assets_BL <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_ts[, i] <span class="sc">&gt;</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (B2M_ts[, i] <span class="sc">&lt;=</span> B2M_Low_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb478-44"><a href="factor-models-1.html#cb478-44" aria-hidden="true" tabindex="-1"></a>  Assets_BM <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_ts[, i] <span class="sc">&gt;</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (B2M_ts[, i] <span class="sc">&gt;</span> B2M_Low_Cutoff) <span class="sc">&amp;</span> (B2M_ts[, i] <span class="sc">&lt;=</span> B2M_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb478-45"><a href="factor-models-1.html#cb478-45" aria-hidden="true" tabindex="-1"></a>  Assets_BH <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_ts[, i] <span class="sc">&gt;</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (B2M_ts[, i] <span class="sc">&gt;</span> B2M_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb478-46"><a href="factor-models-1.html#cb478-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb478-47"><a href="factor-models-1.html#cb478-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the returns</span></span>
<span id="cb478-48"><a href="factor-models-1.html#cb478-48" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For the Market Cap</span></span>
<span id="cb478-49"><a href="factor-models-1.html#cb478-49" aria-hidden="true" tabindex="-1"></a>  Return_Small <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(Market_Cap_Small, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>, i]</span>
<span id="cb478-50"><a href="factor-models-1.html#cb478-50" aria-hidden="true" tabindex="-1"></a>  Return_Big <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(Market_Cap_Big, <span class="dv">1</span>)<span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>, i]</span>
<span id="cb478-51"><a href="factor-models-1.html#cb478-51" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For the B2M Ratio</span></span>
<span id="cb478-52"><a href="factor-models-1.html#cb478-52" aria-hidden="true" tabindex="-1"></a>  Return_Low <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(B2M_Low, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>, i]</span>
<span id="cb478-53"><a href="factor-models-1.html#cb478-53" aria-hidden="true" tabindex="-1"></a>  Return_Mid <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(B2M_Mid, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>, i]</span>
<span id="cb478-54"><a href="factor-models-1.html#cb478-54" aria-hidden="true" tabindex="-1"></a>  Return_High <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(B2M_High, <span class="dv">1</span>)<span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>, i]</span>
<span id="cb478-55"><a href="factor-models-1.html#cb478-55" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For the interaction indicator variables to get S/L, S/M, S/H &amp; B/L, B/M, B/H returns</span></span>
<span id="cb478-56"><a href="factor-models-1.html#cb478-56" aria-hidden="true" tabindex="-1"></a>  Returns_SL <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_SL, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>, i]</span>
<span id="cb478-57"><a href="factor-models-1.html#cb478-57" aria-hidden="true" tabindex="-1"></a>  Returns_SM <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_SM, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>, i]</span>
<span id="cb478-58"><a href="factor-models-1.html#cb478-58" aria-hidden="true" tabindex="-1"></a>  Returns_SH <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_SH, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>, i]</span>
<span id="cb478-59"><a href="factor-models-1.html#cb478-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb478-60"><a href="factor-models-1.html#cb478-60" aria-hidden="true" tabindex="-1"></a>  Returns_BL <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_BL, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>, i]</span>
<span id="cb478-61"><a href="factor-models-1.html#cb478-61" aria-hidden="true" tabindex="-1"></a>  Returns_BM <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_BM, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>, i]</span>
<span id="cb478-62"><a href="factor-models-1.html#cb478-62" aria-hidden="true" tabindex="-1"></a>  Returns_BH <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_BH, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>, i]</span>
<span id="cb478-63"><a href="factor-models-1.html#cb478-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb478-64"><a href="factor-models-1.html#cb478-64" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="st">&quot;NESN&quot;</span>){</span>
<span id="cb478-65"><a href="factor-models-1.html#cb478-65" aria-hidden="true" tabindex="-1"></a>    Returns_SL_final <span class="ot">&lt;-</span> Returns_SL</span>
<span id="cb478-66"><a href="factor-models-1.html#cb478-66" aria-hidden="true" tabindex="-1"></a>    Returns_SM_final <span class="ot">&lt;-</span> Returns_SM</span>
<span id="cb478-67"><a href="factor-models-1.html#cb478-67" aria-hidden="true" tabindex="-1"></a>    Returns_SH_final <span class="ot">&lt;-</span> Returns_SH</span>
<span id="cb478-68"><a href="factor-models-1.html#cb478-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb478-69"><a href="factor-models-1.html#cb478-69" aria-hidden="true" tabindex="-1"></a>    Returns_BL_final <span class="ot">&lt;-</span> Returns_BL</span>
<span id="cb478-70"><a href="factor-models-1.html#cb478-70" aria-hidden="true" tabindex="-1"></a>    Returns_BM_final <span class="ot">&lt;-</span> Returns_BM</span>
<span id="cb478-71"><a href="factor-models-1.html#cb478-71" aria-hidden="true" tabindex="-1"></a>    Returns_BH_final <span class="ot">&lt;-</span> Returns_BH</span>
<span id="cb478-72"><a href="factor-models-1.html#cb478-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb478-73"><a href="factor-models-1.html#cb478-73" aria-hidden="true" tabindex="-1"></a>    Return_Small_final <span class="ot">&lt;-</span> Return_Small</span>
<span id="cb478-74"><a href="factor-models-1.html#cb478-74" aria-hidden="true" tabindex="-1"></a>    Return_Big_final <span class="ot">&lt;-</span> Return_Big</span>
<span id="cb478-75"><a href="factor-models-1.html#cb478-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb478-76"><a href="factor-models-1.html#cb478-76" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb478-77"><a href="factor-models-1.html#cb478-77" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb478-78"><a href="factor-models-1.html#cb478-78" aria-hidden="true" tabindex="-1"></a>    Returns_SL_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_SL_final, Returns_SL)</span>
<span id="cb478-79"><a href="factor-models-1.html#cb478-79" aria-hidden="true" tabindex="-1"></a>    Returns_SM_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_SM_final, Returns_SM)</span>
<span id="cb478-80"><a href="factor-models-1.html#cb478-80" aria-hidden="true" tabindex="-1"></a>    Returns_SH_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_SH_final, Returns_SH)</span>
<span id="cb478-81"><a href="factor-models-1.html#cb478-81" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb478-82"><a href="factor-models-1.html#cb478-82" aria-hidden="true" tabindex="-1"></a>    Returns_BL_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_BL_final, Returns_BL)</span>
<span id="cb478-83"><a href="factor-models-1.html#cb478-83" aria-hidden="true" tabindex="-1"></a>    Returns_BM_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_BM_final, Returns_BM)</span>
<span id="cb478-84"><a href="factor-models-1.html#cb478-84" aria-hidden="true" tabindex="-1"></a>    Returns_BH_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_BH_final, Returns_BH)</span>
<span id="cb478-85"><a href="factor-models-1.html#cb478-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb478-86"><a href="factor-models-1.html#cb478-86" aria-hidden="true" tabindex="-1"></a>    Return_Small_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Return_Small_final, Return_Small)</span>
<span id="cb478-87"><a href="factor-models-1.html#cb478-87" aria-hidden="true" tabindex="-1"></a>    Return_Big_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Return_Big_final, Return_Big)</span>
<span id="cb478-88"><a href="factor-models-1.html#cb478-88" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb478-89"><a href="factor-models-1.html#cb478-89" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb478-90"><a href="factor-models-1.html#cb478-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-91"><a href="factor-models-1.html#cb478-91" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we create average, equally weighted returns</span></span>
<span id="cb478-92"><a href="factor-models-1.html#cb478-92" aria-hidden="true" tabindex="-1"></a>EW_Returns_SL <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_SL_final, <span class="at">na.rm =</span> T)</span>
<span id="cb478-93"><a href="factor-models-1.html#cb478-93" aria-hidden="true" tabindex="-1"></a>EW_Returns_SM <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_SM_final, <span class="at">na.rm =</span> T)</span>
<span id="cb478-94"><a href="factor-models-1.html#cb478-94" aria-hidden="true" tabindex="-1"></a>EW_Returns_SH <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_SH_final, <span class="at">na.rm =</span> T)</span>
<span id="cb478-95"><a href="factor-models-1.html#cb478-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-96"><a href="factor-models-1.html#cb478-96" aria-hidden="true" tabindex="-1"></a>EW_Returns_BL <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_BL_final, <span class="at">na.rm =</span> T)</span>
<span id="cb478-97"><a href="factor-models-1.html#cb478-97" aria-hidden="true" tabindex="-1"></a>EW_Returns_BM <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_BM_final, <span class="at">na.rm =</span> T)</span>
<span id="cb478-98"><a href="factor-models-1.html#cb478-98" aria-hidden="true" tabindex="-1"></a>EW_Returns_BH <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_BH_final, <span class="at">na.rm =</span> T)</span>
<span id="cb478-99"><a href="factor-models-1.html#cb478-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-100"><a href="factor-models-1.html#cb478-100" aria-hidden="true" tabindex="-1"></a>EW_Returns_Big <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Return_Big_final, <span class="at">na.rm =</span> T)</span>
<span id="cb478-101"><a href="factor-models-1.html#cb478-101" aria-hidden="true" tabindex="-1"></a>EW_Returns_Small <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Return_Small_final, <span class="at">na.rm =</span> T)</span>
<span id="cb478-102"><a href="factor-models-1.html#cb478-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-103"><a href="factor-models-1.html#cb478-103" aria-hidden="true" tabindex="-1"></a><span class="co"># Based on this, we can use the formula to compute the SMB and HML factors</span></span>
<span id="cb478-104"><a href="factor-models-1.html#cb478-104" aria-hidden="true" tabindex="-1"></a>SMB <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span><span class="sc">*</span>(EW_Returns_SL <span class="sc">+</span> EW_Returns_SM <span class="sc">+</span> EW_Returns_SH) <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span><span class="sc">*</span>(EW_Returns_BL <span class="sc">+</span> EW_Returns_BM <span class="sc">+</span> EW_Returns_BH)</span>
<span id="cb478-105"><a href="factor-models-1.html#cb478-105" aria-hidden="true" tabindex="-1"></a>LS_Size <span class="ot">&lt;-</span> EW_Returns_Small <span class="sc">-</span> EW_Returns_Big</span>
<span id="cb478-106"><a href="factor-models-1.html#cb478-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-107"><a href="factor-models-1.html#cb478-107" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the Cumulative Product</span></span>
<span id="cb478-108"><a href="factor-models-1.html#cb478-108" aria-hidden="true" tabindex="-1"></a>Dates <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">dmy</span>(Prices_Adj[,<span class="dv">1</span>][<span class="dv">14</span><span class="sc">:</span><span class="dv">361</span>]))</span>
<span id="cb478-109"><a href="factor-models-1.html#cb478-109" aria-hidden="true" tabindex="-1"></a>SMB_cp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(Dates,<span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">+</span>SMB), <span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">+</span>LS_Size)))</span>
<span id="cb478-110"><a href="factor-models-1.html#cb478-110" aria-hidden="true" tabindex="-1"></a>SMB_cp_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> SMB_cp[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> Dates)</span>
<span id="cb478-111"><a href="factor-models-1.html#cb478-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-112"><a href="factor-models-1.html#cb478-112" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(SMB_cp_ts) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Cumulative Return LS SMB&quot;</span>, <span class="st">&quot;Cumulative Return LS Size&quot;</span>)</span></code></pre></div>
<div id="cumulative-returns-of-the-factor-mimicking-portfolios-1" class="section level4" number="9.4.2.1">
<h4><span class="header-section-number">9.4.2.1</span> Cumulative Returns of the Factor-mimicking Portfolios</h4>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb479-1"><a href="factor-models-1.html#cb479-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot</span></span>
<span id="cb479-2"><a href="factor-models-1.html#cb479-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb479-3"><a href="factor-models-1.html#cb479-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(SMB_cp_ts) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>index,<span class="at">y=</span>value, <span class="at">color=</span>series)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb479-4"><a href="factor-models-1.html#cb479-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;tomato3&quot;</span>, <span class="st">&quot;khaki3&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>, <span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;violetred4&quot;</span>)) <span class="sc">+</span></span>
<span id="cb479-5"><a href="factor-models-1.html#cb479-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">&quot;Cumulative Returns&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Relationship of Cumulative Returns on SMB LS PF&quot;</span>) <span class="sc">+</span></span>
<span id="cb479-6"><a href="factor-models-1.html#cb479-6" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb479-7"><a href="factor-models-1.html#cb479-7" aria-hidden="true" tabindex="-1"></a><span class="at">hjust=</span><span class="fl">0.5</span>,</span>
<span id="cb479-8"><a href="factor-models-1.html#cb479-8" aria-hidden="true" tabindex="-1"></a><span class="at">lineheight=</span><span class="fl">1.2</span>), <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb479-9"><a href="factor-models-1.html#cb479-9" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb479-10"><a href="factor-models-1.html#cb479-10" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb479-11"><a href="factor-models-1.html#cb479-11" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb479-12"><a href="factor-models-1.html#cb479-12" aria-hidden="true" tabindex="-1"></a><span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb479-13"><a href="factor-models-1.html#cb479-13" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb479-14"><a href="factor-models-1.html#cb479-14" aria-hidden="true" tabindex="-1"></a><span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-278-1.png" width="672" /></p>
<p>Great! We were able to construct the size factor based on both single- and double-sorting strategy. Interestingly, we observe that the Fama-French factor shows lower cumulative returns compared to the single-sorted factor. We can assess this observation analytically. For instance, we could deconstruct the factor again into its individual constituents. Note that the main difference between both was the inclusion of a value characteristic through a B2M ratio. Apparently, this inclusion decreases the cumulative returns quite considerably from the 2000’s on. Let’s visualise this as well:</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb480-1"><a href="factor-models-1.html#cb480-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the Cumulative Product</span></span>
<span id="cb480-2"><a href="factor-models-1.html#cb480-2" aria-hidden="true" tabindex="-1"></a>Dates <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">dmy</span>(Prices_Adj[,<span class="dv">1</span>][<span class="dv">14</span><span class="sc">:</span><span class="dv">361</span>]))</span>
<span id="cb480-3"><a href="factor-models-1.html#cb480-3" aria-hidden="true" tabindex="-1"></a>SMB_cp_components <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(Dates,</span>
<span id="cb480-4"><a href="factor-models-1.html#cb480-4" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">+</span>EW_Returns_SL), </span>
<span id="cb480-5"><a href="factor-models-1.html#cb480-5" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">+</span>EW_Returns_SM), </span>
<span id="cb480-6"><a href="factor-models-1.html#cb480-6" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">+</span>EW_Returns_SH), </span>
<span id="cb480-7"><a href="factor-models-1.html#cb480-7" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">+</span>EW_Returns_BL), </span>
<span id="cb480-8"><a href="factor-models-1.html#cb480-8" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">+</span>EW_Returns_BM), </span>
<span id="cb480-9"><a href="factor-models-1.html#cb480-9" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">+</span>EW_Returns_BH)))</span>
<span id="cb480-10"><a href="factor-models-1.html#cb480-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-11"><a href="factor-models-1.html#cb480-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the xts object</span></span>
<span id="cb480-12"><a href="factor-models-1.html#cb480-12" aria-hidden="true" tabindex="-1"></a>SMB_cp_components_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> SMB_cp_components[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> Dates)</span>
<span id="cb480-13"><a href="factor-models-1.html#cb480-13" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(SMB_cp_components_ts) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Cumulative Return S/L&quot;</span>, <span class="st">&quot;Cumulative Return S/M&quot;</span>, <span class="st">&quot;Cumulative Return S/H&quot;</span>, <span class="st">&quot;Cumulative Return B/L&quot;</span>, <span class="st">&quot;Cumulative Return B/M&quot;</span>, <span class="st">&quot;Cumulative Return B/H&quot;</span>)</span>
<span id="cb480-14"><a href="factor-models-1.html#cb480-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-15"><a href="factor-models-1.html#cb480-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot for the double-sorted SMB Factor</span></span>
<span id="cb480-16"><a href="factor-models-1.html#cb480-16" aria-hidden="true" tabindex="-1"></a>SMB_plot_comp <span class="ot">&lt;-</span> <span class="fu">tidy</span>(SMB_cp_components_ts) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>index,<span class="at">y=</span>value, <span class="at">color=</span>series)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb480-17"><a href="factor-models-1.html#cb480-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>( <span class="st">&quot;khaki3&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>, <span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;tomato3&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>)) <span class="sc">+</span></span>
<span id="cb480-18"><a href="factor-models-1.html#cb480-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">&quot;Cumulative Returns&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Relationship of Cumulative Returns on SMB LS PF - Components&quot;</span>) <span class="sc">+</span></span>
<span id="cb480-19"><a href="factor-models-1.html#cb480-19" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb480-20"><a href="factor-models-1.html#cb480-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb480-21"><a href="factor-models-1.html#cb480-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb480-22"><a href="factor-models-1.html#cb480-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb480-23"><a href="factor-models-1.html#cb480-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb480-24"><a href="factor-models-1.html#cb480-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb480-25"><a href="factor-models-1.html#cb480-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb480-26"><a href="factor-models-1.html#cb480-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb480-27"><a href="factor-models-1.html#cb480-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb480-28"><a href="factor-models-1.html#cb480-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb480-29"><a href="factor-models-1.html#cb480-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb480-30"><a href="factor-models-1.html#cb480-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<pre><code>## Scale for &#39;colour&#39; is already present. Adding another scale for &#39;colour&#39;, which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb482-1"><a href="factor-models-1.html#cb482-1" aria-hidden="true" tabindex="-1"></a>SMB_plot_comp</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-279-1.png" width="672" /></p>
<p>As we can observe, by distributing the average return into its constituents, we see that average returns are mainly driven by High B2M ratios. Furthermore, we can observe that, throughout all B2M characteristics, assets with larger than median market caps outperform their smaller counterparts. Given this mononous behaviour, it is apparent that the Size factor appears to no longer hold, at least when considering the last 30 years. Furthermore, it can be shown that, although the value factor is still valid, its magnitude depends on the market capitalisation of the securities under consideration, as higher B2M ratios outperform their lower counterparts only when we control for size (for instance, the second best performing portfolio is small and high, and it greatly outperforms the big and medium B2M ratio portfolio).</p>
</div>
<div id="fama-macbeth-regression-1" class="section level4" number="9.4.2.2">
<h4><span class="header-section-number">9.4.2.2</span> Fama-MacBeth Regression</h4>
<p>We have seen the strength of the Fama-MacBeth (1973) procedure in assessing the ability of a covariate to explain movements in the cross-section of dependent returns during the application of the CAPM, where we were able to empirically prove that the movements of the market returns are unable to sufficiently explain the cross-sectional variation in asset returns. Given that the Market Return in the CAPM is nothing more than a factor itself, it is straight-forward to assume that we can replicate the procedure to include the factors under consideration.</p>
<p>However, since we are working with multiple factors, we need to generalise the formula we encountered in the previous chapter. As such, we first run a time-series regression of each asset’s excess return on the factors under consideration. That is, we run:</p>
<p><span class="math display">\[
r_{i,t} - r_{ft} = \alpha_i + \sum_{k=1}^K \beta_{i,k}f_k + \epsilon_{it}
\]</span></p>
<p>whereas <span class="math inline">\(f_k\)</span> is the k’th factor in the model.</p>
<p>Based on that, retrieve the factor loadings of each factor and perform a cross-sectional regression at each date, in which we regress the (excess) returns of each asset on the factor loadings. That is, we run:</p>
<p><span class="math display">\[
r_{i,t} - r_{ft} = \lambda_{i,0} + \sum_{k=1}^K \lambda_{i,k}\hat{\beta}_{i,k} + u_{it}
\]</span></p>
<p>This is identical to what we have seen in the previous chapter. The only difference is now that we have multiple factors. This is represented by the sum sign. This means that we take factor loading 1 to k and run, at each date, the cross-section of asset returns on the asset returns.</p>
<p>Let’s recreate the FM (1973) approach and apply it to the SMB factor.</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb483-1"><a href="factor-models-1.html#cb483-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the risk free rate as well as the Market Index</span></span>
<span id="cb483-2"><a href="factor-models-1.html#cb483-2" aria-hidden="true" tabindex="-1"></a>rf <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;~/Desktop/Master UZH/Data/A2_dataset_02.txt&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb483-3"><a href="factor-models-1.html#cb483-3" aria-hidden="true" tabindex="-1"></a>rf_sub <span class="ot">&lt;-</span> <span class="fu">subset</span>(rf, (Date <span class="sc">&gt;=</span> <span class="st">&#39;1989-12-01&#39;</span>) <span class="sc">&amp;</span> (Date <span class="sc">&lt;=</span> <span class="st">&#39;2019-12-31&#39;</span>))</span>
<span id="cb483-4"><a href="factor-models-1.html#cb483-4" aria-hidden="true" tabindex="-1"></a>rf_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(rf_sub[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> <span class="fu">as.Date</span>(<span class="fu">dmy</span>(Prices_Adj_FF[,<span class="dv">1</span>])))</span>
<span id="cb483-5"><a href="factor-models-1.html#cb483-5" aria-hidden="true" tabindex="-1"></a>rf_ts_yearly <span class="ot">&lt;-</span> rf_ts<span class="sc">$</span>SWISS.CONFEDERATION.BOND.<span class="fl">1.</span>YEAR...RED..YIELD <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb483-6"><a href="factor-models-1.html#cb483-6" aria-hidden="true" tabindex="-1"></a>rf_ts_monthly <span class="ot">&lt;-</span> ((<span class="dv">1</span> <span class="sc">+</span> rf_ts_yearly)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>) <span class="sc">-</span> <span class="dv">1</span>)[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>]</span>
<span id="cb483-7"><a href="factor-models-1.html#cb483-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(rf_ts_monthly) <span class="ot">&lt;-</span> <span class="st">&quot;rf&quot;</span></span>
<span id="cb483-8"><a href="factor-models-1.html#cb483-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-9"><a href="factor-models-1.html#cb483-9" aria-hidden="true" tabindex="-1"></a>SMI <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;~/Desktop/Master UZH/Data/A2_dataset_03.txt&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb483-10"><a href="factor-models-1.html#cb483-10" aria-hidden="true" tabindex="-1"></a>SMI_sub <span class="ot">&lt;-</span> <span class="fu">subset</span>(SMI, (Date <span class="sc">&gt;=</span> <span class="st">&#39;1989-12-01&#39;</span>) <span class="sc">&amp;</span> (Date <span class="sc">&lt;=</span> <span class="st">&#39;2019-12-31&#39;</span>))</span>
<span id="cb483-11"><a href="factor-models-1.html#cb483-11" aria-hidden="true" tabindex="-1"></a>SMI_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(SMI_sub[,<span class="dv">2</span>], <span class="at">order.by =</span> <span class="fu">as.Date</span>(<span class="fu">dmy</span>(Prices_Adj_FF[,<span class="dv">1</span>])))</span>
<span id="cb483-12"><a href="factor-models-1.html#cb483-12" aria-hidden="true" tabindex="-1"></a>SMI_ts_ret <span class="ot">&lt;-</span> <span class="fu">Return.calculate</span>(SMI_ts, <span class="at">method =</span> <span class="st">&quot;discrete&quot;</span>)</span>
<span id="cb483-13"><a href="factor-models-1.html#cb483-13" aria-hidden="true" tabindex="-1"></a>Mkt_rf_SMI <span class="ot">&lt;-</span> SMI_ts_ret[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>] <span class="sc">-</span> rf_ts_monthly[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>]</span>
<span id="cb483-14"><a href="factor-models-1.html#cb483-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Mkt_rf_SMI) <span class="ot">&lt;-</span> <span class="st">&quot;Index&quot;</span></span>
<span id="cb483-15"><a href="factor-models-1.html#cb483-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-16"><a href="factor-models-1.html#cb483-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the X and y variables for the regression</span></span>
<span id="cb483-17"><a href="factor-models-1.html#cb483-17" aria-hidden="true" tabindex="-1"></a>SPI_Index_ts <span class="ot">&lt;-</span> <span class="fu">merge.xts</span>(Returns_Adj_ts[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>], rf_ts_monthly[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>], Mkt_rf_SMI[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>], SMB)</span>
<span id="cb483-18"><a href="factor-models-1.html#cb483-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-19"><a href="factor-models-1.html#cb483-19" aria-hidden="true" tabindex="-1"></a><span class="co"># First Pass Regression</span></span>
<span id="cb483-20"><a href="factor-models-1.html#cb483-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">names</span>(SPI_Index_ts)[<span class="dv">1</span><span class="sc">:</span><span class="dv">384</span>]){</span>
<span id="cb483-21"><a href="factor-models-1.html#cb483-21" aria-hidden="true" tabindex="-1"></a>  col_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(i)</span>
<span id="cb483-22"><a href="factor-models-1.html#cb483-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the rolling window coefficients</span></span>
<span id="cb483-23"><a href="factor-models-1.html#cb483-23" aria-hidden="true" tabindex="-1"></a>  fit_roll_coefs <span class="ot">&lt;-</span> <span class="fu">summary</span>(<span class="fu">lm</span>(SPI_Index_ts[,i] <span class="sc">-</span> SPI_Index_ts[,<span class="dv">385</span>] <span class="sc">~</span> SPI_Index_ts[,<span class="dv">386</span>] <span class="sc">+</span> SPI_Index_ts[,<span class="dv">387</span>]))<span class="sc">$</span>coefficients[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb483-24"><a href="factor-models-1.html#cb483-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-25"><a href="factor-models-1.html#cb483-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="st">&#39;NESN&#39;</span>){</span>
<span id="cb483-26"><a href="factor-models-1.html#cb483-26" aria-hidden="true" tabindex="-1"></a>    col_name_final <span class="ot">&lt;-</span> col_name</span>
<span id="cb483-27"><a href="factor-models-1.html#cb483-27" aria-hidden="true" tabindex="-1"></a>    fit_roll_coefs_final_beta <span class="ot">&lt;-</span> fit_roll_coefs_beta</span>
<span id="cb483-28"><a href="factor-models-1.html#cb483-28" aria-hidden="true" tabindex="-1"></a>    fit_roll_coefs_final <span class="ot">&lt;-</span> fit_roll_coefs</span>
<span id="cb483-29"><a href="factor-models-1.html#cb483-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb483-30"><a href="factor-models-1.html#cb483-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>{</span>
<span id="cb483-31"><a href="factor-models-1.html#cb483-31" aria-hidden="true" tabindex="-1"></a>    col_name_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(col_name_final, col_name)</span>
<span id="cb483-32"><a href="factor-models-1.html#cb483-32" aria-hidden="true" tabindex="-1"></a>    fit_roll_coefs_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(fit_roll_coefs_final, fit_roll_coefs)</span>
<span id="cb483-33"><a href="factor-models-1.html#cb483-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb483-34"><a href="factor-models-1.html#cb483-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb483-35"><a href="factor-models-1.html#cb483-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-36"><a href="factor-models-1.html#cb483-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the column names</span></span>
<span id="cb483-37"><a href="factor-models-1.html#cb483-37" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(fit_roll_coefs_final) <span class="ot">&lt;-</span> col_name_final</span>
<span id="cb483-38"><a href="factor-models-1.html#cb483-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-39"><a href="factor-models-1.html#cb483-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the coefficients at each time period</span></span>
<span id="cb483-40"><a href="factor-models-1.html#cb483-40" aria-hidden="true" tabindex="-1"></a>beta_smb <span class="ot">&lt;-</span> <span class="fu">t</span>(fit_roll_coefs_final)</span>
<span id="cb483-41"><a href="factor-models-1.html#cb483-41" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(beta_smb) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;MKT_RF&quot;</span>, <span class="st">&quot;SMB&quot;</span>)</span>
<span id="cb483-42"><a href="factor-models-1.html#cb483-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-43"><a href="factor-models-1.html#cb483-43" aria-hidden="true" tabindex="-1"></a>avg_ret <span class="ot">&lt;-</span> <span class="fu">t</span>(SPI_Index_ts[,<span class="dv">1</span><span class="sc">:</span><span class="dv">384</span>])</span>
<span id="cb483-44"><a href="factor-models-1.html#cb483-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-45"><a href="factor-models-1.html#cb483-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind them together</span></span>
<span id="cb483-46"><a href="factor-models-1.html#cb483-46" aria-hidden="true" tabindex="-1"></a>second_pass_data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(beta_smb, avg_ret))</span>
<span id="cb483-47"><a href="factor-models-1.html#cb483-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-48"><a href="factor-models-1.html#cb483-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform the second pass regression</span></span>
<span id="cb483-49"><a href="factor-models-1.html#cb483-49" aria-hidden="true" tabindex="-1"></a>factors <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb483-50"><a href="factor-models-1.html#cb483-50" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">paste</span>(<span class="st">&quot;`&quot;</span>,<span class="fu">names</span>(second_pass_data[,<span class="dv">2</span><span class="sc">:</span><span class="dv">350</span>]) , <span class="st">&quot;`&quot;</span>, <span class="st">&#39; ~ MKT_RF + SMB&#39;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb483-51"><a href="factor-models-1.html#cb483-51" aria-hidden="true" tabindex="-1"></a><span class="cf">function</span>(f){ <span class="fu">lm</span>(<span class="fu">as.formula</span>(f), <span class="at">data =</span> second_pass_data) <span class="sc">%&gt;%</span>               <span class="co"># Call lm(.)</span></span>
<span id="cb483-52"><a href="factor-models-1.html#cb483-52" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">summary</span>() <span class="sc">%&gt;%</span>                                    <span class="co"># Gather the output</span></span>
<span id="cb483-53"><a href="factor-models-1.html#cb483-53" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&quot;$&quot;</span>(coef) <span class="sc">%&gt;%</span>                                    <span class="co"># Keep only the coefs</span></span>
<span id="cb483-54"><a href="factor-models-1.html#cb483-54" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span>                                 <span class="co"># Convert to dataframe</span></span>
<span id="cb483-55"><a href="factor-models-1.html#cb483-55" aria-hidden="true" tabindex="-1"></a>                         dplyr<span class="sc">::</span><span class="fu">select</span>(Estimate)}                         <span class="co"># Keep only estimates</span></span>
<span id="cb483-56"><a href="factor-models-1.html#cb483-56" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb483-57"><a href="factor-models-1.html#cb483-57" aria-hidden="true" tabindex="-1"></a>lambdas <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">unlist</span>(models), <span class="at">ncol =</span> factors <span class="sc">+</span> <span class="dv">1</span>, <span class="at">byrow =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb483-58"><a href="factor-models-1.html#cb483-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>()</span>
<span id="cb483-59"><a href="factor-models-1.html#cb483-59" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb483-60"><a href="factor-models-1.html#cb483-60" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(lambdas) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Constant&quot;</span>, <span class="st">&quot;MKT_RF&quot;</span>, <span class="st">&quot;SMB&quot;</span>)</span>
<span id="cb483-61"><a href="factor-models-1.html#cb483-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-62"><a href="factor-models-1.html#cb483-62" aria-hidden="true" tabindex="-1"></a><span class="co"># We can now calculate the respective t statistics</span></span>
<span id="cb483-63"><a href="factor-models-1.html#cb483-63" aria-hidden="true" tabindex="-1"></a>T_Period <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">names</span>(second_pass_data[,<span class="dv">2</span><span class="sc">:</span><span class="dv">350</span>]))</span>
<span id="cb483-64"><a href="factor-models-1.html#cb483-64" aria-hidden="true" tabindex="-1"></a>average <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(lambdas, <span class="at">na.rm =</span> T)</span>
<span id="cb483-65"><a href="factor-models-1.html#cb483-65" aria-hidden="true" tabindex="-1"></a>sd <span class="ot">&lt;-</span> <span class="fu">colStdevs</span>(lambdas, <span class="at">na.rm =</span> T)</span>
<span id="cb483-66"><a href="factor-models-1.html#cb483-66" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> sd <span class="sc">/</span> <span class="fu">sqrt</span>(T_Period)</span>
<span id="cb483-67"><a href="factor-models-1.html#cb483-67" aria-hidden="true" tabindex="-1"></a>t_value <span class="ot">&lt;-</span> average<span class="sc">/</span>se</span>
<span id="cb483-68"><a href="factor-models-1.html#cb483-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-69"><a href="factor-models-1.html#cb483-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a final data frame</span></span>
<span id="cb483-70"><a href="factor-models-1.html#cb483-70" aria-hidden="true" tabindex="-1"></a>second_pass <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(average, se, t_value))</span>
<span id="cb483-71"><a href="factor-models-1.html#cb483-71" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(second_pass) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Risk Premia Estimate&quot;</span>, <span class="st">&quot;Standard Error&quot;</span>, <span class="st">&quot;T-Stat&quot;</span>)</span>
<span id="cb483-72"><a href="factor-models-1.html#cb483-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb483-73"><a href="factor-models-1.html#cb483-73" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(second_pass, <span class="dv">4</span>)</span></code></pre></div>
<pre><code>##          Risk Premia Estimate Standard Error  T-Stat
## Constant              -0.0016         0.0045 -0.3631
## MKT_RF                -0.0015         0.0021 -0.7409
## SMB                    0.0063         0.0019  3.2394</code></pre>
<p>As we can see, the SMB factor is already quite successful in explaining the cross-sectional movements under consideration. However, note the following. If we leave the standard errors as is, we are highly likely to induce bias into the regression model. This is two-fold. Initially, we can refer to the usual issues in estimation accuracy based on the covariance structure of the assets under consideration. Note therein the heteroskedasticity and serial correlation assumptions we made in earlier chapters. Further, and even more worrisome, the factor loadings <span class="math inline">\(\hat{\beta}_{i,k}\)</span> are <strong>estimates</strong>. This induces a bias arising from potential selection mistakes, or measurement error, as we have discussed. Usually, we need to further correct for this by applying different sorting or standard error correction techniques (to comprehend how, please refer to Shanken (1992)).</p>
<p>Lastly, we can visualise the behavior of the factor risk premia over time. Doing so, we will make use of the following visualisation.</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb485-1"><a href="factor-models-1.html#cb485-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here, we only take from the second row onwards</span></span>
<span id="cb485-2"><a href="factor-models-1.html#cb485-2" aria-hidden="true" tabindex="-1"></a>lambdas[<span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(lambdas),] <span class="sc">%&gt;%</span> </span>
<span id="cb485-3"><a href="factor-models-1.html#cb485-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We only select the factors of interet</span></span>
<span id="cb485-4"><a href="factor-models-1.html#cb485-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(MKT_RF, SMB) <span class="sc">%&gt;%</span> </span>
<span id="cb485-5"><a href="factor-models-1.html#cb485-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We then bind the columns such that we can gather them on the same x axis</span></span>
<span id="cb485-6"><a href="factor-models-1.html#cb485-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">names</span>(second_pass_data[,<span class="dv">3</span><span class="sc">:</span><span class="dv">350</span>]))) <span class="sc">%&gt;%</span> </span>
<span id="cb485-7"><a href="factor-models-1.html#cb485-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We gather the factor and the lambda value based on each date</span></span>
<span id="cb485-8"><a href="factor-models-1.html#cb485-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> factor, <span class="at">value =</span> lambda, <span class="sc">-</span>date) <span class="sc">%&gt;%</span> </span>
<span id="cb485-9"><a href="factor-models-1.html#cb485-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Here, we just create the ggplot</span></span>
<span id="cb485-10"><a href="factor-models-1.html#cb485-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> lambda, <span class="at">color =</span> factor)) <span class="sc">+</span> </span>
<span id="cb485-11"><a href="factor-models-1.html#cb485-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">facet_grid</span>(factor<span class="sc">~</span>.) <span class="sc">+</span> </span>
<span id="cb485-12"><a href="factor-models-1.html#cb485-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;tomato3&quot;</span>, <span class="st">&quot;khaki3&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>, </span>
<span id="cb485-13"><a href="factor-models-1.html#cb485-13" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;violetred4&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb485-14"><a href="factor-models-1.html#cb485-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-281-1.png" width="672" /></p>
<p>We can observe that both factors behave somewhat dependently on each other. That is, they could potentially represent <strong>collinearity issues</strong>. Both factors compensate in an unclear aggregate effect. This highlights the usefulness of penalized estimates, a machine learning technique that is used to reduce dimensionality of a regression framework. However, it is not the aim of this course to dive into this chapter (yet).</p>
</div>
<div id="factor-competition-1" class="section level4" number="9.4.2.3">
<h4><span class="header-section-number">9.4.2.3</span> Factor Competition</h4>
<p>As we stated, the main aim of of factors is to explain the cross-section of stock returns. However, as we have shown above, there is a potential that factors are moving simultaneously. In other words, it is likely that some factors are colinear to each other. As we understand it, collinearity is an issue because it absorbs variation of a given covariate, thereby making the estimates of interest redundant. If we have a variable which can be substantially represented by another variable within our model, then the resulting framework will induce variation which does not add explanatory power to the variation of the underlying variable of interest, but only noise. Without stating the theoretical concepts of this situation, this shares great similarities with the bias-and-variance issue usually encountered in machine learning applications. Therein, by introducing highly correlated variables, we add noise to the model which, subsequently, increases the standard errors and thus reduces the precision of the estimates. In addition, Guine (2021) states that, when asset managers decompose the performance of their returns into factors, overlaps (high absolute correlations) between factors yield exposures that are less interpretable; positive and negative exposures compensate each other in an uncomprehensible, or spurious, way.</p>
<p>They state a simple protocol to account for redundant factors, by running regressions of each factor against all others. That is, you run:</p>
<p><span class="math display">\[
f_{t,k} = \alpha_{k} + \sum_{j \neq k} \delta_{k,j}f_{t,j} + \epsilon_{t,k}
\]</span></p>
<p>The authors state that the interesting metric is then the test statistic associated to the estimation of <span class="math inline">\(\alpha_k\)</span>.</p>
<ul>
<li>If <span class="math inline">\(\alpha_k\)</span> is significantly different from zero, then the cross-section of (other) factors fails to explain exhaustively the average return of factor k.</li>
<li>Otherwise, the return of the factor can be captured by exposures to the other factors and is thus redundant.</li>
</ul>
<p>We will come back to this application once we encountered and retrieved more factors for the Swiss market.</p>
</div>
</div>
<div id="how-to-create-factors-1" class="section level3" number="9.4.3">
<h3><span class="header-section-number">9.4.3</span> How to create factors</h3>
<p>We have now leveraged the linear factor model and understand how to use these models in order to evaluate variation and detect anomalies. So far, the factors that we used were already pre-defined, meaning that we had the data already and “just” had to use the factor construction strategy discussed. However, without data there is not much to compute. Consequently, in the next part, we intend to bring you closer to the actual task of retrieving data needed to construct factor mimicking portfolios and then use the steps discussed above to coherently construct the factor of interest. This will be quite helpful because it constitutes of all steps necessary to construct, apply and interpret factors (and thus resembles the day to day work within factor setting asset management companies).</p>
<p>However, a major difference to all external asset managers is that we intend not to take too long in order to retrieve the data at hand :-). As such, we will again introduce the field of the relational database computing. We have elaborated the SQL coding approach to retrieve data from a relational database. However, we now enhanced the function which automates the entire process for us such that we can now get data from CRSP, Compustat as well as Thomson Reuters / Datastream. The latter is important because it allows us to access the worldscope data base, which offers the largeest consortium of company financials as well as security characteristics for Non-US stocks.</p>
<p>The function for WRDS Database Query is the following. Again, you don’t need to know the function by heart. However, there are still multiple databases which this function cannot (yet) retrieve. Thus, if you feel like something is missing, try modifying the function and see if you are able to get what you need. Any help is certainly greatly appreciated!</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb486-1"><a href="factor-models-1.html#cb486-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function to automate the data retrieval jobs on SQL</span></span>
<span id="cb486-2"><a href="factor-models-1.html#cb486-2" aria-hidden="true" tabindex="-1"></a>dataset_a <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb486-3"><a href="factor-models-1.html#cb486-3" aria-hidden="true" tabindex="-1"></a>dataset_b <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb486-4"><a href="factor-models-1.html#cb486-4" aria-hidden="true" tabindex="-1"></a>dataset_sql <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb486-5"><a href="factor-models-1.html#cb486-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb486-6"><a href="factor-models-1.html#cb486-6" aria-hidden="true" tabindex="-1"></a>datafmt <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb486-7"><a href="factor-models-1.html#cb486-7" aria-hidden="true" tabindex="-1"></a>consol <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb486-8"><a href="factor-models-1.html#cb486-8" aria-hidden="true" tabindex="-1"></a>indfmt <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb486-9"><a href="factor-models-1.html#cb486-9" aria-hidden="true" tabindex="-1"></a>sic <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb486-10"><a href="factor-models-1.html#cb486-10" aria-hidden="true" tabindex="-1"></a>gvkey <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb486-11"><a href="factor-models-1.html#cb486-11" aria-hidden="true" tabindex="-1"></a>tic<span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb486-12"><a href="factor-models-1.html#cb486-12" aria-hidden="true" tabindex="-1"></a>cusip<span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb486-13"><a href="factor-models-1.html#cb486-13" aria-hidden="true" tabindex="-1"></a>isin <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb486-14"><a href="factor-models-1.html#cb486-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb486-15"><a href="factor-models-1.html#cb486-15" aria-hidden="true" tabindex="-1"></a>filters_list<span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb486-16"><a href="factor-models-1.html#cb486-16" aria-hidden="true" tabindex="-1"></a>filters_list_final<span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb486-17"><a href="factor-models-1.html#cb486-17" aria-hidden="true" tabindex="-1"></a>filters_list_tweaked<span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb486-18"><a href="factor-models-1.html#cb486-18" aria-hidden="true" tabindex="-1"></a>filters_list_tweaked_final<span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb486-19"><a href="factor-models-1.html#cb486-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb486-20"><a href="factor-models-1.html#cb486-20" aria-hidden="true" tabindex="-1"></a>query_sql <span class="ot">&lt;-</span></span>
<span id="cb486-21"><a href="factor-models-1.html#cb486-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(dataset_a, dataset_b, column_a, column_b, column_sql, start, end, datafmt, consol, indfmt, sic, gvkey, tic, cusip, isin, <span class="at">multi_function =</span> <span class="cn">TRUE</span>, <span class="at">reuters_ds =</span> <span class="cn">FALSE</span>){</span>
<span id="cb486-22"><a href="factor-models-1.html#cb486-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb486-23"><a href="factor-models-1.html#cb486-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (reuters_ds <span class="sc">==</span> <span class="cn">FALSE</span>){</span>
<span id="cb486-24"><a href="factor-models-1.html#cb486-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb486-25"><a href="factor-models-1.html#cb486-25" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(column_a)) {</span>
<span id="cb486-26"><a href="factor-models-1.html#cb486-26" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(column_a)) {</span>
<span id="cb486-27"><a href="factor-models-1.html#cb486-27" aria-hidden="true" tabindex="-1"></a>      column_a[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.&quot;</span>, column_a[i], <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb486-28"><a href="factor-models-1.html#cb486-28" aria-hidden="true" tabindex="-1"></a>      column_filter_a <span class="ot">=</span> <span class="fu">paste</span>(column_a, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>)</span>
<span id="cb486-29"><a href="factor-models-1.html#cb486-29" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-30"><a href="factor-models-1.html#cb486-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb486-31"><a href="factor-models-1.html#cb486-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb486-32"><a href="factor-models-1.html#cb486-32" aria-hidden="true" tabindex="-1"></a>      columns_filter_a <span class="ot">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb486-33"><a href="factor-models-1.html#cb486-33" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb486-34"><a href="factor-models-1.html#cb486-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb486-35"><a href="factor-models-1.html#cb486-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(column_b)) {</span>
<span id="cb486-36"><a href="factor-models-1.html#cb486-36" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(column_b)) {</span>
<span id="cb486-37"><a href="factor-models-1.html#cb486-37" aria-hidden="true" tabindex="-1"></a>      column_b[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;b.&quot;</span>, column_b[i], <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb486-38"><a href="factor-models-1.html#cb486-38" aria-hidden="true" tabindex="-1"></a>      column_filter_b <span class="ot">=</span> <span class="fu">paste</span>(column_b, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>)</span>
<span id="cb486-39"><a href="factor-models-1.html#cb486-39" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-40"><a href="factor-models-1.html#cb486-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb486-41"><a href="factor-models-1.html#cb486-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb486-42"><a href="factor-models-1.html#cb486-42" aria-hidden="true" tabindex="-1"></a>      columns_filter_b <span class="ot">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb486-43"><a href="factor-models-1.html#cb486-43" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb486-44"><a href="factor-models-1.html#cb486-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb486-45"><a href="factor-models-1.html#cb486-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(column_sql)) {</span>
<span id="cb486-46"><a href="factor-models-1.html#cb486-46" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(column_sql)) {</span>
<span id="cb486-47"><a href="factor-models-1.html#cb486-47" aria-hidden="true" tabindex="-1"></a>      column_sql[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;b.&quot;</span>, column_sql[i], <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb486-48"><a href="factor-models-1.html#cb486-48" aria-hidden="true" tabindex="-1"></a>      column_filter_sql <span class="ot">=</span> <span class="fu">paste</span>(column_sql, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>)</span>
<span id="cb486-49"><a href="factor-models-1.html#cb486-49" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-50"><a href="factor-models-1.html#cb486-50" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb486-51"><a href="factor-models-1.html#cb486-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb486-52"><a href="factor-models-1.html#cb486-52" aria-hidden="true" tabindex="-1"></a>      columns_filter_sql <span class="ot">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb486-53"><a href="factor-models-1.html#cb486-53" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb486-54"><a href="factor-models-1.html#cb486-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb486-55"><a href="factor-models-1.html#cb486-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(start) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(end)){</span>
<span id="cb486-56"><a href="factor-models-1.html#cb486-56" aria-hidden="true" tabindex="-1"></a>      date_filter <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.datadate BETWEEN &#39;&quot;</span>, start, <span class="st">&quot;&#39; AND &#39;&quot;</span>, end, <span class="st">&quot;&#39;&quot;</span>)</span>
<span id="cb486-57"><a href="factor-models-1.html#cb486-57" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb486-58"><a href="factor-models-1.html#cb486-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb486-59"><a href="factor-models-1.html#cb486-59" aria-hidden="true" tabindex="-1"></a>    sic_filter <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb486-60"><a href="factor-models-1.html#cb486-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(sic)) {</span>
<span id="cb486-61"><a href="factor-models-1.html#cb486-61" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sic)) {</span>
<span id="cb486-62"><a href="factor-models-1.html#cb486-62" aria-hidden="true" tabindex="-1"></a>      sic[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;&#39;&quot;</span>, sic[i], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb486-63"><a href="factor-models-1.html#cb486-63" aria-hidden="true" tabindex="-1"></a>      sic_filter <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.sic IN (&quot;</span>, <span class="fu">paste</span>(sic, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb486-64"><a href="factor-models-1.html#cb486-64" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-65"><a href="factor-models-1.html#cb486-65" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb486-66"><a href="factor-models-1.html#cb486-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb486-67"><a href="factor-models-1.html#cb486-67" aria-hidden="true" tabindex="-1"></a>    gvkey_filter <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb486-68"><a href="factor-models-1.html#cb486-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(gvkey)) {</span>
<span id="cb486-69"><a href="factor-models-1.html#cb486-69" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(gvkey)) {</span>
<span id="cb486-70"><a href="factor-models-1.html#cb486-70" aria-hidden="true" tabindex="-1"></a>      gvkey[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;&#39;&quot;</span>, gvkey[i], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb486-71"><a href="factor-models-1.html#cb486-71" aria-hidden="true" tabindex="-1"></a>      gvkey_filter <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.gvkey IN (&quot;</span>, <span class="fu">paste</span>(gvkey, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb486-72"><a href="factor-models-1.html#cb486-72" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-73"><a href="factor-models-1.html#cb486-73" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb486-74"><a href="factor-models-1.html#cb486-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb486-75"><a href="factor-models-1.html#cb486-75" aria-hidden="true" tabindex="-1"></a>    tic_filter <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb486-76"><a href="factor-models-1.html#cb486-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(tic)) {</span>
<span id="cb486-77"><a href="factor-models-1.html#cb486-77" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tic)) {</span>
<span id="cb486-78"><a href="factor-models-1.html#cb486-78" aria-hidden="true" tabindex="-1"></a>      tic[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;&#39;&quot;</span>, tic[i], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb486-79"><a href="factor-models-1.html#cb486-79" aria-hidden="true" tabindex="-1"></a>      tic_filter <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.tic IN (&quot;</span>, <span class="fu">paste</span>(tic, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb486-80"><a href="factor-models-1.html#cb486-80" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-81"><a href="factor-models-1.html#cb486-81" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb486-82"><a href="factor-models-1.html#cb486-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb486-83"><a href="factor-models-1.html#cb486-83" aria-hidden="true" tabindex="-1"></a>    cusip_filter <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb486-84"><a href="factor-models-1.html#cb486-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(cusip)) {</span>
<span id="cb486-85"><a href="factor-models-1.html#cb486-85" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cusip)) {</span>
<span id="cb486-86"><a href="factor-models-1.html#cb486-86" aria-hidden="true" tabindex="-1"></a>      cusip[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;&#39;&quot;</span>, cusip[i], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb486-87"><a href="factor-models-1.html#cb486-87" aria-hidden="true" tabindex="-1"></a>      cusip_filter <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.cusip IN (&quot;</span>, <span class="fu">paste</span>(cusip, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb486-88"><a href="factor-models-1.html#cb486-88" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-89"><a href="factor-models-1.html#cb486-89" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb486-90"><a href="factor-models-1.html#cb486-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb486-91"><a href="factor-models-1.html#cb486-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(datafmt)) {</span>
<span id="cb486-92"><a href="factor-models-1.html#cb486-92" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(datafmt)) {</span>
<span id="cb486-93"><a href="factor-models-1.html#cb486-93" aria-hidden="true" tabindex="-1"></a>      datafmt[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.datafmt =  &#39;&quot;</span>, datafmt[i], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb486-94"><a href="factor-models-1.html#cb486-94" aria-hidden="true" tabindex="-1"></a>      datafmt_filter <span class="ot">=</span> <span class="fu">paste</span>(datafmt, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>)</span>
<span id="cb486-95"><a href="factor-models-1.html#cb486-95" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb486-96"><a href="factor-models-1.html#cb486-96" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-97"><a href="factor-models-1.html#cb486-97" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb486-98"><a href="factor-models-1.html#cb486-98" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb486-99"><a href="factor-models-1.html#cb486-99" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(consol)) {</span>
<span id="cb486-100"><a href="factor-models-1.html#cb486-100" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(consol)) {</span>
<span id="cb486-101"><a href="factor-models-1.html#cb486-101" aria-hidden="true" tabindex="-1"></a>      consol[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.consol =  &#39;&quot;</span>, consol[i], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb486-102"><a href="factor-models-1.html#cb486-102" aria-hidden="true" tabindex="-1"></a>      consol_filter <span class="ot">=</span> <span class="fu">paste</span>(consol, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>)</span>
<span id="cb486-103"><a href="factor-models-1.html#cb486-103" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb486-104"><a href="factor-models-1.html#cb486-104" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-105"><a href="factor-models-1.html#cb486-105" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb486-106"><a href="factor-models-1.html#cb486-106" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb486-107"><a href="factor-models-1.html#cb486-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(indfmt)) {</span>
<span id="cb486-108"><a href="factor-models-1.html#cb486-108" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(indfmt)) {</span>
<span id="cb486-109"><a href="factor-models-1.html#cb486-109" aria-hidden="true" tabindex="-1"></a>      indfmt[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.indfmt =  &#39;&quot;</span>, indfmt[i], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb486-110"><a href="factor-models-1.html#cb486-110" aria-hidden="true" tabindex="-1"></a>      indfmt_filter <span class="ot">=</span> <span class="fu">paste</span>(indfmt, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>)</span>
<span id="cb486-111"><a href="factor-models-1.html#cb486-111" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb486-112"><a href="factor-models-1.html#cb486-112" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-113"><a href="factor-models-1.html#cb486-113" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb486-114"><a href="factor-models-1.html#cb486-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb486-115"><a href="factor-models-1.html#cb486-115" aria-hidden="true" tabindex="-1"></a>    filters <span class="ot">=</span> <span class="fu">c</span>(date_filter, cusip_filter, tic_filter, gvkey_filter, sic_filter, datafmt_filter, consol_filter, indfmt_filter)</span>
<span id="cb486-116"><a href="factor-models-1.html#cb486-116" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb486-117"><a href="factor-models-1.html#cb486-117" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(filters)){</span>
<span id="cb486-118"><a href="factor-models-1.html#cb486-118" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(filters[i])){</span>
<span id="cb486-119"><a href="factor-models-1.html#cb486-119" aria-hidden="true" tabindex="-1"></a>        filters_list[i] <span class="ot">=</span> <span class="fu">paste</span>(filters[i], <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb486-120"><a href="factor-models-1.html#cb486-120" aria-hidden="true" tabindex="-1"></a>        filters_list_final <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot; WHERE &quot;</span>, <span class="fu">paste</span>(filters_list, <span class="at">collapse =</span> <span class="st">&quot; AND &quot;</span>))</span>
<span id="cb486-121"><a href="factor-models-1.html#cb486-121" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-122"><a href="factor-models-1.html#cb486-122" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb486-123"><a href="factor-models-1.html#cb486-123" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb486-124"><a href="factor-models-1.html#cb486-124" aria-hidden="true" tabindex="-1"></a>    filters_tweaked <span class="ot">=</span> <span class="fu">c</span>(date_filter, cusip_filter, tic_filter, gvkey_filter, sic_filter)</span>
<span id="cb486-125"><a href="factor-models-1.html#cb486-125" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb486-126"><a href="factor-models-1.html#cb486-126" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(filters_tweaked[i])){</span>
<span id="cb486-127"><a href="factor-models-1.html#cb486-127" aria-hidden="true" tabindex="-1"></a>       <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(filters_tweaked)){</span>
<span id="cb486-128"><a href="factor-models-1.html#cb486-128" aria-hidden="true" tabindex="-1"></a>        filters_list_tweaked[i] <span class="ot">=</span> <span class="fu">paste</span>(filters_tweaked[i], <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb486-129"><a href="factor-models-1.html#cb486-129" aria-hidden="true" tabindex="-1"></a>        filters_list_tweaked_final <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot; WHERE &quot;</span>, <span class="fu">paste</span>(filters_list_tweaked, <span class="at">collapse =</span> <span class="st">&quot; AND &quot;</span>))</span>
<span id="cb486-130"><a href="factor-models-1.html#cb486-130" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-131"><a href="factor-models-1.html#cb486-131" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb486-132"><a href="factor-models-1.html#cb486-132" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb486-133"><a href="factor-models-1.html#cb486-133" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (multi_function <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb486-134"><a href="factor-models-1.html#cb486-134" aria-hidden="true" tabindex="-1"></a>      sql <span class="ot">=</span> (<span class="fu">paste</span>(<span class="st">&quot;SELECT &quot;</span>, </span>
<span id="cb486-135"><a href="factor-models-1.html#cb486-135" aria-hidden="true" tabindex="-1"></a>                   column_filter_a, </span>
<span id="cb486-136"><a href="factor-models-1.html#cb486-136" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;, &quot;</span>, column_filter_b,</span>
<span id="cb486-137"><a href="factor-models-1.html#cb486-137" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot; FROM  &quot;</span>, dataset_a, <span class="st">&quot; a&quot;</span>,</span>
<span id="cb486-138"><a href="factor-models-1.html#cb486-138" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot; inner join &quot;</span>, dataset_b, <span class="st">&quot; b&quot;</span>, </span>
<span id="cb486-139"><a href="factor-models-1.html#cb486-139" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot; on &quot;</span>, column_a[<span class="dv">1</span>], <span class="st">&quot; = &quot;</span>, column_sql[<span class="dv">1</span>], </span>
<span id="cb486-140"><a href="factor-models-1.html#cb486-140" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot; and &quot;</span>, column_a[<span class="dv">2</span>], <span class="st">&quot; = &quot;</span>, column_sql[<span class="dv">2</span>], </span>
<span id="cb486-141"><a href="factor-models-1.html#cb486-141" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot; and &quot;</span>, column_a[<span class="dv">3</span>], <span class="st">&quot; = &quot;</span>, column_sql[<span class="dv">3</span>],</span>
<span id="cb486-142"><a href="factor-models-1.html#cb486-142" aria-hidden="true" tabindex="-1"></a>                   filters_list_final))</span>
<span id="cb486-143"><a href="factor-models-1.html#cb486-143" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb486-144"><a href="factor-models-1.html#cb486-144" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb486-145"><a href="factor-models-1.html#cb486-145" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb486-146"><a href="factor-models-1.html#cb486-146" aria-hidden="true" tabindex="-1"></a>      sql <span class="ot">=</span> (<span class="fu">paste</span>(<span class="st">&quot;SELECT &quot;</span>, </span>
<span id="cb486-147"><a href="factor-models-1.html#cb486-147" aria-hidden="true" tabindex="-1"></a>                   column_filter_a, </span>
<span id="cb486-148"><a href="factor-models-1.html#cb486-148" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot; FROM  &quot;</span>, dataset_a, <span class="st">&quot; a&quot;</span>,</span>
<span id="cb486-149"><a href="factor-models-1.html#cb486-149" aria-hidden="true" tabindex="-1"></a>                   filters_list_tweaked_final))</span>
<span id="cb486-150"><a href="factor-models-1.html#cb486-150" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb486-151"><a href="factor-models-1.html#cb486-151" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb486-152"><a href="factor-models-1.html#cb486-152" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb486-153"><a href="factor-models-1.html#cb486-153" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb486-154"><a href="factor-models-1.html#cb486-154" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb486-155"><a href="factor-models-1.html#cb486-155" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(column_a)) {</span>
<span id="cb486-156"><a href="factor-models-1.html#cb486-156" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(column_a)) {</span>
<span id="cb486-157"><a href="factor-models-1.html#cb486-157" aria-hidden="true" tabindex="-1"></a>        column_a[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.&quot;</span>, column_a[i], <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb486-158"><a href="factor-models-1.html#cb486-158" aria-hidden="true" tabindex="-1"></a>        column_filter_a <span class="ot">=</span> <span class="fu">paste</span>(column_a, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>)</span>
<span id="cb486-159"><a href="factor-models-1.html#cb486-159" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb486-160"><a href="factor-models-1.html#cb486-160" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-161"><a href="factor-models-1.html#cb486-161" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb486-162"><a href="factor-models-1.html#cb486-162" aria-hidden="true" tabindex="-1"></a>        columns_filter_a <span class="ot">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb486-163"><a href="factor-models-1.html#cb486-163" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-164"><a href="factor-models-1.html#cb486-164" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb486-165"><a href="factor-models-1.html#cb486-165" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(column_b)) {</span>
<span id="cb486-166"><a href="factor-models-1.html#cb486-166" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(column_b)) {</span>
<span id="cb486-167"><a href="factor-models-1.html#cb486-167" aria-hidden="true" tabindex="-1"></a>        column_b[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;b.&quot;</span>, column_b[i], <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb486-168"><a href="factor-models-1.html#cb486-168" aria-hidden="true" tabindex="-1"></a>        column_filter_b <span class="ot">=</span> <span class="fu">paste</span>(column_b, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>)</span>
<span id="cb486-169"><a href="factor-models-1.html#cb486-169" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb486-170"><a href="factor-models-1.html#cb486-170" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-171"><a href="factor-models-1.html#cb486-171" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb486-172"><a href="factor-models-1.html#cb486-172" aria-hidden="true" tabindex="-1"></a>        columns_filter_b <span class="ot">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb486-173"><a href="factor-models-1.html#cb486-173" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-174"><a href="factor-models-1.html#cb486-174" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb486-175"><a href="factor-models-1.html#cb486-175" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(column_sql)) {</span>
<span id="cb486-176"><a href="factor-models-1.html#cb486-176" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(column_sql)) {</span>
<span id="cb486-177"><a href="factor-models-1.html#cb486-177" aria-hidden="true" tabindex="-1"></a>        column_sql[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;b.&quot;</span>, column_sql[i], <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb486-178"><a href="factor-models-1.html#cb486-178" aria-hidden="true" tabindex="-1"></a>        column_filter_sql <span class="ot">=</span> <span class="fu">paste</span>(column_sql, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>)</span>
<span id="cb486-179"><a href="factor-models-1.html#cb486-179" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb486-180"><a href="factor-models-1.html#cb486-180" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-181"><a href="factor-models-1.html#cb486-181" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb486-182"><a href="factor-models-1.html#cb486-182" aria-hidden="true" tabindex="-1"></a>        columns_filter_sql <span class="ot">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb486-183"><a href="factor-models-1.html#cb486-183" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-184"><a href="factor-models-1.html#cb486-184" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb486-185"><a href="factor-models-1.html#cb486-185" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(start) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(end)){</span>
<span id="cb486-186"><a href="factor-models-1.html#cb486-186" aria-hidden="true" tabindex="-1"></a>        date_filter <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.year_ BETWEEN &#39;&quot;</span>, start, <span class="st">&quot;&#39; AND &#39;&quot;</span>, end, <span class="st">&quot;&#39;&quot;</span>)</span>
<span id="cb486-187"><a href="factor-models-1.html#cb486-187" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-188"><a href="factor-models-1.html#cb486-188" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb486-189"><a href="factor-models-1.html#cb486-189" aria-hidden="true" tabindex="-1"></a>      sic_filter <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb486-190"><a href="factor-models-1.html#cb486-190" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(sic)) {</span>
<span id="cb486-191"><a href="factor-models-1.html#cb486-191" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sic)) {</span>
<span id="cb486-192"><a href="factor-models-1.html#cb486-192" aria-hidden="true" tabindex="-1"></a>        sic[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;&#39;&quot;</span>, sic[i], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb486-193"><a href="factor-models-1.html#cb486-193" aria-hidden="true" tabindex="-1"></a>        sic_filter <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.sic IN (&quot;</span>, <span class="fu">paste</span>(sic, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb486-194"><a href="factor-models-1.html#cb486-194" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb486-195"><a href="factor-models-1.html#cb486-195" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-196"><a href="factor-models-1.html#cb486-196" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb486-197"><a href="factor-models-1.html#cb486-197" aria-hidden="true" tabindex="-1"></a>      gvkey_filter <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb486-198"><a href="factor-models-1.html#cb486-198" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(gvkey)) {</span>
<span id="cb486-199"><a href="factor-models-1.html#cb486-199" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(gvkey)) {</span>
<span id="cb486-200"><a href="factor-models-1.html#cb486-200" aria-hidden="true" tabindex="-1"></a>        gvkey[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;&#39;&quot;</span>, gvkey[i], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb486-201"><a href="factor-models-1.html#cb486-201" aria-hidden="true" tabindex="-1"></a>        gvkey_filter <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.gvkey IN (&quot;</span>, <span class="fu">paste</span>(gvkey, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb486-202"><a href="factor-models-1.html#cb486-202" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb486-203"><a href="factor-models-1.html#cb486-203" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-204"><a href="factor-models-1.html#cb486-204" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb486-205"><a href="factor-models-1.html#cb486-205" aria-hidden="true" tabindex="-1"></a>      tic_filter <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb486-206"><a href="factor-models-1.html#cb486-206" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(tic)) {</span>
<span id="cb486-207"><a href="factor-models-1.html#cb486-207" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tic)) {</span>
<span id="cb486-208"><a href="factor-models-1.html#cb486-208" aria-hidden="true" tabindex="-1"></a>        tic[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;&#39;&quot;</span>, tic[i], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb486-209"><a href="factor-models-1.html#cb486-209" aria-hidden="true" tabindex="-1"></a>        tic_filter <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.item5601 IN (&quot;</span>, <span class="fu">paste</span>(tic, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb486-210"><a href="factor-models-1.html#cb486-210" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb486-211"><a href="factor-models-1.html#cb486-211" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-212"><a href="factor-models-1.html#cb486-212" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb486-213"><a href="factor-models-1.html#cb486-213" aria-hidden="true" tabindex="-1"></a>      cusip_filter <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb486-214"><a href="factor-models-1.html#cb486-214" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(cusip)) {</span>
<span id="cb486-215"><a href="factor-models-1.html#cb486-215" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cusip)) {</span>
<span id="cb486-216"><a href="factor-models-1.html#cb486-216" aria-hidden="true" tabindex="-1"></a>        cusip[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;&#39;&quot;</span>, cusip[i], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb486-217"><a href="factor-models-1.html#cb486-217" aria-hidden="true" tabindex="-1"></a>        cusip_filter <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.item6004 IN (&quot;</span>, <span class="fu">paste</span>(cusip, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb486-218"><a href="factor-models-1.html#cb486-218" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb486-219"><a href="factor-models-1.html#cb486-219" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-220"><a href="factor-models-1.html#cb486-220" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb486-221"><a href="factor-models-1.html#cb486-221" aria-hidden="true" tabindex="-1"></a>      isin_filter <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb486-222"><a href="factor-models-1.html#cb486-222" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(isin)) {</span>
<span id="cb486-223"><a href="factor-models-1.html#cb486-223" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(isin)) {</span>
<span id="cb486-224"><a href="factor-models-1.html#cb486-224" aria-hidden="true" tabindex="-1"></a>        isin[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;&#39;&quot;</span>, isin[i], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb486-225"><a href="factor-models-1.html#cb486-225" aria-hidden="true" tabindex="-1"></a>        isin_filter <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.item6008 IN (&quot;</span>, <span class="fu">paste</span>(isin, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb486-226"><a href="factor-models-1.html#cb486-226" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb486-227"><a href="factor-models-1.html#cb486-227" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-228"><a href="factor-models-1.html#cb486-228" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb486-229"><a href="factor-models-1.html#cb486-229" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb486-230"><a href="factor-models-1.html#cb486-230" aria-hidden="true" tabindex="-1"></a>      filters <span class="ot">=</span> <span class="fu">c</span>(date_filter, cusip_filter, tic_filter, gvkey_filter, sic_filter, isin_filter)</span>
<span id="cb486-231"><a href="factor-models-1.html#cb486-231" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb486-232"><a href="factor-models-1.html#cb486-232" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(filters)){</span>
<span id="cb486-233"><a href="factor-models-1.html#cb486-233" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(filters[i])){</span>
<span id="cb486-234"><a href="factor-models-1.html#cb486-234" aria-hidden="true" tabindex="-1"></a>          filters_list[i] <span class="ot">=</span> <span class="fu">paste</span>(filters[i], <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb486-235"><a href="factor-models-1.html#cb486-235" aria-hidden="true" tabindex="-1"></a>          filters_list_final <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot; WHERE &quot;</span>, <span class="fu">paste</span>(filters_list, <span class="at">collapse =</span> <span class="st">&quot; AND &quot;</span>))</span>
<span id="cb486-236"><a href="factor-models-1.html#cb486-236" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb486-237"><a href="factor-models-1.html#cb486-237" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-238"><a href="factor-models-1.html#cb486-238" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb486-239"><a href="factor-models-1.html#cb486-239" aria-hidden="true" tabindex="-1"></a>      filters_tweaked <span class="ot">=</span> <span class="fu">c</span>(date_filter, cusip_filter, tic_filter, gvkey_filter, sic_filter, isin_filter)</span>
<span id="cb486-240"><a href="factor-models-1.html#cb486-240" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb486-241"><a href="factor-models-1.html#cb486-241" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(filters_tweaked[i])){</span>
<span id="cb486-242"><a href="factor-models-1.html#cb486-242" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(filters_tweaked)){</span>
<span id="cb486-243"><a href="factor-models-1.html#cb486-243" aria-hidden="true" tabindex="-1"></a>          filters_list_tweaked[i] <span class="ot">=</span> <span class="fu">paste</span>(filters_tweaked[i], <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb486-244"><a href="factor-models-1.html#cb486-244" aria-hidden="true" tabindex="-1"></a>          filters_list_tweaked_final <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot; WHERE &quot;</span>, <span class="fu">paste</span>(filters_list_tweaked, <span class="at">collapse =</span> <span class="st">&quot; AND &quot;</span>))</span>
<span id="cb486-245"><a href="factor-models-1.html#cb486-245" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb486-246"><a href="factor-models-1.html#cb486-246" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-247"><a href="factor-models-1.html#cb486-247" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb486-248"><a href="factor-models-1.html#cb486-248" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (multi_function <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb486-249"><a href="factor-models-1.html#cb486-249" aria-hidden="true" tabindex="-1"></a>        sql <span class="ot">=</span> (<span class="fu">paste</span>(<span class="st">&quot;SELECT &quot;</span>, </span>
<span id="cb486-250"><a href="factor-models-1.html#cb486-250" aria-hidden="true" tabindex="-1"></a>                     column_filter_a, </span>
<span id="cb486-251"><a href="factor-models-1.html#cb486-251" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;, &quot;</span>, column_filter_b,</span>
<span id="cb486-252"><a href="factor-models-1.html#cb486-252" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot; FROM  &quot;</span>, dataset_a, <span class="st">&quot; a&quot;</span>,</span>
<span id="cb486-253"><a href="factor-models-1.html#cb486-253" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot; inner join &quot;</span>, dataset_b, <span class="st">&quot; b&quot;</span>, </span>
<span id="cb486-254"><a href="factor-models-1.html#cb486-254" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot; on &quot;</span>, column_a[<span class="dv">1</span>], <span class="st">&quot; = &quot;</span>, column_sql[<span class="dv">1</span>], </span>
<span id="cb486-255"><a href="factor-models-1.html#cb486-255" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot; and &quot;</span>, column_a[<span class="dv">2</span>], <span class="st">&quot; = &quot;</span>, column_sql[<span class="dv">2</span>], </span>
<span id="cb486-256"><a href="factor-models-1.html#cb486-256" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot; and &quot;</span>, column_a[<span class="dv">3</span>], <span class="st">&quot; = &quot;</span>, column_sql[<span class="dv">3</span>],</span>
<span id="cb486-257"><a href="factor-models-1.html#cb486-257" aria-hidden="true" tabindex="-1"></a>                     filters_list_final))</span>
<span id="cb486-258"><a href="factor-models-1.html#cb486-258" aria-hidden="true" tabindex="-1"></a>      } </span>
<span id="cb486-259"><a href="factor-models-1.html#cb486-259" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb486-260"><a href="factor-models-1.html#cb486-260" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb486-261"><a href="factor-models-1.html#cb486-261" aria-hidden="true" tabindex="-1"></a>        sql <span class="ot">=</span> (<span class="fu">paste</span>(<span class="st">&quot;SELECT &quot;</span>, </span>
<span id="cb486-262"><a href="factor-models-1.html#cb486-262" aria-hidden="true" tabindex="-1"></a>                     column_filter_a, </span>
<span id="cb486-263"><a href="factor-models-1.html#cb486-263" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot; FROM  &quot;</span>, dataset_a, <span class="st">&quot; a&quot;</span>,</span>
<span id="cb486-264"><a href="factor-models-1.html#cb486-264" aria-hidden="true" tabindex="-1"></a>                     filters_list_tweaked_final))</span>
<span id="cb486-265"><a href="factor-models-1.html#cb486-265" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb486-266"><a href="factor-models-1.html#cb486-266" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb486-267"><a href="factor-models-1.html#cb486-267" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb486-268"><a href="factor-models-1.html#cb486-268" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb487-1"><a href="factor-models-1.html#cb487-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the connection </span></span>
<span id="cb487-2"><a href="factor-models-1.html#cb487-2" aria-hidden="true" tabindex="-1"></a>wrds <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(<span class="fu">Postgres</span>(),</span>
<span id="cb487-3"><a href="factor-models-1.html#cb487-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">host=</span><span class="st">&#39;wrds-pgdata.wharton.upenn.edu&#39;</span>,</span>
<span id="cb487-4"><a href="factor-models-1.html#cb487-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">port=</span><span class="dv">9737</span>,</span>
<span id="cb487-5"><a href="factor-models-1.html#cb487-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dbname=</span><span class="st">&#39;wrds&#39;</span>,</span>
<span id="cb487-6"><a href="factor-models-1.html#cb487-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sslmode=</span><span class="st">&#39;require&#39;</span>,</span>
<span id="cb487-7"><a href="factor-models-1.html#cb487-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">user=</span><span class="st">&#39;gostlow&#39;</span>,</span>
<span id="cb487-8"><a href="factor-models-1.html#cb487-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">password =</span> <span class="st">&quot;climaterisk8K&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb488-1"><a href="factor-models-1.html#cb488-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s now retrieve some data to construct additional factors. We already did so for the SMB and HML factor. Let&#39;s try to replicate the CMA and RMW factors. The RMW is based on the Operating Profitability of an asset. It is defined as revenues minus the cost of goods sold, interest expenses, selling, general, and administrative expenses divided by the book equity. The CMA is defined as Investment based on the asset under consideration. It is defined as the ratio of total assets of a stock at the fiscal year end of t−1 and the total assets at fiscal year end of t−2.</span></span>
<span id="cb488-2"><a href="factor-models-1.html#cb488-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-3"><a href="factor-models-1.html#cb488-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Consequently, we require the following accounting data to construct RMW as well as CMA factor: </span></span>
<span id="cb488-4"><a href="factor-models-1.html#cb488-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-5"><a href="factor-models-1.html#cb488-5" aria-hidden="true" tabindex="-1"></a><span class="do">## RMW </span></span>
<span id="cb488-6"><a href="factor-models-1.html#cb488-6" aria-hidden="true" tabindex="-1"></a><span class="do">### - Annual Revenue </span></span>
<span id="cb488-7"><a href="factor-models-1.html#cb488-7" aria-hidden="true" tabindex="-1"></a><span class="do">### - COGS </span></span>
<span id="cb488-8"><a href="factor-models-1.html#cb488-8" aria-hidden="true" tabindex="-1"></a><span class="do">### - Interest Expenses</span></span>
<span id="cb488-9"><a href="factor-models-1.html#cb488-9" aria-hidden="true" tabindex="-1"></a><span class="do">### - Selling, General and Administrative Expenses</span></span>
<span id="cb488-10"><a href="factor-models-1.html#cb488-10" aria-hidden="true" tabindex="-1"></a><span class="do">### - Book Equity (which we already calculated)</span></span>
<span id="cb488-11"><a href="factor-models-1.html#cb488-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-12"><a href="factor-models-1.html#cb488-12" aria-hidden="true" tabindex="-1"></a><span class="do">## CMA</span></span>
<span id="cb488-13"><a href="factor-models-1.html#cb488-13" aria-hidden="true" tabindex="-1"></a><span class="do">### - Total Assets t-1 </span></span>
<span id="cb488-14"><a href="factor-models-1.html#cb488-14" aria-hidden="true" tabindex="-1"></a><span class="do">### - Total Assets t-2 </span></span>
<span id="cb488-15"><a href="factor-models-1.html#cb488-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-16"><a href="factor-models-1.html#cb488-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Remember the complicated looking function we introduced somewhere in the first exercise session(s) to retrieve the Database Query. Well, now we can finally make use of it. </span></span>
<span id="cb488-17"><a href="factor-models-1.html#cb488-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-18"><a href="factor-models-1.html#cb488-18" aria-hidden="true" tabindex="-1"></a>tic <span class="ot">&lt;-</span> <span class="fu">names</span>(Prices_Adj_ts)</span>
<span id="cb488-19"><a href="factor-models-1.html#cb488-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-20"><a href="factor-models-1.html#cb488-20" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the first database, used for the keys from the fundamentals annually list</span></span>
<span id="cb488-21"><a href="factor-models-1.html#cb488-21" aria-hidden="true" tabindex="-1"></a>column_a <span class="ot">=</span> <span class="fu">list</span>(<span class="st">&#39;year_&#39;</span>, <span class="st">&#39;seq&#39;</span>, <span class="st">&#39;code&#39;</span>, <span class="st">&#39;item5601&#39;</span>, <span class="st">&#39;item6008&#39;</span>, <span class="st">&#39;item6004&#39;</span>, <span class="st">&#39;item6035&#39;</span>, <span class="st">&#39;item6038&#39;</span>, </span>
<span id="cb488-22"><a href="factor-models-1.html#cb488-22" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;item1001&#39;</span>, <span class="st">&#39;item1051&#39;</span>, <span class="st">&#39;item1084&#39;</span>, <span class="st">&#39;item1100&#39;</span>, <span class="st">&#39;item1101&#39;</span>, <span class="st">&#39;item1148&#39;</span>, <span class="st">&#39;item1249&#39;</span>, <span class="st">&#39;item1250&#39;</span>, <span class="st">&#39;item1251&#39;</span>, </span>
<span id="cb488-23"><a href="factor-models-1.html#cb488-23" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;item1401&#39;</span>, <span class="st">&#39;item1451&#39;</span>, <span class="st">&#39;item1751&#39;</span>, <span class="st">&#39;item18175&#39;</span>, <span class="st">&#39;item18191&#39;</span>, <span class="st">&#39;item2201&#39;</span>, <span class="st">&#39;item3101&#39;</span>, <span class="st">&#39;item3255&#39;</span>, <span class="st">&#39;item2999&#39;</span>,</span>
<span id="cb488-24"><a href="factor-models-1.html#cb488-24" aria-hidden="true" tabindex="-1"></a>                <span class="st">&#39;item3351&#39;</span>, <span class="st">&#39;item3501&#39;</span>)</span>
<span id="cb488-25"><a href="factor-models-1.html#cb488-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-26"><a href="factor-models-1.html#cb488-26" aria-hidden="true" tabindex="-1"></a><span class="co"># This is to connect the both databases without duplicating their output in the end</span></span>
<span id="cb488-27"><a href="factor-models-1.html#cb488-27" aria-hidden="true" tabindex="-1"></a>column_sql <span class="ot">=</span> <span class="fu">list</span>(<span class="st">&#39;year_&#39;</span>, <span class="st">&#39;seq&#39;</span>, <span class="st">&#39;code&#39;</span>)</span>
<span id="cb488-28"><a href="factor-models-1.html#cb488-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-29"><a href="factor-models-1.html#cb488-29" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the second database, used for the keys from the securities monthly list</span></span>
<span id="cb488-30"><a href="factor-models-1.html#cb488-30" aria-hidden="true" tabindex="-1"></a>column_b <span class="ot">=</span> <span class="fu">list</span>(<span class="st">&#39;item5476&#39;</span>, <span class="st">&#39;item5301&#39;</span>) <span class="co"># Book Value per Share + Shares Outstanding</span></span>
<span id="cb488-31"><a href="factor-models-1.html#cb488-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-32"><a href="factor-models-1.html#cb488-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the quarterly data on company financials</span></span>
<span id="cb488-33"><a href="factor-models-1.html#cb488-33" aria-hidden="true" tabindex="-1"></a>query <span class="ot">=</span> <span class="fu">query_sql</span>(<span class="at">dataset_a =</span> <span class="st">&quot;tr_worldscope.wrds_ws_funda&quot;</span>,</span>
<span id="cb488-34"><a href="factor-models-1.html#cb488-34" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dataset_b =</span> <span class="st">&quot;tr_worldscope.wrds_ws_stock&quot;</span>,</span>
<span id="cb488-35"><a href="factor-models-1.html#cb488-35" aria-hidden="true" tabindex="-1"></a>                  <span class="at">multi_function =</span> T,</span>
<span id="cb488-36"><a href="factor-models-1.html#cb488-36" aria-hidden="true" tabindex="-1"></a>                  <span class="at">reuters_ds =</span> T,</span>
<span id="cb488-37"><a href="factor-models-1.html#cb488-37" aria-hidden="true" tabindex="-1"></a>                  <span class="at">column_a =</span> column_a,</span>
<span id="cb488-38"><a href="factor-models-1.html#cb488-38" aria-hidden="true" tabindex="-1"></a>                  <span class="at">column_b =</span> column_b,</span>
<span id="cb488-39"><a href="factor-models-1.html#cb488-39" aria-hidden="true" tabindex="-1"></a>                  <span class="at">column_sql =</span> column_sql,</span>
<span id="cb488-40"><a href="factor-models-1.html#cb488-40" aria-hidden="true" tabindex="-1"></a>                  <span class="at">gvkey =</span> gvkey,</span>
<span id="cb488-41"><a href="factor-models-1.html#cb488-41" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sic =</span> sic,</span>
<span id="cb488-42"><a href="factor-models-1.html#cb488-42" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tic =</span> tic,</span>
<span id="cb488-43"><a href="factor-models-1.html#cb488-43" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cusip =</span> cusip, </span>
<span id="cb488-44"><a href="factor-models-1.html#cb488-44" aria-hidden="true" tabindex="-1"></a>                  <span class="at">isin =</span> isin,</span>
<span id="cb488-45"><a href="factor-models-1.html#cb488-45" aria-hidden="true" tabindex="-1"></a>                  <span class="at">datafmt =</span> <span class="cn">NULL</span>, </span>
<span id="cb488-46"><a href="factor-models-1.html#cb488-46" aria-hidden="true" tabindex="-1"></a>                  <span class="at">consol =</span> <span class="st">&#39;C&#39;</span>, </span>
<span id="cb488-47"><a href="factor-models-1.html#cb488-47" aria-hidden="true" tabindex="-1"></a>                  <span class="at">indfmt =</span> <span class="st">&#39;INDL&#39;</span>,</span>
<span id="cb488-48"><a href="factor-models-1.html#cb488-48" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start =</span> <span class="st">&#39;1989&#39;</span>,</span>
<span id="cb488-49"><a href="factor-models-1.html#cb488-49" aria-hidden="true" tabindex="-1"></a>                  <span class="at">end =</span> <span class="st">&#39;2020&#39;</span>) </span>
<span id="cb488-50"><a href="factor-models-1.html#cb488-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-51"><a href="factor-models-1.html#cb488-51" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">dbSendQuery</span>(wrds, query)</span>
<span id="cb488-52"><a href="factor-models-1.html#cb488-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-53"><a href="factor-models-1.html#cb488-53" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">dbFetch</span>(res)</span>
<span id="cb488-54"><a href="factor-models-1.html#cb488-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-55"><a href="factor-models-1.html#cb488-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Give the correct variable names</span></span>
<span id="cb488-56"><a href="factor-models-1.html#cb488-56" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data) <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="st">&#39;Year_t&#39;</span>, <span class="st">&#39;Seq&#39;</span>, <span class="st">&#39;Code&#39;</span>, <span class="st">&#39;Ticker&#39;</span>, <span class="st">&#39;ISIN&#39;</span>, <span class="st">&#39;CUSIP&#39;</span>, <span class="st">&#39;WorldScope_Ident&#39;</span>, <span class="st">&#39;IBES_tic&#39;</span>, </span>
<span id="cb488-57"><a href="factor-models-1.html#cb488-57" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&#39;Revenue_Tot&#39;</span>, <span class="st">&#39;COGS_wo_dep&#39;</span>, <span class="st">&#39;Staff_Exp&#39;</span>, <span class="st">&#39;Gross_Income&#39;</span>, <span class="st">&#39;SGAE&#39;</span>, <span class="st">&#39;Depreciation&#39;</span>, <span class="st">&#39;Oper_Exp_Tot&#39;</span>, <span class="st">&#39;Oper_Inc_Tot&#39;</span>, <span class="st">&#39;Interest_Exp&#39;</span>,</span>
<span id="cb488-58"><a href="factor-models-1.html#cb488-58" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&#39;Pretax_Income&#39;</span>, <span class="st">&#39;Taxes&#39;</span>, <span class="st">&#39;Net_Income&#39;</span>, <span class="st">&#39;Ordinary_Profit&#39;</span>, <span class="st">&#39;EBIT&#39;</span>, <span class="st">&#39;Current_Assets&#39;</span>, <span class="st">&#39;Current_Liab&#39;</span>, <span class="st">&#39;Total_Debt&#39;</span>,</span>
<span id="cb488-59"><a href="factor-models-1.html#cb488-59" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&#39;Total_Liab&#39;</span>, <span class="st">&#39;Common_Equity&#39;</span>, <span class="st">&#39;Total_Assets&#39;</span>, <span class="st">&#39;Book_Value_per_Share&#39;</span>, <span class="st">&#39;Shares_Outst&#39;</span>)</span>
<span id="cb488-60"><a href="factor-models-1.html#cb488-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-61"><a href="factor-models-1.html#cb488-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Only get Swiss companies </span></span>
<span id="cb488-62"><a href="factor-models-1.html#cb488-62" aria-hidden="true" tabindex="-1"></a>CH_data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb488-63"><a href="factor-models-1.html#cb488-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">country =</span> <span class="fu">substr</span>(data<span class="sc">$</span>ISIN,<span class="dv">1</span>,<span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb488-64"><a href="factor-models-1.html#cb488-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(country <span class="sc">==</span> <span class="st">&quot;CH&quot;</span>) </span>
<span id="cb488-65"><a href="factor-models-1.html#cb488-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-66"><a href="factor-models-1.html#cb488-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-67"><a href="factor-models-1.html#cb488-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove duplicated observations based on the Code and Year combination </span></span>
<span id="cb488-68"><a href="factor-models-1.html#cb488-68" aria-hidden="true" tabindex="-1"></a>CH_data <span class="ot">&lt;-</span> CH_data[<span class="sc">!</span><span class="fu">duplicated</span>(CH_data[<span class="fu">c</span>(<span class="st">&#39;Year_t&#39;</span>, <span class="st">&#39;Code&#39;</span>)]),]</span>
<span id="cb488-69"><a href="factor-models-1.html#cb488-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-70"><a href="factor-models-1.html#cb488-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the Operating Profitability and the Investment accounting numbers</span></span>
<span id="cb488-71"><a href="factor-models-1.html#cb488-71" aria-hidden="true" tabindex="-1"></a>CH_data <span class="ot">&lt;-</span> CH_data <span class="sc">%&gt;%</span> </span>
<span id="cb488-72"><a href="factor-models-1.html#cb488-72" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create both the Book Value and Operating Profitability Variable</span></span>
<span id="cb488-73"><a href="factor-models-1.html#cb488-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Book_Value =</span> Total_Assets <span class="sc">*</span> Total_Liab, </span>
<span id="cb488-74"><a href="factor-models-1.html#cb488-74" aria-hidden="true" tabindex="-1"></a>         <span class="at">Oper_Profitability =</span> (Revenue_Tot <span class="sc">-</span> COGS_wo_dep <span class="sc">-</span> Interest_Exp <span class="sc">-</span> SGAE) <span class="sc">/</span> Book_Value) <span class="sc">%&gt;%</span> </span>
<span id="cb488-75"><a href="factor-models-1.html#cb488-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Code) <span class="sc">%&gt;%</span> </span>
<span id="cb488-76"><a href="factor-models-1.html#cb488-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the Investments variable</span></span>
<span id="cb488-77"><a href="factor-models-1.html#cb488-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Investments =</span> Total_Assets <span class="sc">/</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(Total_Assets, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">default =</span> <span class="cn">NA</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb488-78"><a href="factor-models-1.html#cb488-78" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Delete potential duplicate Ticker entries which were incorrectly downloaded from Thompson Reuters Data Stream b/c there were multiple code numbers </span></span>
<span id="cb488-79"><a href="factor-models-1.html#cb488-79" aria-hidden="true" tabindex="-1"></a>  <span class="co"># associated with the same Ticker symbol (e.g. Nestle had 4 code numbers associated with &quot;NESN&quot; and thus it retrieved 4 times the entire time-series, but </span></span>
<span id="cb488-80"><a href="factor-models-1.html#cb488-80" aria-hidden="true" tabindex="-1"></a>  <span class="co"># only in one of those four codes the data was available, for the rest it was only NA values)</span></span>
<span id="cb488-81"><a href="factor-models-1.html#cb488-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Oper_Inv_Dummy =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(Oper_Profitability) <span class="sc">|</span> <span class="sc">!</span><span class="fu">is.na</span>(Investments), <span class="dv">1</span>, <span class="dv">0</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb488-82"><a href="factor-models-1.html#cb488-82" aria-hidden="true" tabindex="-1"></a>  <span class="co"># By defining a dummy which is 1 if either Investment or Oper. Profitability is not NA, we indirectly can source for the Code-Ticker combinations which were </span></span>
<span id="cb488-83"><a href="factor-models-1.html#cb488-83" aria-hidden="true" tabindex="-1"></a>  <span class="co"># duplicated and just had NA values in each row. This is b/c then we know that it has neither entry necessary to compute either characteristic and must </span></span>
<span id="cb488-84"><a href="factor-models-1.html#cb488-84" aria-hidden="true" tabindex="-1"></a>  <span class="co"># thus be a redundant row</span></span>
<span id="cb488-85"><a href="factor-models-1.html#cb488-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(Oper_Inv_Dummy <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb488-86"><a href="factor-models-1.html#cb488-86" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Now, we need to create the date variable as we have upsampled the entire time-series from yearly to monthly intervals</span></span>
<span id="cb488-87"><a href="factor-models-1.html#cb488-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Year_t, Code) <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(), <span class="fu">first</span>(<span class="dv">12</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb488-88"><a href="factor-models-1.html#cb488-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month_t =</span> <span class="fu">c</span>(<span class="dv">01</span>, <span class="dv">02</span>, <span class="dv">03</span>, <span class="dv">04</span>, <span class="dv">05</span>, <span class="dv">06</span>, <span class="dv">07</span>, <span class="dv">08</span>, <span class="dv">09</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>), </span>
<span id="cb488-89"><a href="factor-models-1.html#cb488-89" aria-hidden="true" tabindex="-1"></a>         <span class="at">Day_t =</span> <span class="fu">c</span>(<span class="dv">01</span>, <span class="dv">01</span>, <span class="dv">01</span>, <span class="dv">01</span>, <span class="dv">01</span>, <span class="dv">01</span>, <span class="dv">01</span>, <span class="dv">01</span>, <span class="dv">01</span>, <span class="dv">01</span>, <span class="dv">01</span>, <span class="dv">01</span>), </span>
<span id="cb488-90"><a href="factor-models-1.html#cb488-90" aria-hidden="true" tabindex="-1"></a>         <span class="at">Date_t =</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(Year_t,Month_t,Day_t,<span class="at">sep=</span><span class="st">&quot;-&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb488-91"><a href="factor-models-1.html#cb488-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb488-92"><a href="factor-models-1.html#cb488-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-93"><a href="factor-models-1.html#cb488-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, in order to create the portfolios we have two options. The first is to transform the document into a wide format for both factors and then obtain a data frame with the same dimensions as the previous data frames. From there on, we can repeat the steps as previously for computing the factors of interest. The second would be to remain in this format. For that, we would need to additionally download the monthly stock prices, adjust the dates to get start-of-the-month dates and then merge the stock prices with the stock characteristics. This is the more feasible approach if we have a high-dimensional set of characteristics (e.g. we want to create a multitude of factors since there we would have many stock characteristics in one file). </span></span>
<span id="cb488-94"><a href="factor-models-1.html#cb488-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-95"><a href="factor-models-1.html#cb488-95" aria-hidden="true" tabindex="-1"></a><span class="co"># We will first show you the common approach. </span></span>
<span id="cb488-96"><a href="factor-models-1.html#cb488-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-97"><a href="factor-models-1.html#cb488-97" aria-hidden="true" tabindex="-1"></a><span class="do">## First, create long dataframes only for the Operating Profitability and Investments data</span></span>
<span id="cb488-98"><a href="factor-models-1.html#cb488-98" aria-hidden="true" tabindex="-1"></a>CH_data_Oper_Profit <span class="ot">&lt;-</span> CH_data <span class="sc">%&gt;%</span> </span>
<span id="cb488-99"><a href="factor-models-1.html#cb488-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(Date_t, Ticker, Oper_Profitability))</span>
<span id="cb488-100"><a href="factor-models-1.html#cb488-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-101"><a href="factor-models-1.html#cb488-101" aria-hidden="true" tabindex="-1"></a>CH_data_Inv <span class="ot">&lt;-</span> CH_data <span class="sc">%&gt;%</span> </span>
<span id="cb488-102"><a href="factor-models-1.html#cb488-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(Date_t, Ticker, Investments))</span>
<span id="cb488-103"><a href="factor-models-1.html#cb488-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-104"><a href="factor-models-1.html#cb488-104" aria-hidden="true" tabindex="-1"></a><span class="do">## Then, based on that, use the spread function to create a wide dataframe</span></span>
<span id="cb488-105"><a href="factor-models-1.html#cb488-105" aria-hidden="true" tabindex="-1"></a>Oper_Profit <span class="ot">&lt;-</span> <span class="fu">spread</span>(CH_data_Oper_Profit, <span class="at">key =</span> Ticker, <span class="at">value =</span> Oper_Profitability)</span>
<span id="cb488-106"><a href="factor-models-1.html#cb488-106" aria-hidden="true" tabindex="-1"></a>Oper_Profit <span class="ot">&lt;-</span> Oper_Profit[<span class="dv">12</span><span class="sc">:</span><span class="dv">384</span>,]</span>
<span id="cb488-107"><a href="factor-models-1.html#cb488-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-108"><a href="factor-models-1.html#cb488-108" aria-hidden="true" tabindex="-1"></a>Investment <span class="ot">&lt;-</span> <span class="fu">spread</span>(CH_data_Inv, <span class="at">key =</span> Ticker, <span class="at">value =</span> Investments)</span>
<span id="cb488-109"><a href="factor-models-1.html#cb488-109" aria-hidden="true" tabindex="-1"></a>Investment <span class="ot">&lt;-</span> Investment[<span class="dv">12</span><span class="sc">:</span><span class="dv">384</span>,]</span>
<span id="cb488-110"><a href="factor-models-1.html#cb488-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb488-111"><a href="factor-models-1.html#cb488-111" aria-hidden="true" tabindex="-1"></a><span class="do">## Create Time-Series Objects </span></span>
<span id="cb488-112"><a href="factor-models-1.html#cb488-112" aria-hidden="true" tabindex="-1"></a>Oper_Profit_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(Oper_Profit[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> <span class="fu">as.Date</span>(<span class="fu">as.character</span>(Oper_Profit<span class="sc">$</span>Date_t)))</span>
<span id="cb488-113"><a href="factor-models-1.html#cb488-113" aria-hidden="true" tabindex="-1"></a>Investment_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(Investment[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> <span class="fu">as.Date</span>(<span class="fu">as.character</span>(Investment<span class="sc">$</span>Date_t)))</span></code></pre></div>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb489-1"><a href="factor-models-1.html#cb489-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Now, we can perform the same steps as before. But note that, since datastream only provided us with 308 of 384 stocks, we first need to slice the dataframe according to the stocks which are available. Otherwise the dimensions of both data frames will not match and we cannot perform any time-series wise operations.</span></span>
<span id="cb489-2"><a href="factor-models-1.html#cb489-2" aria-hidden="true" tabindex="-1"></a>Prices_Adj_FF <span class="ot">&lt;-</span> Prices_Adj <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(Date, <span class="fu">names</span>(Oper_Profit_ts)))</span>
<span id="cb489-3"><a href="factor-models-1.html#cb489-3" aria-hidden="true" tabindex="-1"></a>Prices_Unadj_FF <span class="ot">&lt;-</span> Prices_Unadj <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(Date, <span class="fu">names</span>(Oper_Profit_ts)))</span>
<span id="cb489-4"><a href="factor-models-1.html#cb489-4" aria-hidden="true" tabindex="-1"></a>Shares_FF <span class="ot">&lt;-</span> Shares <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(Date, <span class="fu">names</span>(Oper_Profit_ts)))</span>
<span id="cb489-5"><a href="factor-models-1.html#cb489-5" aria-hidden="true" tabindex="-1"></a>Book_FF <span class="ot">&lt;-</span> Book <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(Date, <span class="fu">names</span>(Oper_Profit_ts)))</span>
<span id="cb489-6"><a href="factor-models-1.html#cb489-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-7"><a href="factor-models-1.html#cb489-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Time-Series objects again</span></span>
<span id="cb489-8"><a href="factor-models-1.html#cb489-8" aria-hidden="true" tabindex="-1"></a>Prices_Adj_FF_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(Prices_Adj_FF[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> <span class="fu">as.Date</span>(<span class="fu">dmy</span>(Prices_Adj_FF[,<span class="dv">1</span>])))</span>
<span id="cb489-9"><a href="factor-models-1.html#cb489-9" aria-hidden="true" tabindex="-1"></a>Prices_Adj_FF_ts<span class="sc">$</span>Index <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Prices_Adj_FF_ts, <span class="at">na.rm =</span> T)</span>
<span id="cb489-10"><a href="factor-models-1.html#cb489-10" aria-hidden="true" tabindex="-1"></a>Prices_Unadj_FF_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> Prices_Unadj_FF[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> <span class="fu">as.Date</span>(<span class="fu">dmy</span>(Prices_Unadj_FF[,<span class="dv">1</span>])))</span>
<span id="cb489-11"><a href="factor-models-1.html#cb489-11" aria-hidden="true" tabindex="-1"></a>Shares_FF_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> Shares_FF[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> <span class="fu">as.Date</span>(<span class="fu">dmy</span>(Shares_FF[,<span class="dv">1</span>])))</span>
<span id="cb489-12"><a href="factor-models-1.html#cb489-12" aria-hidden="true" tabindex="-1"></a>Book_FF_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> Book_FF[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> <span class="fu">as.Date</span>(<span class="fu">dmy</span>(Book_FF[,<span class="dv">1</span>])))</span>
<span id="cb489-13"><a href="factor-models-1.html#cb489-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-14"><a href="factor-models-1.html#cb489-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Do the same for the rf</span></span>
<span id="cb489-15"><a href="factor-models-1.html#cb489-15" aria-hidden="true" tabindex="-1"></a>rf <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;~/Desktop/Master UZH/Data/A2_dataset_02.txt&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb489-16"><a href="factor-models-1.html#cb489-16" aria-hidden="true" tabindex="-1"></a>rf_sub <span class="ot">&lt;-</span> <span class="fu">subset</span>(rf, (Date <span class="sc">&gt;=</span> <span class="st">&#39;1989-12-01&#39;</span>) <span class="sc">&amp;</span> (Date <span class="sc">&lt;=</span> <span class="st">&#39;2019-12-31&#39;</span>))</span>
<span id="cb489-17"><a href="factor-models-1.html#cb489-17" aria-hidden="true" tabindex="-1"></a>rf_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(rf_sub[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> <span class="fu">as.Date</span>(<span class="fu">dmy</span>(Prices_Adj_FF[,<span class="dv">1</span>])))</span>
<span id="cb489-18"><a href="factor-models-1.html#cb489-18" aria-hidden="true" tabindex="-1"></a>rf_ts_yearly <span class="ot">&lt;-</span> rf_ts<span class="sc">$</span>SWISS.CONFEDERATION.BOND.<span class="fl">1.</span>YEAR...RED..YIELD <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb489-19"><a href="factor-models-1.html#cb489-19" aria-hidden="true" tabindex="-1"></a>rf_ts_monthly <span class="ot">&lt;-</span> ((<span class="dv">1</span> <span class="sc">+</span> rf_ts_yearly)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb489-20"><a href="factor-models-1.html#cb489-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-21"><a href="factor-models-1.html#cb489-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the new return again </span></span>
<span id="cb489-22"><a href="factor-models-1.html#cb489-22" aria-hidden="true" tabindex="-1"></a>Returns_Adj_ts <span class="ot">&lt;-</span> <span class="fu">Return.calculate</span>(Prices_Adj_FF_ts, <span class="at">method =</span> <span class="st">&quot;discrete&quot;</span>)[,<span class="sc">-</span><span class="dv">301</span>]</span>
<span id="cb489-23"><a href="factor-models-1.html#cb489-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-24"><a href="factor-models-1.html#cb489-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the Market return</span></span>
<span id="cb489-25"><a href="factor-models-1.html#cb489-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Returns_Index_Adj_ts &lt;- Return.calculate(Prices_Adj_FF_ts, method = &quot;discrete&quot;)[,301]</span></span>
<span id="cb489-26"><a href="factor-models-1.html#cb489-26" aria-hidden="true" tabindex="-1"></a><span class="co"># returns_Index_rf_Adj_ts &lt;- Returns_Index_Adj_ts - rf_ts_monthly</span></span>
<span id="cb489-27"><a href="factor-models-1.html#cb489-27" aria-hidden="true" tabindex="-1"></a>SMI <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;~/Desktop/Master UZH/Data/A2_dataset_03.txt&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb489-28"><a href="factor-models-1.html#cb489-28" aria-hidden="true" tabindex="-1"></a>SMI_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(SMI[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> <span class="fu">as.Date</span>(SMI[,<span class="dv">1</span>]))</span>
<span id="cb489-29"><a href="factor-models-1.html#cb489-29" aria-hidden="true" tabindex="-1"></a>SMI_ts_ret <span class="ot">&lt;-</span> <span class="fu">Return.calculate</span>(stocks_SMI_ts, <span class="at">method =</span> <span class="st">&quot;discrete&quot;</span>)</span>
<span id="cb489-30"><a href="factor-models-1.html#cb489-30" aria-hidden="true" tabindex="-1"></a>returns_Index_rf_Adj_ts <span class="ot">&lt;-</span> SMI_ts_ret <span class="sc">-</span> rf_ts_monthly</span>
<span id="cb489-31"><a href="factor-models-1.html#cb489-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-32"><a href="factor-models-1.html#cb489-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind all three variables</span></span>
<span id="cb489-33"><a href="factor-models-1.html#cb489-33" aria-hidden="true" tabindex="-1"></a>BAB_CH_var <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_Adj_ts, Returns_Index_rf_Adj_ts, rf_ts_monthly)</span>
<span id="cb489-34"><a href="factor-models-1.html#cb489-34" aria-hidden="true" tabindex="-1"></a>BAB_CH_var<span class="sc">$</span>rf <span class="ot">&lt;-</span> BAB_CH_var<span class="sc">$</span>SWISS.CONFEDERATION.BOND.<span class="fl">1.</span>YEAR...RED..YIELD</span>
<span id="cb489-35"><a href="factor-models-1.html#cb489-35" aria-hidden="true" tabindex="-1"></a>BAB_CH_var<span class="sc">$</span>SWISS.CONFEDERATION.BOND.<span class="fl">1.</span>YEAR...RED..YIELD <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb489-36"><a href="factor-models-1.html#cb489-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-37"><a href="factor-models-1.html#cb489-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the market cap Time-Series</span></span>
<span id="cb489-38"><a href="factor-models-1.html#cb489-38" aria-hidden="true" tabindex="-1"></a>Market_Cap_FF_ts <span class="ot">&lt;-</span> Shares_FF_ts <span class="sc">*</span> Prices_Unadj_FF_ts</span>
<span id="cb489-39"><a href="factor-models-1.html#cb489-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-40"><a href="factor-models-1.html#cb489-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the Book-to-Market ratio</span></span>
<span id="cb489-41"><a href="factor-models-1.html#cb489-41" aria-hidden="true" tabindex="-1"></a>B2M_FF_ts <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(Book_FF_ts, <span class="dv">6</span>) <span class="sc">/</span> Market_Cap_FF_ts</span>
<span id="cb489-42"><a href="factor-models-1.html#cb489-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-43"><a href="factor-models-1.html#cb489-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the Return for the Momentum Factor</span></span>
<span id="cb489-44"><a href="factor-models-1.html#cb489-44" aria-hidden="true" tabindex="-1"></a>Mom_FF_ts <span class="ot">&lt;-</span> (Prices_Adj_FF_ts <span class="sc">-</span> stats<span class="sc">::</span><span class="fu">lag</span>(Prices_Adj_FF_ts, <span class="dv">11</span>)) <span class="sc">/</span> stats<span class="sc">::</span><span class="fu">lag</span>(Prices_Adj_FF_ts, <span class="dv">11</span>)</span>
<span id="cb489-45"><a href="factor-models-1.html#cb489-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-46"><a href="factor-models-1.html#cb489-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the Beta values</span></span>
<span id="cb489-47"><a href="factor-models-1.html#cb489-47" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">names</span>(Market_Cap_FF_ts)){</span>
<span id="cb489-48"><a href="factor-models-1.html#cb489-48" aria-hidden="true" tabindex="-1"></a>  col_name <span class="ot">&lt;-</span> <span class="fu">paste0</span>(i)</span>
<span id="cb489-49"><a href="factor-models-1.html#cb489-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb489-50"><a href="factor-models-1.html#cb489-50" aria-hidden="true" tabindex="-1"></a>  fit_roll_coefs <span class="ot">&lt;-</span> <span class="fu">roll_lm</span>(BAB_CH_var<span class="sc">$</span>Index[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>], BAB_CH_var[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>, i] <span class="sc">-</span> BAB_CH_var<span class="sc">$</span>rf[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>], <span class="at">width =</span> <span class="dv">60</span>)<span class="sc">$</span>coefficients[<span class="dv">60</span><span class="sc">:</span><span class="fu">dim</span>(BAB_CH_var<span class="sc">$</span>Index[<span class="st">&#39;1991-01-01/2019-12-01&#39;</span>]),<span class="dv">2</span>]</span>
<span id="cb489-51"><a href="factor-models-1.html#cb489-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb489-52"><a href="factor-models-1.html#cb489-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="st">&#39;ABBN&#39;</span>){</span>
<span id="cb489-53"><a href="factor-models-1.html#cb489-53" aria-hidden="true" tabindex="-1"></a>    col_name_final <span class="ot">&lt;-</span> col_name</span>
<span id="cb489-54"><a href="factor-models-1.html#cb489-54" aria-hidden="true" tabindex="-1"></a>    fit_roll_coefs_final <span class="ot">&lt;-</span> fit_roll_coefs</span>
<span id="cb489-55"><a href="factor-models-1.html#cb489-55" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb489-56"><a href="factor-models-1.html#cb489-56" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span>{</span>
<span id="cb489-57"><a href="factor-models-1.html#cb489-57" aria-hidden="true" tabindex="-1"></a>    col_name_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(col_name_final, col_name)</span>
<span id="cb489-58"><a href="factor-models-1.html#cb489-58" aria-hidden="true" tabindex="-1"></a>    fit_roll_coefs_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(fit_roll_coefs_final, fit_roll_coefs)</span>
<span id="cb489-59"><a href="factor-models-1.html#cb489-59" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb489-60"><a href="factor-models-1.html#cb489-60" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb489-61"><a href="factor-models-1.html#cb489-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-62"><a href="factor-models-1.html#cb489-62" aria-hidden="true" tabindex="-1"></a>Beta_factors_ts <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(fit_roll_coefs_final)</span>
<span id="cb489-63"><a href="factor-models-1.html#cb489-63" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(Beta_factors_ts) <span class="ot">&lt;-</span> col_name_final</span>
<span id="cb489-64"><a href="factor-models-1.html#cb489-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the cut-off points of each factor composite </span></span>
<span id="cb489-65"><a href="factor-models-1.html#cb489-65" aria-hidden="true" tabindex="-1"></a><span class="do">## For the Market Cap</span></span>
<span id="cb489-66"><a href="factor-models-1.html#cb489-66" aria-hidden="true" tabindex="-1"></a>Market_Cap_ts_Median_Cutoff <span class="ot">&lt;-</span> matrixStats<span class="sc">::</span><span class="fu">rowMedians</span>(Market_Cap_FF_ts, <span class="at">na.rm =</span> T)</span>
<span id="cb489-67"><a href="factor-models-1.html#cb489-67" aria-hidden="true" tabindex="-1"></a><span class="do">## For the HML</span></span>
<span id="cb489-68"><a href="factor-models-1.html#cb489-68" aria-hidden="true" tabindex="-1"></a>B2M_Low_Cutoff <span class="ot">&lt;-</span> matrixStats<span class="sc">::</span><span class="fu">rowQuantiles</span>(<span class="fu">as.matrix</span>(B2M_FF_ts), <span class="at">probs =</span> <span class="fl">0.3</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb489-69"><a href="factor-models-1.html#cb489-69" aria-hidden="true" tabindex="-1"></a>B2M_High_Cutoff <span class="ot">&lt;-</span> matrixStats<span class="sc">::</span><span class="fu">rowQuantiles</span>(<span class="fu">as.matrix</span>(B2M_FF_ts), <span class="at">probs =</span> <span class="fl">0.7</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb489-70"><a href="factor-models-1.html#cb489-70" aria-hidden="true" tabindex="-1"></a>B2M_Mid_Cutoff <span class="ot">&lt;-</span> matrixStats<span class="sc">::</span><span class="fu">rowQuantiles</span>(<span class="fu">as.matrix</span>(B2M_FF_ts), <span class="at">probs =</span> <span class="fl">0.5</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb489-71"><a href="factor-models-1.html#cb489-71" aria-hidden="true" tabindex="-1"></a><span class="do">## For the Operating Profitability (=OP)</span></span>
<span id="cb489-72"><a href="factor-models-1.html#cb489-72" aria-hidden="true" tabindex="-1"></a>OP_Low_Cutoff <span class="ot">&lt;-</span> matrixStats<span class="sc">::</span><span class="fu">rowQuantiles</span>(<span class="fu">as.matrix</span>(Oper_Profit_ts), <span class="at">probs =</span> <span class="fl">0.3</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb489-73"><a href="factor-models-1.html#cb489-73" aria-hidden="true" tabindex="-1"></a>OP_High_Cutoff <span class="ot">&lt;-</span> matrixStats<span class="sc">::</span><span class="fu">rowQuantiles</span>(<span class="fu">as.matrix</span>(Oper_Profit_ts), <span class="at">probs =</span> <span class="fl">0.7</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb489-74"><a href="factor-models-1.html#cb489-74" aria-hidden="true" tabindex="-1"></a><span class="do">## For the Investment (Inv)</span></span>
<span id="cb489-75"><a href="factor-models-1.html#cb489-75" aria-hidden="true" tabindex="-1"></a>Inv_Low_Cutoff <span class="ot">&lt;-</span> matrixStats<span class="sc">::</span><span class="fu">rowQuantiles</span>(<span class="fu">as.matrix</span>(Investment_ts), <span class="at">probs =</span> <span class="fl">0.3</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb489-76"><a href="factor-models-1.html#cb489-76" aria-hidden="true" tabindex="-1"></a>Inv_High_Cutoff <span class="ot">&lt;-</span> matrixStats<span class="sc">::</span><span class="fu">rowQuantiles</span>(<span class="fu">as.matrix</span>(Investment_ts), <span class="at">probs =</span> <span class="fl">0.7</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb489-77"><a href="factor-models-1.html#cb489-77" aria-hidden="true" tabindex="-1"></a>Inv_Mid_Cutoff <span class="ot">&lt;-</span> matrixStats<span class="sc">::</span><span class="fu">rowQuantiles</span>(<span class="fu">as.matrix</span>(Investment_ts), <span class="at">probs =</span> <span class="fl">0.5</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb489-78"><a href="factor-models-1.html#cb489-78" aria-hidden="true" tabindex="-1"></a><span class="do">## For the Momentum (Mom)</span></span>
<span id="cb489-79"><a href="factor-models-1.html#cb489-79" aria-hidden="true" tabindex="-1"></a>Mom_Low_Cutoff <span class="ot">&lt;-</span> matrixStats<span class="sc">::</span><span class="fu">rowQuantiles</span>(<span class="fu">as.matrix</span>(Mom_FF_ts), <span class="at">probs =</span> <span class="fl">0.3</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb489-80"><a href="factor-models-1.html#cb489-80" aria-hidden="true" tabindex="-1"></a>Mom_High_Cutoff <span class="ot">&lt;-</span> matrixStats<span class="sc">::</span><span class="fu">rowQuantiles</span>(<span class="fu">as.matrix</span>(Mom_FF_ts), <span class="at">probs =</span> <span class="fl">0.7</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb489-81"><a href="factor-models-1.html#cb489-81" aria-hidden="true" tabindex="-1"></a>MOM_Mid_Cutoff <span class="ot">&lt;-</span> matrixStats<span class="sc">::</span><span class="fu">rowQuantiles</span>(<span class="fu">as.matrix</span>(Mom_FF_ts), <span class="at">probs =</span> <span class="fl">0.5</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb489-82"><a href="factor-models-1.html#cb489-82" aria-hidden="true" tabindex="-1"></a><span class="do">## For the BAB factor (BAB)</span></span>
<span id="cb489-83"><a href="factor-models-1.html#cb489-83" aria-hidden="true" tabindex="-1"></a>BAB_Low_Cutoff <span class="ot">&lt;-</span> matrixStats<span class="sc">::</span><span class="fu">rowQuantiles</span>(<span class="fu">as.matrix</span>(Beta_factors), <span class="at">probs =</span> <span class="fl">0.3</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb489-84"><a href="factor-models-1.html#cb489-84" aria-hidden="true" tabindex="-1"></a>BAB_Mid_Cutoff <span class="ot">&lt;-</span> matrixStats<span class="sc">::</span><span class="fu">rowQuantiles</span>(<span class="fu">as.matrix</span>(Beta_factors), <span class="at">probs =</span> <span class="fl">0.5</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb489-85"><a href="factor-models-1.html#cb489-85" aria-hidden="true" tabindex="-1"></a>BAB_High_Cutoff <span class="ot">&lt;-</span> matrixStats<span class="sc">::</span><span class="fu">rowQuantiles</span>(<span class="fu">as.matrix</span>(Beta_factors), <span class="at">probs =</span> <span class="fl">0.7</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb489-86"><a href="factor-models-1.html#cb489-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-87"><a href="factor-models-1.html#cb489-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Based on the Cutoff values, generate dummies that indicate whether a certain data point is within a given cutoff level</span></span>
<span id="cb489-88"><a href="factor-models-1.html#cb489-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-89"><a href="factor-models-1.html#cb489-89" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">names</span>(Market_Cap_FF_ts)){</span>
<span id="cb489-90"><a href="factor-models-1.html#cb489-90" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the indicator variables</span></span>
<span id="cb489-91"><a href="factor-models-1.html#cb489-91" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For the Market Cap</span></span>
<span id="cb489-92"><a href="factor-models-1.html#cb489-92" aria-hidden="true" tabindex="-1"></a>  Market_Cap_Small <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Market_Cap_FF_ts[, i] <span class="sc">&lt;=</span> Market_Cap_ts_Median_Cutoff, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-93"><a href="factor-models-1.html#cb489-93" aria-hidden="true" tabindex="-1"></a>  Market_Cap_Big <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Market_Cap_FF_ts[, i] <span class="sc">&gt;</span> Market_Cap_ts_Median_Cutoff, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-94"><a href="factor-models-1.html#cb489-94" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For the B2M Ratio</span></span>
<span id="cb489-95"><a href="factor-models-1.html#cb489-95" aria-hidden="true" tabindex="-1"></a>  B2M_Low <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(B2M_FF_ts[, i] <span class="sc">&lt;=</span> B2M_Low_Cutoff, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-96"><a href="factor-models-1.html#cb489-96" aria-hidden="true" tabindex="-1"></a>  B2M_Mid <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((B2M_FF_ts[, i] <span class="sc">&gt;</span> B2M_Low_Cutoff) <span class="sc">&amp;</span> (B2M_FF_ts[, i] <span class="sc">&lt;=</span> B2M_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-97"><a href="factor-models-1.html#cb489-97" aria-hidden="true" tabindex="-1"></a>  B2M_High <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(B2M_FF_ts[, i] <span class="sc">&gt;</span> B2M_High_Cutoff, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-98"><a href="factor-models-1.html#cb489-98" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For the OP </span></span>
<span id="cb489-99"><a href="factor-models-1.html#cb489-99" aria-hidden="true" tabindex="-1"></a>  OP_Weak <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Oper_Profit_ts[, i] <span class="sc">&lt;=</span> OP_Low_Cutoff, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-100"><a href="factor-models-1.html#cb489-100" aria-hidden="true" tabindex="-1"></a>  OP_Mid <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Oper_Profit_ts[, i] <span class="sc">&gt;</span> OP_Low_Cutoff) <span class="sc">&amp;</span> (Oper_Profit_ts[, i] <span class="sc">&lt;=</span> OP_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-101"><a href="factor-models-1.html#cb489-101" aria-hidden="true" tabindex="-1"></a>  OP_Robust <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Oper_Profit_ts[, i] <span class="sc">&gt;</span> OP_High_Cutoff, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-102"><a href="factor-models-1.html#cb489-102" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For the Inv </span></span>
<span id="cb489-103"><a href="factor-models-1.html#cb489-103" aria-hidden="true" tabindex="-1"></a>  Inv_Cons <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Investment_ts[, i] <span class="sc">&lt;=</span> Inv_Low_Cutoff, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-104"><a href="factor-models-1.html#cb489-104" aria-hidden="true" tabindex="-1"></a>  Inv_Mid <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Investment_ts[, i] <span class="sc">&gt;</span> Inv_Low_Cutoff) <span class="sc">&amp;</span> (Investment_ts[, i] <span class="sc">&lt;=</span> Inv_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-105"><a href="factor-models-1.html#cb489-105" aria-hidden="true" tabindex="-1"></a>  Inv_Aggres <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Investment_ts[, i] <span class="sc">&gt;</span> Inv_High_Cutoff, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-106"><a href="factor-models-1.html#cb489-106" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For the Mom</span></span>
<span id="cb489-107"><a href="factor-models-1.html#cb489-107" aria-hidden="true" tabindex="-1"></a>  Mom_Lose <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Mom_FF_ts[,i] <span class="sc">&lt;=</span> Mom_Low_Cutoff, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-108"><a href="factor-models-1.html#cb489-108" aria-hidden="true" tabindex="-1"></a>  Mom_Mid <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Mom_FF_ts[, i] <span class="sc">&gt;</span> Mom_Low_Cutoff) <span class="sc">&amp;</span> (Mom_FF_ts[, i] <span class="sc">&lt;=</span> Mom_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-109"><a href="factor-models-1.html#cb489-109" aria-hidden="true" tabindex="-1"></a>  Mom_Win <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Mom_FF_ts[,i] <span class="sc">&gt;</span> Mom_High_Cutoff, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-110"><a href="factor-models-1.html#cb489-110" aria-hidden="true" tabindex="-1"></a>  <span class="co"># For the BAB</span></span>
<span id="cb489-111"><a href="factor-models-1.html#cb489-111" aria-hidden="true" tabindex="-1"></a>  BAB_Lowvol <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Beta_factors_ts[,i] <span class="sc">&lt;=</span> BAB_Low_Cutoff, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-112"><a href="factor-models-1.html#cb489-112" aria-hidden="true" tabindex="-1"></a>  BAB_Highvol <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Beta_factors_ts[,i] <span class="sc">&gt;</span> BAB_High_Cutoff, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-113"><a href="factor-models-1.html#cb489-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-114"><a href="factor-models-1.html#cb489-114" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Further Checks</span></span>
<span id="cb489-115"><a href="factor-models-1.html#cb489-115" aria-hidden="true" tabindex="-1"></a>  Mom_Test_Down <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Mom_FF_ts[,i] <span class="sc">&lt;=</span> MOM_Mid_Cutoff, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-116"><a href="factor-models-1.html#cb489-116" aria-hidden="true" tabindex="-1"></a>  Mom_Test_Up <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(Mom_FF_ts[,i] <span class="sc">&gt;</span> MOM_Mid_Cutoff, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-117"><a href="factor-models-1.html#cb489-117" aria-hidden="true" tabindex="-1"></a>  B2M_Test_High <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(B2M_FF_ts[,i] <span class="sc">&gt;</span> B2M_Mid_Cutoff, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-118"><a href="factor-models-1.html#cb489-118" aria-hidden="true" tabindex="-1"></a>  B2M_Test_Low <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(B2M_FF_ts[,i] <span class="sc">&lt;=</span> B2M_Mid_Cutoff, <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-119"><a href="factor-models-1.html#cb489-119" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb489-120"><a href="factor-models-1.html#cb489-120" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For the interaction indicator variables to get S/L, S/M, S/H &amp; B/L, B/M, B/H</span></span>
<span id="cb489-121"><a href="factor-models-1.html#cb489-121" aria-hidden="true" tabindex="-1"></a>  <span class="do">### For the B2M Interaction</span></span>
<span id="cb489-122"><a href="factor-models-1.html#cb489-122" aria-hidden="true" tabindex="-1"></a>  Assets_SL_B2M <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_FF_ts[, i] <span class="sc">&lt;=</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (B2M_FF_ts[, i] <span class="sc">&lt;=</span> B2M_Low_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-123"><a href="factor-models-1.html#cb489-123" aria-hidden="true" tabindex="-1"></a>  Assets_SM_B2M<span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_FF_ts[, i] <span class="sc">&lt;=</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (B2M_FF_ts[, i] <span class="sc">&gt;</span> B2M_Low_Cutoff) <span class="sc">&amp;</span> (B2M_ts[, i] <span class="sc">&lt;=</span> B2M_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-124"><a href="factor-models-1.html#cb489-124" aria-hidden="true" tabindex="-1"></a>  Assets_SH_B2M <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_FF_ts[, i] <span class="sc">&lt;=</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (B2M_FF_ts[, i] <span class="sc">&gt;</span> B2M_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-125"><a href="factor-models-1.html#cb489-125" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb489-126"><a href="factor-models-1.html#cb489-126" aria-hidden="true" tabindex="-1"></a>  Assets_BL_B2M <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_FF_ts[, i] <span class="sc">&gt;</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (B2M_FF_ts[, i] <span class="sc">&lt;=</span> B2M_Low_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-127"><a href="factor-models-1.html#cb489-127" aria-hidden="true" tabindex="-1"></a>  Assets_BM_B2M <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_FF_ts[, i] <span class="sc">&gt;</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (B2M_FF_ts[, i] <span class="sc">&gt;</span> B2M_Low_Cutoff) <span class="sc">&amp;</span> (B2M_ts[, i] <span class="sc">&lt;=</span> B2M_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-128"><a href="factor-models-1.html#cb489-128" aria-hidden="true" tabindex="-1"></a>  Assets_BH_B2M <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_FF_ts[, i] <span class="sc">&gt;</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (B2M_FF_ts[, i] <span class="sc">&gt;</span> B2M_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-129"><a href="factor-models-1.html#cb489-129" aria-hidden="true" tabindex="-1"></a>  <span class="do">### For the RMW Interaction</span></span>
<span id="cb489-130"><a href="factor-models-1.html#cb489-130" aria-hidden="true" tabindex="-1"></a>  Assets_SL_OP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_FF_ts[, i] <span class="sc">&lt;=</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (Oper_Profit_ts[, i] <span class="sc">&lt;=</span> OP_Low_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-131"><a href="factor-models-1.html#cb489-131" aria-hidden="true" tabindex="-1"></a>  Assets_SM_OP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_FF_ts[, i] <span class="sc">&lt;=</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (Oper_Profit_ts[, i] <span class="sc">&gt;</span> OP_Low_Cutoff) <span class="sc">&amp;</span> (Oper_Profit_ts[, i] <span class="sc">&lt;=</span> OP_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-132"><a href="factor-models-1.html#cb489-132" aria-hidden="true" tabindex="-1"></a>  Assets_SH_OP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_FF_ts[, i] <span class="sc">&lt;=</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (Oper_Profit_ts[, i] <span class="sc">&gt;</span> OP_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-133"><a href="factor-models-1.html#cb489-133" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb489-134"><a href="factor-models-1.html#cb489-134" aria-hidden="true" tabindex="-1"></a>  Assets_BL_OP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_FF_ts[, i] <span class="sc">&gt;</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (Oper_Profit_ts[, i] <span class="sc">&lt;=</span> OP_Low_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-135"><a href="factor-models-1.html#cb489-135" aria-hidden="true" tabindex="-1"></a>  Assets_BM_OP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_FF_ts[, i] <span class="sc">&gt;</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (Oper_Profit_ts[, i] <span class="sc">&gt;</span> OP_Low_Cutoff) <span class="sc">&amp;</span> (Oper_Profit_ts[, i] <span class="sc">&lt;=</span> OP_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-136"><a href="factor-models-1.html#cb489-136" aria-hidden="true" tabindex="-1"></a>  Assets_BH_OP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_FF_ts[, i] <span class="sc">&gt;</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (Oper_Profit_ts[, i] <span class="sc">&gt;</span> OP_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-137"><a href="factor-models-1.html#cb489-137" aria-hidden="true" tabindex="-1"></a>  <span class="do">### For the CMA Interaction</span></span>
<span id="cb489-138"><a href="factor-models-1.html#cb489-138" aria-hidden="true" tabindex="-1"></a>  Assets_SL_Inv <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_FF_ts[, i] <span class="sc">&lt;=</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (Investment_ts[, i] <span class="sc">&lt;=</span> Inv_Low_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-139"><a href="factor-models-1.html#cb489-139" aria-hidden="true" tabindex="-1"></a>  Assets_SM_Inv <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_FF_ts[, i] <span class="sc">&lt;=</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (Investment_ts[, i] <span class="sc">&gt;</span> Inv_Low_Cutoff) <span class="sc">&amp;</span> (Investment_ts[, i] <span class="sc">&lt;=</span> Inv_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-140"><a href="factor-models-1.html#cb489-140" aria-hidden="true" tabindex="-1"></a>  Assets_SH_Inv <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_FF_ts[, i] <span class="sc">&lt;=</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (Investment_ts[, i] <span class="sc">&gt;</span> Inv_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-141"><a href="factor-models-1.html#cb489-141" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb489-142"><a href="factor-models-1.html#cb489-142" aria-hidden="true" tabindex="-1"></a>  Assets_BL_Inv <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_FF_ts[, i] <span class="sc">&gt;</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (Investment_ts[, i] <span class="sc">&lt;=</span> Inv_Low_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-143"><a href="factor-models-1.html#cb489-143" aria-hidden="true" tabindex="-1"></a>  Assets_BM_Inv <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_FF_ts[, i] <span class="sc">&gt;</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (Investment_ts[, i] <span class="sc">&gt;</span> Inv_Low_Cutoff) <span class="sc">&amp;</span> (Investment_ts[, i] <span class="sc">&lt;=</span> Inv_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-144"><a href="factor-models-1.html#cb489-144" aria-hidden="true" tabindex="-1"></a>  Assets_BH_Inv <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_FF_ts[, i] <span class="sc">&gt;</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (Investment_ts[, i] <span class="sc">&gt;</span> Inv_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-145"><a href="factor-models-1.html#cb489-145" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For the MOM Interaction</span></span>
<span id="cb489-146"><a href="factor-models-1.html#cb489-146" aria-hidden="true" tabindex="-1"></a>  Assets_SL_Mom <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_FF_ts[, i] <span class="sc">&lt;=</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (Mom_FF_ts[, i] <span class="sc">&lt;=</span> Mom_Low_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-147"><a href="factor-models-1.html#cb489-147" aria-hidden="true" tabindex="-1"></a>  Assets_SM_Mom <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_FF_ts[, i] <span class="sc">&lt;=</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (Mom_FF_ts[, i] <span class="sc">&gt;</span> Mom_Low_Cutoff) <span class="sc">&amp;</span> (Mom_FF_ts[, i] <span class="sc">&lt;=</span> Mom_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-148"><a href="factor-models-1.html#cb489-148" aria-hidden="true" tabindex="-1"></a>  Assets_SH_Mom <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_FF_ts[, i] <span class="sc">&lt;=</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (Mom_FF_ts[, i] <span class="sc">&gt;</span> Mom_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-149"><a href="factor-models-1.html#cb489-149" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb489-150"><a href="factor-models-1.html#cb489-150" aria-hidden="true" tabindex="-1"></a>  Assets_BL_Mom <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_FF_ts[, i] <span class="sc">&gt;</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (Mom_FF_ts[, i] <span class="sc">&lt;=</span> Mom_Low_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-151"><a href="factor-models-1.html#cb489-151" aria-hidden="true" tabindex="-1"></a>  Assets_BM_Mom <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_FF_ts[, i] <span class="sc">&gt;</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (Mom_FF_ts[, i] <span class="sc">&gt;</span> Mom_Low_Cutoff) <span class="sc">&amp;</span> (Mom_FF_ts[, i] <span class="sc">&lt;=</span> Mom_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-152"><a href="factor-models-1.html#cb489-152" aria-hidden="true" tabindex="-1"></a>  Assets_BH_Mom <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((Market_Cap_FF_ts[, i] <span class="sc">&gt;</span> Market_Cap_ts_Median_Cutoff) <span class="sc">&amp;</span> (Mom_FF_ts[, i] <span class="sc">&gt;</span> Mom_High_Cutoff), <span class="dv">1</span>, <span class="cn">NA</span>)</span>
<span id="cb489-153"><a href="factor-models-1.html#cb489-153" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb489-154"><a href="factor-models-1.html#cb489-154" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the returns</span></span>
<span id="cb489-155"><a href="factor-models-1.html#cb489-155" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For the B2M </span></span>
<span id="cb489-156"><a href="factor-models-1.html#cb489-156" aria-hidden="true" tabindex="-1"></a>  Return_Low <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(B2M_Low, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-157"><a href="factor-models-1.html#cb489-157" aria-hidden="true" tabindex="-1"></a>  Return_Mid <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(B2M_Mid, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-158"><a href="factor-models-1.html#cb489-158" aria-hidden="true" tabindex="-1"></a>  Return_High <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(B2M_High, <span class="dv">1</span>)<span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-159"><a href="factor-models-1.html#cb489-159" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For the OP </span></span>
<span id="cb489-160"><a href="factor-models-1.html#cb489-160" aria-hidden="true" tabindex="-1"></a>  Return_Weak <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(OP_Weak, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-161"><a href="factor-models-1.html#cb489-161" aria-hidden="true" tabindex="-1"></a>  Return_Mid_OP <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(OP_Mid, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-162"><a href="factor-models-1.html#cb489-162" aria-hidden="true" tabindex="-1"></a>  Return_Robust <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(OP_Robust, <span class="dv">1</span>)<span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-011/2019-12-01&#39;</span>, i]</span>
<span id="cb489-163"><a href="factor-models-1.html#cb489-163" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For the Inv </span></span>
<span id="cb489-164"><a href="factor-models-1.html#cb489-164" aria-hidden="true" tabindex="-1"></a>  Return_Weak <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(Inv_Cons, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-165"><a href="factor-models-1.html#cb489-165" aria-hidden="true" tabindex="-1"></a>  Return_Mid_Inv <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(Inv_Mid, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-166"><a href="factor-models-1.html#cb489-166" aria-hidden="true" tabindex="-1"></a>  Return_Robust <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(Inv_Aggres, <span class="dv">1</span>)<span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-012019-12-01&#39;</span>, i]</span>
<span id="cb489-167"><a href="factor-models-1.html#cb489-167" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For the Mom</span></span>
<span id="cb489-168"><a href="factor-models-1.html#cb489-168" aria-hidden="true" tabindex="-1"></a>  Return_Loser <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(Mom_Lose, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-169"><a href="factor-models-1.html#cb489-169" aria-hidden="true" tabindex="-1"></a>  Return_Mid_Mom <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(Mom_Mid, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-170"><a href="factor-models-1.html#cb489-170" aria-hidden="true" tabindex="-1"></a>  Return_Winner <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(Mom_Win, <span class="dv">1</span>)<span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-171"><a href="factor-models-1.html#cb489-171" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb489-172"><a href="factor-models-1.html#cb489-172" aria-hidden="true" tabindex="-1"></a>  Return_Test_Down <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(Mom_Test_Down, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-173"><a href="factor-models-1.html#cb489-173" aria-hidden="true" tabindex="-1"></a>  Return_Test_Up <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(Mom_Test_Up, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-174"><a href="factor-models-1.html#cb489-174" aria-hidden="true" tabindex="-1"></a>  Return_Test_High <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(B2M_Test_High, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-175"><a href="factor-models-1.html#cb489-175" aria-hidden="true" tabindex="-1"></a>  Return_Test_Low <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(B2M_Test_Low, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-176"><a href="factor-models-1.html#cb489-176" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb489-177"><a href="factor-models-1.html#cb489-177" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For the BAB</span></span>
<span id="cb489-178"><a href="factor-models-1.html#cb489-178" aria-hidden="true" tabindex="-1"></a>  Return_Highvol <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(BAB_Highvol, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-179"><a href="factor-models-1.html#cb489-179" aria-hidden="true" tabindex="-1"></a>  Return_Lowvol <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">lag</span>(BAB_Lowvol, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-180"><a href="factor-models-1.html#cb489-180" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb489-181"><a href="factor-models-1.html#cb489-181" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For the interaction indicator variables to get S/L, S/M, S/H &amp; B/L, B/M, B/H returns</span></span>
<span id="cb489-182"><a href="factor-models-1.html#cb489-182" aria-hidden="true" tabindex="-1"></a>  <span class="do">### For the B2M</span></span>
<span id="cb489-183"><a href="factor-models-1.html#cb489-183" aria-hidden="true" tabindex="-1"></a>  Returns_SL_B2M <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_SL_B2M, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-184"><a href="factor-models-1.html#cb489-184" aria-hidden="true" tabindex="-1"></a>  Returns_SM_B2M <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_SM_B2M, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-185"><a href="factor-models-1.html#cb489-185" aria-hidden="true" tabindex="-1"></a>  Returns_SH_B2M <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_SH_B2M, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-186"><a href="factor-models-1.html#cb489-186" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb489-187"><a href="factor-models-1.html#cb489-187" aria-hidden="true" tabindex="-1"></a>  Returns_BL_B2M <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_BL_B2M, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-188"><a href="factor-models-1.html#cb489-188" aria-hidden="true" tabindex="-1"></a>  Returns_BM_B2M <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_BM_B2M, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-189"><a href="factor-models-1.html#cb489-189" aria-hidden="true" tabindex="-1"></a>  Returns_BH_B2M <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_BH_B2M, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-190"><a href="factor-models-1.html#cb489-190" aria-hidden="true" tabindex="-1"></a>  <span class="do">### For the OP</span></span>
<span id="cb489-191"><a href="factor-models-1.html#cb489-191" aria-hidden="true" tabindex="-1"></a>  Returns_SL_OP <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_SL_OP, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-192"><a href="factor-models-1.html#cb489-192" aria-hidden="true" tabindex="-1"></a>  Returns_SM_OP <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_SM_OP, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-193"><a href="factor-models-1.html#cb489-193" aria-hidden="true" tabindex="-1"></a>  Returns_SH_OP <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_SH_OP, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-194"><a href="factor-models-1.html#cb489-194" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb489-195"><a href="factor-models-1.html#cb489-195" aria-hidden="true" tabindex="-1"></a>  Returns_BL_OP <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_BL_OP, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-196"><a href="factor-models-1.html#cb489-196" aria-hidden="true" tabindex="-1"></a>  Returns_BM_OP <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_BM_OP, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-197"><a href="factor-models-1.html#cb489-197" aria-hidden="true" tabindex="-1"></a>  Returns_BH_OP <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_BH_OP, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-198"><a href="factor-models-1.html#cb489-198" aria-hidden="true" tabindex="-1"></a>  <span class="do">### For the Inv</span></span>
<span id="cb489-199"><a href="factor-models-1.html#cb489-199" aria-hidden="true" tabindex="-1"></a>  Returns_SL_Inv <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_SL_Inv, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-200"><a href="factor-models-1.html#cb489-200" aria-hidden="true" tabindex="-1"></a>  Returns_SM_Inv <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_SM_Inv, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-201"><a href="factor-models-1.html#cb489-201" aria-hidden="true" tabindex="-1"></a>  Returns_SH_Inv <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_SH_Inv, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-202"><a href="factor-models-1.html#cb489-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-203"><a href="factor-models-1.html#cb489-203" aria-hidden="true" tabindex="-1"></a>  Returns_BL_Inv <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_BL_Inv, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-204"><a href="factor-models-1.html#cb489-204" aria-hidden="true" tabindex="-1"></a>  Returns_BM_Inv <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_BM_Inv, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-205"><a href="factor-models-1.html#cb489-205" aria-hidden="true" tabindex="-1"></a>  Returns_BH_Inv <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_BH_Inv, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-206"><a href="factor-models-1.html#cb489-206" aria-hidden="true" tabindex="-1"></a>  <span class="do">### For the Mom</span></span>
<span id="cb489-207"><a href="factor-models-1.html#cb489-207" aria-hidden="true" tabindex="-1"></a>  Returns_SL_Mom <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_SL_Mom, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-208"><a href="factor-models-1.html#cb489-208" aria-hidden="true" tabindex="-1"></a>  Returns_SM_Mom <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_SM_Mom, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-209"><a href="factor-models-1.html#cb489-209" aria-hidden="true" tabindex="-1"></a>  Returns_SH_Mom <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_SH_Mom, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-210"><a href="factor-models-1.html#cb489-210" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb489-211"><a href="factor-models-1.html#cb489-211" aria-hidden="true" tabindex="-1"></a>  Returns_BL_Mom <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_BL_Mom, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-212"><a href="factor-models-1.html#cb489-212" aria-hidden="true" tabindex="-1"></a>  Returns_BM_Mom <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_BM_Mom, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-213"><a href="factor-models-1.html#cb489-213" aria-hidden="true" tabindex="-1"></a>  Returns_BH_Mom <span class="ot">&lt;-</span>  stats<span class="sc">::</span><span class="fu">lag</span>(Assets_BH_Mom, <span class="dv">1</span>) <span class="sc">*</span> Returns_Adj_ts[<span class="st">&#39;1995-12-01/2019-12-01&#39;</span>, i]</span>
<span id="cb489-214"><a href="factor-models-1.html#cb489-214" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb489-215"><a href="factor-models-1.html#cb489-215" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span> <span class="st">&quot;ABBN&quot;</span>){</span>
<span id="cb489-216"><a href="factor-models-1.html#cb489-216" aria-hidden="true" tabindex="-1"></a>    Returns_SL_final_B2M <span class="ot">&lt;-</span> Returns_SL_B2M</span>
<span id="cb489-217"><a href="factor-models-1.html#cb489-217" aria-hidden="true" tabindex="-1"></a>    Returns_SM_final_B2M <span class="ot">&lt;-</span> Returns_SM_B2M</span>
<span id="cb489-218"><a href="factor-models-1.html#cb489-218" aria-hidden="true" tabindex="-1"></a>    Returns_SH_final_B2M <span class="ot">&lt;-</span> Returns_SH_B2M</span>
<span id="cb489-219"><a href="factor-models-1.html#cb489-219" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb489-220"><a href="factor-models-1.html#cb489-220" aria-hidden="true" tabindex="-1"></a>    Returns_BL_final_B2M <span class="ot">&lt;-</span> Returns_BL_B2M</span>
<span id="cb489-221"><a href="factor-models-1.html#cb489-221" aria-hidden="true" tabindex="-1"></a>    Returns_BM_final_B2M <span class="ot">&lt;-</span> Returns_BM_B2M</span>
<span id="cb489-222"><a href="factor-models-1.html#cb489-222" aria-hidden="true" tabindex="-1"></a>    Returns_BH_final_B2M <span class="ot">&lt;-</span> Returns_BH_B2M</span>
<span id="cb489-223"><a href="factor-models-1.html#cb489-223" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb489-224"><a href="factor-models-1.html#cb489-224" aria-hidden="true" tabindex="-1"></a>    Returns_SL_final_OP <span class="ot">&lt;-</span> Returns_SL_OP</span>
<span id="cb489-225"><a href="factor-models-1.html#cb489-225" aria-hidden="true" tabindex="-1"></a>    Returns_SM_final_OP <span class="ot">&lt;-</span> Returns_SM_OP</span>
<span id="cb489-226"><a href="factor-models-1.html#cb489-226" aria-hidden="true" tabindex="-1"></a>    Returns_SH_final_OP <span class="ot">&lt;-</span> Returns_SH_OP</span>
<span id="cb489-227"><a href="factor-models-1.html#cb489-227" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb489-228"><a href="factor-models-1.html#cb489-228" aria-hidden="true" tabindex="-1"></a>    Returns_BL_final_OP <span class="ot">&lt;-</span> Returns_BL_OP</span>
<span id="cb489-229"><a href="factor-models-1.html#cb489-229" aria-hidden="true" tabindex="-1"></a>    Returns_BM_final_OP <span class="ot">&lt;-</span> Returns_BM_OP</span>
<span id="cb489-230"><a href="factor-models-1.html#cb489-230" aria-hidden="true" tabindex="-1"></a>    Returns_BH_final_OP <span class="ot">&lt;-</span> Returns_BH_OP</span>
<span id="cb489-231"><a href="factor-models-1.html#cb489-231" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb489-232"><a href="factor-models-1.html#cb489-232" aria-hidden="true" tabindex="-1"></a>    Returns_SL_final_Inv <span class="ot">&lt;-</span> Returns_SL_Inv</span>
<span id="cb489-233"><a href="factor-models-1.html#cb489-233" aria-hidden="true" tabindex="-1"></a>    Returns_SM_final_Inv <span class="ot">&lt;-</span> Returns_SM_Inv</span>
<span id="cb489-234"><a href="factor-models-1.html#cb489-234" aria-hidden="true" tabindex="-1"></a>    Returns_SH_final_Inv <span class="ot">&lt;-</span> Returns_SH_Inv</span>
<span id="cb489-235"><a href="factor-models-1.html#cb489-235" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb489-236"><a href="factor-models-1.html#cb489-236" aria-hidden="true" tabindex="-1"></a>    Returns_BL_final_Inv <span class="ot">&lt;-</span> Returns_BL_Inv</span>
<span id="cb489-237"><a href="factor-models-1.html#cb489-237" aria-hidden="true" tabindex="-1"></a>    Returns_BM_final_Inv <span class="ot">&lt;-</span> Returns_BM_Inv</span>
<span id="cb489-238"><a href="factor-models-1.html#cb489-238" aria-hidden="true" tabindex="-1"></a>    Returns_BH_final_Inv <span class="ot">&lt;-</span> Returns_BH_Inv</span>
<span id="cb489-239"><a href="factor-models-1.html#cb489-239" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb489-240"><a href="factor-models-1.html#cb489-240" aria-hidden="true" tabindex="-1"></a>    Returns_SL_final_Mom <span class="ot">&lt;-</span> Returns_SL_Mom</span>
<span id="cb489-241"><a href="factor-models-1.html#cb489-241" aria-hidden="true" tabindex="-1"></a>    Returns_SM_final_Mom <span class="ot">&lt;-</span> Returns_SM_Mom</span>
<span id="cb489-242"><a href="factor-models-1.html#cb489-242" aria-hidden="true" tabindex="-1"></a>    Returns_SH_final_Mom <span class="ot">&lt;-</span> Returns_SH_Mom</span>
<span id="cb489-243"><a href="factor-models-1.html#cb489-243" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb489-244"><a href="factor-models-1.html#cb489-244" aria-hidden="true" tabindex="-1"></a>    Returns_BL_final_Mom <span class="ot">&lt;-</span> Returns_BL_Mom</span>
<span id="cb489-245"><a href="factor-models-1.html#cb489-245" aria-hidden="true" tabindex="-1"></a>    Returns_BM_final_Mom <span class="ot">&lt;-</span> Returns_BM_Mom</span>
<span id="cb489-246"><a href="factor-models-1.html#cb489-246" aria-hidden="true" tabindex="-1"></a>    Returns_BH_final_Mom <span class="ot">&lt;-</span> Returns_BH_Mom</span>
<span id="cb489-247"><a href="factor-models-1.html#cb489-247" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb489-248"><a href="factor-models-1.html#cb489-248" aria-hidden="true" tabindex="-1"></a>    Returns_Highvol_final_BAB <span class="ot">&lt;-</span> Return_Highvol</span>
<span id="cb489-249"><a href="factor-models-1.html#cb489-249" aria-hidden="true" tabindex="-1"></a>    Returns_Lowvol_final_BAB <span class="ot">&lt;-</span> Return_Lowvol</span>
<span id="cb489-250"><a href="factor-models-1.html#cb489-250" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb489-251"><a href="factor-models-1.html#cb489-251" aria-hidden="true" tabindex="-1"></a>    Returns_Test_final_Down <span class="ot">&lt;-</span> Return_Test_Down</span>
<span id="cb489-252"><a href="factor-models-1.html#cb489-252" aria-hidden="true" tabindex="-1"></a>    Returns_Test_final_Up <span class="ot">&lt;-</span> Return_Test_Up</span>
<span id="cb489-253"><a href="factor-models-1.html#cb489-253" aria-hidden="true" tabindex="-1"></a>    Returns_Test_final_High <span class="ot">&lt;-</span> Return_Test_High</span>
<span id="cb489-254"><a href="factor-models-1.html#cb489-254" aria-hidden="true" tabindex="-1"></a>    Returns_Test_final_Low <span class="ot">&lt;-</span> Return_Test_Low</span>
<span id="cb489-255"><a href="factor-models-1.html#cb489-255" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb489-256"><a href="factor-models-1.html#cb489-256" aria-hidden="true" tabindex="-1"></a>    Return_Winner_final <span class="ot">&lt;-</span> Return_Winner</span>
<span id="cb489-257"><a href="factor-models-1.html#cb489-257" aria-hidden="true" tabindex="-1"></a>    Return_Loser_final <span class="ot">&lt;-</span> Return_Loser</span>
<span id="cb489-258"><a href="factor-models-1.html#cb489-258" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb489-259"><a href="factor-models-1.html#cb489-259" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb489-260"><a href="factor-models-1.html#cb489-260" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb489-261"><a href="factor-models-1.html#cb489-261" aria-hidden="true" tabindex="-1"></a>    Returns_SL_final_B2M <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_SL_final_B2M, Returns_SL_B2M)</span>
<span id="cb489-262"><a href="factor-models-1.html#cb489-262" aria-hidden="true" tabindex="-1"></a>    Returns_SM_final_B2M <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_SM_final_B2M, Returns_SM_B2M)</span>
<span id="cb489-263"><a href="factor-models-1.html#cb489-263" aria-hidden="true" tabindex="-1"></a>    Returns_SH_final_B2M <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_SH_final_B2M, Returns_SH_B2M)</span>
<span id="cb489-264"><a href="factor-models-1.html#cb489-264" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb489-265"><a href="factor-models-1.html#cb489-265" aria-hidden="true" tabindex="-1"></a>    Returns_BL_final_B2M <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_BL_final_B2M, Returns_BL_B2M)</span>
<span id="cb489-266"><a href="factor-models-1.html#cb489-266" aria-hidden="true" tabindex="-1"></a>    Returns_BM_final_B2M <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_BM_final_B2M, Returns_BM_B2M)</span>
<span id="cb489-267"><a href="factor-models-1.html#cb489-267" aria-hidden="true" tabindex="-1"></a>    Returns_BH_final_B2M <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_BH_final_B2M, Returns_BH_B2M)</span>
<span id="cb489-268"><a href="factor-models-1.html#cb489-268" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb489-269"><a href="factor-models-1.html#cb489-269" aria-hidden="true" tabindex="-1"></a>    Returns_SL_final_OP <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_SL_final_OP, Returns_SL_OP)</span>
<span id="cb489-270"><a href="factor-models-1.html#cb489-270" aria-hidden="true" tabindex="-1"></a>    Returns_SM_final_OP <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_SM_final_OP, Returns_SM_OP)</span>
<span id="cb489-271"><a href="factor-models-1.html#cb489-271" aria-hidden="true" tabindex="-1"></a>    Returns_SH_final_OP <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_SH_final_OP, Returns_SH_OP)</span>
<span id="cb489-272"><a href="factor-models-1.html#cb489-272" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb489-273"><a href="factor-models-1.html#cb489-273" aria-hidden="true" tabindex="-1"></a>    Returns_BL_final_OP <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_BL_final_OP, Returns_BL_OP)</span>
<span id="cb489-274"><a href="factor-models-1.html#cb489-274" aria-hidden="true" tabindex="-1"></a>    Returns_BM_final_OP <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_BM_final_OP, Returns_BM_OP)</span>
<span id="cb489-275"><a href="factor-models-1.html#cb489-275" aria-hidden="true" tabindex="-1"></a>    Returns_BH_final_OP <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_BH_final_OP, Returns_BH_OP)</span>
<span id="cb489-276"><a href="factor-models-1.html#cb489-276" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb489-277"><a href="factor-models-1.html#cb489-277" aria-hidden="true" tabindex="-1"></a>    Returns_SL_final_Inv <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_SL_final_Inv, Returns_SL_Inv)</span>
<span id="cb489-278"><a href="factor-models-1.html#cb489-278" aria-hidden="true" tabindex="-1"></a>    Returns_SM_final_Inv <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_SM_final_Inv, Returns_SM_Inv)</span>
<span id="cb489-279"><a href="factor-models-1.html#cb489-279" aria-hidden="true" tabindex="-1"></a>    Returns_SH_final_Inv <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_SH_final_Inv, Returns_SH_Inv)</span>
<span id="cb489-280"><a href="factor-models-1.html#cb489-280" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb489-281"><a href="factor-models-1.html#cb489-281" aria-hidden="true" tabindex="-1"></a>    Returns_BL_final_Inv <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_BL_final_Inv, Returns_BL_Inv)</span>
<span id="cb489-282"><a href="factor-models-1.html#cb489-282" aria-hidden="true" tabindex="-1"></a>    Returns_BM_final_Inv <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_BM_final_Inv, Returns_BM_Inv)</span>
<span id="cb489-283"><a href="factor-models-1.html#cb489-283" aria-hidden="true" tabindex="-1"></a>    Returns_BH_final_Inv <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_BH_final_Inv, Returns_BH_Inv)</span>
<span id="cb489-284"><a href="factor-models-1.html#cb489-284" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb489-285"><a href="factor-models-1.html#cb489-285" aria-hidden="true" tabindex="-1"></a>    Returns_SL_final_Mom <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_SL_final_Mom, Returns_SL_Mom)</span>
<span id="cb489-286"><a href="factor-models-1.html#cb489-286" aria-hidden="true" tabindex="-1"></a>    Returns_SM_final_Mom <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_SM_final_Mom, Returns_SM_Mom)</span>
<span id="cb489-287"><a href="factor-models-1.html#cb489-287" aria-hidden="true" tabindex="-1"></a>    Returns_SH_final_Mom <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_SH_final_Mom, Returns_SH_Mom)</span>
<span id="cb489-288"><a href="factor-models-1.html#cb489-288" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb489-289"><a href="factor-models-1.html#cb489-289" aria-hidden="true" tabindex="-1"></a>    Returns_BL_final_Mom <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_BL_final_Mom, Returns_BL_Mom)</span>
<span id="cb489-290"><a href="factor-models-1.html#cb489-290" aria-hidden="true" tabindex="-1"></a>    Returns_BM_final_Mom <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_BM_final_Mom, Returns_BM_Mom)</span>
<span id="cb489-291"><a href="factor-models-1.html#cb489-291" aria-hidden="true" tabindex="-1"></a>    Returns_BH_final_Mom <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_BH_final_Mom, Returns_BH_Mom)</span>
<span id="cb489-292"><a href="factor-models-1.html#cb489-292" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb489-293"><a href="factor-models-1.html#cb489-293" aria-hidden="true" tabindex="-1"></a>    Returns_Test_final_Down <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_Test_final_Down, Return_Test_Down)</span>
<span id="cb489-294"><a href="factor-models-1.html#cb489-294" aria-hidden="true" tabindex="-1"></a>    Returns_Test_final_Up <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_Test_final_Up, Return_Test_Up)</span>
<span id="cb489-295"><a href="factor-models-1.html#cb489-295" aria-hidden="true" tabindex="-1"></a>    Returns_Test_final_High <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_Test_final_High, Return_Test_High)</span>
<span id="cb489-296"><a href="factor-models-1.html#cb489-296" aria-hidden="true" tabindex="-1"></a>    Returns_Test_final_Low <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_Test_final_Low, Return_Test_Low)</span>
<span id="cb489-297"><a href="factor-models-1.html#cb489-297" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb489-298"><a href="factor-models-1.html#cb489-298" aria-hidden="true" tabindex="-1"></a>    Returns_Highvol_final_BAB <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_Highvol_final_BAB, Return_Highvol)</span>
<span id="cb489-299"><a href="factor-models-1.html#cb489-299" aria-hidden="true" tabindex="-1"></a>    Returns_Lowvol_final_BAB <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Returns_Lowvol_final_BAB, Return_Lowvol)</span>
<span id="cb489-300"><a href="factor-models-1.html#cb489-300" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb489-301"><a href="factor-models-1.html#cb489-301" aria-hidden="true" tabindex="-1"></a>    Return_Winner_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Return_Winner_final, Return_Winner)</span>
<span id="cb489-302"><a href="factor-models-1.html#cb489-302" aria-hidden="true" tabindex="-1"></a>    Return_Loser_final <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Return_Loser_final, Return_Loser)</span>
<span id="cb489-303"><a href="factor-models-1.html#cb489-303" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb489-304"><a href="factor-models-1.html#cb489-304" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb489-305"><a href="factor-models-1.html#cb489-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-306"><a href="factor-models-1.html#cb489-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-307"><a href="factor-models-1.html#cb489-307" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we create average, equally weighted returns</span></span>
<span id="cb489-308"><a href="factor-models-1.html#cb489-308" aria-hidden="true" tabindex="-1"></a><span class="do">## For B2M</span></span>
<span id="cb489-309"><a href="factor-models-1.html#cb489-309" aria-hidden="true" tabindex="-1"></a>EW_Returns_SL_B2M <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_SL_final_B2M, <span class="at">na.rm =</span> T)</span>
<span id="cb489-310"><a href="factor-models-1.html#cb489-310" aria-hidden="true" tabindex="-1"></a>EW_Returns_SM_B2M <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_SM_final_B2M, <span class="at">na.rm =</span> T)</span>
<span id="cb489-311"><a href="factor-models-1.html#cb489-311" aria-hidden="true" tabindex="-1"></a>EW_Returns_SH_B2M <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_SH_final_B2M, <span class="at">na.rm =</span> T)</span>
<span id="cb489-312"><a href="factor-models-1.html#cb489-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-313"><a href="factor-models-1.html#cb489-313" aria-hidden="true" tabindex="-1"></a>EW_Returns_BL_B2M <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_BL_final_B2M, <span class="at">na.rm =</span> T)</span>
<span id="cb489-314"><a href="factor-models-1.html#cb489-314" aria-hidden="true" tabindex="-1"></a>EW_Returns_BM_B2M <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_BM_final_B2M, <span class="at">na.rm =</span> T)</span>
<span id="cb489-315"><a href="factor-models-1.html#cb489-315" aria-hidden="true" tabindex="-1"></a>EW_Returns_BH_B2M <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_BH_final_B2M, <span class="at">na.rm =</span> T)</span>
<span id="cb489-316"><a href="factor-models-1.html#cb489-316" aria-hidden="true" tabindex="-1"></a><span class="do">## For OP</span></span>
<span id="cb489-317"><a href="factor-models-1.html#cb489-317" aria-hidden="true" tabindex="-1"></a>EW_Returns_SL_OP <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_SL_final_OP, <span class="at">na.rm =</span> T)</span>
<span id="cb489-318"><a href="factor-models-1.html#cb489-318" aria-hidden="true" tabindex="-1"></a>EW_Returns_SM_OP <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_SM_final_OP, <span class="at">na.rm =</span> T)</span>
<span id="cb489-319"><a href="factor-models-1.html#cb489-319" aria-hidden="true" tabindex="-1"></a>EW_Returns_SH_OP <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_SH_final_OP, <span class="at">na.rm =</span> T)</span>
<span id="cb489-320"><a href="factor-models-1.html#cb489-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-321"><a href="factor-models-1.html#cb489-321" aria-hidden="true" tabindex="-1"></a>EW_Returns_BL_OP <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_BL_final_OP, <span class="at">na.rm =</span> T)</span>
<span id="cb489-322"><a href="factor-models-1.html#cb489-322" aria-hidden="true" tabindex="-1"></a>EW_Returns_BM_OP <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_BM_final_OP, <span class="at">na.rm =</span> T)</span>
<span id="cb489-323"><a href="factor-models-1.html#cb489-323" aria-hidden="true" tabindex="-1"></a>EW_Returns_BH_OP <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_BH_final_OP, <span class="at">na.rm =</span> T)</span>
<span id="cb489-324"><a href="factor-models-1.html#cb489-324" aria-hidden="true" tabindex="-1"></a><span class="do">## For Inv</span></span>
<span id="cb489-325"><a href="factor-models-1.html#cb489-325" aria-hidden="true" tabindex="-1"></a>EW_Returns_SL_Inv <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_SL_final_Inv, <span class="at">na.rm =</span> T)</span>
<span id="cb489-326"><a href="factor-models-1.html#cb489-326" aria-hidden="true" tabindex="-1"></a>EW_Returns_SM_Inv <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_SM_final_Inv, <span class="at">na.rm =</span> T)</span>
<span id="cb489-327"><a href="factor-models-1.html#cb489-327" aria-hidden="true" tabindex="-1"></a>EW_Returns_SH_Inv <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_SH_final_Inv, <span class="at">na.rm =</span> T)</span>
<span id="cb489-328"><a href="factor-models-1.html#cb489-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-329"><a href="factor-models-1.html#cb489-329" aria-hidden="true" tabindex="-1"></a>EW_Returns_BL_Inv <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_BL_final_Inv, <span class="at">na.rm =</span> T)</span>
<span id="cb489-330"><a href="factor-models-1.html#cb489-330" aria-hidden="true" tabindex="-1"></a>EW_Returns_BM_Inv <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_BM_final_Inv, <span class="at">na.rm =</span> T)</span>
<span id="cb489-331"><a href="factor-models-1.html#cb489-331" aria-hidden="true" tabindex="-1"></a>EW_Returns_BH_Inv <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_BH_final_Inv, <span class="at">na.rm =</span> T)</span>
<span id="cb489-332"><a href="factor-models-1.html#cb489-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-333"><a href="factor-models-1.html#cb489-333" aria-hidden="true" tabindex="-1"></a><span class="do">## For Mom</span></span>
<span id="cb489-334"><a href="factor-models-1.html#cb489-334" aria-hidden="true" tabindex="-1"></a>EW_Returns_SL_Mom <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_SL_final_Mom, <span class="at">na.rm =</span> T)</span>
<span id="cb489-335"><a href="factor-models-1.html#cb489-335" aria-hidden="true" tabindex="-1"></a>EW_Returns_SM_Mom <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_SM_final_Mom, <span class="at">na.rm =</span> T)</span>
<span id="cb489-336"><a href="factor-models-1.html#cb489-336" aria-hidden="true" tabindex="-1"></a>EW_Returns_SH_Mom <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_SH_final_Mom, <span class="at">na.rm =</span> T)</span>
<span id="cb489-337"><a href="factor-models-1.html#cb489-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-338"><a href="factor-models-1.html#cb489-338" aria-hidden="true" tabindex="-1"></a>EW_Returns_BL_Mom <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_BL_final_Mom, <span class="at">na.rm =</span> T)</span>
<span id="cb489-339"><a href="factor-models-1.html#cb489-339" aria-hidden="true" tabindex="-1"></a>EW_Returns_BM_Mom <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_BM_final_Mom, <span class="at">na.rm =</span> T)</span>
<span id="cb489-340"><a href="factor-models-1.html#cb489-340" aria-hidden="true" tabindex="-1"></a>EW_Returns_BH_Mom <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_BH_final_Mom, <span class="at">na.rm =</span> T)</span>
<span id="cb489-341"><a href="factor-models-1.html#cb489-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-342"><a href="factor-models-1.html#cb489-342" aria-hidden="true" tabindex="-1"></a><span class="do">## For BAB</span></span>
<span id="cb489-343"><a href="factor-models-1.html#cb489-343" aria-hidden="true" tabindex="-1"></a>Beta_factors_ts</span></code></pre></div>
<pre><code>##                 ABBN      ACIN ACON        ACUN ADBN     ADEN ADVN ADXN AEVS AFP      AGIN        AIRE      AIRN ALC ALCN ALLN      ALPH ALPN     ALSN AMSN
## 1995-12-01 0.3635825 0.3906395   NA  0.16212556   NA 1.282962   NA   NA   NA  NA 0.4557453 -0.07204321 0.4456255  NA   NA   NA 0.3524637   NA 1.252863   NA
## 1996-01-01 0.3810278 0.4057252   NA  0.16245781   NA 1.285276   NA   NA   NA  NA 0.5025963 -0.07142055 0.4294052  NA   NA   NA 0.3601835   NA 1.280813   NA
## 1996-02-01 0.4319994 0.4218534   NA -0.03189966   NA 1.309595   NA   NA   NA  NA 0.4788763 -0.09436688 0.5019532  NA   NA   NA 0.4329947   NA 1.210215   NA
##                 APGN APHN      ARBN      ARON ARYN      ASCN      ASKN ASWN ATRI AUTN BAER      BALN BANB       BAP BARN BBN         BC BCGE BCHN        BCJ
## 1995-12-01 0.4398501   NA 0.7729398 0.5027567   NA 0.5300168 0.2772846   NA   NA   NA   NA 0.1704913   NA 0.2776074   NA  NA 0.13349358   NA   NA -0.1072788
## 1996-01-01 0.4145323   NA 0.7732498 0.5140425   NA 0.5801636 0.3153213   NA   NA   NA   NA 0.1600723   NA 0.2902444   NA  NA 0.12018823   NA   NA -0.1017615
## 1996-02-01 0.4147306   NA 0.8295010 0.5068720   NA 0.5728107 0.3009660   NA   NA   NA   NA 0.1731473   NA 0.3227477   NA  NA 0.09133695   NA   NA -0.1128986
##                 BCVN BEAN BEKN        BELL       BERN       BIG BION       BIZ BKW       BLKB BLS      BOAN     BOBNN       BON      BOSN BRKN      BSKP BSLN
## 1995-12-01 0.2265120   NA   NA  0.06183307 0.03616341 0.1755380   NA 0.3153580  NA 0.09898704  NA 0.4945443 0.2925228 0.3550807 0.5897233   NA 0.2204458   NA
## 1996-01-01 0.2295289   NA   NA  0.04344719 0.02426185 0.2226296   NA 0.3408545  NA 0.09809007  NA 0.5422420 0.2909247 0.3373554 0.5838547   NA 0.2174447   NA
## 1996-02-01 0.1974176   NA   NA -0.02708535 0.12900634 0.2830412   NA 0.3705228  NA 0.09746277  NA 0.5921789 0.3530349 0.2933077 0.5786955   NA 0.2149143   NA
##                 BUCN      BUCP      BVZN      CALN      CANN CEVA       CFR       CFT CGAN      CHAM CHN CIBN CICN      CIE CLN CLTN CLXN CMBN COTN CPHN
## 1995-12-01 0.6685616 0.7518876 0.1936023 0.4938040 0.8215856   NA 0.4891983 0.1984735   NA 0.5935903  NA   NA   NA 1.421012  NA   NA   NA   NA   NA   NA
## 1996-01-01 0.6780385 0.7897951 0.1955621 0.4785948 0.8230926   NA 0.4947589 0.1850489   NA 0.5897271  NA   NA   NA 1.405473  NA   NA   NA   NA   NA   NA
## 1996-02-01 0.5385802 0.8189762 0.2090528 0.5252834 0.8131124   NA 0.4579036 0.1954400   NA 0.5800987  NA   NA   NA 1.499272  NA   NA   NA   NA   NA   NA
##                 CSGN       DAE DAYN       DCN DESN DKSH DMS DOKA       DSF DUFN      EDHN        EDI EFGN       EGL ELMN EMMN      EMSN ESUN EVE      FHZN
## 1995-12-01 0.2177683 0.4746713   NA 0.7572887   NA   NA  NA   NA 0.6595639   NA 0.1134462 0.08011670   NA 0.1914755   NA   NA 0.3622168   NA  NA 0.3196594
## 1996-01-01 0.2605224 0.4698379   NA 0.7369893   NA   NA  NA   NA 0.6712441   NA 0.1195321 0.08649360   NA 0.1992135   NA   NA 0.3807488   NA  NA 0.3105924
## 1996-02-01 0.3228777 0.4460317   NA 0.7295078   NA   NA  NA   NA 0.5862198   NA 0.1041807 0.06272835   NA 0.2147699   NA   NA 0.4119440   NA  NA 0.3409627
##                 FORN FREN FTON GALE       GAM GATE       GAV GCZ GEBN        GG GIGN GIVN GLKBN GMI       GOL      GRKP       GUR       HAR        HBLN HBMN
## 1995-12-01 0.4521533   NA   NA   NA 0.3771359   NA 0.5284849  NA   NA 0.3481416   NA   NA    NA  NA 0.5586764 0.1951827 0.7226559 0.1829823  0.02461653   NA
## 1996-01-01 0.4681663   NA   NA   NA 0.3812747   NA 0.5751902  NA   NA 0.3223569   NA   NA    NA  NA 0.5645476 0.1992355 0.7107893 0.2099934  0.01824285   NA
## 1996-02-01 0.5354422   NA   NA   NA 0.5352393   NA 0.6770238  NA   NA 0.3516122   NA   NA    NA  NA 0.5581231 0.1544014 0.6652874 0.2256412 -0.02121344   NA
##                 HELN       HER HIAG HIEN     HILP HIT HIZN HLEE HOCN HREN      HUBN       HUE IDIA IFCN      IHSN IMHE IMPN       INI INRN IREN       ISN JELN
## 1995-12-01 0.1955664 0.1327032   NA   NA 1.034793  NA   NA   NA   NA   NA 0.5199152 0.9648655   NA   NA 0.3402468   NA   NA 0.1283897   NA   NA 0.1844324   NA
## 1996-01-01 0.1768019 0.1399551   NA   NA 1.063586  NA   NA   NA   NA   NA 0.5287337 0.9714032   NA   NA 0.3481077   NA   NA 0.1635418   NA   NA 0.1998721   NA
## 1996-02-01 0.1479857 0.1366093   NA   NA 1.073460  NA   NA   NA   NA   NA 0.4560253 0.9443782   NA   NA 0.6249148   NA   NA 0.2950970   NA   NA 0.2910783   NA
##                   JFN      KARN KLIN KNIN KOMN      KUD      KUNN KURN LAND LBBN LECN       LEHN LEON LGSN      LINN      LISN LLQ      LOEP      LOGN LOHN
## 1995-12-01 0.10346421 0.3342944   NA   NA   NA 1.111583 0.7040168   NA   NA   NA   NA 0.05400642   NA   NA 0.2486401 0.1088173  NA 0.5683151 0.1519454   NA
## 1996-01-01 0.09938828 0.3304942   NA   NA   NA 1.165211 0.7409733   NA   NA   NA   NA 0.05685896   NA   NA 0.2561670 0.1223777  NA 0.5849296 0.1778780   NA
## 1996-02-01 0.09066642 0.2478105   NA   NA   NA 1.061505 0.6148976   NA   NA   NA   NA 0.20465269   NA   NA 0.2279051 0.1181890  NA 0.5458247 0.3258078   NA
##            LONN LOUN       LUKN LURN MASN MBTN MCHN MED     METN       MIC      MIKN      MIND MIRN MIV MOBN MOLN       MOV MOVE MOZN MSSN       MTG MXN NBEN
## 1995-12-01   NA   NA 0.07385910   NA   NA   NA   NA  NA 1.250772 0.4927853 0.5866177 0.5601091   NA  NA   NA   NA 0.5774102   NA   NA   NA 0.4639193  NA   NA
## 1996-01-01   NA   NA 0.07437532   NA   NA   NA   NA  NA 1.199477 0.5272289 0.6035164 0.5536361   NA  NA   NA   NA 0.5854551   NA   NA   NA 0.4680067  NA   NA
## 1996-02-01   NA   NA 0.07686036   NA   NA   NA   NA  NA 1.113010 0.5640166 0.6279564 0.5162746   NA  NA   NA   NA 0.4972045   NA   NA   NA 0.4770627  NA   NA
##                 NESN       NET NEV NEWN NIHN      NOVN NREN NWEN ODHN      OERL       OFN       ORI ORON       PAXN PEAN      PEDU       PEL PGHN PLAN
## 1995-12-01 0.3134869 0.8413009  NA   NA   NA 0.1344064   NA   NA   NA 0.1344054 0.6104267 0.8350162   NA 0.02786285   NA 0.6836039 0.5195410   NA   NA
## 1996-01-01 0.3292293 0.7383441  NA   NA   NA 0.1471105   NA   NA   NA 0.1145470 0.6167911 0.8780889   NA 0.05277455   NA 0.7038544 0.5595716   NA   NA
## 1996-02-01 0.3688642 0.7197051  NA   NA   NA 0.2433145   NA   NA   NA 0.2699849 0.6692966 0.8851191   NA 0.06321968   NA 0.7324839 0.5198563   NA   NA
##                   PM PNHO POLN PRFN PRWN PSPN      PUBN PWTN QUAN      RIEN RIVN       RLD RLF       ROG       ROL ROSE RUS SAHN SAKN SANN      SAUN SBEN SCI
## 1995-12-01 0.2299476   NA   NA   NA   NA   NA 0.6871565   NA   NA 0.1813533   NA 0.2786709  NA 0.2244536 0.6218003   NA  NA   NA   NA   NA 0.6525380   NA  NA
## 1996-01-01 0.2361260   NA   NA   NA   NA   NA 0.6923850   NA   NA 0.1794788   NA 0.2712009  NA 0.2339889 0.6341246   NA  NA   NA   NA   NA 0.6417259   NA  NA
## 1996-02-01 0.2798977   NA   NA   NA   NA   NA 0.6853821   NA   NA 0.2045724   NA 0.2316164  NA 0.2499466 0.6963862   NA  NA   NA   NA   NA 0.6560941   NA  NA
##            SCMN SELN SENS SEZN SFPN SFSN      SFZN SG SGKN SGRN      SGSN SIAN SIGN      SIKA        SIM        SLHN      SLOG SMET      SNBN SOON      SOPN
## 1995-12-01   NA   NA   NA   NA   NA   NA 0.3372145 NA   NA   NA 0.2649278   NA   NA 0.6152065 0.01368480 -0.07182170 0.3499051   NA 0.1143372   NA 0.1519315
## 1996-01-01   NA   NA   NA   NA   NA   NA 0.3497584 NA   NA   NA 0.2733921   NA   NA 0.6235376 0.01724348 -0.05988185 0.3196294   NA 0.1385002   NA 0.1525725
## 1996-02-01   NA   NA   NA   NA   NA   NA 0.3048334 NA   NA   NA 0.2708619   NA   NA 0.5203162 0.01715641 -0.08447345 0.2939371   NA 0.1514335   NA 0.1664378
##            SPSN SQN SRAIL SRCG        SREN      SSTE STGN      STLN STMN      STRN       SUN      SWIN SWON        SWTQ SYNN      TECN TEMN TIBN TKBP TOHN
## 1995-12-01   NA  NA    NA   NA -0.17659578 0.3236230   NA 0.4482382   NA 0.2315236 0.5288735 0.7685650   NA -0.12087886   NA 0.7427174   NA   NA   NA   NA
## 1996-01-01   NA  NA    NA   NA -0.16923722 0.3266034   NA 0.4566915   NA 0.2052236 0.5313807 0.7851003   NA -0.04048131   NA 0.7534608   NA   NA   NA   NA
## 1996-02-01   NA  NA    NA   NA -0.04301242 0.4113907   NA 0.4575706   NA 0.2192647 0.4386913 0.8520113   NA  0.19600727   NA 0.6630230   NA   NA   NA   NA
##            TSGN TTO TXGN      UBSG      UBSN UBXN UHR ULB VACN      VAHN      VALN VARN VATN VBSN VCH      VETN      VIFN VIJN      VILN VLRT      VONN VZN
## 1995-12-01   NA  NA   NA 0.3247104 0.3240766   NA  NA  NA   NA 0.3903489 0.1834629   NA   NA   NA  NA 0.6694806 0.5163524   NA 0.2057600   NA 0.2041995  NA
## 1996-01-01   NA  NA   NA 0.3475998 0.3472414   NA  NA  NA   NA 0.3872010 0.1946796   NA   NA   NA  NA 0.6894868 0.5472900   NA 0.2078354   NA 0.2068556  NA
## 1996-02-01   NA  NA   NA 0.4716046 0.4722028   NA  NA  NA   NA 0.4256642 0.1959416   NA   NA   NA  NA 0.7599377 0.5828522   NA 0.2349903   NA 0.2435354  NA
##                 WARN WIHN WKBN YPSN      ZEHN       ZEL      ZKKN     ZUBN     ZUGER ZUGN      ZURN ZWM
## 1995-12-01 0.8226502   NA   NA   NA 0.4067799 0.2744486 0.6210755 1.697686 0.4016597   NA 0.3233087  NA
## 1996-01-01 0.8263838   NA   NA   NA 0.3746219 0.3068200 0.6391484 1.693161 0.4087543   NA 0.3349202  NA
## 1996-02-01 0.9409994   NA   NA   NA 0.3577448 0.2667407 0.6684504 1.701156 0.4034444   NA 0.4543630  NA
##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 286 rows ]</code></pre>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb491-1"><a href="factor-models-1.html#cb491-1" aria-hidden="true" tabindex="-1"></a><span class="fu">view</span>(<span class="fu">as.data.frame</span>(Returns_Lowvol_final_BAB))</span>
<span id="cb491-2"><a href="factor-models-1.html#cb491-2" aria-hidden="true" tabindex="-1"></a>EW_Returns_Lowvol_BAB <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_Lowvol_final_BAB, <span class="at">na.rm =</span> T)</span>
<span id="cb491-3"><a href="factor-models-1.html#cb491-3" aria-hidden="true" tabindex="-1"></a>EW_Returns_Highvol_BAB <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_Highvol_final_BAB, <span class="at">na.rm =</span> T)</span>
<span id="cb491-4"><a href="factor-models-1.html#cb491-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-5"><a href="factor-models-1.html#cb491-5" aria-hidden="true" tabindex="-1"></a>EW_Returns_Test_Down <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_Test_final_Down, <span class="at">na.rm =</span> T)</span>
<span id="cb491-6"><a href="factor-models-1.html#cb491-6" aria-hidden="true" tabindex="-1"></a>EW_Returns_Test_Up <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_Test_final_Up, <span class="at">na.rm =</span> T)</span>
<span id="cb491-7"><a href="factor-models-1.html#cb491-7" aria-hidden="true" tabindex="-1"></a>EW_Returns_Test_MOM <span class="ot">&lt;-</span> EW_Returns_Test_Up <span class="sc">-</span> EW_Returns_Test_Down</span>
<span id="cb491-8"><a href="factor-models-1.html#cb491-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-9"><a href="factor-models-1.html#cb491-9" aria-hidden="true" tabindex="-1"></a>EW_Returns_Test_Winner <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Return_Winner_final, <span class="at">na.rm =</span> T)</span>
<span id="cb491-10"><a href="factor-models-1.html#cb491-10" aria-hidden="true" tabindex="-1"></a>EW_Returns_Test_Loser <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Return_Loser_final, <span class="at">na.rm =</span> T)</span>
<span id="cb491-11"><a href="factor-models-1.html#cb491-11" aria-hidden="true" tabindex="-1"></a>EW_Returns_Test_3070_MOM <span class="ot">&lt;-</span> EW_Returns_Test_Winner <span class="sc">-</span> EW_Returns_Test_Loser</span>
<span id="cb491-12"><a href="factor-models-1.html#cb491-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-13"><a href="factor-models-1.html#cb491-13" aria-hidden="true" tabindex="-1"></a>EW_Returns_Test_High <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_Test_final_High, <span class="at">na.rm =</span> T)</span>
<span id="cb491-14"><a href="factor-models-1.html#cb491-14" aria-hidden="true" tabindex="-1"></a>EW_Returns_Test_Low <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(Returns_Test_final_Low, <span class="at">na.rm =</span> T)</span>
<span id="cb491-15"><a href="factor-models-1.html#cb491-15" aria-hidden="true" tabindex="-1"></a>EW_Returns_Test_HML <span class="ot">&lt;-</span> EW_Returns_Test_High <span class="sc">-</span> EW_Returns_Test_Low</span>
<span id="cb491-16"><a href="factor-models-1.html#cb491-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-17"><a href="factor-models-1.html#cb491-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Based on this, we can use the formula to compute the SMB and HML factors</span></span>
<span id="cb491-18"><a href="factor-models-1.html#cb491-18" aria-hidden="true" tabindex="-1"></a>SMB_B2M <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span><span class="sc">*</span>(EW_Returns_SL_B2M <span class="sc">+</span> EW_Returns_SM_B2M <span class="sc">+</span> EW_Returns_SH_B2M) <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span><span class="sc">*</span>(EW_Returns_BL_B2M <span class="sc">+</span> EW_Returns_BM_B2M <span class="sc">+</span> EW_Returns_BH_B2M)</span>
<span id="cb491-19"><a href="factor-models-1.html#cb491-19" aria-hidden="true" tabindex="-1"></a>SMB_OP <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span><span class="sc">*</span>(EW_Returns_SL_OP <span class="sc">+</span> EW_Returns_SM_OP <span class="sc">+</span> EW_Returns_SH_OP) <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span><span class="sc">*</span>(EW_Returns_BL_OP <span class="sc">+</span> EW_Returns_BM_OP <span class="sc">+</span> EW_Returns_BH_OP)</span>
<span id="cb491-20"><a href="factor-models-1.html#cb491-20" aria-hidden="true" tabindex="-1"></a>SMB_Inv <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span><span class="sc">*</span>(EW_Returns_SL_Inv <span class="sc">+</span> EW_Returns_SM_Inv <span class="sc">+</span> EW_Returns_SH_Inv) <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span><span class="sc">*</span>(EW_Returns_BL_Inv <span class="sc">+</span> EW_Returns_BM_Inv <span class="sc">+</span> EW_Returns_BH_Inv)</span>
<span id="cb491-21"><a href="factor-models-1.html#cb491-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-22"><a href="factor-models-1.html#cb491-22" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate the SMB</span></span>
<span id="cb491-23"><a href="factor-models-1.html#cb491-23" aria-hidden="true" tabindex="-1"></a>SMB <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span><span class="sc">*</span>(SMB_B2M <span class="sc">+</span> SMB_OP <span class="sc">+</span> SMB_Inv)</span>
<span id="cb491-24"><a href="factor-models-1.html#cb491-24" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate the HML</span></span>
<span id="cb491-25"><a href="factor-models-1.html#cb491-25" aria-hidden="true" tabindex="-1"></a>HML <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span><span class="sc">*</span>(EW_Returns_SH_B2M <span class="sc">+</span> EW_Returns_BH_B2M) <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span><span class="sc">*</span>(EW_Returns_SL_B2M <span class="sc">+</span> EW_Returns_BL_B2M)</span>
<span id="cb491-26"><a href="factor-models-1.html#cb491-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate the RMW</span></span>
<span id="cb491-27"><a href="factor-models-1.html#cb491-27" aria-hidden="true" tabindex="-1"></a>RMW <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span><span class="sc">*</span>(EW_Returns_SH_OP <span class="sc">+</span> EW_Returns_BH_OP) <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span><span class="sc">*</span>(EW_Returns_SL_OP <span class="sc">+</span> EW_Returns_BL_OP)</span>
<span id="cb491-28"><a href="factor-models-1.html#cb491-28" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate the CMA</span></span>
<span id="cb491-29"><a href="factor-models-1.html#cb491-29" aria-hidden="true" tabindex="-1"></a>CMA <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span><span class="sc">*</span>(EW_Returns_SH_Inv <span class="sc">+</span> EW_Returns_BH_Inv) <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span><span class="sc">*</span>(EW_Returns_SL_Inv <span class="sc">+</span> EW_Returns_BL_Inv)</span>
<span id="cb491-30"><a href="factor-models-1.html#cb491-30" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate the MOM</span></span>
<span id="cb491-31"><a href="factor-models-1.html#cb491-31" aria-hidden="true" tabindex="-1"></a>MOM <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span><span class="sc">*</span>(EW_Returns_SH_Mom <span class="sc">+</span> EW_Returns_BH_Mom) <span class="sc">-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span><span class="sc">*</span>(EW_Returns_SL_Mom <span class="sc">+</span> EW_Returns_BL_Mom)</span>
<span id="cb491-32"><a href="factor-models-1.html#cb491-32" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate the BAB</span></span>
<span id="cb491-33"><a href="factor-models-1.html#cb491-33" aria-hidden="true" tabindex="-1"></a>BAB <span class="ot">=</span> EW_Returns_Lowvol_BAB <span class="sc">-</span> EW_Returns_Highvol_BAB</span>
<span id="cb491-34"><a href="factor-models-1.html#cb491-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-35"><a href="factor-models-1.html#cb491-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the Return</span></span>
<span id="cb491-36"><a href="factor-models-1.html#cb491-36" aria-hidden="true" tabindex="-1"></a>Dates <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">dmy</span>(Prices_Adj[,<span class="dv">1</span>][<span class="dv">14</span><span class="sc">:</span><span class="dv">361</span>]))</span>
<span id="cb491-37"><a href="factor-models-1.html#cb491-37" aria-hidden="true" tabindex="-1"></a>FF <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(Dates,SMB,HML,RMW,CMA, MOM))</span>
<span id="cb491-38"><a href="factor-models-1.html#cb491-38" aria-hidden="true" tabindex="-1"></a>FF_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> FF[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> Dates)</span>
<span id="cb491-39"><a href="factor-models-1.html#cb491-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-40"><a href="factor-models-1.html#cb491-40" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(FF_ts) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Return SMB&quot;</span>, <span class="st">&quot;Return HML&quot;</span>, <span class="st">&quot;Return RMW&quot;</span>, <span class="st">&quot;Return CMA&quot;</span>, <span class="st">&quot;Return MOM&quot;</span>)</span>
<span id="cb491-41"><a href="factor-models-1.html#cb491-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-42"><a href="factor-models-1.html#cb491-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the Cumulative Product</span></span>
<span id="cb491-43"><a href="factor-models-1.html#cb491-43" aria-hidden="true" tabindex="-1"></a>Dates <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">dmy</span>(Prices_Adj[,<span class="dv">1</span>][<span class="dv">73</span><span class="sc">:</span><span class="dv">361</span>]))</span>
<span id="cb491-44"><a href="factor-models-1.html#cb491-44" aria-hidden="true" tabindex="-1"></a>FF_cp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(Dates,<span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">+</span>SMB),<span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">+</span>HML),<span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">+</span>RMW), <span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">+</span>MOM), <span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">+</span>BAB)))</span>
<span id="cb491-45"><a href="factor-models-1.html#cb491-45" aria-hidden="true" tabindex="-1"></a>FF_cp_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> FF_cp[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> Dates)</span>
<span id="cb491-46"><a href="factor-models-1.html#cb491-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-47"><a href="factor-models-1.html#cb491-47" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(FF_cp_ts) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Return SMB&quot;</span>, <span class="st">&quot;Return HML&quot;</span>, <span class="st">&quot;Return RMW&quot;</span>, <span class="st">&quot;Return MOM&quot;</span>, <span class="st">&quot;Return BAB&quot;</span>)</span>
<span id="cb491-48"><a href="factor-models-1.html#cb491-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-49"><a href="factor-models-1.html#cb491-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plots</span></span>
<span id="cb491-50"><a href="factor-models-1.html#cb491-50" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(FF_ts) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>index,<span class="at">y=</span>value, <span class="at">color=</span>series)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb491-51"><a href="factor-models-1.html#cb491-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;tomato3&quot;</span>, <span class="st">&quot;khaki3&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>, <span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;violetred4&quot;</span>)) <span class="sc">+</span></span>
<span id="cb491-52"><a href="factor-models-1.html#cb491-52" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">&quot;Returns&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Relationship of factor Returns LS PF&quot;</span>) <span class="sc">+</span></span>
<span id="cb491-53"><a href="factor-models-1.html#cb491-53" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb491-54"><a href="factor-models-1.html#cb491-54" aria-hidden="true" tabindex="-1"></a><span class="at">hjust=</span><span class="fl">0.5</span>,</span>
<span id="cb491-55"><a href="factor-models-1.html#cb491-55" aria-hidden="true" tabindex="-1"></a><span class="at">lineheight=</span><span class="fl">1.2</span>), <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb491-56"><a href="factor-models-1.html#cb491-56" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb491-57"><a href="factor-models-1.html#cb491-57" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb491-58"><a href="factor-models-1.html#cb491-58" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb491-59"><a href="factor-models-1.html#cb491-59" aria-hidden="true" tabindex="-1"></a><span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb491-60"><a href="factor-models-1.html#cb491-60" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb491-61"><a href="factor-models-1.html#cb491-61" aria-hidden="true" tabindex="-1"></a><span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-285-1.png" width="672" /></p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb492-1"><a href="factor-models-1.html#cb492-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(FF_cp_ts) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>index,<span class="at">y=</span>value, <span class="at">color=</span>series)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb492-2"><a href="factor-models-1.html#cb492-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;tomato3&quot;</span>, <span class="st">&quot;khaki3&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>, <span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;violetred4&quot;</span>)) <span class="sc">+</span></span>
<span id="cb492-3"><a href="factor-models-1.html#cb492-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">&quot;Cumulative Returns&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Relationship of Cumulative factor Returns LS PF&quot;</span>) <span class="sc">+</span></span>
<span id="cb492-4"><a href="factor-models-1.html#cb492-4" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb492-5"><a href="factor-models-1.html#cb492-5" aria-hidden="true" tabindex="-1"></a><span class="at">hjust=</span><span class="fl">0.5</span>,</span>
<span id="cb492-6"><a href="factor-models-1.html#cb492-6" aria-hidden="true" tabindex="-1"></a><span class="at">lineheight=</span><span class="fl">1.2</span>), <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb492-7"><a href="factor-models-1.html#cb492-7" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb492-8"><a href="factor-models-1.html#cb492-8" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb492-9"><a href="factor-models-1.html#cb492-9" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb492-10"><a href="factor-models-1.html#cb492-10" aria-hidden="true" tabindex="-1"></a><span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb492-11"><a href="factor-models-1.html#cb492-11" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb492-12"><a href="factor-models-1.html#cb492-12" aria-hidden="true" tabindex="-1"></a><span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-285-2.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="factor-models.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/NikolasAnic/Empirical_Finance_R_Lab/edit/master/Factor_Models_Backup.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/NikolasAnic/Empirical_Finance_R_Lab/blob/master/Factor_Models_Backup.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
