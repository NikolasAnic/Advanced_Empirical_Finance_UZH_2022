<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Time-Series in Finance and Economics | Empricial Finance and Statistical Analysis</title>
  <meta name="description" content="Chapter 9 Time-Series in Finance and Economics | Empricial Finance and Statistical Analysis" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Time-Series in Finance and Economics | Empricial Finance and Statistical Analysis" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Time-Series in Finance and Economics | Empricial Finance and Statistical Analysis" />
  
  
  

<meta name="author" content="Nikolas Anic &amp; Lorenz Gassmann" />


<meta name="date" content="2022-01-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="factor-models.html"/>

<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Empirical Finance and Statistical Analysis - Theory and Empirics Lab</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction to the course objectives and organisation of the course</a></li>
<li class="chapter" data-level="2" data-path="the-programming-environment.html"><a href="the-programming-environment.html"><i class="fa fa-check"></i><b>2</b> The Programming Environment</a>
<ul>
<li class="chapter" data-level="2.1" data-path="the-programming-environment.html"><a href="the-programming-environment.html#markdown-files"><i class="fa fa-check"></i><b>2.1</b> Markdown Files</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="the-programming-environment.html"><a href="the-programming-environment.html#how-to-create-a-markdown-file"><i class="fa fa-check"></i><b>2.1.1</b> How to create a Markdown File</a></li>
<li class="chapter" data-level="2.1.2" data-path="the-programming-environment.html"><a href="the-programming-environment.html#the-r-markdown-structure"><i class="fa fa-check"></i><b>2.1.2</b> The R Markdown Structure</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="the-programming-environment.html"><a href="the-programming-environment.html#coding-in-r---a-concise-overview"><i class="fa fa-check"></i><b>2.2</b> Coding In R - A concise overview</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="the-programming-environment.html"><a href="the-programming-environment.html#introduction"><i class="fa fa-check"></i><b>2.2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2.2" data-path="the-programming-environment.html"><a href="the-programming-environment.html#vectors"><i class="fa fa-check"></i><b>2.2.2</b> Vectors</a></li>
<li class="chapter" data-level="2.2.3" data-path="the-programming-environment.html"><a href="the-programming-environment.html#data-types"><i class="fa fa-check"></i><b>2.2.3</b> Data Types</a></li>
<li class="chapter" data-level="2.2.4" data-path="the-programming-environment.html"><a href="the-programming-environment.html#data-frames"><i class="fa fa-check"></i><b>2.2.4</b> Data Frames</a></li>
<li class="chapter" data-level="2.2.5" data-path="the-programming-environment.html"><a href="the-programming-environment.html#importing-data"><i class="fa fa-check"></i><b>2.2.5</b> Importing Data</a></li>
<li class="chapter" data-level="2.2.6" data-path="the-programming-environment.html"><a href="the-programming-environment.html#data-manipulation"><i class="fa fa-check"></i><b>2.2.6</b> Data Manipulation</a></li>
<li class="chapter" data-level="2.2.7" data-path="the-programming-environment.html"><a href="the-programming-environment.html#data-reshaping"><i class="fa fa-check"></i><b>2.2.7</b> Data Reshaping</a></li>
<li class="chapter" data-level="2.2.8" data-path="the-programming-environment.html"><a href="the-programming-environment.html#beautiful-graphs-with-ggplot2"><i class="fa fa-check"></i><b>2.2.8</b> Beautiful Graphs with <code>ggplot2</code></a></li>
<li class="chapter" data-level="2.2.9" data-path="the-programming-environment.html"><a href="the-programming-environment.html#dates-and-times"><i class="fa fa-check"></i><b>2.2.9</b> Dates and Times</a></li>
<li class="chapter" data-level="2.2.10" data-path="the-programming-environment.html"><a href="the-programming-environment.html#string-manipulations-in-r-the-stringr-package"><i class="fa fa-check"></i><b>2.2.10</b> String Manipulations in R: The <code>stringr()</code> package</a></li>
<li class="chapter" data-level="2.2.11" data-path="the-programming-environment.html"><a href="the-programming-environment.html#database-queries"><i class="fa fa-check"></i><b>2.2.11</b> Database Queries</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="statistical-properties.html"><a href="statistical-properties.html"><i class="fa fa-check"></i><b>3</b> Statistical Properties</a>
<ul>
<li class="chapter" data-level="3.1" data-path="statistical-properties.html"><a href="statistical-properties.html#random-variables-and-probability-distributions-introdcution"><i class="fa fa-check"></i><b>3.1</b> Random Variables and Probability Distributions: Introdcution</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="statistical-properties.html"><a href="statistical-properties.html#the-concept-of-probability-important-notions-and-definitions"><i class="fa fa-check"></i><b>3.1.1</b> The concept of Probability: Important Notions and Definitions</a></li>
<li class="chapter" data-level="3.1.2" data-path="statistical-properties.html"><a href="statistical-properties.html#random-variables"><i class="fa fa-check"></i><b>3.1.2</b> Random Variables</a></li>
<li class="chapter" data-level="3.1.3" data-path="statistical-properties.html"><a href="statistical-properties.html#discrete-random-variables-and-distributions"><i class="fa fa-check"></i><b>3.1.3</b> Discrete Random Variables and Distributions</a></li>
<li class="chapter" data-level="3.1.4" data-path="statistical-properties.html"><a href="statistical-properties.html#continuous-random-variables-and-distributions"><i class="fa fa-check"></i><b>3.1.4</b> Continuous Random Variables and Distributions</a></li>
<li class="chapter" data-level="3.1.5" data-path="statistical-properties.html"><a href="statistical-properties.html#the-cumulative-distribution"><i class="fa fa-check"></i><b>3.1.5</b> The cumulative Distribution</a></li>
<li class="chapter" data-level="3.1.6" data-path="statistical-properties.html"><a href="statistical-properties.html#continuous-distributions-with-appealing-properties"><i class="fa fa-check"></i><b>3.1.6</b> Continuous Distributions with Appealing Properties</a></li>
<li class="chapter" data-level="3.1.7" data-path="statistical-properties.html"><a href="statistical-properties.html#moments-and-properties-of-bivariate-distributions"><i class="fa fa-check"></i><b>3.1.7</b> Moments and Properties of bivariate distributions</a></li>
<li class="chapter" data-level="3.1.8" data-path="statistical-properties.html"><a href="statistical-properties.html#moments-of-probability-distributions"><i class="fa fa-check"></i><b>3.1.8</b> Moments of Probability Distributions</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="statistical-properties.html"><a href="statistical-properties.html#matrix-algebra-introduction"><i class="fa fa-check"></i><b>3.2</b> Matrix Algebra: Introduction</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="statistical-properties.html"><a href="statistical-properties.html#matrices-and-vectors"><i class="fa fa-check"></i><b>3.2.1</b> Matrices and Vectors</a></li>
<li class="chapter" data-level="3.2.2" data-path="statistical-properties.html"><a href="statistical-properties.html#basic-matrix-operations"><i class="fa fa-check"></i><b>3.2.2</b> Basic Matrix Operations</a></li>
<li class="chapter" data-level="3.2.3" data-path="statistical-properties.html"><a href="statistical-properties.html#summation-notation-in-matrix-form"><i class="fa fa-check"></i><b>3.2.3</b> Summation Notation in Matrix Form</a></li>
<li class="chapter" data-level="3.2.4" data-path="statistical-properties.html"><a href="statistical-properties.html#systems-of-linear-equations"><i class="fa fa-check"></i><b>3.2.4</b> Systems of Linear Equations</a></li>
<li class="chapter" data-level="3.2.5" data-path="statistical-properties.html"><a href="statistical-properties.html#positive-definite-pd-matrix"><i class="fa fa-check"></i><b>3.2.5</b> Positive Definite (PD) Matrix</a></li>
<li class="chapter" data-level="3.2.6" data-path="statistical-properties.html"><a href="statistical-properties.html#multivariate-probability-distributions"><i class="fa fa-check"></i><b>3.2.6</b> Multivariate Probability Distributions</a></li>
<li class="chapter" data-level="3.2.7" data-path="statistical-properties.html"><a href="statistical-properties.html#portfolio-construction-and-mathematical-properties-using-matrix-algebra"><i class="fa fa-check"></i><b>3.2.7</b> Portfolio Construction and Mathematical Properties using Matrix Algebra</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html"><i class="fa fa-check"></i><b>4</b> Inductive Statistics and Regression Analysis Fundamentals</a>
<ul>
<li class="chapter" data-level="4.1" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#inductive-statistics"><i class="fa fa-check"></i><b>4.1</b> Inductive Statistics</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#point-estimators"><i class="fa fa-check"></i><b>4.1.1</b> Point Estimators</a></li>
<li class="chapter" data-level="4.1.2" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#confidence-intervals"><i class="fa fa-check"></i><b>4.1.2</b> Confidence Intervals</a></li>
<li class="chapter" data-level="4.1.3" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#hypothesis-testing"><i class="fa fa-check"></i><b>4.1.3</b> Hypothesis Testing</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#introduction-to-regression-analysis"><i class="fa fa-check"></i><b>4.2</b> Introduction to Regression Analysis</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#the-role-of-correlation"><i class="fa fa-check"></i><b>4.2.1</b> The role of correlation</a></li>
<li class="chapter" data-level="4.2.2" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#the-simple-univariate-regression-model"><i class="fa fa-check"></i><b>4.2.2</b> The simple / univariate regression model</a></li>
<li class="chapter" data-level="4.2.3" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#the-multivariate-regression-model"><i class="fa fa-check"></i><b>4.2.3</b> The multivariate regression model</a></li>
<li class="chapter" data-level="4.2.4" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#goodness-of-fit"><i class="fa fa-check"></i><b>4.2.4</b> Goodness of Fit</a></li>
<li class="chapter" data-level="4.2.5" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#assumption-and-diagnostic-tests-of-ols"><i class="fa fa-check"></i><b>4.2.5</b> Assumption and diagnostic tests of OLS</a></li>
<li class="chapter" data-level="4.2.6" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#properties-of-the-ols-estimator"><i class="fa fa-check"></i><b>4.2.6</b> Properties of the OLS Estimator</a></li>
<li class="chapter" data-level="4.2.7" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#expected-value-and-variance-of-the-multivarite-ols-estimator-if-the-assumptions-hold"><i class="fa fa-check"></i><b>4.2.7</b> Expected Value and Variance of the multivarite OLS estimator if the assumptions hold:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="risk-and-return.html"><a href="risk-and-return.html"><i class="fa fa-check"></i><b>5</b> Risk and Return</a>
<ul>
<li class="chapter" data-level="5.1" data-path="risk-and-return.html"><a href="risk-and-return.html#the-time-series-of-returns---transformations-in-r-1"><i class="fa fa-check"></i><b>5.1</b> The time-series of Returns - Transformations in R</a></li>
<li class="chapter" data-level="5.2" data-path="risk-and-return.html"><a href="risk-and-return.html#security-returns"><i class="fa fa-check"></i><b>5.2</b> Security Returns</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="risk-and-return.html"><a href="risk-and-return.html#simple-returns"><i class="fa fa-check"></i><b>5.2.1</b> Simple Returns</a></li>
<li class="chapter" data-level="5.2.2" data-path="risk-and-return.html"><a href="risk-and-return.html#logarithmic-returns"><i class="fa fa-check"></i><b>5.2.2</b> Logarithmic Returns</a></li>
<li class="chapter" data-level="5.2.3" data-path="risk-and-return.html"><a href="risk-and-return.html#accounting-for-dividends-total-returns"><i class="fa fa-check"></i><b>5.2.3</b> Accounting for Dividends: Total Returns</a></li>
<li class="chapter" data-level="5.2.4" data-path="risk-and-return.html"><a href="risk-and-return.html#truncating-the-data"><i class="fa fa-check"></i><b>5.2.4</b> Truncating the data</a></li>
<li class="chapter" data-level="5.2.5" data-path="risk-and-return.html"><a href="risk-and-return.html#arithmetic-vs.-geometric-returns"><i class="fa fa-check"></i><b>5.2.5</b> Arithmetic vs. Geometric Returns</a></li>
<li class="chapter" data-level="5.2.6" data-path="risk-and-return.html"><a href="risk-and-return.html#cumulative-returns"><i class="fa fa-check"></i><b>5.2.6</b> Cumulative Returns</a></li>
<li class="chapter" data-level="5.2.7" data-path="risk-and-return.html"><a href="risk-and-return.html#periodic-transformation-of-returns"><i class="fa fa-check"></i><b>5.2.7</b> Periodic Transformation of Returns</a></li>
<li class="chapter" data-level="5.2.8" data-path="risk-and-return.html"><a href="risk-and-return.html#annualising-returns"><i class="fa fa-check"></i><b>5.2.8</b> Annualising Returns</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="risk-and-return.html"><a href="risk-and-return.html#portfolio-returns"><i class="fa fa-check"></i><b>5.3</b> Portfolio Returns</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="risk-and-return.html"><a href="risk-and-return.html#equal-weighted-returns"><i class="fa fa-check"></i><b>5.3.1</b> Equal-weighted Returns</a></li>
<li class="chapter" data-level="5.3.2" data-path="risk-and-return.html"><a href="risk-and-return.html#value-weighted-returns"><i class="fa fa-check"></i><b>5.3.2</b> Value-weighted Returns</a></li>
<li class="chapter" data-level="5.3.3" data-path="risk-and-return.html"><a href="risk-and-return.html#timing-of-returns"><i class="fa fa-check"></i><b>5.3.3</b> Timing of Returns</a></li>
<li class="chapter" data-level="5.3.4" data-path="risk-and-return.html"><a href="risk-and-return.html#nominal-vs.-real-returns"><i class="fa fa-check"></i><b>5.3.4</b> Nominal vs. Real Returns</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="risk-and-return.html"><a href="risk-and-return.html#individual-security-risk"><i class="fa fa-check"></i><b>5.4</b> Individual Security Risk</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="risk-and-return.html"><a href="risk-and-return.html#standard-deviation-and-variance"><i class="fa fa-check"></i><b>5.4.1</b> Standard Deviation and Variance</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="risk-and-return.html"><a href="risk-and-return.html#rolling-risk-characteristics"><i class="fa fa-check"></i><b>5.5</b> Rolling Risk Characteristics</a></li>
<li class="chapter" data-level="5.6" data-path="risk-and-return.html"><a href="risk-and-return.html#portfolio-risk"><i class="fa fa-check"></i><b>5.6</b> Portfolio Risk</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="risk-and-return.html"><a href="risk-and-return.html#portfolio-risk-of-two-securities"><i class="fa fa-check"></i><b>5.6.1</b> Portfolio Risk of two securities</a></li>
<li class="chapter" data-level="5.6.2" data-path="risk-and-return.html"><a href="risk-and-return.html#portfolio-risk-for-multiple-assets"><i class="fa fa-check"></i><b>5.6.2</b> Portfolio Risk for Multiple Assets</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="risk-and-return.html"><a href="risk-and-return.html#risk-in-extremes-and-alternative-risk-measures"><i class="fa fa-check"></i><b>5.7</b> Risk in Extremes and Alternative Risk Measures</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="risk-and-return.html"><a href="risk-and-return.html#value-at-risk-var"><i class="fa fa-check"></i><b>5.7.1</b> Value at Risk (VaR)</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="risk-and-return.html"><a href="risk-and-return.html#market-efficiency-and-independence-of-risk-and-return"><i class="fa fa-check"></i><b>5.8</b> Market Efficiency and independence of risk and return</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="risk-and-return.html"><a href="risk-and-return.html#variance-ratio-test"><i class="fa fa-check"></i><b>5.8.1</b> Variance Ratio Test</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="beta.html"><a href="beta.html"><i class="fa fa-check"></i><b>6</b> Beta</a>
<ul>
<li class="chapter" data-level="6.1" data-path="beta.html"><a href="beta.html#application-of-regression-analysis-beta-analysis-in-financial-market-settings"><i class="fa fa-check"></i><b>6.1</b> Application of Regression Analysis: <span class="math inline">\(\beta\)</span> analysis in Financial Market Settings</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="beta.html"><a href="beta.html#the-single-index-model"><i class="fa fa-check"></i><b>6.1.1</b> The Single Index Model</a></li>
<li class="chapter" data-level="6.1.2" data-path="beta.html"><a href="beta.html#estimation-of-the-sim"><i class="fa fa-check"></i><b>6.1.2</b> Estimation of the SIM</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><i class="fa fa-check"></i><b>7</b> Portfolio Theory: Mean-Variance Optimisation and the CAPM</a>
<ul>
<li class="chapter" data-level="7.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#markowitz-portfolio-theory-with-two-risky-assets"><i class="fa fa-check"></i><b>7.1</b> Markowitz Portfolio Theory with two Risky Assets</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-case-of-portfolios"><i class="fa fa-check"></i><b>7.1.1</b> The case of portfolios</a></li>
<li class="chapter" data-level="7.1.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-set-of-attainable-portfolios"><i class="fa fa-check"></i><b>7.1.2</b> The set of attainable portfolios</a></li>
<li class="chapter" data-level="7.1.3" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-minimum-variance-portfolio"><i class="fa fa-check"></i><b>7.1.3</b> The Minimum-Variance Portfolio</a></li>
<li class="chapter" data-level="7.1.4" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-role-of-correlation-on-the-frontier-of-portfolios"><i class="fa fa-check"></i><b>7.1.4</b> The role of correlation on the frontier of portfolios</a></li>
<li class="chapter" data-level="7.1.5" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#efficient-portfolios-with-two-risky-assets"><i class="fa fa-check"></i><b>7.1.5</b> Efficient Portfolios with two risky assets</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#markowitz-portfolio-theory-with-a-risky-and-a-risk-free-asset"><i class="fa fa-check"></i><b>7.2</b> Markowitz Portfolio Theory with a Risky and a Risk-Free Asset</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-capital-allocation-line-cal"><i class="fa fa-check"></i><b>7.2.1</b> The Capital Allocation Line (CAL)</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#markowitz-portfolio-theory-with-two-risky-and-a-risk-free-asset"><i class="fa fa-check"></i><b>7.3</b> Markowitz Portfolio Theory with two Risky and a Risk-Free Asset</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#tangency-portfolio"><i class="fa fa-check"></i><b>7.3.1</b> Tangency Portfolio</a></li>
<li class="chapter" data-level="7.3.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#mutual-fund-theorem-and-derivation-of-the-capital-market-line-cml"><i class="fa fa-check"></i><b>7.3.2</b> Mutual Fund Theorem and Derivation of the Capital Market Line (CML)</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#markowitz-portfolio-theory-with-n-risky-assets"><i class="fa fa-check"></i><b>7.4</b> Markowitz Portfolio Theory with N Risky Assets</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-theoretical-foundations-of-n-assets"><i class="fa fa-check"></i><b>7.4.1</b> The theoretical foundations of N Assets</a></li>
<li class="chapter" data-level="7.4.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-minimum-variance-portfolio-for-n-assets"><i class="fa fa-check"></i><b>7.4.2</b> The Minimum Variance Portfolio for N assets</a></li>
<li class="chapter" data-level="7.4.3" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-efficient-frontier-for-n-assets"><i class="fa fa-check"></i><b>7.4.3</b> The Efficient Frontier for N assets</a></li>
<li class="chapter" data-level="7.4.4" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-efficient-and-feasible-portfolio-cal-of-n-risky-assets-and-a-risk-free-asset"><i class="fa fa-check"></i><b>7.4.4</b> The Efficient and Feasible Portfolio CAL of N risky Assets and a risk-free Asset</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-capital-asset-pricing-model"><i class="fa fa-check"></i><b>7.5</b> The Capital Asset Pricing Model</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#intuition-of-the-capm"><i class="fa fa-check"></i><b>7.5.1</b> Intuition of the CAPM</a></li>
<li class="chapter" data-level="7.5.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#mathematical-derivation-of-the-security-market-line-sml"><i class="fa fa-check"></i><b>7.5.2</b> Mathematical Derivation of the Security Market Line (SML)</a></li>
<li class="chapter" data-level="7.5.3" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#similarity-of-the-cml-and-sml"><i class="fa fa-check"></i><b>7.5.3</b> Similarity of the CML and SML</a></li>
<li class="chapter" data-level="7.5.4" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#diagnostic-tests-of-the-capm"><i class="fa fa-check"></i><b>7.5.4</b> Diagnostic Tests of the CAPM</a></li>
<li class="chapter" data-level="7.5.5" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#fama-macbeth-1973-approach"><i class="fa fa-check"></i><b>7.5.5</b> Fama-MacBeth (1973) approach</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="factor-models.html"><a href="factor-models.html"><i class="fa fa-check"></i><b>8</b> Factor Models</a>
<ul>
<li class="chapter" data-level="8.1" data-path="factor-models.html"><a href="factor-models.html#the-idea-behind-factor-models"><i class="fa fa-check"></i><b>8.1</b> The idea behind factor models</a></li>
<li class="chapter" data-level="8.2" data-path="factor-models.html"><a href="factor-models.html#the-quest-of-detecting-anomalies"><i class="fa fa-check"></i><b>8.2</b> The quest of detecting anomalies</a></li>
<li class="chapter" data-level="8.3" data-path="factor-models.html"><a href="factor-models.html#the-fama-french-three-factor-model"><i class="fa fa-check"></i><b>8.3</b> The Fama-French Three Factor Model</a></li>
<li class="chapter" data-level="8.4" data-path="factor-models.html"><a href="factor-models.html#testing-for-factor-validity"><i class="fa fa-check"></i><b>8.4</b> Testing for factor validity</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="factor-models.html"><a href="factor-models.html#portfolio-sorts"><i class="fa fa-check"></i><b>8.4.1</b> Portfolio Sorts</a></li>
<li class="chapter" data-level="8.4.2" data-path="factor-models.html"><a href="factor-models.html#factor-construction"><i class="fa fa-check"></i><b>8.4.2</b> Factor Construction</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="factor-models.html"><a href="factor-models.html#create-your-own-factors-a-step-by-step-example"><i class="fa fa-check"></i><b>8.5</b> Create your own factors: A step-by-step example</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="factor-models.html"><a href="factor-models.html#setting-up-the-wrds-proxy"><i class="fa fa-check"></i><b>8.5.1</b> Setting up the WRDS proxy</a></li>
<li class="chapter" data-level="8.5.2" data-path="factor-models.html"><a href="factor-models.html#factors-of-interest"><i class="fa fa-check"></i><b>8.5.2</b> Factors of interest</a></li>
<li class="chapter" data-level="8.5.3" data-path="factor-models.html"><a href="factor-models.html#get-the-data-to-construct-the-factors"><i class="fa fa-check"></i><b>8.5.3</b> Get the data to construct the factors</a></li>
<li class="chapter" data-level="8.5.4" data-path="factor-models.html"><a href="factor-models.html#portfolio-sorts-for-different-factors"><i class="fa fa-check"></i><b>8.5.4</b> Portfolio Sorts for different factors</a></li>
<li class="chapter" data-level="8.5.5" data-path="factor-models.html"><a href="factor-models.html#double-sorted-portfolios"><i class="fa fa-check"></i><b>8.5.5</b> Double-sorted Portfolios</a></li>
<li class="chapter" data-level="8.5.6" data-path="factor-models.html"><a href="factor-models.html#the-importance-of-data-selection"><i class="fa fa-check"></i><b>8.5.6</b> The importance of data selection</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html"><i class="fa fa-check"></i><b>9</b> Time-Series in Finance and Economics</a>
<ul>
<li class="chapter" data-level="9.1" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#introduction-1"><i class="fa fa-check"></i><b>9.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#the-concept-of-time-series-modelling"><i class="fa fa-check"></i><b>9.1.1</b> The concept of Time-Series Modelling</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#the-fundamental-notinos-of-time-series-modelling"><i class="fa fa-check"></i><b>9.2</b> The fundamental notinos of time series modelling</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#the-concept-of-stationarity-and-ergodicity"><i class="fa fa-check"></i><b>9.2.1</b> The concept of Stationarity and Ergodicity</a></li>
<li class="chapter" data-level="9.2.2" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#properties-of-time-series"><i class="fa fa-check"></i><b>9.2.2</b> Properties of Time Series</a></li>
<li class="chapter" data-level="9.2.3" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#components-of-time-series"><i class="fa fa-check"></i><b>9.2.3</b> Components of Time Series</a></li>
<li class="chapter" data-level="9.2.4" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#adjustments-of-the-time-series"><i class="fa fa-check"></i><b>9.2.4</b> Adjustments of the time series</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#regression-models-for-time-series"><i class="fa fa-check"></i><b>9.3</b> Regression Models for Time Series</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#using-least-squares-in-time-series-the-forecast-package"><i class="fa fa-check"></i><b>9.3.1</b> Using Least Squares in Time Series: the forecast package</a></li>
<li class="chapter" data-level="9.3.2" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#evaluation-of-a-time-series-regression-model"><i class="fa fa-check"></i><b>9.3.2</b> Evaluation of a time series regression model</a></li>
<li class="chapter" data-level="9.3.3" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#evaluation-of-the-forecasting-accuracy"><i class="fa fa-check"></i><b>9.3.3</b> Evaluation of the forecasting accuracy</a></li>
<li class="chapter" data-level="9.3.4" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#temporal-predictor-variables-in-time-series"><i class="fa fa-check"></i><b>9.3.4</b> Temporal predictor variables in time series</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#decomposition-of-a-time-series"><i class="fa fa-check"></i><b>9.4</b> Decomposition of a Time Series</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#moving-average-smoothing"><i class="fa fa-check"></i><b>9.4.1</b> Moving Average Smoothing</a></li>
<li class="chapter" data-level="9.4.2" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#decomposition-methods-using-classical-decomposition"><i class="fa fa-check"></i><b>9.4.2</b> Decomposition Methods using Classical Decomposition</a></li>
<li class="chapter" data-level="9.4.3" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#decomposition-methods-using-x11"><i class="fa fa-check"></i><b>9.4.3</b> Decomposition Methods using X11</a></li>
<li class="chapter" data-level="9.4.4" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#decomposition-methods-using-stl"><i class="fa fa-check"></i><b>9.4.4</b> Decomposition Methods using STL</a></li>
<li class="chapter" data-level="9.4.5" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#time-series-models-and-predictor-variables"><i class="fa fa-check"></i><b>9.4.5</b> Time-Series Models and Predictor Variables</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#autoregressive-and-moving-average-processes"><i class="fa fa-check"></i><b>9.5</b> Autoregressive and Moving Average Processes</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#ma-processes"><i class="fa fa-check"></i><b>9.5.1</b> MA Processes</a></li>
<li class="chapter" data-level="9.5.2" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#ra-processes"><i class="fa fa-check"></i><b>9.5.2</b> RA Processes</a></li>
<li class="chapter" data-level="9.5.3" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#using-an-rap-process"><i class="fa fa-check"></i><b>9.5.3</b> Using an RA(p) process</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#combining-autoregressive-and-moving-average-processes"><i class="fa fa-check"></i><b>9.6</b> Combining Autoregressive and moving average processes</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#arma-processes"><i class="fa fa-check"></i><b>9.6.1</b> ARMA Processes</a></li>
<li class="chapter" data-level="9.6.2" data-path="time-series-in-finance-and-economics.html"><a href="time-series-in-finance-and-economics.html#using-an-armapq-process"><i class="fa fa-check"></i><b>9.6.2</b> Using an ARMA(p,q) process</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Empricial Finance and Statistical Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="time-series-in-finance-and-economics" class="section level1" number="9">
<h1><span class="header-section-number">Chapter 9</span> Time-Series in Finance and Economics</h1>
<div id="introduction-1" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> Introduction</h2>
<p><em>Note</em> that the chapters on Time-Series and Volatility forecasting are written with help of the materials provided by <em>Rob J Hyndman and George Athanasopoulos</em>. Therein, it follows the structure of their book <em>Forecasting: Principles and Practices</em>. The authors flag their work as Open-Source material, implying that the use and replication of their work is granted if the required citation practices are fulfilled. Wherever parts are directly copied, this will be explicitly stated. We are very thankful to Prof. Hyndman and Prof. Athanasopoulos for their tireless contribution in the field of public-source financial analytics. Let’s now start with the chapter.</p>
<div id="the-concept-of-time-series-modelling" class="section level3" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> The concept of Time-Series Modelling</h3>
<p>Both financial and economic variables are, to a certain extent, time ordered. This implies that we observe the data throughout time, meaning that we work with time-series data.</p>
<p>Thus far, we have solely considered financial analytics aspects in retrospective. That is, we worked with past data to assign, describe, summarise and evaluate data. Although these methods are material to any investment cycle, their primary function is to deduce past behaviour. Consequently, these methods do not automatically obtain a forward-looking character, thereby they do not provide much information on how past movements can be related to future expectations.</p>
<p>As a consequence, we will now introduce the concept of <strong>forecasting</strong>. This is a part of financial analytics which enables us to deduce future behaviour based on past observations. Throughout, we will especially focus on <strong>quantitative forecasting</strong>. This requires us to assume two conditions:</p>
<ul>
<li>data about the past is available</li>
<li>data is prone to trends which assumes that past patterns are recurrent in the future</li>
</ul>
<p>Within the domain of quantitative forecasting, practitioners often refer to the term of <strong>time-series data</strong>. In general, each sequential observation collected at regular intervals over time can be considered a time-series. Examples include Annual Profits, Stock Prices, Hourly Public Transport data, Minute-based communication data or higher interval data.</p>
<p>The main emphasis of time-series forecasting is to estimate whether and <strong>how the past sequence of observations will behave into the future</strong>.</p>
<p>If we assume that the past behavior of a variable is connected to potential future movements, then we understand that the time order of the data is important due to the intertemporal dependencies of the variable. In said case, we need to incorporate time dependence into the probability models we use to forecast and deduce relationships of the data.</p>
<p>We call the time-series dependence of variables <strong>autocorrelation</strong>. We have seen it already in a previous chapter, in which we introduced the HAC standard error corrections. Autocorrelation implies that we need to maintain the time order of the data in order to define statistical dependencies through a model. However, a large issue here is that the baseline assumptions of random sampling and, subsequently, the use of IID observations, cannot longer hold explicitely as we have a certain dependence of our data in time-series settings.</p>
<p>In essence, in order to accurately define time-series models, we need to make sure that the observed data is similar to our population parameters while simultaneously allowing the variables to have time-series dependencies (or to be autocorrelated). This is possible if we can show that the time-series data is derived from a <strong>stationary time-series process</strong>.</p>
<p>We will follow-up on this theorem later on. Throughout this chapter, we will introduce the theoretical concepts as well as the practical implications of working with and analysing time-series data. In general, we will review fundamental time series concepts vital for analysing and modeling financial time-series data. We first introduce time-series concepts graphically and show how visualisation techniques are useful to deduce time-wise dependencies within our data. We then focus on time-series decompositions and show on what factors time-series variables can rely on. We then define univariate time-series processes and introduce the concepts of stationarity as well as ergodicity. Based on this, we define time-series which are covariance stationary. This will provide us with the main concept to measure linear time dependency using autocorrelation. Further, we will follow-up on the discussion of Gaussian White Noise Models (GWN) in order to relate their behaviour to time-wise dependent variables. Showing the respective statistical properties, we then show why stationarity is important to allow for autocorrelation models. Therein, we introduce time series models such as exponential smoothing methods and autoregressive moving average processes. By deriving their properties and using simulations, we attempt to understand their inner workings. Ultimately, we apply the models to forecast observations, by first introducing simple time-series stationarity models and then changing to more advanced topics.</p>
</div>
</div>
<div id="the-fundamental-notinos-of-time-series-modelling" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> The fundamental notinos of time series modelling</h2>
<p>Time-Series processes, or <strong>discrete-time stochastic processes</strong>, expressed as</p>
<p><span class="math display">\[
Y_{-\infty}, \dots, Y_t, Y_{t+1}, \dots, Y_{\infty}  = {Y_t}^\infty_{t=-\infty}
\]</span></p>
<p>is a consortium of random variables of data which are ordered in time. That is, the observations that constitute a time-series are ordered throughout the time period in which they were registered. Also known as panel data, the time-based ordering of such vectors or matrices <strong>relates the observations of a single quantity (e.g. variable) throughout time</strong>. This notion is key to comprehend the concept of time series, as this implicit, time-based ordering implies that the data is likely to follow a certain, time-dependent structure, yielding the conclusion that observations in close <em>timewise proximity to each other tend to be correlated</em>. Said timewise correlation would automatically threaten the assumption of independence that we have made throughout the previous chapters. Remember that we said in order to derive models that can capture the underlying co-movements between variables, we need to assume that the observations are independent and identically distributed (IID). We derived that, in random sampling from a population, the ordering of the random variables representing the sample does not matter because they are independent. This was important because it allowed us to derive properties related to the distribution of estimators, linearity, asymptotic normality as well as efficiency. In essence, we assumed IID in order to be able to draw valid causal conclusions on the co-dependence of variables.</p>
<p>However, in time-series settings, we can no longer implicitly assume that observations are independent of each other. Especially, modeling time series data, we propose that the <em>ordering of the observations throughout time</em> is of essence as we assume that <em>co-movements of a variable with itself persist and are captured by their temporal relationship with one another</em>. Consequently, the models we have encountered so far are inappropriate for modeling temporally dependent data, as they assume that the observations are independent of each other.</p>
<p>As is with previous modeling techniques, the main goal of time series modeling is to derive the acute probabilistic functions of the discrete-time stochastic processes that are thought to best possibly have generated the sample data under consideration. That is, we want to create a model which best possibly fits the data, that’s nothing new. Further, we want to be able to assume that the behavior of the sample data follows similar properties as the population data, which is required to assume causality of the underlying data generating process.</p>
<p>However, now we are working with different assumptions that we expect the data adheres to. Consequently, we want to be able to use the observed sample to estimate important characteristics of a time series model such as measures of time dependence. In order to do this, we need to make a number of <strong>assumptions regarding the joint behavior of the random variables in the stochastic process</strong> such that we may treat the <strong>stochastic process in much the same way as we treat a random sample from a given population</strong>. Essentially, we want to obtain similar models as we used during the IID assumptions such that we can follow the same strategy to draw causal conclusions and identify best possibly the underlying co-movements, just within time-ordered data.</p>
<div id="the-concept-of-stationarity-and-ergodicity" class="section level3" number="9.2.1">
<h3><span class="header-section-number">9.2.1</span> The concept of Stationarity and Ergodicity</h3>
<p>The fundamental concept of time series modeling can be related to the idea of <strong>stationarity</strong>.</p>
<p>To understand why, let’s focus again on the random sampling property on which we usually rely for any data generating process. Throughout, we state that we sample observations from a population as a sequence of IID random variables <span class="math inline">\(X_i\)</span>. Consequently, we were able to show that each <span class="math inline">\(X_i\)</span> underlies the identical probability distribution <span class="math inline">\(F_X\)</span>, such that <span class="math inline">\(X_i \sim F_X\)</span>. Based on this distributional characteristic, we practically create all of the variable properties and modeling techniques we have thus far encountered. This allowed us to assume concepts such as consistency, asymptotic normality or efficiency, enabled us to create models which quantify the co-dependence of covariates and test these models in order to conduct valid inference.</p>
<p>Now, within time series, the IID assumption appears to be no longer desirable. We still want the random variables to be identically distributed, but we no longer want to assume that they are independent of each other. In time series contexts, we are likely to presume that certain, time-ordered random variables show a dependence with each other (for instance, two observations that are adjacent to each other), while others show no or little dependence (for instance, two observations far from one another).</p>
<p>In essence, it is the aim to allow time series models to account for the fact that certain random variables are in dependence to each other while other are not. Importantly, we want to generalise this claim such that we can account for seemingly random dependence between random variables (and thus allow for trends, features, seasonality etc).</p>
<p>In order for us to be able to crate such models, we need to use the concepts of <strong>stationarity</strong> and <strong>ergodicity</strong></p>
<div id="stationarity" class="section level4" number="9.2.1.1">
<h4><span class="header-section-number">9.2.1.1</span> Stationarity</h4>
<p>In essence, there are three forms of stationary processes. The first one constitutes <strong>Strict Stationarity</strong>.</p>
<p>We define a stochastic process to be <em>strictly stationary</em> if the Joint Distribution of <span class="math inline">\((X_{t_1}, \dots, X_{t_r})\)</span> is the same as for <span class="math inline">\((X_{t_{1}-t}, \dots, X_{t_r-t})\)</span>, for any value of t and any finite integer r. This implies that the joint distribution is <strong>time invariant</strong>. This means that the joint distribution of the random variables <em>does not change over time</em>. Consequently, the <em>individual random variables <span class="math inline">\(X_t\)</span> have the same marginal distribution <span class="math inline">\(F_X\)</span></em>. This means that properties such as <strong>mean, variance etc. do not change throughout time</strong>. However, within strict stationarity, we do not assume anything about the correlations between the random variables, except for that the correlation between <span class="math inline">\(X_t\)</span> and <span class="math inline">\(X_{t_r}\)</span> depends only on the time between <span class="math inline">\(X_t\)</span> and <span class="math inline">\(X_{t_r}\)</span>. Consequently, strict stationarity <strong>allows for temporal dependence between the random variables</strong>.</p>
<p>Strict Stationarity imposes the greatest restrictions to a time series, because we need to assume that the moments of the random variables are identical, or time invariant.</p>
<p>The second form of stationarity is <strong>Covariance Stationarity</strong>.</p>
<p>We define a <em>covariance stationary</em> stochastic process if:</p>
<ul>
<li><span class="math inline">\(E[X_t] = \mu &lt; \infty\)</span></li>
<li><span class="math inline">\(var(X_t) = \sigma^2 &lt; \infty\)</span></li>
<li><span class="math inline">\(cov(X_t,X_{t-j} = \gamma_j &lt; \infty\)</span> and depends only on j</li>
</ul>
<p>The third assumption introduces an important concept on temporal correlation. <span class="math inline">\(\gamma_j\)</span> is called the <strong>j^{th} autocovariance</strong> term. From it, we can deduce the <strong>j^{th} autocorrelation coefficient</strong> as:</p>
<p><span class="math display">\[
\rho_j = \frac{cov(X_t, X_{t-j})}{\sqrt{var(X_t)var(X_{t-j})}} = \frac{\gamma_j}{\sigma^2}
\]</span></p>
<p>Note that we covered some of this already in the part on regression techniques. Therein, we stated that</p>
<ul>
<li><span class="math inline">\(\gamma_j\)</span> measures the direction of the linear dependence between <span class="math inline">\(X_t\)</span> and <span class="math inline">\(X_{t-j}\)</span></li>
<li><span class="math inline">\(\rho_j\)</span> measures the direction and strength of the linear dependence between <span class="math inline">\(X_t\)</span> and <span class="math inline">\(X_{t-j}\)</span></li>
</ul>
<p>In essence, <span class="math inline">\(\rho_j\)</span> is nothing else than the time-series correlation coefficient, and works identical to the cross-sectional counterpart. As such, they <strong>measure the temporal linear dependence between two observations</strong>.</p>
<p>The major difference between covariance stationarity and strict stationarity is that, in the former, we only assume the <strong>mean, variance and autocovariance terms to be time invariant</strong>, instead of the entire joint distribution. This relaxation of moment invariance properties is important.</p>
<p>We can graphically display the autocorrelation (or temporal dependence) by plotting <span class="math inline">\(\rho_j\)</span> against j. This is called the autocorrelation function (ACF). Let’s plot it when assuming that <span class="math inline">\(\rho_j = 0.5^j\)</span>.</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb510-1"><a href="time-series-in-finance-and-economics.html#cb510-1" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">=</span> <span class="fl">0.5</span></span>
<span id="cb510-2"><a href="time-series-in-finance-and-economics.html#cb510-2" aria-hidden="true" tabindex="-1"></a>c_rho <span class="ot">=</span> (rho)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) </span>
<span id="cb510-3"><a href="time-series-in-finance-and-economics.html#cb510-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ts.plot</span>(c_rho, <span class="at">type=</span><span class="st">&quot;h&quot;</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&quot;blue&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;Lag j&quot;</span>, </span>
<span id="cb510-4"><a href="time-series-in-finance-and-economics.html#cb510-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">ylab=</span><span class="fu">expression</span>(rho[j]))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-349-1.png" width="672" /></p>
<p>In this case, the linear dependence decays with increasing lags, whereas the decay factor is the power of the lag. As such, we can see that the linear dependence between observations declines with increasing time.</p>
<p>An important concept we need to cover is related to the normality assumption of the data. Covariance stationarity implies that <span class="math inline">\(E[X_t]\)</span> and <span class="math inline">\(var(X_t)\)</span> must be finite numbers. This is only true if we assume that the data is <strong>normally distributed</strong>, but not if, for example, the data is t-student distribution. This is the case because <strong>a normal distribution is completely defined by its first 2 moments</strong>.</p>
<div id="the-gaussian-white-noise-gwn-process" class="section level5" number="9.2.1.1.1">
<h5><span class="header-section-number">9.2.1.1.1</span> The Gaussian White Noise (GWN) process</h5>
<p>So far, we have worked with models which assumed the following two properties of random variables:</p>
<ul>
<li><span class="math inline">\(X_t \sim\)</span> IID</li>
<li><span class="math inline">\(X_t \sim N(0, \sigma^2)\)</span></li>
</ul>
<p>That is, random variables are assumed to be drawn from random samples such that they are independent and identically distributed, while they share the property of zero mean and variance of <span class="math inline">\(\sigma^2\)</span>. Processes with these specific characteristics are called <strong>Gaussian White Noise</strong> processes. They are the most common form of processes that we encounter in statistical inference settings. Remember that, in GWN processes, we do make explicit assumptions of time independence for both moments. That is, we assume that the <em>mean, variance as well as the covariance between observations is independent of t</em>.</p>
<p>This insight here is especially important for deductive statistics. Let’s understand why. So, we know that, in order to draw valid inference, we need to assume stationarity. This is because only then we can assume that all moments of a distribution of random variables are invariant and, as such, the joint distribution of the random variables <em>does not change over time</em> (making it possible to perform random samples). Now, we understand that strict stationarity is quite impossible to obtain in itself. However, we know that covariance stationary processes make a weaker assumption and only assume the mean, variance and covariance (hence, the first two moments) to be time invariant. Hence, if we can find distributions which are entirely defined by their first two moments, then these distributions would fulfill strong stationarity properties (because the only moments which count are the first two moments and if they are time invariant then we have covariance stationarity). Now, the most prominent of such distributions is called the Normal Distribution. Consequently, models which assume that the random variables follow a normal distribution <em>satisfy the properties of covariance stationary processes</em> and are thus <strong>covariance stationary</strong>.</p>
<p>Following up, the GWN assumes gaussian distribution of its random variables. The defining characteristic of a GWN process is the lack of any predictable pattern over time in the realized values of the process, thereby assuming IID draws. This “White Noise” term represents the lack of any predictable signal in the data.</p>
<p>In essence, we now understand that data generating processes which satisfy GWN properties can be assumed to be stationary. It is fairly straightforward to draw GWN processes. We can do so by simply generating a random normal process. Let’s simulate one.</p>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-350-1.png" width="672" /></p>
<p>Relating this now to financial markets, we may have encountered similar processes already, correct? Well, let’s look at the return structure of the Big Four Swiss companies to evaluate any similarity.</p>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-351-1.png" width="672" /></p>
<p>As we can see, the distribution of returns is quite similar to the GWN process encountered before. In essence, we can <strong>represent the distribution of returns in terms of a GWN process</strong> as follows:</p>
<p><span class="math display">\[
r_t = \mu + \epsilon_t \sim GWN(0, \sigma^2)
\]</span></p>
<p>where the <em>return is constructed as GWN process plus a constant</em>. This implies that the <strong>return is a GWN process with a non-zero mean</strong>.</p>
<p>This is the reason why we operate with returns instead of prices. Because returns can be represented by GWN processes with a constant. Since we now know that GWN processes adhere to strong stationarity properties, we thus can draw valid inference on return-based characteristics of financial assets.</p>
</div>
</div>
<div id="non-stationarity" class="section level4" number="9.2.1.2">
<h4><span class="header-section-number">9.2.1.2</span> Non-Stationarity</h4>
<p>In a covariance stationary stochastic process it is assumed that the means, variances and autocovariances are independent of time. In a non-stationary process, one or more of these assumptions is not true. For the sake of completenss, and because we heard the term already a gazillion times, let’s quickly introduce the non-stationarity within random walk processes.</p>
<div id="random-walk-processes" class="section level5" number="9.2.1.2.1">
<h5><span class="header-section-number">9.2.1.2.1</span> Random Walk Processes</h5>
<p>The classical <strong>Random Walk Process</strong> is defied as:</p>
<p><span class="math display">\[
X_t = X_{t-1} + \epsilon_t 
\]</span></p>
<p>Whereas <span class="math inline">\(\epsilon_t \sim N(0, \sigma^2\)</span>.</p>
<p>Now, by recurive subaddition, we obtain that:</p>
<p><span class="math display">\[
X_t = X_0 + \epsilon_1 + \dots + \epsilon_t = Y_0 + \sum_{j=1}^t \epsilon_j
\]</span></p>
<p>That is, the t’th observation depends on the first observation and the sum of all normally distributed eror terms up to t.</p>
<p>The issue is now, that:</p>
<p><span class="math display">\[
var(X_t) = var(X_0 + \sum_{j=1}^t \epsilon_j) = var(X_0) + var(\sum_{j=1}^t \epsilon_j) = var(\sum_{j=1}^t \sigma_\epsilon^2) = t \times \sigma_\epsilon^2
\]</span></p>
<p>As the second moment depends on t and is thus not time invariant, the random walk process cannot be stationary.</p>
<p>Let’s visualise the random walk process.</p>
<div class="sourceCode" id="cb511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb511-1"><a href="time-series-in-finance-and-economics.html#cb511-1" aria-hidden="true" tabindex="-1"></a>sequence <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">30</span>,<span class="dv">1</span>)</span>
<span id="cb511-2"><a href="time-series-in-finance-and-economics.html#cb511-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb511-3"><a href="time-series-in-finance-and-economics.html#cb511-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> sequence){</span>
<span id="cb511-4"><a href="time-series-in-finance-and-economics.html#cb511-4" aria-hidden="true" tabindex="-1"></a>  v <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">200</span>)</span>
<span id="cb511-5"><a href="time-series-in-finance-and-economics.html#cb511-5" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">=</span> <span class="fu">cumsum</span>(v)</span>
<span id="cb511-6"><a href="time-series-in-finance-and-economics.html#cb511-6" aria-hidden="true" tabindex="-1"></a>  names <span class="ot">=</span> <span class="fu">paste0</span>(<span class="st">&quot;x_&quot;</span>, i)</span>
<span id="cb511-7"><a href="time-series-in-finance-and-economics.html#cb511-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="sc">==</span><span class="dv">1</span>) {</span>
<span id="cb511-8"><a href="time-series-in-finance-and-economics.html#cb511-8" aria-hidden="true" tabindex="-1"></a>    x_final <span class="ot">=</span> x</span>
<span id="cb511-9"><a href="time-series-in-finance-and-economics.html#cb511-9" aria-hidden="true" tabindex="-1"></a>    names_final <span class="ot">=</span> names</span>
<span id="cb511-10"><a href="time-series-in-finance-and-economics.html#cb511-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb511-11"><a href="time-series-in-finance-and-economics.html#cb511-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb511-12"><a href="time-series-in-finance-and-economics.html#cb511-12" aria-hidden="true" tabindex="-1"></a>    x_final <span class="ot">=</span> <span class="fu">cbind</span>(x_final, x)</span>
<span id="cb511-13"><a href="time-series-in-finance-and-economics.html#cb511-13" aria-hidden="true" tabindex="-1"></a>    names_final <span class="ot">=</span> <span class="fu">cbind</span>(names_final, names)</span>
<span id="cb511-14"><a href="time-series-in-finance-and-economics.html#cb511-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb511-15"><a href="time-series-in-finance-and-economics.html#cb511-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb511-16"><a href="time-series-in-finance-and-economics.html#cb511-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb511-17"><a href="time-series-in-finance-and-economics.html#cb511-17" aria-hidden="true" tabindex="-1"></a>x_final_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(x_final)</span>
<span id="cb511-18"><a href="time-series-in-finance-and-economics.html#cb511-18" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(x_final_df) <span class="ot">&lt;-</span> names_final</span>
<span id="cb511-19"><a href="time-series-in-finance-and-economics.html#cb511-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb511-20"><a href="time-series-in-finance-and-economics.html#cb511-20" aria-hidden="true" tabindex="-1"></a>x_final_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(x_final_df, <span class="at">order.by =</span> <span class="fu">as.Date</span>(stocks_SMI[<span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>,<span class="dv">1</span>]))</span>
<span id="cb511-21"><a href="time-series-in-finance-and-economics.html#cb511-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb511-22"><a href="time-series-in-finance-and-economics.html#cb511-22" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(x_final_ts) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>index,<span class="at">y=</span> value, <span class="at">color=</span>series)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb511-23"><a href="time-series-in-finance-and-economics.html#cb511-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">&quot;Cumulative Sum of the Returns&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Return of the 30 Random Walk Processes over 20 years&quot;</span>) <span class="sc">+</span></span>
<span id="cb511-24"><a href="time-series-in-finance-and-economics.html#cb511-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Return&#39;</span>) <span class="sc">+</span></span>
<span id="cb511-25"><a href="time-series-in-finance-and-economics.html#cb511-25" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb511-26"><a href="time-series-in-finance-and-economics.html#cb511-26" aria-hidden="true" tabindex="-1"></a><span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb511-27"><a href="time-series-in-finance-and-economics.html#cb511-27" aria-hidden="true" tabindex="-1"></a><span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb511-28"><a href="time-series-in-finance-and-economics.html#cb511-28" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb511-29"><a href="time-series-in-finance-and-economics.html#cb511-29" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb511-30"><a href="time-series-in-finance-and-economics.html#cb511-30" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb511-31"><a href="time-series-in-finance-and-economics.html#cb511-31" aria-hidden="true" tabindex="-1"></a><span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb511-32"><a href="time-series-in-finance-and-economics.html#cb511-32" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb511-33"><a href="time-series-in-finance-and-economics.html#cb511-33" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb511-34"><a href="time-series-in-finance-and-economics.html#cb511-34" aria-hidden="true" tabindex="-1"></a><span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>), </span>
<span id="cb511-35"><a href="time-series-in-finance-and-economics.html#cb511-35" aria-hidden="true" tabindex="-1"></a><span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-352-1.png" width="672" /></p>
<p>As you may note, this is very similar to price processes of financial instruments. As the variance of the process increases linearly with time, the uncertainty about where the process will be at a given point in time increases with time. This can be seen by the increasing gap of the lowest and highest return.</p>
</div>
</div>
<div id="ergodicity" class="section level4" number="9.2.1.3">
<h4><span class="header-section-number">9.2.1.3</span> Ergodicity</h4>
<p>Having covered covariance stationarity, it is also useful to dig a little into ergodicity. In covariance stationary processes we have not yet made any assumptions about the magnitude of the linear dependence term, <span class="math inline">\(\rho\)</span>. Although we can assume that <span class="math inline">\(\rho_1 = \rho_2 = \dots = \rho_{100}\)</span>, it is reasonable to assume that the <strong>strength of linear dependence diminishes with time</strong>. That is: <span class="math inline">\(\rho_1 &gt; \rho_2 &gt; \dots\)</span>, such that <span class="math inline">\(\rho_j = 0\)</span>. The assumption of diminishing linear dependence is captured by the term <strong>ergodicity</strong>.</p>
<p>Although ergodicity requires a little deeper knowledge about statistics, we can say that, in essence, ergodic processes are stochastic processes in which <span class="math inline">\(X_t\)</span> and <span class="math inline">\(X_{t-j}\)</span> are quasi independent for large enough j.</p>
<p>Consequently, GWN processes are assumed to be both ergodic and covariance stationary.</p>
</div>
<div id="stationary-and-ergodic-multivariate-time-series" class="section level4" number="9.2.1.4">
<h4><span class="header-section-number">9.2.1.4</span> Stationary and ergodic multivariate time series</h4>
<p>To be completed.</p>
</div>
</div>
<div id="properties-of-time-series" class="section level3" number="9.2.2">
<h3><span class="header-section-number">9.2.2</span> Properties of Time Series</h3>
<p>Within time-series analysis, we need to model the behaviour of not GWN, but solely covariance stationary and ergodic stochastic processes. Consequently, the properties of time-series processes are largely identical to the ones of GWN processes, with the distinct difference of a time-based linear dependence, quantified by the autocorrelation coefficient discussed. Let’s quickly recapitulate the properties.</p>
<div id="mean" class="section level4" number="9.2.2.1">
<h4><span class="header-section-number">9.2.2.1</span> Mean</h4>
<p>The <strong>mean</strong> of a time series is defined as:</p>
<p><span class="math display">\[
\mu_t = E[X_t]
\]</span></p>
<p>for all time periods t of the random variable.</p>
<p>If we assume the mean to be constant over time, then the estimate will be:</p>
<p><span class="math display">\[
\hat\mu = \frac{1}{n}\sum_{t=1}^n x_t
\]</span></p>
<p>If the mean of the data is not constant, for instance if we have seasonality or trends, then we can estimate it with time series modelling techniques described in later parts of this topic.</p>
</div>
<div id="variance-1" class="section level4" number="9.2.2.2">
<h4><span class="header-section-number">9.2.2.2</span> Variance</h4>
<p>The <strong>variance</strong> of a time series is defined as:</p>
<p><span class="math display">\[
\sigma_t^2 = var[X_t] = E[X_t^2] - E[X_t]^2
\]</span></p>
<p>for all time periods t of the random variable.</p>
<p>Again, if we assume the variance to be constant over time, then the estimate will be:</p>
<p><span class="math display">\[
\hat\mu = \frac{1}{n}\sum_{t=1}^n (x_t - \hat\mu)^2 
\]</span>
#### Autocovariance and Autocorrelation</p>
<p>The concept of autocovariance and autocorrelation is defined as terms of <strong>direction as well as strength of linear time-based dependence of a random variable</strong>. Within, we measure the time-series, and not the cross-sectional, co-dependence of the data, as opposed to the usual terms of covariance and correlation.</p>
<p><em>Autocovariance</em> is defined as:</p>
<p><span class="math display">\[
\gamma_{s,t} = Cov(X_s, X_{t}) = E[X_sX_{t}] - E[X_s] - E[X_{t}]
\]</span></p>
<p><em>Autocorrelation</em> is thereby defined as:</p>
<p><span class="math display">\[
\rho_{s,t} = \frac{cov(X_s, X_{t})}{\sqrt{var(X_s)var(X_{t})}} = \frac{\gamma_{s,t}}{\sigma_s\sigma_t}
\]</span></p>
<p>To determine both functions for data, we assume that the <strong>dependence structure remains constant over time</strong>. That is we assume:</p>
<p><span class="math display">\[
\gamma_{s,t} = Cov(X_s, X_{t}) = Cov(X_{s+k}, X_{t+k}) = \gamma_{s+k, t+k}
\]</span></p>
<p>This is a vital property, because we state that the dependence of two observations is identical as long as their time-based difference is identical. This means that the covariance does not depend on the starting point of the observation, but only on the <strong>lag <span class="math inline">\(\tau\)</span> = |s - t|</strong>.</p>
<p>This assumption allows us to greatly break down the autocovariance structure of the random variables, because we don’t assume that each observation in time uniquely depends on each different observation in time. Therefore the only <em>autocovariances</em> that need to be calculated are:</p>
<p><span class="math display">\[
\gamma_\tau = Cov(X_t, X_{t - j}) = Cov(X_t, X_{t + \tau})
\]</span></p>
<p>and, consequently, the <em>autocorrelations</em>:</p>
<p><span class="math display">\[
\rho_\tau = \frac{Cov(X_t, X_{t + \tau})}{\sqrt{var(X_t)var(X_{t+\tau})}} = \frac{\gamma_\tau}{\sigma^2} = \frac{\gamma_\tau}{\gamma_0}
\]</span></p>
<p>This is vital because we can see here that both the variance as well as the autocorrelation <strong>do not depend on the original time point t</strong>. Consequently, we understand that, by assuming a constant dependence structure, we make sure that the process remains <strong>stationary</strong>.</p>
<p>Note that the ergodicity property still holds, as ergodicity only considers the time-based differene between two observations and assumes a diminishing effect with increased difference.</p>
<div id="estimation-of-the-autocovariance-and-autocorrelation" class="section level5" number="9.2.2.2.1">
<h5><span class="header-section-number">9.2.2.2.1</span> Estimation of the autocovariance and autocorrelation</h5>
<p>In order to estimate the autocorrelation, recall that for any two sets of random variables (<span class="math inline">\(x_1 \dots x_n\)</span>) (<span class="math inline">\(y_1 \dots y_n\)</span>) the sample covariance and correlation functions are given by:</p>
<p><span class="math display">\[
\begin{align}
\hat{Cov(x,y)} &amp;= \frac{1}{n-1}\sum_{i=1}^n(x_i - \bar{x})(y_i - \bar{y})\\
\hat{\rho}_{x,y} &amp;= \frac{Cov(x,y)}{\sigma_x\sigma_y}
\end{align}
\]</span></p>
<p>We can easily transfer the idea of estimating covariances into a time-series setting by just measuring the autocovariance, which is the covariance between a single time series and itself at different lags. Note that this is not yet a matrix because we assume that the starting point of each observation is redundant for the linear dependence.</p>
<p>In that case, we can estimate the different lags. For instance, the <em>sample autocovariance function at lag 0</em>, denoted by <span class="math inline">\(\hat\gamma_0\)</span>, is the covariance of <span class="math inline">\((x_1, \dots, x_n)\)</span> with itself:</p>
<p><span class="math display">\[
\hat\gamma_0 = \frac{1}{n-1}\sum_{t=1}^n(x_t - \bar{x})(x_t - \bar{x}) = \hat\sigma^2
\]</span>
consequently, the autocorrelation function measures the correlation between the series and itself and is defined as:</p>
<p><span class="math display">\[
\hat\rho_0 = \frac{Cov(x,x)}{\sigma_x\sigma_x} = 1
\]</span></p>
<p>Based on this, we can create the estimates of all lagged autocovariances. For instance, the <em>sample autocovariance function at lag k</em>, denoted by <span class="math inline">\(\hat\gamma_\tau\)</span>, is the covariance of <span class="math inline">\((x_1, \dots, x_n)\)</span> with <span class="math inline">\((x_{1+\tau}, \dots, x_{n+\tau})\)</span>:</p>
<p><span class="math display">\[
\hat\gamma_\tau = \frac{1}{n}\sum_{t=1}^{n-\tau}(x_t - \bar{x})(x_{t+\tau} - \bar{x})
\]</span>
and the autocorrelation at <span class="math inline">\(\tau\)</span> is:</p>
<p><span class="math display">\[
\hat\rho_\tau = \frac{\hat\gamma_\tau}{\sigma_{x}\sigma_{x}} = \frac{\hat\gamma_\tau}{\hat\gamma_0}
\]</span></p>
<p>We can calculate the autocorrelation function in R using the command <code>acf(x, lag.max)</code> where <code>x</code> is the time series and <code>lag.max</code> is the maximum lag you wish to calculate the autocorrelation function for.</p>
</div>
</div>
<div id="the-correlogram" class="section level4" number="9.2.2.3">
<h4><span class="header-section-number">9.2.2.3</span> The correlogram</h4>
<p>The ACF states the autocorrelation factor between two time-ordered random variables, whereas it only depends on the lag between two observations. In addition, the <strong>correlogram</strong> is a plot of the autocorrelation function for different lags. It is used to visualise any autocorrelation of the data.</p>
<p>It will essentially provide information on the <strong>presence of trends</strong>, the <strong>seasonal variation</strong> as well as <strong>short term correlation patterns</strong>.</p>
<p>Let’s consider the following example of the company Nestle</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb512-1"><a href="time-series-in-finance-and-economics.html#cb512-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s create the ggplot</span></span>
<span id="cb512-2"><a href="time-series-in-finance-and-economics.html#cb512-2" aria-hidden="true" tabindex="-1"></a>bacf <span class="ot">&lt;-</span> stocks_SMI_ts_ret[,<span class="dv">1</span>] <span class="sc">%&gt;%</span> <span class="fu">acf</span>(<span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb512-3"><a href="time-series-in-finance-and-economics.html#cb512-3" aria-hidden="true" tabindex="-1"></a>bacfdf <span class="ot">&lt;-</span> <span class="fu">with</span>(bacf, <span class="fu">data.frame</span>(lag, acf))</span>
<span id="cb512-4"><a href="time-series-in-finance-and-economics.html#cb512-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-5"><a href="time-series-in-finance-and-economics.html#cb512-5" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">tidy</span>(stocks_SMI_ts_ret[,<span class="dv">1</span>]) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>index,<span class="at">y=</span> value, <span class="at">color=</span>series)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb512-6"><a href="time-series-in-finance-and-economics.html#cb512-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">&quot;Returns&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Return of the company Nestle from 1988 to 2020&quot;</span>) <span class="sc">+</span></span>
<span id="cb512-7"><a href="time-series-in-finance-and-economics.html#cb512-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Return&#39;</span>) <span class="sc">+</span></span>
<span id="cb512-8"><a href="time-series-in-finance-and-economics.html#cb512-8" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb512-9"><a href="time-series-in-finance-and-economics.html#cb512-9" aria-hidden="true" tabindex="-1"></a><span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb512-10"><a href="time-series-in-finance-and-economics.html#cb512-10" aria-hidden="true" tabindex="-1"></a><span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb512-11"><a href="time-series-in-finance-and-economics.html#cb512-11" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb512-12"><a href="time-series-in-finance-and-economics.html#cb512-12" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb512-13"><a href="time-series-in-finance-and-economics.html#cb512-13" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb512-14"><a href="time-series-in-finance-and-economics.html#cb512-14" aria-hidden="true" tabindex="-1"></a><span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb512-15"><a href="time-series-in-finance-and-economics.html#cb512-15" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb512-16"><a href="time-series-in-finance-and-economics.html#cb512-16" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb512-17"><a href="time-series-in-finance-and-economics.html#cb512-17" aria-hidden="true" tabindex="-1"></a><span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span>
<span id="cb512-18"><a href="time-series-in-finance-and-economics.html#cb512-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-19"><a href="time-series-in-finance-and-economics.html#cb512-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-20"><a href="time-series-in-finance-and-economics.html#cb512-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb512-21"><a href="time-series-in-finance-and-economics.html#cb512-21" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> bacfdf, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> lag, <span class="at">y =</span> acf)) <span class="sc">+</span></span>
<span id="cb512-22"><a href="time-series-in-finance-and-economics.html#cb512-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb512-23"><a href="time-series-in-finance-and-economics.html#cb512-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">xend =</span> lag, <span class="at">yend =</span> <span class="dv">0</span>)) <span class="sc">+</span> </span>
<span id="cb512-24"><a href="time-series-in-finance-and-economics.html#cb512-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">length</span>(stocks_SMI_ts_ret[,<span class="dv">1</span>]))), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span> </span>
<span id="cb512-25"><a href="time-series-in-finance-and-economics.html#cb512-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">length</span>(stocks_SMI_ts_ret[,<span class="dv">1</span>]))), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span> </span>
<span id="cb512-26"><a href="time-series-in-finance-and-economics.html#cb512-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>( <span class="st">&quot;khaki3&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>, <span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;tomato3&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>)) <span class="sc">+</span></span>
<span id="cb512-27"><a href="time-series-in-finance-and-economics.html#cb512-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;ACF&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Lags&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Correlogram to show the ACF of Nestle&quot;</span>) <span class="sc">+</span></span>
<span id="cb512-28"><a href="time-series-in-finance-and-economics.html#cb512-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb512-29"><a href="time-series-in-finance-and-economics.html#cb512-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb512-30"><a href="time-series-in-finance-and-economics.html#cb512-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb512-31"><a href="time-series-in-finance-and-economics.html#cb512-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb512-32"><a href="time-series-in-finance-and-economics.html#cb512-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb512-33"><a href="time-series-in-finance-and-economics.html#cb512-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb512-34"><a href="time-series-in-finance-and-economics.html#cb512-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb512-35"><a href="time-series-in-finance-and-economics.html#cb512-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb512-36"><a href="time-series-in-finance-and-economics.html#cb512-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb512-37"><a href="time-series-in-finance-and-economics.html#cb512-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb512-38"><a href="time-series-in-finance-and-economics.html#cb512-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb512-39"><a href="time-series-in-finance-and-economics.html#cb512-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<pre><code>## Scale for &#39;colour&#39; is already present. Adding another scale for &#39;colour&#39;, which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb514-1"><a href="time-series-in-finance-and-economics.html#cb514-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> q <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-353-1.png" width="672" /></p>
<p>Let’s assess the main components of the ACF:</p>
<ul>
<li>The large value of 1 at t=0 is the correlation of the observation with itself (thereby equaling 1)</li>
<li>The dashed light blue lines approximate the 95% CI for the autocorrelation function, with the hypothesis that the true correlation is zero. They equal <span class="math inline">\(\pm \frac{1.96}{\sqrt{n}}\)</span></li>
</ul>
<p>As a consequence, the <strong>lags where the correlogram is inside the light blue lines do not have correlation significantly different from zero</strong>.</p>
<p>As we can see, in this case we can work with a purely independent series as the autocorrelation appears not to ever be materially different from zero.</p>
<p>Let’s look at some examples for which we cannot assume this.</p>
<p></p>
<p>Time Series data with trends has positive autocorrelations at a large number of lags. Note, the same correlogram would be observed if the trend was decreasing over time.</p>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-354-1.png" width="672" /></p>
<p></p>
<p>Time series data that has a seasonal effect is shown below. It has a regular seasonal pattern in the correlogram.</p>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-355-1.png" width="672" /></p>
<p></p>
<p>Time series data that has a trend and a seasonal effect is displayed below. It has a regular seasonal pattern in the correlogram, although due to the trend, the correlogram will generally have positive values.</p>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-356-1.png" width="672" /></p>
</div>
<div id="how-to-test-for-independence-in-time-series" class="section level4" number="9.2.2.4">
<h4><span class="header-section-number">9.2.2.4</span> How to test for independence in time series</h4>
<p>We can also quantify the existence, or absence, of temporal linear dependence, instead of visualising the time series. There are three common tests that are usually conducted.</p>
<p>The first is called <strong>Box-Pierce (BP) and Ljung–Box (LB) tests</strong>. In them, we conduct a single significance test on the set of autocorrelations <span class="math inline">\(\hat\rho_1, \dots, \hat\rho_j\)</span> where the researches determines the maximum level of lag j. Then, given a time series, we test the hypotheses:</p>
<ul>
<li>H0: The time series is independent</li>
<li>H1: The time series is not independent</li>
</ul>
<p>Thetests have the following formulae:</p>
<p><span class="math display">\[
\begin{align}
Q_{BP} &amp;= n\sum_{\tau = 1}^j \hat\rho_\tau^2\\
Q_{LB} &amp;= n(n+2)\sum_{\tau = 1}^j \frac{\hat\rho_\tau^2}{n - \tau}
\end{align}
\]</span></p>
<p>As with many tests of multiple variables, we assume in H0 that the test statistics have a <span class="math inline">\(\chi^2_j\)</span> distribution. That is, we <strong>reject the Null if the value of Q exceeds the critical value of<span class="math inline">\(\chi^2_{j, 0.95}\)</span> at the 5% level</strong>.</p>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb515-1"><a href="time-series-in-finance-and-economics.html#cb515-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Conduct Ljung-Box tests</span></span>
<span id="cb515-2"><a href="time-series-in-finance-and-economics.html#cb515-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(stocks_SMI_ts_ret[,<span class="dv">1</span>], <span class="at">lag =</span> <span class="dv">30</span>, <span class="at">type =</span> <span class="st">&quot;Ljung-Box&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Box-Ljung test
## 
## data:  stocks_SMI_ts_ret[, 1]
## X-squared = 24.875, df = 30, p-value = 0.7311</code></pre>
<div class="sourceCode" id="cb517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb517-1"><a href="time-series-in-finance-and-economics.html#cb517-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Conduct Box-Pierce tests</span></span>
<span id="cb517-2"><a href="time-series-in-finance-and-economics.html#cb517-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Box.test</span>(stocks_SMI_ts_ret[,<span class="dv">1</span>], <span class="at">lag =</span> <span class="dv">30</span>, <span class="at">type =</span> <span class="st">&quot;Box-Pierce&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Box-Pierce test
## 
## data:  stocks_SMI_ts_ret[, 1]
## X-squared = 23.046, df = 30, p-value = 0.8134</code></pre>
<p>As we can see, there is no reason to believe that we can reject the Null Hypothesis.</p>
</div>
</div>
<div id="components-of-time-series" class="section level3" number="9.2.3">
<h3><span class="header-section-number">9.2.3</span> Components of Time Series</h3>
<p>According to Hyndman, time series data are usually decomposed into three main constituents:</p>
<ul>
<li>Trend</li>
</ul>
<p>A trend exists when there is a linear or non-linear, long-term repetitive movement in the data.</p>
<ul>
<li>Seasonality</li>
</ul>
<p>A seasonal pattern occurs when a time series is affected by seasonal factors such as the time of the year or the day of the week. Seasonality is always of a fixed and known period.</p>
<ul>
<li>Unexplained variation</li>
</ul>
<p>Unexplained variation is the remaining variation in a time series once any trend and seasonal variation have been removed. This unexplained variation may be independent or exhibit short-term correlation.</p>
<p>Based on this, we can define two simple models for time series:</p>
<ul>
<li>Additive: <span class="math inline">\(X_t = m_t + s_t + e_t\)</span></li>
<li>Multiplicative: <span class="math inline">\(X_t = m_t\times s_t \times e_t\)</span></li>
</ul>
<p>whereas we partition the series into the <strong>trend variation</strong> <span class="math inline">\(m_t\)</span>, the <strong>seasonality variation</strong> <span class="math inline">\(s_t\)</span> and the <strong>unexplained variation</strong> <span class="math inline">\(e_t\)</span>. This is handy because we specify separate models for each component.</p>
<p>We generally use either model accordingly:</p>
<ul>
<li>Additive decomposition is used when the variation of the trend or the magnitude of the seasonality <strong>does not</strong> vary with the time series</li>
</ul>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-359-1.png" width="672" /></p>
<p>Here, we can see both trends and seasonality. But, importantly, both components appear to be constant throughout the time series. That is, they do not increase through time.</p>
<ul>
<li>Multiplicative decomposition is used when the variation of the trend or the magnitude of the seasonality <strong>does</strong> vary with the time series</li>
</ul>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-360-1.png" width="672" /></p>
<p>Here, we see that the seasonality and trend component increase throughout time. This is better captured by multiplicative models.</p>
</div>
<div id="adjustments-of-the-time-series" class="section level3" number="9.2.4">
<h3><span class="header-section-number">9.2.4</span> Adjustments of the time series</h3>
<p>Based on the previous idea of multiplicative and additive models, we may be interested in understanding how we can transform, or adjust, the data such that it will result in a simpler time series. The most common forms of transformation are the following:</p>
<ul>
<li>Population Adjustments</li>
</ul>
<p>Population adjustments are handy when considering data which depends on a population parameter. We can transform this data usually by dividing it by the population parameter, to obtain <strong>per-capita</strong> values.</p>
<ul>
<li>Inflation Adjustments</li>
</ul>
<p>Inflation adjustments are good when considering data that depend on the time-value of money. We can transform this data usually by considering factors such as Consumer Price Indices and then taking dividing the nominal values by the return of the CPI. We already did so in the Risk and Return chapter.</p>
<ul>
<li>Mathematical Adjustments</li>
</ul>
<p>Lastly, we can again focus on the additive vs. multiplicative modelling situation. As an alternative to using multiplicative modelling, we can also first transform seasonality-trend temporal dependent data until it is <strong>stable over time</strong>. Then, we can again use additive decomposition. The most famous is a log-linear transformation, based on:</p>
<p><span class="math display">\[
X_t = m_t\times s_t \times e_t  \sim log(X_t) = log( m_t) + log( s_t ) + log(e_t)
\]</span></p>
<p>Also, we can use <strong>power transformations</strong> of the data, in which we can take exponents or roots of the time series to stabilise.</p>
<p>The most common tool which combines both approaches is known as the <strong>Box-Cox Transformations</strong>, which depend on a tuning parameter <span class="math inline">\(\lambda\)</span>.</p>
<p><span class="math display">\[
Y_t = 
\begin{cases}
(X_t^\lambda - 1)/\lambda &amp;&amp; \text{if } \lambda \neq 0\\
\ln(X_t) &amp;&amp; \text{if } \lambda = 0 
\end{cases}
\]</span></p>
<p>This implies that the natural logarithm is used if <span class="math inline">\(\lambda\)</span> is zero, and scaled multiplicative transformations are used if <span class="math inline">\(\lambda\)</span> is different from zero.</p>
<p>Importantly, a good value of <span class="math inline">\(\lambda\)</span> should flatten the variation of the cycle-seasonality pattern throughout time. As such, we can transform the data from a multiplicative model to an additive model in the best possible way.</p>
<p>In order to define a best possible <span class="math inline">\(\lambda\)</span> we can use the <code>guerrero</code> feature in R.</p>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb519-1"><a href="time-series-in-finance-and-economics.html#cb519-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(feasts)</span>
<span id="cb519-2"><a href="time-series-in-finance-and-economics.html#cb519-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Here, we define how to calculate the Lambda value for the emissions dataset</span></span>
<span id="cb519-3"><a href="time-series-in-finance-and-economics.html#cb519-3" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> air_ZH_merged_ts <span class="sc">%&gt;%</span></span>
<span id="cb519-4"><a href="time-series-in-finance-and-economics.html#cb519-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Standort <span class="sc">==</span> <span class="st">&quot;Zch_Stampfenbachstrasse&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb519-5"><a href="time-series-in-finance-and-economics.html#cb519-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from=</span>Wert, <span class="at">names_from=</span>Parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb519-6"><a href="time-series-in-finance-and-economics.html#cb519-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(O3) <span class="sc">%&gt;%</span> <span class="fu">features</span>(O3, <span class="at">features =</span> guerrero) <span class="sc">%&gt;%</span></span>
<span id="cb519-7"><a href="time-series-in-finance-and-economics.html#cb519-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(lambda_guerrero)</span>
<span id="cb519-8"><a href="time-series-in-finance-and-economics.html#cb519-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb519-9"><a href="time-series-in-finance-and-economics.html#cb519-9" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> air_ZH_merged_ts <span class="sc">%&gt;%</span></span>
<span id="cb519-10"><a href="time-series-in-finance-and-economics.html#cb519-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Standort <span class="sc">==</span> <span class="st">&quot;Zch_Stampfenbachstrasse&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb519-11"><a href="time-series-in-finance-and-economics.html#cb519-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from=</span>Wert, <span class="at">names_from=</span>Parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb519-12"><a href="time-series-in-finance-and-economics.html#cb519-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(O3) <span class="sc">%&gt;%</span> </span>
<span id="cb519-13"><a href="time-series-in-finance-and-economics.html#cb519-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>(<span class="fu">box_cox</span>(O3, lambda), <span class="at">color =</span> <span class="st">&quot;violetred4&quot;</span>) <span class="sc">+</span></span>
<span id="cb519-14"><a href="time-series-in-finance-and-economics.html#cb519-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;µg/m3&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> </span>
<span id="cb519-15"><a href="time-series-in-finance-and-economics.html#cb519-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Concentration of O3 at Zürich Stampfenbachstrasse - Box Cox Transformed&quot;</span>) <span class="sc">+</span></span>
<span id="cb519-16"><a href="time-series-in-finance-and-economics.html#cb519-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb519-17"><a href="time-series-in-finance-and-economics.html#cb519-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb519-18"><a href="time-series-in-finance-and-economics.html#cb519-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb519-19"><a href="time-series-in-finance-and-economics.html#cb519-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb519-20"><a href="time-series-in-finance-and-economics.html#cb519-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb519-21"><a href="time-series-in-finance-and-economics.html#cb519-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb519-22"><a href="time-series-in-finance-and-economics.html#cb519-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb519-23"><a href="time-series-in-finance-and-economics.html#cb519-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb519-24"><a href="time-series-in-finance-and-economics.html#cb519-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb519-25"><a href="time-series-in-finance-and-economics.html#cb519-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb519-26"><a href="time-series-in-finance-and-economics.html#cb519-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span>
<span id="cb519-27"><a href="time-series-in-finance-and-economics.html#cb519-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb519-28"><a href="time-series-in-finance-and-economics.html#cb519-28" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-361-1.png" width="672" /></p>
</div>
</div>
<div id="regression-models-for-time-series" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> Regression Models for Time Series</h2>
<p>The simplest form to measure time series is by using simple or multiple linear regression models. We already covered both the theoretical foundations, assumptions as well as the properties and applications of linear regression models in previous chapters, so we will not repeat this here. We, however, do highlight the similarities of its application domain to time series forecasting.</p>
<p>The principle of running linear regressions in time series is identical to cross-sectional applications. Especially, it still is our aim to minimise the sum of squared residuals, or the absolute difference between the observed and fitted values. However, now we are in a <strong>forecasting world</strong>. This implies that our main objective is to most accurately forecast the behavior of our time series data. As a consequence, we are not inherently interested in the statistical metrics to assess significance, which would then deem us a quantity for causality. Rather, we are interested in most accurately <strong>fitting the data</strong>, such that we can increase the certainty that the model can predict future variation accurately (this is intuitive because we assume that if the model can fit the data well until this point and if the data has repeating patterns, then we should assume that the model can also fit this future repetitive pattern well).</p>
<p>Thus, we are more interested in <strong>fitted values</strong> as well as in <strong>measures to evaluate the goodness of fit</strong>. We will cover these metrics as well as the time series linear regression approach in the following subchapter.</p>
<div id="using-least-squares-in-time-series-the-forecast-package" class="section level3" number="9.3.1">
<h3><span class="header-section-number">9.3.1</span> Using Least Squares in Time Series: the forecast package</h3>
<p>In order to fit, evaluate and forecast models in time series, we can use the <code>forecast</code> package. It provides methods and tools for displaying and analysing
univariate time series forecasts including exponential smoothing, via state space models and automatic ARIMA modelling. Thereby, it also includes an option for using linear regression to estimate time series data.</p>
<p>To use the regression estimation procedure, we refer to the <code>tslm</code> function. It fits a linear regression model to time series data and is essentially identical to the <code>lm</code> function we encountered previously, but provides additional facilities for handling time series. In order to use the time series, we can either convert the data into a <code>tsibble</code> or an <code>xts</code> object and then create an additional <em>time series object</em> by defining the command <code>ts()</code> on the previously created object.</p>
<p>Let’s quickly look at the fitted values by considering the time series for the GDP growth of Switzerland from 1980 to 2020.</p>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb520-1"><a href="time-series-in-finance-and-economics.html#cb520-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb520-2"><a href="time-series-in-finance-and-economics.html#cb520-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb520-3"><a href="time-series-in-finance-and-economics.html#cb520-3" aria-hidden="true" tabindex="-1"></a>global_econ_CH <span class="ot">&lt;-</span> <span class="fu">subset</span>(tsibbledata<span class="sc">::</span>global_economy, Country <span class="sc">==</span> <span class="st">&quot;Switzerland&quot;</span> <span class="sc">&amp;</span> Year <span class="sc">&gt;=</span> <span class="dv">1981</span>)</span>
<span id="cb520-4"><a href="time-series-in-finance-and-economics.html#cb520-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb520-5"><a href="time-series-in-finance-and-economics.html#cb520-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform into an xts object</span></span>
<span id="cb520-6"><a href="time-series-in-finance-and-economics.html#cb520-6" aria-hidden="true" tabindex="-1"></a>global_econ_CH_time <span class="ot">&lt;-</span> global_econ_CH <span class="sc">%&gt;%</span> </span>
<span id="cb520-7"><a href="time-series-in-finance-and-economics.html#cb520-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb520-8"><a href="time-series-in-finance-and-economics.html#cb520-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="dv">01</span>, </span>
<span id="cb520-9"><a href="time-series-in-finance-and-economics.html#cb520-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">day =</span> <span class="dv">01</span>, </span>
<span id="cb520-10"><a href="time-series-in-finance-and-economics.html#cb520-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">Date =</span> <span class="fu">as.Date</span>(<span class="fu">paste0</span>(Year, <span class="st">&quot;-&quot;</span>, month, <span class="st">&quot;-&quot;</span>, day )))</span>
<span id="cb520-11"><a href="time-series-in-finance-and-economics.html#cb520-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb520-12"><a href="time-series-in-finance-and-economics.html#cb520-12" aria-hidden="true" tabindex="-1"></a>global_econ_CH_ts <span class="ot">&lt;-</span> <span class="fu">as.xts</span>(global_econ_CH_time[,<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">10</span>)], <span class="at">order.by =</span> global_econ_CH_time[,<span class="dv">12</span>])</span>
<span id="cb520-13"><a href="time-series-in-finance-and-economics.html#cb520-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb520-14"><a href="time-series-in-finance-and-economics.html#cb520-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the tslm </span></span>
<span id="cb520-15"><a href="time-series-in-finance-and-economics.html#cb520-15" aria-hidden="true" tabindex="-1"></a>fit_CH <span class="ot">&lt;-</span> <span class="fu">tslm</span>(Growth <span class="sc">~</span> CPI <span class="sc">+</span> Imports <span class="sc">+</span> Exports <span class="sc">+</span> Population, <span class="at">data =</span> <span class="fu">ts</span>(global_econ_CH_ts))</span>
<span id="cb520-16"><a href="time-series-in-finance-and-economics.html#cb520-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb520-17"><a href="time-series-in-finance-and-economics.html#cb520-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, use the fitted values for another column in the original data frame</span></span>
<span id="cb520-18"><a href="time-series-in-finance-and-economics.html#cb520-18" aria-hidden="true" tabindex="-1"></a>fitted_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="fu">fitted</span>(fit_CH), <span class="at">order.by =</span> global_econ_CH_time[,<span class="dv">12</span>])</span>
<span id="cb520-19"><a href="time-series-in-finance-and-economics.html#cb520-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb520-20"><a href="time-series-in-finance-and-economics.html#cb520-20" aria-hidden="true" tabindex="-1"></a>global_econ_CH_ts<span class="sc">$</span>Fitted <span class="ot">&lt;-</span> fitted_ts</span>
<span id="cb520-21"><a href="time-series-in-finance-and-economics.html#cb520-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb520-22"><a href="time-series-in-finance-and-economics.html#cb520-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the relaitonship</span></span>
<span id="cb520-23"><a href="time-series-in-finance-and-economics.html#cb520-23" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">tidy</span>(global_econ_CH_ts[,<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span>)]) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>index,<span class="at">y=</span> value, <span class="at">color=</span>series)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb520-24"><a href="time-series-in-finance-and-economics.html#cb520-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">&quot;GDP Growth&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Growth of the Swiss GDP from 1980 to 2020&quot;</span>) <span class="sc">+</span></span>
<span id="cb520-25"><a href="time-series-in-finance-and-economics.html#cb520-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor&#39;</span>) <span class="sc">+</span></span>
<span id="cb520-26"><a href="time-series-in-finance-and-economics.html#cb520-26" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb520-27"><a href="time-series-in-finance-and-economics.html#cb520-27" aria-hidden="true" tabindex="-1"></a><span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb520-28"><a href="time-series-in-finance-and-economics.html#cb520-28" aria-hidden="true" tabindex="-1"></a><span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb520-29"><a href="time-series-in-finance-and-economics.html#cb520-29" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb520-30"><a href="time-series-in-finance-and-economics.html#cb520-30" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb520-31"><a href="time-series-in-finance-and-economics.html#cb520-31" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb520-32"><a href="time-series-in-finance-and-economics.html#cb520-32" aria-hidden="true" tabindex="-1"></a><span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb520-33"><a href="time-series-in-finance-and-economics.html#cb520-33" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb520-34"><a href="time-series-in-finance-and-economics.html#cb520-34" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb520-35"><a href="time-series-in-finance-and-economics.html#cb520-35" aria-hidden="true" tabindex="-1"></a><span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span>
<span id="cb520-36"><a href="time-series-in-finance-and-economics.html#cb520-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb520-37"><a href="time-series-in-finance-and-economics.html#cb520-37" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-362-1.png" width="672" /></p>
<p>Let’s not focus on the apparently bad fit of the model here. Just note that we are able to perform the exact same procedure as with the <code>lm</code> function. We can confirm this by plotting a scatterplot of both variables.</p>
<div class="sourceCode" id="cb521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb521-1"><a href="time-series-in-finance-and-economics.html#cb521-1" aria-hidden="true" tabindex="-1"></a>global_econ_CH_ts <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Fitted,<span class="at">y=</span> Growth)) <span class="sc">+</span> </span>
<span id="cb521-2"><a href="time-series-in-finance-and-economics.html#cb521-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb521-3"><a href="time-series-in-finance-and-economics.html#cb521-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept=</span><span class="dv">0</span>, <span class="at">slope=</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb521-4"><a href="time-series-in-finance-and-economics.html#cb521-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">&quot;GDP Growth&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;GDP Growth Fitted&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Growth of the Swiss GDP from 1980 to 2020 - Fitted vs. Actual&quot;</span>) <span class="sc">+</span></span>
<span id="cb521-5"><a href="time-series-in-finance-and-economics.html#cb521-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor&#39;</span>) <span class="sc">+</span></span>
<span id="cb521-6"><a href="time-series-in-finance-and-economics.html#cb521-6" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb521-7"><a href="time-series-in-finance-and-economics.html#cb521-7" aria-hidden="true" tabindex="-1"></a><span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb521-8"><a href="time-series-in-finance-and-economics.html#cb521-8" aria-hidden="true" tabindex="-1"></a><span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb521-9"><a href="time-series-in-finance-and-economics.html#cb521-9" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb521-10"><a href="time-series-in-finance-and-economics.html#cb521-10" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb521-11"><a href="time-series-in-finance-and-economics.html#cb521-11" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb521-12"><a href="time-series-in-finance-and-economics.html#cb521-12" aria-hidden="true" tabindex="-1"></a><span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb521-13"><a href="time-series-in-finance-and-economics.html#cb521-13" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb521-14"><a href="time-series-in-finance-and-economics.html#cb521-14" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb521-15"><a href="time-series-in-finance-and-economics.html#cb521-15" aria-hidden="true" tabindex="-1"></a><span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-363-1.png" width="672" /></p>
</div>
<div id="evaluation-of-a-time-series-regression-model" class="section level3" number="9.3.2">
<h3><span class="header-section-number">9.3.2</span> Evaluation of a time series regression model</h3>
<p>The <code>forecast</code> package also provides a series of procedures to evaluate the regression based output. They mainly match the procedures used in non time series regression frameworks. That is, their primary focus is on the evaluation of the residuals. As we know from previous classes on statistical inference, we can verify the validity of the regression model by either quantifying metrics or visually assessing plots related to the residuals, for instance to show if there is heteroskedasticity, serial correlation or non normality of the errors. We can replicate this procedure to use it for time series regression models, as well.</p>
<div id="autocorrelation-function-plots" class="section level4" number="9.3.2.1">
<h4><span class="header-section-number">9.3.2.1</span> Autocorrelation Function Plots</h4>
<p>Let’s start with the most fundamental check, which is related to the temporal correlation of the regression model, or autocorrelation. Since it is likely that observations close to each other are correlated with one another, it is also likely that the residuals are autocorrelated. In this case, the estimated model violates the assumption of no autocorrelation in the errors, and our forecasts may be <strong>inefficient but unbiased</strong>, implying they have larger than necessary standard errors as there is some information left in the model which we should determine to induce an improved fit.</p>
<p>We can <em>quantify</em> this ACF plot by using a method similar to the box test approach. The test is called <strong>Breusch-Godfrey</strong> test is used to test the joint hypothesis that there is <strong>no autocorrelation in the residuals up to a certain specified order</strong>. A <strong>small p-value</strong> indicates there is <strong>significant autocorrelation remaining in the residuals</strong>.</p>
</div>
<div id="residual-histogram" class="section level4" number="9.3.2.2">
<h4><span class="header-section-number">9.3.2.2</span> Residual Histogram</h4>
<p>Another important part is to check whether the residuals are normally distributed. Although it is not essential for forecasting, but it does make the calculation of prediction intervals much easier.</p>
<p>We can create both ACF and residual plots by using the <code>checkresiduals</code> function of the <code>forecast</code> package. Let’s explore this.</p>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb522-1"><a href="time-series-in-finance-and-economics.html#cb522-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(fit_CH)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-364-1.png" width="672" /></p>
<pre><code>## 
##  Breusch-Godfrey test for serial correlation of order up to 8
## 
## data:  Residuals from Linear regression model
## LM test = 15.763, df = 8, p-value = 0.04589</code></pre>
<p>As we can see, the figure shows the ACF and the histogram of the residuals from the multiple regression model fitted, as well as the Breusch-Godfrey test for jointly testing up to 8th order autocorrelation.</p>
<p>We can interpret the following from these plots:</p>
<ul>
<li>The first plot shows the residuals over time and can thus provide us with an intuition on the <strong>heteroskedasticity</strong> of the model. There appears to be some heteroskedasticity, as the variance of the residual terms appears to be slightly different depending on the time intervals under consideration</li>
<li>The second plot shows the ACF. There appears to be no clear significant spike for either lag, although lag 3 and 10 show near significance, thereby we cannot clearly disregard the chance of autocorrelation</li>
<li>Further, the ACF plot shows that there is seasonality, as some lags are lower while others are higher than the average.</li>
<li>Lastly, the residuals plot shows a rough normality trend.</li>
</ul>
<p>Further, we see the BP test shows some significance at the 5% level. This is an issue as it appears as if we can reject the null hypothesis of independence between the observations. This implies that at certain lags the autocorrelation is likely to have a noticeable impact on the forecasts or the prediction intervals. We will discuss later how to deal with this.</p>
</div>
<div id="residual-plots-against-predictors" class="section level4" number="9.3.2.3">
<h4><span class="header-section-number">9.3.2.3</span> Residual plots against predictors</h4>
<p>We would expect the residuals to be randomly scattered without showing any systematic patterns. A simple and quick way to check this is to examine scatterplots of the residuals against each of the predictor variables. If these scatterplots show a pattern, then the relationship may be nonlinear and the model will need to be modified accordingly.</p>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb524-1"><a href="time-series-in-finance-and-economics.html#cb524-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> global_econ_CH_ts <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>CPI,<span class="at">y=</span> <span class="fu">residuals</span>(fit_CH))) <span class="sc">+</span> </span>
<span id="cb524-2"><a href="time-series-in-finance-and-economics.html#cb524-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb524-3"><a href="time-series-in-finance-and-economics.html#cb524-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">&quot;Residuals&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;CPI&quot;</span>) <span class="sc">+</span></span>
<span id="cb524-4"><a href="time-series-in-finance-and-economics.html#cb524-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor&#39;</span>) <span class="sc">+</span></span>
<span id="cb524-5"><a href="time-series-in-finance-and-economics.html#cb524-5" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb524-6"><a href="time-series-in-finance-and-economics.html#cb524-6" aria-hidden="true" tabindex="-1"></a><span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb524-7"><a href="time-series-in-finance-and-economics.html#cb524-7" aria-hidden="true" tabindex="-1"></a><span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb524-8"><a href="time-series-in-finance-and-economics.html#cb524-8" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb524-9"><a href="time-series-in-finance-and-economics.html#cb524-9" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb524-10"><a href="time-series-in-finance-and-economics.html#cb524-10" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb524-11"><a href="time-series-in-finance-and-economics.html#cb524-11" aria-hidden="true" tabindex="-1"></a><span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb524-12"><a href="time-series-in-finance-and-economics.html#cb524-12" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb524-13"><a href="time-series-in-finance-and-economics.html#cb524-13" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb524-14"><a href="time-series-in-finance-and-economics.html#cb524-14" aria-hidden="true" tabindex="-1"></a><span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span>
<span id="cb524-15"><a href="time-series-in-finance-and-economics.html#cb524-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb524-16"><a href="time-series-in-finance-and-economics.html#cb524-16" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> global_econ_CH_ts <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Exports,<span class="at">y=</span> <span class="fu">residuals</span>(fit_CH))) <span class="sc">+</span> </span>
<span id="cb524-17"><a href="time-series-in-finance-and-economics.html#cb524-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb524-18"><a href="time-series-in-finance-and-economics.html#cb524-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">&quot;Residuals&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Exports&quot;</span>) <span class="sc">+</span></span>
<span id="cb524-19"><a href="time-series-in-finance-and-economics.html#cb524-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor&#39;</span>) <span class="sc">+</span></span>
<span id="cb524-20"><a href="time-series-in-finance-and-economics.html#cb524-20" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb524-21"><a href="time-series-in-finance-and-economics.html#cb524-21" aria-hidden="true" tabindex="-1"></a><span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb524-22"><a href="time-series-in-finance-and-economics.html#cb524-22" aria-hidden="true" tabindex="-1"></a><span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb524-23"><a href="time-series-in-finance-and-economics.html#cb524-23" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb524-24"><a href="time-series-in-finance-and-economics.html#cb524-24" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb524-25"><a href="time-series-in-finance-and-economics.html#cb524-25" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb524-26"><a href="time-series-in-finance-and-economics.html#cb524-26" aria-hidden="true" tabindex="-1"></a><span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb524-27"><a href="time-series-in-finance-and-economics.html#cb524-27" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb524-28"><a href="time-series-in-finance-and-economics.html#cb524-28" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb524-29"><a href="time-series-in-finance-and-economics.html#cb524-29" aria-hidden="true" tabindex="-1"></a><span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span>
<span id="cb524-30"><a href="time-series-in-finance-and-economics.html#cb524-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb524-31"><a href="time-series-in-finance-and-economics.html#cb524-31" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> global_econ_CH_ts <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Imports,<span class="at">y=</span> <span class="fu">residuals</span>(fit_CH))) <span class="sc">+</span> </span>
<span id="cb524-32"><a href="time-series-in-finance-and-economics.html#cb524-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb524-33"><a href="time-series-in-finance-and-economics.html#cb524-33" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">&quot;Residuals&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Imports&quot;</span>) <span class="sc">+</span> </span>
<span id="cb524-34"><a href="time-series-in-finance-and-economics.html#cb524-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor&#39;</span>) <span class="sc">+</span></span>
<span id="cb524-35"><a href="time-series-in-finance-and-economics.html#cb524-35" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb524-36"><a href="time-series-in-finance-and-economics.html#cb524-36" aria-hidden="true" tabindex="-1"></a><span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb524-37"><a href="time-series-in-finance-and-economics.html#cb524-37" aria-hidden="true" tabindex="-1"></a><span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb524-38"><a href="time-series-in-finance-and-economics.html#cb524-38" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb524-39"><a href="time-series-in-finance-and-economics.html#cb524-39" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb524-40"><a href="time-series-in-finance-and-economics.html#cb524-40" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb524-41"><a href="time-series-in-finance-and-economics.html#cb524-41" aria-hidden="true" tabindex="-1"></a><span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb524-42"><a href="time-series-in-finance-and-economics.html#cb524-42" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb524-43"><a href="time-series-in-finance-and-economics.html#cb524-43" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb524-44"><a href="time-series-in-finance-and-economics.html#cb524-44" aria-hidden="true" tabindex="-1"></a><span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span>
<span id="cb524-45"><a href="time-series-in-finance-and-economics.html#cb524-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb524-46"><a href="time-series-in-finance-and-economics.html#cb524-46" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> global_econ_CH_ts <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Population ,<span class="at">y=</span> <span class="fu">residuals</span>(fit_CH))) <span class="sc">+</span> </span>
<span id="cb524-47"><a href="time-series-in-finance-and-economics.html#cb524-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb524-48"><a href="time-series-in-finance-and-economics.html#cb524-48" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">&quot;Residuals&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Population&quot;</span>) <span class="sc">+</span></span>
<span id="cb524-49"><a href="time-series-in-finance-and-economics.html#cb524-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor&#39;</span>) <span class="sc">+</span></span>
<span id="cb524-50"><a href="time-series-in-finance-and-economics.html#cb524-50" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb524-51"><a href="time-series-in-finance-and-economics.html#cb524-51" aria-hidden="true" tabindex="-1"></a><span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb524-52"><a href="time-series-in-finance-and-economics.html#cb524-52" aria-hidden="true" tabindex="-1"></a><span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb524-53"><a href="time-series-in-finance-and-economics.html#cb524-53" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb524-54"><a href="time-series-in-finance-and-economics.html#cb524-54" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb524-55"><a href="time-series-in-finance-and-economics.html#cb524-55" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb524-56"><a href="time-series-in-finance-and-economics.html#cb524-56" aria-hidden="true" tabindex="-1"></a><span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb524-57"><a href="time-series-in-finance-and-economics.html#cb524-57" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb524-58"><a href="time-series-in-finance-and-economics.html#cb524-58" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb524-59"><a href="time-series-in-finance-and-economics.html#cb524-59" aria-hidden="true" tabindex="-1"></a><span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span>
<span id="cb524-60"><a href="time-series-in-finance-and-economics.html#cb524-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb524-61"><a href="time-series-in-finance-and-economics.html#cb524-61" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p1, p2, p3, p4, <span class="at">nrow=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type ts. Defaulting to continuous.
## Don&#39;t know how to automatically pick scale for object of type ts. Defaulting to continuous.
## Don&#39;t know how to automatically pick scale for object of type ts. Defaulting to continuous.
## Don&#39;t know how to automatically pick scale for object of type ts. Defaulting to continuous.</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-365-1.png" width="672" /></p>
<p>They all appear to be randomly scattered, making the case for linearity more likely.</p>
</div>
<div id="residuals-vs.-fitted-values" class="section level4" number="9.3.2.4">
<h4><span class="header-section-number">9.3.2.4</span> Residuals vs. Fitted values</h4>
<p>Lastly, we can confirm <strong>heteroskedasticity</strong> by plotting the residuals against the fitted values.</p>
<div class="sourceCode" id="cb526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb526-1"><a href="time-series-in-finance-and-economics.html#cb526-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> global_econ_CH_ts <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">fitted</span>(fit_CH) ,<span class="at">y=</span> <span class="fu">residuals</span>(fit_CH))) <span class="sc">+</span> </span>
<span id="cb526-2"><a href="time-series-in-finance-and-economics.html#cb526-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb526-3"><a href="time-series-in-finance-and-economics.html#cb526-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">&quot;Residuals&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Fitted Values&quot;</span>) <span class="sc">+</span></span>
<span id="cb526-4"><a href="time-series-in-finance-and-economics.html#cb526-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor&#39;</span>) <span class="sc">+</span></span>
<span id="cb526-5"><a href="time-series-in-finance-and-economics.html#cb526-5" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb526-6"><a href="time-series-in-finance-and-economics.html#cb526-6" aria-hidden="true" tabindex="-1"></a><span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb526-7"><a href="time-series-in-finance-and-economics.html#cb526-7" aria-hidden="true" tabindex="-1"></a><span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb526-8"><a href="time-series-in-finance-and-economics.html#cb526-8" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb526-9"><a href="time-series-in-finance-and-economics.html#cb526-9" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb526-10"><a href="time-series-in-finance-and-economics.html#cb526-10" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb526-11"><a href="time-series-in-finance-and-economics.html#cb526-11" aria-hidden="true" tabindex="-1"></a><span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb526-12"><a href="time-series-in-finance-and-economics.html#cb526-12" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb526-13"><a href="time-series-in-finance-and-economics.html#cb526-13" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb526-14"><a href="time-series-in-finance-and-economics.html#cb526-14" aria-hidden="true" tabindex="-1"></a><span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span>
<span id="cb526-15"><a href="time-series-in-finance-and-economics.html#cb526-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb526-16"><a href="time-series-in-finance-and-economics.html#cb526-16" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type ts. Defaulting to continuous.
## Don&#39;t know how to automatically pick scale for object of type ts. Defaulting to continuous.</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-366-1.png" width="672" /></p>
<p>Likely, there appears to be no heteroskedasticity in the data.</p>
</div>
<div id="spurious-regressions" class="section level4" number="9.3.2.5">
<h4><span class="header-section-number">9.3.2.5</span> Spurious Regressions</h4>
<p>Within time series data, we often fear that the obserations are non-stationary. That is, the moments of the distribution of the data appear not to fluctutate around a constant. Regressing non-stationary time series can lead to <strong>spurious regressions</strong>. These are regresssions which output material effects although, in essence, these effects are not material, but rather happen due to a hazardeous correlation between two variables. That is, the variables just move in the same direction by chance.</p>
<p>An important sign of spurious regressions are <strong>high R2 values and high residual autocorrelation</strong>. We will discuss these features in more detail in later chapters, but understand that high R2 values imply that the model fits the data well, relative to the average fit. Further, large residual autocorrelation states that some residuals are co-dependent on each other, implying that some of the information which is not contained in the model is likely to follow a systematic structure. Thus, it might appear to give reasonable short-term forecasts, but will generally not continue to work into the future as (I) the regressors are likely to co-depend by chance and (II) the data does not seem to follow constant structures throughout time.</p>
</div>
</div>
<div id="evaluation-of-the-forecasting-accuracy" class="section level3" number="9.3.3">
<h3><span class="header-section-number">9.3.3</span> Evaluation of the forecasting accuracy</h3>
<p>When working with time series data, our primary aim is to construct a model which can best possibly represent the underlying variation of the data. Consequently, it is imperative to <strong>evaluate the forecasting accuracy</strong> of our model. However, although the size or distribution of the residuals are a good measure to quantify the extent of the underlying accuracy of a model, they cannot determine the <strong>true underlying forecasting error</strong>, because we do not use the model on new data. The accuracy of forecasts can only be determined by considering how well a model performs on <strong>new data that were not used when fitting the model</strong>.</p>
<p>When choosing models, it is common practice to separate the available data into two portions, training and test data, where the training data is used to estimate any parameters of a forecasting method and the test data is used to evaluate its accuracy. Because the test data is not used in determining the forecasts, it should provide a reliable indication of how well the model is likely to forecast on new data. This is the usual method chosen in <em>Machine Learning applications</em> as it shows the accuracy of the model when generalising it to external data not previously used to determine the model parameters.</p>
<p>When evaluating foeecasting accuracy, we typically split the data into a <strong>training and testing set</strong>. Usually, the proportions are 80:20. In time series, this implies that the first 80% of the time we use the data to train a model and in the subsequent 20% of the time we apply the model on new data. For instance, if we have a period of 10 years, we use the first 8 to train the model and then apply the model on the data of the last two years.</p>
<div id="metrics-to-evaluate-forecasting-accuracy" class="section level4" number="9.3.3.1">
<h4><span class="header-section-number">9.3.3.1</span> Metrics to evaluate forecasting accuracy</h4>
<p>We need some metrics to evaluate the forecasting accuracy. These metrics can be summarised as <strong>forecast errors</strong>. A forecast error is the difference between an observed value and its forecast in the test set. They are defined as <span class="math inline">\(e_t\)</span>. There are generally three forms of distinct errors:</p>
<p></p>
<p>The forecast errors are on the same scale as the data. Therefore, scale-dependent and cannot be used to make comparisons between series that involve different units. The two most common are:</p>
<ul>
<li>Mean-Absolute Error (MAE): <span class="math inline">\(mean(|e_t|)\)</span></li>
<li>Root Mean-Squared Error (RMSE): <span class="math inline">\(\sqrt{mean(e_t^2)}\)</span></li>
</ul>
<p>A forecast method that minimises the MAE will lead to forecasts of the median, while minimising the RMSE will lead to forecasts of the mean.</p>
<p></p>
<p>Percentage errors are given by:</p>
<p><span class="math display">\[
p_t = 100\cdot e_t/y_t
\]</span></p>
<p>Percentage errors have the advantage of being unit-free, and so are frequently used to compare forecast performances between data sets. The most commonly used measure is:</p>
<ul>
<li>Mean Absolute Percentage Error (MAPE): <span class="math inline">\(mean(|p_t|)\)</span></li>
</ul>
<p>Measures based on percentage errors have the disadvantage of being infinite or undefined if <span class="math inline">\(y_t = 0\)</span> for any t in the observational period, and having extreme values if any <span class="math inline">\(y_t\)</span> is close to zero. They also have the disadvantage that they put a heavier penalty on negative errors than on positive errors.</p>
<p></p>
<p>Scaled errors were proposed by Hyndman &amp; Koehler (2006) as an alternative to using percentage errors when comparing forecast accuracy across series with different units. They proposed scaling the errors based on the training MAE from a simple forecast method. For a non-seasonal time series, a useful way to define a scaled error uses naïve forecasts:</p>
<p><span class="math display">\[
q_j = \frac{e_j}{\frac{1}{T-1}\sum_{t=2}^T|y_t - y_{t-1}|}
\]</span></p>
<p>Whereas <strong>naive forecast</strong> means that we simply set all forecasts to be the value of the last observation. That is:</p>
<p><span class="math display">\[
\hat{y}_{T+h|t} = y_T
\]</span></p>
<p>which defines the second term of the denominator in our case.</p>
<p>Because the numerator and denominator both involve values on the scale of the original data, <span class="math inline">\(q_j\)</span> is independent of the scale of the data. The general rule is:</p>
<ul>
<li>A scaled error is <strong>less than one</strong> if it arises from a <strong>better forecast than the average naive forecast</strong> computed on the training data.</li>
<li>A scaled error is <strong>greater than one</strong> if the forecast is <strong>worse than the average naisve forecast</strong> computed on the training data.</li>
</ul>
<p>Further, for <strong>seasonal time series</strong>, a scaled error can be defined using <strong>seasonal naive forecasts</strong>:</p>
<p><span class="math display">\[
q_j = \frac{e_j}{\frac{1}{T-m}\sum_{t=m+1}^T|y_t - y_{t-2}|}
\]</span></p>
<p>Whereas <strong>naive forecast</strong> means that we simply set all forecasts to be the value of the last observation. That is:</p>
<p><span class="math display">\[
\hat{y}_{T+h|t} = y_{T+h-m(k+1)}
\]</span></p>
<p>Then, the mean absolute scaled error is:</p>
<p><span class="math display">\[
MASE = mean(|q_j|)
\]</span></p>
<p></p>
<p>A more sophisticated version of training/test sets is time series cross-validation. In this procedure, there are a series of test sets, each consisting of a single observation. The corresponding <strong>training set consists only of observations that occurred prior to the observation that forms the test set</strong>. Thus, no future observations can be used in constructing the forecast. Since it is not possible to obtain a reliable forecast based on a small training set, the earliest observations are not considered as test sets.</p>
<p>Based on each time-step training-testing set combination, the forecasting accuracy is gathered by <strong>averaging the respective accuracy over all test sets</strong>.</p>
<p>With time series forecasting, one-step forecasts may not be as relevant as multi-step forecasts. In this case, the <strong>cross-validation procedure can be modified to allow multi-step errors</strong>. That is, we can increase the temporal step size from 1 to h.</p>
<p>Time series cross-validation is straight-forward to implement by using the <code>tsCV</code> command.</p>
<p>Let’s apply these methods to the Swiss GDP Growth dataset through the command <code>accuracy</code>:</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb528-1"><a href="time-series-in-finance-and-economics.html#cb528-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create training and test set</span></span>
<span id="cb528-2"><a href="time-series-in-finance-and-economics.html#cb528-2" aria-hidden="true" tabindex="-1"></a>CH_train <span class="ot">&lt;-</span> <span class="fu">window</span>(global_econ_CH_ts, <span class="at">start=</span><span class="st">&quot;1981-01-01&quot;</span>, <span class="at">end =</span><span class="st">&quot;2005-01-01&quot;</span>)</span>
<span id="cb528-3"><a href="time-series-in-finance-and-economics.html#cb528-3" aria-hidden="true" tabindex="-1"></a>CH_test <span class="ot">&lt;-</span> <span class="fu">window</span>(global_econ_CH_ts, <span class="at">start =</span><span class="st">&quot;2006-01-01&quot;</span>)</span>
<span id="cb528-4"><a href="time-series-in-finance-and-economics.html#cb528-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb528-5"><a href="time-series-in-finance-and-economics.html#cb528-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we run different models</span></span>
<span id="cb528-6"><a href="time-series-in-finance-and-economics.html#cb528-6" aria-hidden="true" tabindex="-1"></a>mean_fc <span class="ot">&lt;-</span> <span class="fu">meanf</span>(CH_train<span class="sc">$</span>Growth, <span class="at">h=</span><span class="dv">12</span>)</span>
<span id="cb528-7"><a href="time-series-in-finance-and-economics.html#cb528-7" aria-hidden="true" tabindex="-1"></a>naive_fc <span class="ot">&lt;-</span> <span class="fu">rwf</span>(CH_train<span class="sc">$</span>Growth, <span class="at">h=</span><span class="dv">12</span>)</span>
<span id="cb528-8"><a href="time-series-in-finance-and-economics.html#cb528-8" aria-hidden="true" tabindex="-1"></a>seas_naive_fc <span class="ot">&lt;-</span> <span class="fu">rwf</span>(CH_train<span class="sc">$</span>Growth, <span class="at">drift=</span><span class="cn">TRUE</span>, <span class="at">h=</span><span class="dv">12</span>)</span>
<span id="cb528-9"><a href="time-series-in-finance-and-economics.html#cb528-9" aria-hidden="true" tabindex="-1"></a>reg_fc <span class="ot">&lt;-</span> <span class="fu">tslm</span>(Growth <span class="sc">~</span> CPI <span class="sc">+</span> Imports <span class="sc">+</span> Exports <span class="sc">+</span> Population, <span class="at">data =</span> <span class="fu">ts</span>(CH_train))</span>
<span id="cb528-10"><a href="time-series-in-finance-and-economics.html#cb528-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb528-11"><a href="time-series-in-finance-and-economics.html#cb528-11" aria-hidden="true" tabindex="-1"></a><span class="co"># We can then take them to predict the future values</span></span>
<span id="cb528-12"><a href="time-series-in-finance-and-economics.html#cb528-12" aria-hidden="true" tabindex="-1"></a>mean_fc_p <span class="ot">&lt;-</span> <span class="fu">predict</span>(mean_fc, CH_test)</span>
<span id="cb528-13"><a href="time-series-in-finance-and-economics.html#cb528-13" aria-hidden="true" tabindex="-1"></a>naive_fc_p <span class="ot">&lt;-</span> <span class="fu">predict</span>(naive_fc, CH_test)</span>
<span id="cb528-14"><a href="time-series-in-finance-and-economics.html#cb528-14" aria-hidden="true" tabindex="-1"></a>seas_naive_fc_p <span class="ot">&lt;-</span> <span class="fu">predict</span>(seas_naive_fc, CH_test)</span>
<span id="cb528-15"><a href="time-series-in-finance-and-economics.html#cb528-15" aria-hidden="true" tabindex="-1"></a>reg_fc_p <span class="ot">&lt;-</span> <span class="fu">predict</span>(reg_fc, CH_test)</span>
<span id="cb528-16"><a href="time-series-in-finance-and-economics.html#cb528-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb528-17"><a href="time-series-in-finance-and-economics.html#cb528-17" aria-hidden="true" tabindex="-1"></a>mean_fc_p_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(mean_fc_p<span class="sc">$</span>mean, <span class="at">order.by =</span> <span class="fu">subset</span>(global_econ_CH_time, Date <span class="sc">&gt;=</span> <span class="st">&quot;2006-01-01&quot;</span>)[,<span class="dv">12</span>])</span>
<span id="cb528-18"><a href="time-series-in-finance-and-economics.html#cb528-18" aria-hidden="true" tabindex="-1"></a>naive_fc_p <span class="ot">&lt;-</span> <span class="fu">xts</span>(naive_fc_p<span class="sc">$</span>mean, <span class="at">order.by =</span> <span class="fu">subset</span>(global_econ_CH_time, Date <span class="sc">&gt;=</span> <span class="st">&quot;2006-01-01&quot;</span>)[,<span class="dv">12</span>])</span>
<span id="cb528-19"><a href="time-series-in-finance-and-economics.html#cb528-19" aria-hidden="true" tabindex="-1"></a>seas_naive_fc_p <span class="ot">&lt;-</span> <span class="fu">xts</span>(seas_naive_fc_p<span class="sc">$</span>mean, <span class="at">order.by =</span> <span class="fu">subset</span>(global_econ_CH_time, Date <span class="sc">&gt;=</span> <span class="st">&quot;2006-01-01&quot;</span>)[,<span class="dv">12</span>])</span>
<span id="cb528-20"><a href="time-series-in-finance-and-economics.html#cb528-20" aria-hidden="true" tabindex="-1"></a>reg_fc_p <span class="ot">&lt;-</span> <span class="fu">xts</span>(reg_fc_p, <span class="at">order.by =</span> <span class="fu">subset</span>(global_econ_CH_time, Date <span class="sc">&gt;=</span> <span class="st">&quot;2006-01-01&quot;</span>)[,<span class="dv">12</span>])</span>
<span id="cb528-21"><a href="time-series-in-finance-and-economics.html#cb528-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb528-22"><a href="time-series-in-finance-and-economics.html#cb528-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge the entire data                      </span></span>
<span id="cb528-23"><a href="time-series-in-finance-and-economics.html#cb528-23" aria-hidden="true" tabindex="-1"></a>global_econ_plot_data <span class="ot">&lt;-</span> <span class="fu">merge.xts</span>(global_econ_CH_ts<span class="sc">$</span>Growth, mean_fc_p_ts, naive_fc_p, seas_naive_fc_p, reg_fc_p)</span>
<span id="cb528-24"><a href="time-series-in-finance-and-economics.html#cb528-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb528-25"><a href="time-series-in-finance-and-economics.html#cb528-25" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(global_econ_plot_data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Actual&quot;</span>, <span class="st">&quot;Mean&quot;</span>, <span class="st">&quot;Naive&quot;</span>, <span class="st">&quot;Seasonally Adjusted, Mean&quot;</span>, <span class="st">&quot;Regression&quot;</span>)</span>
<span id="cb528-26"><a href="time-series-in-finance-and-economics.html#cb528-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb528-27"><a href="time-series-in-finance-and-economics.html#cb528-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the relationship</span></span>
<span id="cb528-28"><a href="time-series-in-finance-and-economics.html#cb528-28" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(global_econ_plot_data) <span class="sc">%&gt;%</span>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> value, <span class="at">color =</span> series)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb528-29"><a href="time-series-in-finance-and-economics.html#cb528-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Growth&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span></span>
<span id="cb528-30"><a href="time-series-in-finance-and-economics.html#cb528-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Forecasting methods&#39;</span>) <span class="sc">+</span></span>
<span id="cb528-31"><a href="time-series-in-finance-and-economics.html#cb528-31" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb528-32"><a href="time-series-in-finance-and-economics.html#cb528-32" aria-hidden="true" tabindex="-1"></a><span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb528-33"><a href="time-series-in-finance-and-economics.html#cb528-33" aria-hidden="true" tabindex="-1"></a><span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb528-34"><a href="time-series-in-finance-and-economics.html#cb528-34" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb528-35"><a href="time-series-in-finance-and-economics.html#cb528-35" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb528-36"><a href="time-series-in-finance-and-economics.html#cb528-36" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb528-37"><a href="time-series-in-finance-and-economics.html#cb528-37" aria-hidden="true" tabindex="-1"></a><span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb528-38"><a href="time-series-in-finance-and-economics.html#cb528-38" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb528-39"><a href="time-series-in-finance-and-economics.html#cb528-39" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb528-40"><a href="time-series-in-finance-and-economics.html#cb528-40" aria-hidden="true" tabindex="-1"></a><span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<pre><code>## Warning: Removed 100 row(s) containing missing values (geom_path).</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-367-1.png" width="672" /></p>
<p>If we plot the data to see the forecasted values, we encounter quite an imprecise image. Let’s see the quantified values of the predictions.</p>
<div class="sourceCode" id="cb530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb530-1"><a href="time-series-in-finance-and-economics.html#cb530-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s create the accuracy scores for the different forecasting methods</span></span>
<span id="cb530-2"><a href="time-series-in-finance-and-economics.html#cb530-2" aria-hidden="true" tabindex="-1"></a>mean_acc <span class="ot">&lt;-</span> <span class="fu">accuracy</span>(mean_fc, CH_test<span class="sc">$</span>Growth)</span>
<span id="cb530-3"><a href="time-series-in-finance-and-economics.html#cb530-3" aria-hidden="true" tabindex="-1"></a>naive_predictions_acc <span class="ot">&lt;-</span> <span class="fu">accuracy</span>(naive_fc, CH_test<span class="sc">$</span>Growth)</span>
<span id="cb530-4"><a href="time-series-in-finance-and-economics.html#cb530-4" aria-hidden="true" tabindex="-1"></a>seas_naive_fc_p_acc <span class="ot">&lt;-</span> <span class="fu">accuracy</span>(seas_naive_fc, CH_test<span class="sc">$</span>Growth)</span>
<span id="cb530-5"><a href="time-series-in-finance-and-economics.html#cb530-5" aria-hidden="true" tabindex="-1"></a>reg_fc_p_acc <span class="ot">&lt;-</span> <span class="fu">accuracy</span>(<span class="fu">fitted</span>(reg_fc), CH_test<span class="sc">$</span>Growth)</span>
<span id="cb530-6"><a href="time-series-in-finance-and-economics.html#cb530-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb530-7"><a href="time-series-in-finance-and-economics.html#cb530-7" aria-hidden="true" tabindex="-1"></a>RMSE <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(mean_acc[<span class="dv">2</span>,<span class="dv">2</span>], naive_predictions_acc[<span class="dv">2</span>,<span class="dv">2</span>], seas_naive_fc_p_acc[<span class="dv">2</span>,<span class="dv">2</span>], reg_fc_p_acc[<span class="dv">1</span>,<span class="dv">2</span>]))</span>
<span id="cb530-8"><a href="time-series-in-finance-and-economics.html#cb530-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(RMSE) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Mean&quot;</span>, <span class="st">&quot;Naive&quot;</span>, <span class="st">&quot;Seasonally adjusted, naive&quot;</span>, <span class="st">&quot;Regression&quot;</span>)</span>
<span id="cb530-9"><a href="time-series-in-finance-and-economics.html#cb530-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb530-10"><a href="time-series-in-finance-and-economics.html#cb530-10" aria-hidden="true" tabindex="-1"></a>RMSE</span></code></pre></div>
<pre><code>##       Mean    Naive Seasonally adjusted, naive Regression
## 1 1.585928 2.049348                   2.390761   1.693818</code></pre>
</div>
</div>
<div id="temporal-predictor-variables-in-time-series" class="section level3" number="9.3.4">
<h3><span class="header-section-number">9.3.4</span> Temporal predictor variables in time series</h3>
<p>There are some temporal predictor variables which occur frequently in time series analysis. They are important to cover because they aid to distribute the time series into pieces which are distinct from each other. As such, they allow us to include a series of effects that are important to better fit data through time. We quickly cover the most common temporal predictors as well as their use in the <code>tslm</code> function. Note that you can also manually create all the predictors.</p>
<div id="trend-variables" class="section level4" number="9.3.4.1">
<h4><span class="header-section-number">9.3.4.1</span> Trend variables</h4>
<p>The simplest form is a trend variable. A linear trend can be modelled by simply using <span class="math inline">\(x_{1,t} = t\)</span> as a predictor:</p>
<p><span class="math display">\[
y_t = \beta_0 + \beta_1t + \epsilon_t 
\]</span></p>
<p>where t = 1, …, T. You can use the trend predictor with the <code>trend</code> option in the <code>tslm</code> function.</p>
</div>
<div id="dummy-variables" class="section level4" number="9.3.4.2">
<h4><span class="header-section-number">9.3.4.2</span> Dummy Variables</h4>
<p>Dummy variables can also be used for temporal data. In this case, the dummy variable takes value 1 for a specific observation and 0 everywhere else. The interpretation of each of the coefficients associated with the dummy variables is that it is a measure of the effect of that category relative to the omitted category.</p>
<p>A special case of dummy variables are <strong>seasonal dummy variables</strong>. These occur if we want to specify certain seasons, such as weekdays, months, quarters etc.
In the <code>tslm</code> function, we can automatically create dummy variables by specifying a factor variable as a predictor. Further, by specifying the predictor <code>season</code> in the regression model. This will automatically detect the seasonality related to the tsibble object.</p>
</div>
<div id="trading-days" class="section level4" number="9.3.4.3">
<h4><span class="header-section-number">9.3.4.3</span> Trading Days</h4>
<p>The number of trading days in a month can vary considerably and can have a substantial effect on sales data. To allow for this, the <strong>number of trading days in each month</strong> can be included as a predictor. For <em>monthly or quarterly data</em>, the <code>bizdays</code> function will compute the number of trading days in each period.</p>
</div>
<div id="fourier-series" class="section level4" number="9.3.4.4">
<h4><span class="header-section-number">9.3.4.4</span> Fourier Series</h4>
<p>An alternative to using seasonal dummy variables, especially for long seasonal periods, is to use Fourier terms. It shows that a <strong>series of sine and cosine terms of the right frequencies can approximate any periodic function</strong>. We can use them for seasonal patterns.</p>
<p>If m is the seasonal period, then the fourier series follows:</p>
<p><span class="math display">\[
x_{i,t} = 
\begin{cases}
sin(\frac{(i+1) \cdot \pi \cdot t}{m}) &amp;&amp; \text{if i is an odd number} \\ 
cos(\frac{i \cdot \pi \cdot t}{m}) &amp;&amp; \text{if i is an even number} 
\end{cases}
\]</span></p>
<p>With Fourier terms, we often need fewer predictors than with dummy variables, especially when m is large, as they provide us with the same effect as dummies with considerably less computational power.</p>
<p>The fourier terms can be created by using the <code>fourier</code> function. The first argument to the function allows it to identify the seasonal period m and the length of the predictors to return. It can be derived by taking the dependent variable as an argument. The second argument K specifies how many pairs of sin and cos terms to include. For instance, this means: <code>fourier(y, K = 2)</code> to retrieve quarterly dummies.</p>
</div>
</div>
</div>
<div id="decomposition-of-a-time-series" class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> Decomposition of a Time Series</h2>
<p>As we have seen, we either have additive or multiplicative time series formats, depending on the temporal variation of the trend- and seasonality parameter. Based on this characteristic, the three individual constituents of a time series interact differently with one another (either in a multiplicative or additive relationship). Further, we can transform the time series to assume simpler interaction forms of the individual constituents.</p>
<p>Let’s focus on the components of the time series. As we defined, each time series consists of three primary constituents. As such, the time series variation can be decomposed into three distinct sources of variation. In order to understand how the variation behaves, it thus is important to be able to decompose the time series and quantify its individual components, in order to comprehend how the overall variation is affected by its parts. This then helps us to determine which models can best classify and quantify the time series at hand.</p>
<div id="moving-average-smoothing" class="section level3" number="9.4.1">
<h3><span class="header-section-number">9.4.1</span> Moving Average Smoothing</h3>
<p>The first step in time series decomposition is the creation of <strong>moving average methods</strong> to estimate the trend of the series. This is also known as <strong>Moving Average Smoothing</strong>. A Moving average smoother estimates the trend and seasonal variation at time t by <strong>averaging values of the time series within k periods of the time series t</strong>. That is:</p>
<p><span class="math display">\[
\hat m_t + \hat s_t = \frac{1}{2k + 1}\sum_{j = -k}^k X_{t+j}
\]</span></p>
<p>Since time-ordered observations are likely to be closer in value, the average <strong>diminishes some of the randomness in the data</strong>, smoothing the trend component. This is known as a k-ordered moving average process.</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb532-1"><a href="time-series-in-finance-and-economics.html#cb532-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s create a Moving Average</span></span>
<span id="cb532-2"><a href="time-series-in-finance-and-economics.html#cb532-2" aria-hidden="true" tabindex="-1"></a>ma <span class="ot">&lt;-</span> <span class="cf">function</span>(x, n){stats<span class="sc">::</span><span class="fu">filter</span>(x, <span class="fu">rep</span>(<span class="dv">1</span> <span class="sc">/</span> n, n), <span class="at">sides =</span> <span class="dv">2</span>)}</span>
<span id="cb532-3"><a href="time-series-in-finance-and-economics.html#cb532-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb532-4"><a href="time-series-in-finance-and-economics.html#cb532-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We want to create a facet plot of moving averages. To do so, we first need to define the variable of interest, O3</span></span>
<span id="cb532-5"><a href="time-series-in-finance-and-economics.html#cb532-5" aria-hidden="true" tabindex="-1"></a>O3 <span class="ot">&lt;-</span> air_ZH_merged_ts  <span class="sc">%&gt;%</span> </span>
<span id="cb532-6"><a href="time-series-in-finance-and-economics.html#cb532-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Standort <span class="sc">==</span> <span class="st">&quot;Zch_Stampfenbachstrasse&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb532-7"><a href="time-series-in-finance-and-economics.html#cb532-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from=</span>Wert, <span class="at">names_from=</span>Parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb532-8"><a href="time-series-in-finance-and-economics.html#cb532-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(O3)</span>
<span id="cb532-9"><a href="time-series-in-finance-and-economics.html#cb532-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb532-10"><a href="time-series-in-finance-and-economics.html#cb532-10" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to repeat the values 4 times in order to create a dataframe which can then be transferred to each facet individually</span></span>
<span id="cb532-11"><a href="time-series-in-finance-and-economics.html#cb532-11" aria-hidden="true" tabindex="-1"></a><span class="co"># From there on, the ggplot will automatically deliver the adjusted MA per plot</span></span>
<span id="cb532-12"><a href="time-series-in-finance-and-economics.html#cb532-12" aria-hidden="true" tabindex="-1"></a>O3_rep <span class="ot">&lt;-</span><span class="fu">rep</span>(O3<span class="sc">$</span>O3, <span class="at">times =</span> <span class="dv">4</span>)</span>
<span id="cb532-13"><a href="time-series-in-finance-and-economics.html#cb532-13" aria-hidden="true" tabindex="-1"></a>Datum_rep <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">as.Date</span>(O3<span class="sc">$</span>Datum), <span class="at">times =</span> <span class="dv">4</span>)</span>
<span id="cb532-14"><a href="time-series-in-finance-and-economics.html#cb532-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb532-15"><a href="time-series-in-finance-and-economics.html#cb532-15" aria-hidden="true" tabindex="-1"></a>O3_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(O3_rep, Datum_rep)) <span class="sc">%&gt;%</span> </span>
<span id="cb532-16"><a href="time-series-in-finance-and-economics.html#cb532-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Datum_rep =</span> <span class="fu">as.Date</span>(Datum_rep))</span>
<span id="cb532-17"><a href="time-series-in-finance-and-economics.html#cb532-17" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(O3_df) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;O3&quot;</span>, <span class="st">&quot;Datum&quot;</span>)</span>
<span id="cb532-18"><a href="time-series-in-finance-and-economics.html#cb532-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb532-19"><a href="time-series-in-finance-and-economics.html#cb532-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we can create the facet plot</span></span>
<span id="cb532-20"><a href="time-series-in-finance-and-economics.html#cb532-20" aria-hidden="true" tabindex="-1"></a>air_ZH_merged_ts  <span class="sc">%&gt;%</span> </span>
<span id="cb532-21"><a href="time-series-in-finance-and-economics.html#cb532-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Standort <span class="sc">==</span> <span class="st">&quot;Zch_Stampfenbachstrasse&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb532-22"><a href="time-series-in-finance-and-economics.html#cb532-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from=</span>Wert, <span class="at">names_from=</span>Parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb532-23"><a href="time-series-in-finance-and-economics.html#cb532-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the MA </span></span>
<span id="cb532-24"><a href="time-series-in-finance-and-economics.html#cb532-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MA_05 =</span> <span class="fu">ma</span>(O3, <span class="dv">5</span>),</span>
<span id="cb532-25"><a href="time-series-in-finance-and-economics.html#cb532-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">MA_10 =</span> <span class="fu">ma</span>(O3, <span class="at">n=</span><span class="dv">10</span>), </span>
<span id="cb532-26"><a href="time-series-in-finance-and-economics.html#cb532-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">MA_15 =</span> <span class="fu">ma</span>(O3, <span class="at">n=</span><span class="dv">15</span>), </span>
<span id="cb532-27"><a href="time-series-in-finance-and-economics.html#cb532-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">MA_20 =</span> <span class="fu">ma</span>(O3, <span class="at">n=</span><span class="dv">20</span>))  <span class="sc">%&gt;%</span> </span>
<span id="cb532-28"><a href="time-series-in-finance-and-economics.html#cb532-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(MA_05, MA_10, MA_15, MA_20)) <span class="sc">%&gt;%</span> </span>
<span id="cb532-29"><a href="time-series-in-finance-and-economics.html#cb532-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Gather the values to transform them into one column</span></span>
<span id="cb532-30"><a href="time-series-in-finance-and-economics.html#cb532-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> factor, <span class="at">value =</span> lambda, <span class="sc">-</span>Datum) <span class="sc">%&gt;%</span> </span>
<span id="cb532-31"><a href="time-series-in-finance-and-economics.html#cb532-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot them</span></span>
<span id="cb532-32"><a href="time-series-in-finance-and-economics.html#cb532-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Datum, <span class="at">y =</span> lambda, <span class="at">color =</span> factor)) <span class="sc">+</span> </span>
<span id="cb532-33"><a href="time-series-in-finance-and-economics.html#cb532-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb532-34"><a href="time-series-in-finance-and-economics.html#cb532-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define the geom line plot of the actual data which should be aparent in each of the facets</span></span>
<span id="cb532-35"><a href="time-series-in-finance-and-economics.html#cb532-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> O3_df<span class="sc">$</span>O3, <span class="at">x =</span> O3_df<span class="sc">$</span>Datum), <span class="at">color =</span> <span class="st">&quot;lightgrey&quot;</span>) <span class="sc">+</span> </span>
<span id="cb532-36"><a href="time-series-in-finance-and-economics.html#cb532-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create Facets</span></span>
<span id="cb532-37"><a href="time-series-in-finance-and-economics.html#cb532-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(factor<span class="sc">~</span>.) <span class="sc">+</span> </span>
<span id="cb532-38"><a href="time-series-in-finance-and-economics.html#cb532-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;tomato3&quot;</span>, <span class="st">&quot;khaki3&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>, </span>
<span id="cb532-39"><a href="time-series-in-finance-and-economics.html#cb532-39" aria-hidden="true" tabindex="-1"></a>                              <span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;violetred4&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb532-40"><a href="time-series-in-finance-and-economics.html#cb532-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;µg/m3&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> </span>
<span id="cb532-41"><a href="time-series-in-finance-and-economics.html#cb532-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Concentration of O3 at Zürich Stampfenbachstrasse - MA included&quot;</span> ) <span class="sc">+</span></span>
<span id="cb532-42"><a href="time-series-in-finance-and-economics.html#cb532-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code></pre></div>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type ts. Defaulting to continuous.</code></pre>
<pre><code>## Warning: Removed 46 row(s) containing missing values (geom_path).</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-369-1.png" width="672" /></p>
<p>Notice that the trend-cycle is smoother than the original data and captures the main movement of the time series without all of the minor fluctuations. The order of the moving average determines the smoothness of the trend-cycle estimate.</p>
<p>It is also possible to create a <strong>multi-layered moving average</strong>. This is, for instance, a moving average of a moving average. One reason for doing this is to make an <strong>even-order moving average symmetric</strong>. When an even k-MA follows a moving average of an even order, it is called a “centred moving average of order k.” Usually, one uses k = 2 to create a <span class="math inline">\(2 \times x\)</span> Moving Average. When we use a second order MA, then we create a <strong>weighted average of observations that is symmetric</strong>.</p>
<p>The most common use of centred moving averages is for estimating the trend-cycle from seasonal data. When applied to periodic data, each period of the year is given equal weight as the first and last terms apply to the same period in consecutive years. Consequently, the <strong>seasonal variation will be averaged out</strong> and the <strong>resulting values will have little or no seasonal variation remaining</strong>.</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb535-1"><a href="time-series-in-finance-and-economics.html#cb535-1" aria-hidden="true" tabindex="-1"></a>air_ZH_merged_ts  <span class="sc">%&gt;%</span> </span>
<span id="cb535-2"><a href="time-series-in-finance-and-economics.html#cb535-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Standort <span class="sc">==</span> <span class="st">&quot;Zch_Stampfenbachstrasse&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb535-3"><a href="time-series-in-finance-and-economics.html#cb535-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from=</span>Wert, <span class="at">names_from=</span>Parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb535-4"><a href="time-series-in-finance-and-economics.html#cb535-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the MA </span></span>
<span id="cb535-5"><a href="time-series-in-finance-and-economics.html#cb535-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">MA_04 =</span> <span class="fu">ma</span>(O3, <span class="dv">12</span>),</span>
<span id="cb535-6"><a href="time-series-in-finance-and-economics.html#cb535-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">MA_02_04 =</span> <span class="fu">ma</span>(MA_04, <span class="at">n=</span><span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb535-7"><a href="time-series-in-finance-and-economics.html#cb535-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(O3, MA_04, MA_02_04)) <span class="sc">%&gt;%</span> </span>
<span id="cb535-8"><a href="time-series-in-finance-and-economics.html#cb535-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Datum, <span class="at">y =</span> O3)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;lightsteelblue3&quot;</span>) <span class="sc">+</span> </span>
<span id="cb535-9"><a href="time-series-in-finance-and-economics.html#cb535-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Datum, <span class="at">y =</span> MA_02_04), <span class="at">color =</span> <span class="st">&quot;violetred4&quot;</span>) <span class="sc">+</span> </span>
<span id="cb535-10"><a href="time-series-in-finance-and-economics.html#cb535-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Datum, <span class="at">y =</span> MA_04), <span class="at">color =</span> <span class="st">&quot;springgreen3&quot;</span>) <span class="sc">+</span> </span>
<span id="cb535-11"><a href="time-series-in-finance-and-economics.html#cb535-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;µg/m3&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> </span>
<span id="cb535-12"><a href="time-series-in-finance-and-economics.html#cb535-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Concentration of O3 at Zürich Stampfenbachstrasse - Layered MA&quot;</span>) <span class="sc">+</span></span>
<span id="cb535-13"><a href="time-series-in-finance-and-economics.html#cb535-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb535-14"><a href="time-series-in-finance-and-economics.html#cb535-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb535-15"><a href="time-series-in-finance-and-economics.html#cb535-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb535-16"><a href="time-series-in-finance-and-economics.html#cb535-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb535-17"><a href="time-series-in-finance-and-economics.html#cb535-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb535-18"><a href="time-series-in-finance-and-economics.html#cb535-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb535-19"><a href="time-series-in-finance-and-economics.html#cb535-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb535-20"><a href="time-series-in-finance-and-economics.html#cb535-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb535-21"><a href="time-series-in-finance-and-economics.html#cb535-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb535-22"><a href="time-series-in-finance-and-economics.html#cb535-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb535-23"><a href="time-series-in-finance-and-economics.html#cb535-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<pre><code>## Warning: Removed 14 row(s) containing missing values (geom_path).</code></pre>
<pre><code>## Warning: Removed 11 row(s) containing missing values (geom_path).</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-370-1.png" width="672" /></p>
<p>This is now a weighted average of observations that is symmetric.</p>
</div>
<div id="decomposition-methods-using-classical-decomposition" class="section level3" number="9.4.2">
<h3><span class="header-section-number">9.4.2</span> Decomposition Methods using Classical Decomposition</h3>
<p>We now have gathered information on how to decompose the first part of the time series, trends, with Moving Average functions. In order to fully decompose the time series, R provides a function called <code>seas</code> from the <code>seasonal</code> package. We will cover the most common decomposition methods now.</p>
<p>The Classical Decomposition is a relatively simple procedure, and forms the starting point for most other methods of time series decomposition. There are two forms of classical decomposition: an additive decomposition and a multiplicative decomposition.</p>
<p>Although this procedure is quite rudimentary and has the least effective prediction procedure, it nevertheless is handy to study it as it provides the necessary fundament for more advanced decomposition methods.</p>
<p>In classical decomposition, we assume that the <strong>seasonal component is constant from year to year</strong>.</p>
<p>We then perform the following steps, depending on the form of decomposition:</p>
<p></p>
<p>If we assume that the time series has an additive composition, we can simply <strong>subtract the individual parts of the time series from the overall variation</strong>. We do this in three steps:</p>
<ul>
<li>Trend Component</li>
</ul>
<p>If m is an <em>even</em> number, compute the trend component <span class="math inline">\(\hat{T}_t\)</span> using a <strong>2 <span class="math inline">\(\times\)</span> m - Moving Average</strong>, whereas m is the seasonal parameter (months, quarters, years etc.).</p>
<p>If m is an <em>odd</em> number, compute the trend component <span class="math inline">\(\hat{T}_t\)</span> using an <strong>m - Moving Average</strong>, whereas m is the seasonal parameter (months, quarters, years etc.).</p>
<ul>
<li>Seasonal Component</li>
</ul>
<p>Then, calculate the <strong>de-trended time series</strong> as: <span class="math inline">\(\hat{D}_t = y_t - \hat{T}_t\)</span>. Based on this, <strong>average the detrended values for that season</strong> to get the <strong>seasonal component per season</strong>. For example, with quarterly data, the seasonal component for Quarter 1 is the average of all the detrended Q1 values in the data. These seasonal component values are then adjusted to ensure that they add to zero. Then, we obtain the overall <strong>seasonal component</strong>, called <span class="math inline">\(\hat{S}_t\)</span>, by creating a vector of all sub-period seasonal components.</p>
<ul>
<li>Remainder Component</li>
</ul>
<p>We then obtain the remainder, or remaining, variation of the time series by subtracting the overall variation from both seasonal and trend parameters. That is, we get: <span class="math inline">\(\hat{R}_t = y_t - \hat{T}_t- \hat{D}_t\)</span>.</p>
<p></p>
<p>The only difference here is that we are working with multiplicative data. As a consequence, we need to ensure that the subtractions are replaced by divisions.</p>
<ul>
<li>Trend Component</li>
</ul>
<p>If m is an <em>even</em> number, compute the trend component <span class="math inline">\(\hat{T}_t\)</span> using a <strong>2 <span class="math inline">\(\times\)</span> m - Moving Average</strong>, whereas m is the seasonal parameter (months, quarters, years etc.).</p>
<p>If m is an <em>odd</em> number, compute the trend component <span class="math inline">\(\hat{T}_t\)</span> using an <strong>m - Moving Average</strong>, whereas m is the seasonal parameter (months, quarters, years etc.).</p>
<ul>
<li>Seasonal Component</li>
</ul>
<p>Then, calculate the <strong>de-trended time series</strong> as: <span class="math inline">\(\hat{D}_t = y_t / \hat{T}_t\)</span>. Based on this, <strong>average the detrended values for that season</strong> to get the <strong>seasonal component per season</strong>. Then, we obtain the overall <strong>seasonal component</strong>, called <span class="math inline">\(\hat{S}_t\)</span>, by creating a vector of all sub-period seasonal components.</p>
<ul>
<li>Remainder Component</li>
</ul>
<p>We then obtain the remainder, or remaining, variation of the time series by subtracting the overall variation from both seasonal and trend parameters. That is, we get: <span class="math inline">\(\hat{R}_t = y_t / (\hat{T}_t \cdot \hat{D}_t)\)</span>.</p>
<p>This is a fairly easy procedure to account for decomposed time series. Let’s consider a small example.</p>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb538-1"><a href="time-series-in-finance-and-economics.html#cb538-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(seasonal)</span>
<span id="cb538-2"><a href="time-series-in-finance-and-economics.html#cb538-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb538-3"><a href="time-series-in-finance-and-economics.html#cb538-3" aria-hidden="true" tabindex="-1"></a><span class="co"># First, it&#39;s important to understand that, in order to use these decomposition methods, we need to create either yearly or monthly time series. This can be achieved by the following code. We first need to define a parameter from a given dataset. Then, we need to understand at which frequency the parameter is measured. Based on this we can then enter the start dates as well as the frequency, and the software will calculate the time series object for us. </span></span>
<span id="cb538-4"><a href="time-series-in-finance-and-economics.html#cb538-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb538-5"><a href="time-series-in-finance-and-economics.html#cb538-5" aria-hidden="true" tabindex="-1"></a>air_ZH_merged <span class="sc">%&gt;%</span> </span>
<span id="cb538-6"><a href="time-series-in-finance-and-economics.html#cb538-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(Parameter <span class="sc">==</span> <span class="st">&quot;O3&quot;</span> <span class="sc">&amp;</span> Standort <span class="sc">==</span> <span class="st">&quot;Zch_Stampfenbachstrasse&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb538-7"><a href="time-series-in-finance-and-economics.html#cb538-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Datum <span class="sc">&lt;=</span> <span class="st">&quot;2000-08-10T00:00+0100&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb538-8"><a href="time-series-in-finance-and-economics.html#cb538-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Wert) <span class="sc">%&gt;%</span> </span>
<span id="cb538-9"><a href="time-series-in-finance-and-economics.html#cb538-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ts</span>(<span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1988</span>,<span class="dv">1</span>), <span class="at">frequency =</span> <span class="dv">12</span>) <span class="sc">%&gt;%</span></span>
<span id="cb538-10"><a href="time-series-in-finance-and-economics.html#cb538-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We assume the data to be multiplicatively composed</span></span>
<span id="cb538-11"><a href="time-series-in-finance-and-economics.html#cb538-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">decompose</span>(<span class="at">type=</span><span class="st">&quot;multiplicative&quot;</span>)</span></code></pre></div>
<pre><code>## $x
##         Jan    Feb    Mar    Apr    May    Jun    Jul    Aug    Sep    Oct    Nov    Dec
## 1988  16.08  14.85  24.91  10.77   6.56   8.34   5.67  10.12   6.11   6.08   4.98   6.06
## 1989  14.10   3.52   4.01  19.73   5.04  15.05  18.74   9.66  27.42  29.23  29.82  37.64
## 1990  19.20   3.44   5.26   7.97  60.50  65.69  41.11   5.48   1.38  10.31   5.81   6.58
## 1991   6.93  34.59  53.90  57.51  23.83  24.54  28.57  48.30  19.32  41.95  60.69  45.84
## 1992  41.23  62.28  41.37  19.97  28.76  23.11  18.30  32.77  13.43  15.60  39.01  51.95
## 1993  55.84  50.75  72.80  67.28  45.91  18.78  36.41  31.28  57.04  39.50  45.04  59.18
## 1994  33.65  26.50  47.27  26.67  22.54  18.13  37.01  57.67  32.65  29.85  16.75  24.13
## 1995  44.01  61.88  44.75  43.08  18.60  58.66  49.91  62.89  33.41  33.18  46.45  45.73
## 1996  33.37  52.71  49.72  58.81  58.49  38.54  71.94  58.63  36.05  51.91  53.38  49.09
## 1997  48.49  37.60  34.02  58.29  58.60  69.82  64.60  32.69  42.06  26.65  39.31  54.24
## 1998  50.86  60.90  55.54  63.51  64.49  63.00  46.49  58.84  50.09  36.45  40.85  72.97
## 1999  62.92  51.54  64.84  62.71  72.82  81.10  38.97  70.09  81.98  69.12  72.34  57.13
## 2000  58.69  49.32  64.79  72.32  50.67  55.70  30.17  48.53  50.39  51.62  75.29  82.69
## 2001  72.41  43.66  70.07  67.50  58.79  81.56  81.60  67.89  94.17  69.91  59.86  77.23
## 2002  96.75  88.40  71.42  78.08 113.44  90.71  57.78  58.52  68.82  67.88  63.61  44.70
## 2003  68.78  70.94  79.71  77.15  43.73  50.01  65.73  73.24  52.41  58.22  64.01  46.42
## 2004  46.76  40.76  60.30  45.46  50.49  49.18  39.59  59.34  66.15  52.65  64.74  80.90
## 2005  68.30  49.87  66.02  66.04  56.97  52.34  47.18  48.55  41.99  66.83  58.42  38.22
## 2006  47.57  38.64  52.77  40.05  46.67  43.73  55.27                                   
## 
## $seasonal
##            Jan       Feb       Mar       Apr       May       Jun       Jul       Aug       Sep       Oct       Nov       Dec
## 1988 1.0112970 0.9620035 1.0761474 1.1118798 1.0154270 1.0828736 0.9698952 0.9790903 0.8816968 0.8990461 0.9831580 1.0274854
## 1989 1.0112970 0.9620035 1.0761474 1.1118798 1.0154270 1.0828736 0.9698952 0.9790903 0.8816968 0.8990461 0.9831580 1.0274854
## 1990 1.0112970 0.9620035 1.0761474 1.1118798 1.0154270 1.0828736 0.9698952 0.9790903 0.8816968 0.8990461 0.9831580 1.0274854
## 1991 1.0112970 0.9620035 1.0761474 1.1118798 1.0154270 1.0828736 0.9698952 0.9790903 0.8816968 0.8990461 0.9831580 1.0274854
## 1992 1.0112970 0.9620035 1.0761474 1.1118798 1.0154270 1.0828736 0.9698952 0.9790903 0.8816968 0.8990461 0.9831580 1.0274854
## 1993 1.0112970 0.9620035 1.0761474 1.1118798 1.0154270 1.0828736 0.9698952 0.9790903 0.8816968 0.8990461 0.9831580 1.0274854
## 1994 1.0112970 0.9620035 1.0761474 1.1118798 1.0154270 1.0828736 0.9698952 0.9790903 0.8816968 0.8990461 0.9831580 1.0274854
## 1995 1.0112970 0.9620035 1.0761474 1.1118798 1.0154270 1.0828736 0.9698952 0.9790903 0.8816968 0.8990461 0.9831580 1.0274854
## 1996 1.0112970 0.9620035 1.0761474 1.1118798 1.0154270 1.0828736 0.9698952 0.9790903 0.8816968 0.8990461 0.9831580 1.0274854
## 1997 1.0112970 0.9620035 1.0761474 1.1118798 1.0154270 1.0828736 0.9698952 0.9790903 0.8816968 0.8990461 0.9831580 1.0274854
## 1998 1.0112970 0.9620035 1.0761474 1.1118798 1.0154270 1.0828736 0.9698952 0.9790903 0.8816968 0.8990461 0.9831580 1.0274854
## 1999 1.0112970 0.9620035 1.0761474 1.1118798 1.0154270 1.0828736 0.9698952 0.9790903 0.8816968 0.8990461 0.9831580 1.0274854
## 2000 1.0112970 0.9620035 1.0761474 1.1118798 1.0154270 1.0828736 0.9698952 0.9790903 0.8816968 0.8990461 0.9831580 1.0274854
## 2001 1.0112970 0.9620035 1.0761474 1.1118798 1.0154270 1.0828736 0.9698952 0.9790903 0.8816968 0.8990461 0.9831580 1.0274854
## 2002 1.0112970 0.9620035 1.0761474 1.1118798 1.0154270 1.0828736 0.9698952 0.9790903 0.8816968 0.8990461 0.9831580 1.0274854
## 2003 1.0112970 0.9620035 1.0761474 1.1118798 1.0154270 1.0828736 0.9698952 0.9790903 0.8816968 0.8990461 0.9831580 1.0274854
## 2004 1.0112970 0.9620035 1.0761474 1.1118798 1.0154270 1.0828736 0.9698952 0.9790903 0.8816968 0.8990461 0.9831580 1.0274854
## 2005 1.0112970 0.9620035 1.0761474 1.1118798 1.0154270 1.0828736 0.9698952 0.9790903 0.8816968 0.8990461 0.9831580 1.0274854
## 2006 1.0112970 0.9620035 1.0761474 1.1118798 1.0154270 1.0828736 0.9698952                                                  
## 
## $trend
##            Jan       Feb       Mar       Apr       May       Jun       Jul       Aug       Sep       Oct       Nov       Dec
## 1988        NA        NA        NA        NA        NA        NA  9.961667  9.407083  8.064167  7.566667  7.876667  8.092917
## 1989  8.917083  9.442500 10.311250 12.163750 14.163333 16.514167 18.042500 18.251667 18.300417 17.862500 19.683333 24.104167
## 1990 27.146250 27.904167 26.645000 24.771667 22.982917 20.688333 18.882917 19.669583 22.994167 27.085000 27.621250 24.378750
## 1991 22.141667 23.403333 25.935000 28.000833 31.605833 35.528333 38.593333 41.176250 41.807917 39.721667 38.362917 38.508750
## 1992 38.021250 36.946250 36.053750 34.710417 32.709167 32.060417 32.923750 33.052083 33.881250 37.162083 39.847917 40.382083
## 1993 40.956250 41.648750 43.403750 46.216667 47.463750 48.016250 47.392917 45.457917 43.383750 40.627917 37.962083 36.961250
## 1994 36.959167 38.083750 38.167083 36.748750 35.167917 32.528750 31.500000 33.405833 34.775000 35.353750 35.873333 37.397917
## 1995 39.624167 40.379167 40.628333 40.798750 42.175000 44.312500 44.769167 43.943750 43.768750 44.631250 46.948750 47.772500
## 1996 47.852083 48.592500 48.525000 49.415417 50.484583 50.913333 51.683333 51.683750 50.400000 49.724167 49.707083 51.015000
## 1997 52.012500 50.625833 49.795417 48.993333 47.354583 46.982917 47.296250 48.365833 50.233333 51.347500 51.810417 51.771667
## 1998 50.732917 51.067917 52.492083 53.235000 53.707500 54.552083 55.835000 55.947500 55.945000 56.299167 56.612917 57.714167
## 1999 58.155000 58.310417 60.107917 62.797917 65.471250 66.123333 65.287083 65.018333 64.923750 65.322083 64.799583 62.818333
## 2000 61.393333 60.128333 57.913750 55.868333 55.262083 56.450000 58.086667 58.422500 58.406667 58.425833 58.563333 59.979167
## 2001 63.199583 66.149167 68.780000 71.366250 71.485417 70.615000 71.401667 74.280000 76.200417 76.697500 79.415417 82.073750
## 2002 81.462500 80.079583 78.632917 77.492083 77.563750 76.364583 73.843750 71.950833 71.568750 71.875417 68.932083 64.331667
## 2003 62.967083 63.911667 63.841250 62.755000 62.369167 62.457500 61.611667 59.436667 57.370417 55.241250 54.202500 54.449583
## 2004 53.325833 51.657500 51.650833 51.991250 51.789583 53.256667 55.590833 56.867917 57.485833 58.581667 59.709167 60.110833
## 2005 60.558750 60.425417 58.969167 58.553333 58.880833 56.839167 54.197083 52.865417 51.845417 50.210417 48.698333 47.910417
## 2006 47.888750        NA        NA        NA        NA        NA        NA                                                  
## 
## $random
##             Jan        Feb        Mar        Apr        May        Jun        Jul        Aug        Sep        Oct        Nov        Dec
## 1988         NA         NA         NA         NA         NA         NA 0.58684885 1.09875978 0.85933491 0.89375194 0.64307788 0.72877234
## 1989 1.56357088 0.38750653 0.36137767 1.45882022 0.35044216 0.84159294 1.07089792 0.54056986 1.69936713 1.82013917 1.54093985 1.51978383
## 1990 0.69937913 0.12814827 0.18344179 0.28936451 2.59239706 2.93221630 2.24467569 0.28455265 0.06806787 0.42339707 0.21394862 0.26268712
## 1991 0.30948828 1.53637135 1.93121564 1.84720284 0.74251988 0.63785501 0.76326114 1.19805725 0.52411832 1.17468798 1.60909696 1.15853595
## 1992 1.07228006 1.75227230 1.06626054 0.51744049 0.86590588 0.66566087 0.57308230 1.01263943 0.44957001 0.46692010 0.99574246 1.25204851
## 1993 1.34817575 1.26665235 1.55859179 1.30927097 0.95256919 0.36118491 0.79210444 0.70280436 1.49119064 1.08141046 1.20677148 1.55830562
## 1994 0.90029365 0.72331842 1.15086634 0.65271354 0.63118774 0.51469823 1.21138930 1.76321339 1.06487048 0.93913250 0.47491925 0.62796326
## 1995 1.09827858 1.59300196 1.02351047 0.94966627 0.43431931 1.22246956 1.14943327 1.46171166 0.86575114 0.82690449 1.00632527 0.93163878
## 1996 0.68956728 1.12757939 0.95212470 1.07036252 1.14096976 0.69904064 1.43514281 1.15862557 0.81125143 1.16118532 1.09228755 0.93652520
## 1997 0.92186164 0.77203860 0.63485303 1.07003810 1.21867214 1.37234125 1.40825406 0.69032480 0.94963784 0.57729252 0.77172515 1.01965173
## 1998 0.99130618 1.23963123 0.98319650 1.07296864 1.18252063 1.06647691 0.85847614 1.07416058 1.01547795 0.72013445 0.73392761 1.23051310
## 1999 1.06985012 0.91880135 1.00239661 0.89811870 1.09534601 1.13263079 0.61542955 1.10102571 1.43213863 1.17696005 1.13548914 0.88511997
## 2000 0.94528808 0.85264306 1.03957194 1.16421952 0.90297336 0.91119955 0.53551798 0.84841314 0.97850417 0.98272297 1.30764002 1.34176633
## 2001 1.13293663 0.68609256 0.94666910 0.85065424 0.80991099 1.06660226 1.17830308 0.93349317 1.40163833 1.01385563 0.76667021 0.91581148
## 2002 1.17439590 1.14750297 0.84400247 0.90620122 1.44031906 1.09694645 0.80675004 0.83070289 1.09061629 1.05045990 0.93860030 0.67624964
## 2003 1.08011471 1.15381027 1.16021823 1.10568081 0.69049545 0.73942564 1.09995743 1.25855188 1.03611246 1.17226750 1.20117201 0.82972639
## 2004 0.86707794 0.82020828 1.08484636 0.78639609 0.96009507 0.85277958 0.73427293 1.06575519 1.30511794 0.99966543 1.10282951 1.30984558
## 2005 1.11523166 0.85791265 1.04034836 1.01437285 0.95284785 0.85037065 0.89754705 0.93798266 0.91857844 1.48045652 1.22018070 0.77639917
## 2006 0.98224751         NA         NA         NA         NA         NA         NA                                                       
## 
## $figure
##  [1] 1.0112970 0.9620035 1.0761474 1.1118798 1.0154270 1.0828736 0.9698952 0.9790903 0.8816968 0.8990461 0.9831580 1.0274854
## 
## $type
## [1] &quot;multiplicative&quot;
## 
## attr(,&quot;class&quot;)
## [1] &quot;decomposed.ts&quot;</code></pre>
<p>The output above indicates the different parts the function calculated. As we can see, we obtain the estimated time series for all three components, as well as the actual time series. We can now use an inbuilt function to plot these characteristics.</p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb540-1"><a href="time-series-in-finance-and-economics.html#cb540-1" aria-hidden="true" tabindex="-1"></a>air_ZH_merged <span class="sc">%&gt;%</span> </span>
<span id="cb540-2"><a href="time-series-in-finance-and-economics.html#cb540-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(Parameter <span class="sc">==</span> <span class="st">&quot;O3&quot;</span> <span class="sc">&amp;</span> Standort <span class="sc">==</span> <span class="st">&quot;Zch_Stampfenbachstrasse&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb540-3"><a href="time-series-in-finance-and-economics.html#cb540-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Datum <span class="sc">&lt;=</span> <span class="st">&quot;2000-08-10T00:00+0100&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb540-4"><a href="time-series-in-finance-and-economics.html#cb540-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Wert) <span class="sc">%&gt;%</span> </span>
<span id="cb540-5"><a href="time-series-in-finance-and-economics.html#cb540-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ts</span>(<span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1988</span>,<span class="dv">1</span>), <span class="at">frequency =</span> <span class="dv">12</span>) <span class="sc">%&gt;%</span></span>
<span id="cb540-6"><a href="time-series-in-finance-and-economics.html#cb540-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We assume the data to be multiplicatively composed</span></span>
<span id="cb540-7"><a href="time-series-in-finance-and-economics.html#cb540-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">decompose</span>(<span class="at">type=</span><span class="st">&quot;multiplicative&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>() <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Year&quot;</span>) <span class="sc">+</span></span>
<span id="cb540-8"><a href="time-series-in-finance-and-economics.html#cb540-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Classical multiplicative decomposition</span></span>
<span id="cb540-9"><a href="time-series-in-finance-and-economics.html#cb540-9" aria-hidden="true" tabindex="-1"></a><span class="st">    of Air Quality data in Zurich&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-372-1.png" width="672" /></p>
<p>We won’t cover the exact details of each of the facetted visualisations, but leave this until we cover more advanced models. However, note that it is not recommended to use classical decomposition due to three consdierations:</p>
<ul>
<li>The trend-cycle estimate tends to over-smooth rapid rises and falls in the data</li>
<li>Classical decomposition methods assume that the seasonal component repeats from year to year. For example, electricity demand patterns have changed over time as air conditioning has become more widespread (going from Winter usage to heat over to summer usage for cooling with temperatures increasing all over the world)</li>
<li>The estimate of the trend-cycle is unavailable for the first few and last few observations. For example, if m = 12, there is no trend-cycle estimate for the first six or the last six observations.</li>
</ul>
</div>
<div id="decomposition-methods-using-x11" class="section level3" number="9.4.3">
<h3><span class="header-section-number">9.4.3</span> Decomposition Methods using X11</h3>
<p>As we have covered the basics, we can can now include extra steps and features in order to overcome the drawbacks of classical decomposition that were discussed in the previous section. In particular, trend-cycle estimates are available for all observations including the end points, and the seasonal component is allowed to vary slowly over time. X11 also has some sophisticated methods for handling trading day variation, holiday effects and the effects of known predictors. It handles both additive and multiplicative decomposition. The process is entirely automatic and tends to be <strong>highly robust to outliers and level shifts in the time series</strong>.</p>
<p>In essence, the X11 works in the following way:</p>
<ul>
<li>Initial Estimates</li>
</ul>
<p>We first also apply a similar Moving average filter to filter out long term trends. Based on this, we then either subtract or divise the original time series by the trend estimate to obtain the seasonal parameter, also as an average. The remainder is calculated in an identical way.</p>
<ul>
<li>Identify extreme events and calendar effects</li>
</ul>
<p>Based on the first set of the time series estimates, we can get the first components. From these estimated values we can identify extremes and outliers. The irregular values are plotted along with some outliers idetified. There are other effects that can be found from estimated irregular series. This includes <em>trading day (TD) and holiday effects</em>. The first are measures the impact of the day-of-the-week composition of a month. For example, January 2016 will have 5 Fridays, 5 Saturdays, and 5 Sundays. While January 2013 had 4 Fridays, 4 Saturdays and 4 Sundays. This can have a dramatic effect on a seasonal adjustment.</p>
<p>Consequently, it is fairly similar to the classical method but incorporates options to include specific, irregular events while obtaining better MA values.</p>
<p>Let’s look directly at the output.</p>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb541-1"><a href="time-series-in-finance-and-economics.html#cb541-1" aria-hidden="true" tabindex="-1"></a>air_ZH_merged <span class="sc">%&gt;%</span> </span>
<span id="cb541-2"><a href="time-series-in-finance-and-economics.html#cb541-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(Parameter <span class="sc">==</span> <span class="st">&quot;O3&quot;</span> <span class="sc">&amp;</span> Standort <span class="sc">==</span> <span class="st">&quot;Zch_Stampfenbachstrasse&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb541-3"><a href="time-series-in-finance-and-economics.html#cb541-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Datum <span class="sc">&lt;=</span> <span class="st">&quot;2000-08-10T00:00+0100&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb541-4"><a href="time-series-in-finance-and-economics.html#cb541-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Wert) <span class="sc">%&gt;%</span> </span>
<span id="cb541-5"><a href="time-series-in-finance-and-economics.html#cb541-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ts</span>(<span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1988</span>,<span class="dv">1</span>), <span class="at">frequency =</span> <span class="dv">12</span>) <span class="sc">%&gt;%</span></span>
<span id="cb541-6"><a href="time-series-in-finance-and-economics.html#cb541-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">seas</span>(<span class="at">x11=</span><span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb541-7"><a href="time-series-in-finance-and-economics.html#cb541-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;µg/m3&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> </span>
<span id="cb541-8"><a href="time-series-in-finance-and-economics.html#cb541-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Concentration of O3 at Zürich Stampfenbachstrasse - Layered MA&quot;</span>) <span class="sc">+</span></span>
<span id="cb541-9"><a href="time-series-in-finance-and-economics.html#cb541-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb541-10"><a href="time-series-in-finance-and-economics.html#cb541-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb541-11"><a href="time-series-in-finance-and-economics.html#cb541-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb541-12"><a href="time-series-in-finance-and-economics.html#cb541-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb541-13"><a href="time-series-in-finance-and-economics.html#cb541-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb541-14"><a href="time-series-in-finance-and-economics.html#cb541-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb541-15"><a href="time-series-in-finance-and-economics.html#cb541-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb541-16"><a href="time-series-in-finance-and-economics.html#cb541-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb541-17"><a href="time-series-in-finance-and-economics.html#cb541-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb541-18"><a href="time-series-in-finance-and-economics.html#cb541-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb541-19"><a href="time-series-in-finance-and-economics.html#cb541-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-373-1.png" width="672" /></p>
<p>If we compare this, we can analyse the following:</p>
<ul>
<li>X11 enabled us to account for the sudden falls in 1990 and 2002. Also, the larger shifted trend around 2000 is also better captured, thereby mitigating the over-smoothing issue</li>
<li>Further, the seasonal parameter is able to better catch the changes in width between two periods</li>
</ul>
<p>Given the output, we can plot the individual time series components as follows:</p>
<ul>
<li><code>seasonal()</code> will extract the seasonal component
-<code>trendcycle()</code> will extract the trend-cycle component</li>
<li><code>remainder()</code> will extract the remainder component</li>
<li><code>seasadj()</code> will compute the seasonally adjusted time series</li>
</ul>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb542-1"><a href="time-series-in-finance-and-economics.html#cb542-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the time series object</span></span>
<span id="cb542-2"><a href="time-series-in-finance-and-economics.html#cb542-2" aria-hidden="true" tabindex="-1"></a>Air_ZH_ts <span class="ot">&lt;-</span> air_ZH_merged <span class="sc">%&gt;%</span> </span>
<span id="cb542-3"><a href="time-series-in-finance-and-economics.html#cb542-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(Parameter <span class="sc">==</span> <span class="st">&quot;O3&quot;</span> <span class="sc">&amp;</span> Standort <span class="sc">==</span> <span class="st">&quot;Zch_Stampfenbachstrasse&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb542-4"><a href="time-series-in-finance-and-economics.html#cb542-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Datum <span class="sc">&lt;=</span> <span class="st">&quot;2000-08-10T00:00+0100&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb542-5"><a href="time-series-in-finance-and-economics.html#cb542-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Wert) <span class="sc">%&gt;%</span> </span>
<span id="cb542-6"><a href="time-series-in-finance-and-economics.html#cb542-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ts</span>(<span class="at">start =</span> <span class="fu">c</span>(<span class="dv">1988</span>,<span class="dv">1</span>), <span class="at">frequency =</span> <span class="dv">12</span>) </span>
<span id="cb542-7"><a href="time-series-in-finance-and-economics.html#cb542-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb542-8"><a href="time-series-in-finance-and-economics.html#cb542-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the fitted variable</span></span>
<span id="cb542-9"><a href="time-series-in-finance-and-economics.html#cb542-9" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> Air_ZH_ts<span class="sc">%&gt;%</span></span>
<span id="cb542-10"><a href="time-series-in-finance-and-economics.html#cb542-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">seas</span>(<span class="at">x11=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb542-11"><a href="time-series-in-finance-and-economics.html#cb542-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb542-12"><a href="time-series-in-finance-and-economics.html#cb542-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot</span></span>
<span id="cb542-13"><a href="time-series-in-finance-and-economics.html#cb542-13" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(Air_ZH_ts, <span class="at">series=</span><span class="st">&quot;Data&quot;</span>) <span class="sc">+</span></span>
<span id="cb542-14"><a href="time-series-in-finance-and-economics.html#cb542-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(<span class="fu">trendcycle</span>(fit), <span class="at">series=</span><span class="st">&quot;Trend&quot;</span>) <span class="sc">+</span></span>
<span id="cb542-15"><a href="time-series-in-finance-and-economics.html#cb542-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(<span class="fu">seasadj</span>(fit), <span class="at">series=</span><span class="st">&quot;Seasonally Adjusted&quot;</span>) <span class="sc">+</span></span>
<span id="cb542-16"><a href="time-series-in-finance-and-economics.html#cb542-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Year&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;O3 concentration in mg&quot;</span>) <span class="sc">+</span></span>
<span id="cb542-17"><a href="time-series-in-finance-and-economics.html#cb542-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;X11 decomposition of Air Quality data in Zurich&quot;</span>) <span class="sc">+</span></span>
<span id="cb542-18"><a href="time-series-in-finance-and-economics.html#cb542-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;µg/m3&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> </span>
<span id="cb542-19"><a href="time-series-in-finance-and-economics.html#cb542-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Concentration of O3 at Zürich Stampfenbachstrasse - Layered X11&quot;</span>) <span class="sc">+</span></span>
<span id="cb542-20"><a href="time-series-in-finance-and-economics.html#cb542-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb542-21"><a href="time-series-in-finance-and-economics.html#cb542-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb542-22"><a href="time-series-in-finance-and-economics.html#cb542-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb542-23"><a href="time-series-in-finance-and-economics.html#cb542-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb542-24"><a href="time-series-in-finance-and-economics.html#cb542-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb542-25"><a href="time-series-in-finance-and-economics.html#cb542-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb542-26"><a href="time-series-in-finance-and-economics.html#cb542-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb542-27"><a href="time-series-in-finance-and-economics.html#cb542-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb542-28"><a href="time-series-in-finance-and-economics.html#cb542-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb542-29"><a href="time-series-in-finance-and-economics.html#cb542-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb542-30"><a href="time-series-in-finance-and-economics.html#cb542-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-374-1.png" width="672" /></p>
</div>
<div id="decomposition-methods-using-stl" class="section level3" number="9.4.4">
<h3><span class="header-section-number">9.4.4</span> Decomposition Methods using STL</h3>
<p>STL stands for “Seasonal and Trend Decomposition using Loess”. Loess itself is a method for measuring <em>non-linear relationships</em>. The STL model is a deterministic model that allows the components to be calculated separately using different methods. In generally, it:</p>
<ul>
<li>estimates the behavior of the <em>trend</em> using a <em>LOESS regression</em></li>
<li>calculates the <em>seasonal</em> component by selecting one of two models: the <strong>seasonal ARIMA</strong> model, or the <strong>ETS model</strong>.</li>
</ul>
<p>The main difference that the STL model has with the others is that, when considering the trend as a LOESS estimation, it is <em>extremely flexible to the changes in the trend of the series</em>, unlike the linear regression, which assumes that the series maintains the same constant.</p>
<p>Let’s see how we can calculate each component individually. We will do so by using the <code>wine</code> dataset of the <code>forecast</code> package.</p>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb543-1"><a href="time-series-in-finance-and-economics.html#cb543-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a wine dataset </span></span>
<span id="cb543-2"><a href="time-series-in-finance-and-economics.html#cb543-2" aria-hidden="true" tabindex="-1"></a>wine <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(forecast<span class="sc">::</span>wineind)</span>
<span id="cb543-3"><a href="time-series-in-finance-and-economics.html#cb543-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a period</span></span>
<span id="cb543-4"><a href="time-series-in-finance-and-economics.html#cb543-4" aria-hidden="true" tabindex="-1"></a>wine <span class="ot">&lt;-</span> wine <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Period=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(<span class="fu">as.matrix</span>(forecast<span class="sc">::</span>wineind)))</span>
<span id="cb543-5"><a href="time-series-in-finance-and-economics.html#cb543-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(wine) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Sales&quot;</span>, <span class="st">&quot;Period&quot;</span>)</span>
<span id="cb543-6"><a href="time-series-in-finance-and-economics.html#cb543-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb543-7"><a href="time-series-in-finance-and-economics.html#cb543-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define train and test sets</span></span>
<span id="cb543-8"><a href="time-series-in-finance-and-economics.html#cb543-8" aria-hidden="true" tabindex="-1"></a>Train <span class="ot">&lt;-</span> wine <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Period <span class="sc">&lt;=</span> <span class="dv">165</span>)</span>
<span id="cb543-9"><a href="time-series-in-finance-and-economics.html#cb543-9" aria-hidden="true" tabindex="-1"></a>Test<span class="ot">&lt;-</span> wine <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Period<span class="sc">&lt;=</span><span class="dv">176</span> <span class="sc">&amp;</span> Period<span class="sc">&gt;=</span><span class="dv">165</span>)</span></code></pre></div>
<p>Let’s look at the dataset quickly</p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb544-1"><a href="time-series-in-finance-and-economics.html#cb544-1" aria-hidden="true" tabindex="-1"></a>wine <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Period, <span class="at">y  =</span> Sales)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;violetred4&quot;</span>) <span class="sc">+</span> </span>
<span id="cb544-2"><a href="time-series-in-finance-and-economics.html#cb544-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Period&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Sales of Wine&quot;</span>) <span class="sc">+</span></span>
<span id="cb544-3"><a href="time-series-in-finance-and-economics.html#cb544-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Wine Sales Data&quot;</span>) <span class="sc">+</span></span>
<span id="cb544-4"><a href="time-series-in-finance-and-economics.html#cb544-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb544-5"><a href="time-series-in-finance-and-economics.html#cb544-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb544-6"><a href="time-series-in-finance-and-economics.html#cb544-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb544-7"><a href="time-series-in-finance-and-economics.html#cb544-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb544-8"><a href="time-series-in-finance-and-economics.html#cb544-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb544-9"><a href="time-series-in-finance-and-economics.html#cb544-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb544-10"><a href="time-series-in-finance-and-economics.html#cb544-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb544-11"><a href="time-series-in-finance-and-economics.html#cb544-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb544-12"><a href="time-series-in-finance-and-economics.html#cb544-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb544-13"><a href="time-series-in-finance-and-economics.html#cb544-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb544-14"><a href="time-series-in-finance-and-economics.html#cb544-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type ts. Defaulting to continuous.</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-376-1.png" width="672" /></p>
<p>At first glance we can observe several characteristics of the series: first, that it maintains a slightly similar behavior, without radical changes in the behavior of the trend; Secondly, it presents a strong seasonal behavior, which explains these ups and downs, far from the average of the series.</p>
<p>In order to effectively model these time series concepts of trends and seasonality, let’s discover the STM model components.</p>
<p></p>
<p>The way to calculate the trend using the STL model is to calculate it from a LOESS regression. LOESS combines the simplicity of linear least squares regression with the flexibility of non-linear regression by <strong>fitting simple models on local subsets of data to create a function that describes the deterministic part of the variation</strong> in point-to-point data. In fact, one of the main attractions of this method is that it is not necessary to specify a global function to fit a model to the data. In return, a greater calculation power is necessary.</p>
<p>The key parameter for the estimation of the regression LOESS is the <em>span.</em> The span is the <strong>degree of smoothing of the series</strong>. Higher smoothing values (h) produce <em>softer functions that move less in response to fluctuations</em> in the data. IN general, <strong>the smaller the h, the closer the adjustment of the regression function to the data</strong> will be. Using too small a value of the smoothing parameter is not desirable because the regression function will begin to capture the random error in the data. The useful values of the smoothing parameter are generally in the <em>range of 0.25 to 0.5 for most LOESS applications</em>.</p>
<p>As an example to this smoothing difference we will occupy different values of span for the same regression, in order to compare the results, using the following code:</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb546-1"><a href="time-series-in-finance-and-economics.html#cb546-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Estimation:</span></span>
<span id="cb546-2"><a href="time-series-in-finance-and-economics.html#cb546-2" aria-hidden="true" tabindex="-1"></a>loessMod10 <span class="ot">&lt;-</span> <span class="fu">loess</span>(Sales <span class="sc">~</span> Period, <span class="at">data=</span>Train, <span class="at">span=</span><span class="fl">0.10</span>) <span class="co"># 10% smoothing span</span></span>
<span id="cb546-3"><a href="time-series-in-finance-and-economics.html#cb546-3" aria-hidden="true" tabindex="-1"></a>loessMod25 <span class="ot">&lt;-</span> <span class="fu">loess</span>(Sales <span class="sc">~</span> Period, <span class="at">data=</span>Train, <span class="at">span=</span><span class="fl">0.25</span>) <span class="co"># 25% smoothing span</span></span>
<span id="cb546-4"><a href="time-series-in-finance-and-economics.html#cb546-4" aria-hidden="true" tabindex="-1"></a>loessMod50 <span class="ot">&lt;-</span> <span class="fu">loess</span>(Sales <span class="sc">~</span> Period, <span class="at">data=</span>Train, <span class="at">span=</span><span class="fl">0.50</span>) <span class="co"># 50% smoothing span</span></span>
<span id="cb546-5"><a href="time-series-in-finance-and-economics.html#cb546-5" aria-hidden="true" tabindex="-1"></a>loessMod75 <span class="ot">&lt;-</span> <span class="fu">loess</span>(Sales <span class="sc">~</span> Period, <span class="at">data=</span>Train, <span class="at">span=</span><span class="fl">0.75</span>) <span class="co"># 75% smoothing span</span></span>
<span id="cb546-6"><a href="time-series-in-finance-and-economics.html#cb546-6" aria-hidden="true" tabindex="-1"></a>loessMod100 <span class="ot">&lt;-</span> <span class="fu">loess</span>(Sales <span class="sc">~</span> Period, <span class="at">data=</span>Train, <span class="at">span=</span><span class="dv">1</span>) <span class="co"># 100% smoothing span</span></span>
<span id="cb546-7"><a href="time-series-in-finance-and-economics.html#cb546-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb546-8"><a href="time-series-in-finance-and-economics.html#cb546-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Prediction</span></span>
<span id="cb546-9"><a href="time-series-in-finance-and-economics.html#cb546-9" aria-hidden="true" tabindex="-1"></a>loessMod10_pred <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predict</span>(loessMod10))</span>
<span id="cb546-10"><a href="time-series-in-finance-and-economics.html#cb546-10" aria-hidden="true" tabindex="-1"></a>loessMod25_pred <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predict</span>(loessMod25))</span>
<span id="cb546-11"><a href="time-series-in-finance-and-economics.html#cb546-11" aria-hidden="true" tabindex="-1"></a>loessMod50_pred <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predict</span>(loessMod50))</span>
<span id="cb546-12"><a href="time-series-in-finance-and-economics.html#cb546-12" aria-hidden="true" tabindex="-1"></a>loessMod75_pred <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predict</span>(loessMod75))</span>
<span id="cb546-13"><a href="time-series-in-finance-and-economics.html#cb546-13" aria-hidden="true" tabindex="-1"></a>loessMod100_pred <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">predict</span>(loessMod100))</span>
<span id="cb546-14"><a href="time-series-in-finance-and-economics.html#cb546-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb546-15"><a href="time-series-in-finance-and-economics.html#cb546-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Set together with Period variable</span></span>
<span id="cb546-16"><a href="time-series-in-finance-and-economics.html#cb546-16" aria-hidden="true" tabindex="-1"></a>wine_est <span class="ot">&lt;-</span> wine[<span class="dv">12</span><span class="sc">:</span><span class="dv">176</span>,]</span>
<span id="cb546-17"><a href="time-series-in-finance-and-economics.html#cb546-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb546-18"><a href="time-series-in-finance-and-economics.html#cb546-18" aria-hidden="true" tabindex="-1"></a>wine_predict <span class="ot">&lt;-</span> wine_est <span class="sc">%&gt;%</span> </span>
<span id="cb546-19"><a href="time-series-in-finance-and-economics.html#cb546-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">loessMod10_pred =</span> loessMod10_pred<span class="sc">$</span><span class="st">`</span><span class="at">predict(loessMod10)</span><span class="st">`</span>,</span>
<span id="cb546-20"><a href="time-series-in-finance-and-economics.html#cb546-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">loessMod25_pred =</span> loessMod25_pred<span class="sc">$</span><span class="st">`</span><span class="at">predict(loessMod25)</span><span class="st">`</span>,</span>
<span id="cb546-21"><a href="time-series-in-finance-and-economics.html#cb546-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">loessMod50_pred =</span> loessMod50_pred<span class="sc">$</span><span class="st">`</span><span class="at">predict(loessMod50)</span><span class="st">`</span>,</span>
<span id="cb546-22"><a href="time-series-in-finance-and-economics.html#cb546-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">loessMod75_pred =</span> loessMod75_pred<span class="sc">$</span><span class="st">`</span><span class="at">predict(loessMod75)</span><span class="st">`</span>,</span>
<span id="cb546-23"><a href="time-series-in-finance-and-economics.html#cb546-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">loessMod100_pred =</span> loessMod100_pred<span class="sc">$</span><span class="st">`</span><span class="at">predict(loessMod100)</span><span class="st">`</span>)</span>
<span id="cb546-24"><a href="time-series-in-finance-and-economics.html#cb546-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb546-25"><a href="time-series-in-finance-and-economics.html#cb546-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb546-26"><a href="time-series-in-finance-and-economics.html#cb546-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb546-27"><a href="time-series-in-finance-and-economics.html#cb546-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a time-series object</span></span>
<span id="cb546-28"><a href="time-series-in-finance-and-economics.html#cb546-28" aria-hidden="true" tabindex="-1"></a>wine_est_loess <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(wine_est, loessMod10_pred, loessMod25_pred, loessMod50_pred, loessMod75_pred, loessMod100_pred))</span>
<span id="cb546-29"><a href="time-series-in-finance-and-economics.html#cb546-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb546-30"><a href="time-series-in-finance-and-economics.html#cb546-30" aria-hidden="true" tabindex="-1"></a>wine_est_loess_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(wine_est_loess[,<span class="sc">-</span><span class="dv">2</span>], <span class="at">order.by =</span> <span class="fu">as.Date</span>(wine_est_loess[,<span class="dv">2</span>]))</span></code></pre></div>
<p>Note that we now created a <strong>degree of smoothing</strong> for the time series, where the span indicates the smoothing strength. Let’s plot this:</p>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb547-1"><a href="time-series-in-finance-and-economics.html#cb547-1" aria-hidden="true" tabindex="-1"></a>wine_est_loess_ts <span class="sc">%&gt;%</span> <span class="fu">tidy</span>()  <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>index, <span class="at">y=</span>value, <span class="at">color =</span> series)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb547-2"><a href="time-series-in-finance-and-economics.html#cb547-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Period&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Sales of Wine&quot;</span>) <span class="sc">+</span></span>
<span id="cb547-3"><a href="time-series-in-finance-and-economics.html#cb547-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Wine Sales Data&quot;</span>) <span class="sc">+</span></span>
<span id="cb547-4"><a href="time-series-in-finance-and-economics.html#cb547-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb547-5"><a href="time-series-in-finance-and-economics.html#cb547-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb547-6"><a href="time-series-in-finance-and-economics.html#cb547-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb547-7"><a href="time-series-in-finance-and-economics.html#cb547-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb547-8"><a href="time-series-in-finance-and-economics.html#cb547-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb547-9"><a href="time-series-in-finance-and-economics.html#cb547-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb547-10"><a href="time-series-in-finance-and-economics.html#cb547-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb547-11"><a href="time-series-in-finance-and-economics.html#cb547-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb547-12"><a href="time-series-in-finance-and-economics.html#cb547-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb547-13"><a href="time-series-in-finance-and-economics.html#cb547-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb547-14"><a href="time-series-in-finance-and-economics.html#cb547-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-378-1.png" width="672" /></p>
<p>We can observe the comparison between different span values separately.</p>
<p>Note again that it is the aim of a forecasting model to best possibly predict future values. We manifested that this can be achieved by incorporating a model which can best possibly fit the data at hand while simultaneously providing a good generalisation to external data. By doing so, we need to balance the fit, in order to circumvent both over- as well as underfitting scenarios. To quantify the extent to which we are able to accurately fit the model while allowing a sufficient generalisation, we defined certain metrics, such as the RMSE or MAE.</p>
<p>Now, in the case of the STL model, we can depict model fit based on trends, seasonality and an external factor. In order to quantify the trend fit, we can tweak the span to understand which value delivers the best possible (lowest) estimation error in the training set. To achieve this result, we will use the loess.as function, from the fANCOVA package.</p>
<p>The metrics the loess.as function chooses to determine model fit and optimal smoothing value are the <em>bias-corrected Akaike information criterion (aicc)</em> and the <em>generalized crossvalidation</em> (gcv). Let’s quickly calculate both:</p>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb548-1"><a href="time-series-in-finance-and-economics.html#cb548-1" aria-hidden="true" tabindex="-1"></a>Loess_Opt <span class="ot">&lt;-</span> fANCOVA<span class="sc">::</span><span class="fu">loess.as</span>(Train<span class="sc">$</span>Period, Train<span class="sc">$</span>Sales, <span class="at">user.span =</span> <span class="cn">NULL</span>, <span class="at">plot =</span> T)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-379-1.png" width="672" /></p>
<p>As we can see, the above plot shows at what values the AICC is maximised. The x defines the overall parameter space and the cut defines the maximum value. We can quantify the repsective span value as follows:</p>
<div class="sourceCode" id="cb549"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb549-1"><a href="time-series-in-finance-and-economics.html#cb549-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the max span value</span></span>
<span id="cb549-2"><a href="time-series-in-finance-and-economics.html#cb549-2" aria-hidden="true" tabindex="-1"></a>span_opt <span class="ot">&lt;-</span> Loess_Opt[[<span class="st">&quot;pars&quot;</span>]][[<span class="st">&quot;span&quot;</span>]]</span>
<span id="cb549-3"><a href="time-series-in-finance-and-economics.html#cb549-3" aria-hidden="true" tabindex="-1"></a>span_opt</span></code></pre></div>
<pre><code>## [1] 0.7840682</code></pre>
<p>On the other hand, using the <code>checkresiduals</code> function we can carry out a brief analysis of the residuals of the estimate, in order to contrast that the remaining variation is distributed in a normal way, with a constant variance and an average equal to 0 when we have the optimal LOESS.</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb551-1"><a href="time-series-in-finance-and-economics.html#cb551-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(Loess_Opt<span class="sc">$</span>residuals)</span></code></pre></div>
<pre><code>## Warning in modeldf.default(object): Could not find appropriate degrees of freedom for this model.</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-381-1.png" width="672" /></p>
<p>As we have defined earlier, we can see that:</p>
<ul>
<li>The residuals do not appear to show heteroskedasticity</li>
<li>There appears to be no normality</li>
<li>The model appears to show serious autocorrelation due to the fact that we only accounted for trend but not seasons yet</li>
</ul>
<p>Since we have elaborated how we can retrieve the best possible trend component, let’s look into the seasonality.</p>
<p></p>
<p>The most common options to assess seasonality are usually through <strong>ARIMA or ETS</strong>. Both models have an important effect that facilitates the calculation of seasonality once the trend is already conceived (which was already calculated from LOESS).</p>
<p>To be sure that the appropriate model was selected to model the behavior of the seasonal component, both the <strong>Akaike criterion and the RMSE of both models will be compared</strong>, and we will select the one that best suits us according to our purposes.</p>
<p>As a first step, it is necessary to <strong>define the training series as a time series, with a periodicity of 12</strong> (since we are considering a monthly seasonality that is repeated year after year - if it were different, we need to adjust this, in e.g. weekly or quarterly, hourly or minutes etc.s). In general, this implies:</p>
<ul>
<li><p>For the forecast (12 months) of the series, we will need to select the <code>s.window = 12</code>, because we will look for the behavior of the seasonal component with a periodicity of 12 months.</p></li>
<li><p>In turn, as the calculation of the optimal value of the span for the estimation of the trend was made, it will be added to the model from the criterion <code>t.window</code>.</p></li>
</ul>
<p>We will start by making the forecast with the ETS and ARIMA model.</p>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb553-1"><a href="time-series-in-finance-and-economics.html#cb553-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a time series model - same as s.window</span></span>
<span id="cb553-2"><a href="time-series-in-finance-and-economics.html#cb553-2" aria-hidden="true" tabindex="-1"></a>wine_ts <span class="ot">&lt;-</span> <span class="fu">ts</span>(Train<span class="sc">$</span>Sales, <span class="at">freq=</span><span class="dv">12</span>)</span>
<span id="cb553-3"><a href="time-series-in-finance-and-economics.html#cb553-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb553-4"><a href="time-series-in-finance-and-economics.html#cb553-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we define the model for ETS </span></span>
<span id="cb553-5"><a href="time-series-in-finance-and-economics.html#cb553-5" aria-hidden="true" tabindex="-1"></a>ts_wine_forecast_ets <span class="ot">&lt;-</span> <span class="fu">stlf</span>(wine_ts, </span>
<span id="cb553-6"><a href="time-series-in-finance-and-economics.html#cb553-6" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># Define the number of periods for forecastings</span></span>
<span id="cb553-7"><a href="time-series-in-finance-and-economics.html#cb553-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">h =</span> <span class="dv">12</span>, </span>
<span id="cb553-8"><a href="time-series-in-finance-and-economics.html#cb553-8" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># seasonal component behaviour with periodicity of 12 months (yearly seasonality - if months = 4, weeks = 7)</span></span>
<span id="cb553-9"><a href="time-series-in-finance-and-economics.html#cb553-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">s.window =</span> <span class="dv">12</span>, </span>
<span id="cb553-10"><a href="time-series-in-finance-and-economics.html#cb553-10" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># Define here the value of the optimal span</span></span>
<span id="cb553-11"><a href="time-series-in-finance-and-economics.html#cb553-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">t.window =</span> span_opt,</span>
<span id="cb553-12"><a href="time-series-in-finance-and-economics.html#cb553-12" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># Method to use for forecasting the seasonally adjusted series</span></span>
<span id="cb553-13"><a href="time-series-in-finance-and-economics.html#cb553-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;ets&quot;</span>))</span>
<span id="cb553-14"><a href="time-series-in-finance-and-economics.html#cb553-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb553-15"><a href="time-series-in-finance-and-economics.html#cb553-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we define the model for arima</span></span>
<span id="cb553-16"><a href="time-series-in-finance-and-economics.html#cb553-16" aria-hidden="true" tabindex="-1"></a>ts_wine_forecast_arima <span class="ot">&lt;-</span> <span class="fu">stlf</span>(wine_ts, </span>
<span id="cb553-17"><a href="time-series-in-finance-and-economics.html#cb553-17" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># Define the number of periods for forecastings</span></span>
<span id="cb553-18"><a href="time-series-in-finance-and-economics.html#cb553-18" aria-hidden="true" tabindex="-1"></a>                         <span class="at">h =</span> <span class="dv">12</span>, </span>
<span id="cb553-19"><a href="time-series-in-finance-and-economics.html#cb553-19" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># seasonal component behaviour with periodicity of 12 months (yearly seasonality - if months = 4, weeks = 7)</span></span>
<span id="cb553-20"><a href="time-series-in-finance-and-economics.html#cb553-20" aria-hidden="true" tabindex="-1"></a>                         <span class="at">s.window =</span> <span class="dv">12</span>, </span>
<span id="cb553-21"><a href="time-series-in-finance-and-economics.html#cb553-21" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># Define here the value of the optimal span</span></span>
<span id="cb553-22"><a href="time-series-in-finance-and-economics.html#cb553-22" aria-hidden="true" tabindex="-1"></a>                         <span class="at">t.window =</span> span_opt,</span>
<span id="cb553-23"><a href="time-series-in-finance-and-economics.html#cb553-23" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># Method to use for forecasting the seasonally adjusted series</span></span>
<span id="cb553-24"><a href="time-series-in-finance-and-economics.html#cb553-24" aria-hidden="true" tabindex="-1"></a>                         <span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;arima&quot;</span>))</span>
<span id="cb553-25"><a href="time-series-in-finance-and-economics.html#cb553-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb553-26"><a href="time-series-in-finance-and-economics.html#cb553-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Let0s get the AIC</span></span>
<span id="cb553-27"><a href="time-series-in-finance-and-economics.html#cb553-27" aria-hidden="true" tabindex="-1"></a>aic_ets <span class="ot">&lt;-</span> ts_wine_forecast_ets[[<span class="st">&quot;model&quot;</span>]][[<span class="st">&quot;aic&quot;</span>]]</span>
<span id="cb553-28"><a href="time-series-in-finance-and-economics.html#cb553-28" aria-hidden="true" tabindex="-1"></a>aic_arima <span class="ot">&lt;-</span> ts_wine_forecast_arima[[<span class="st">&quot;model&quot;</span>]][[<span class="st">&quot;aic&quot;</span>]]</span>
<span id="cb553-29"><a href="time-series-in-finance-and-economics.html#cb553-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb553-30"><a href="time-series-in-finance-and-economics.html#cb553-30" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(aic_ets, aic_arima)</span></code></pre></div>
<pre><code>##       aic_ets aic_arima
## [1,] 3355.928  2963.756</code></pre>
<p>According to the data, we should go for the arima model as it minimises the AIC.</p>
<p>Now, let’s repeat this for the RMSE.</p>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb555-1"><a href="time-series-in-finance-and-economics.html#cb555-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the test set</span></span>
<span id="cb555-2"><a href="time-series-in-finance-and-economics.html#cb555-2" aria-hidden="true" tabindex="-1"></a>TestSales<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(Test<span class="sc">$</span>Sales)</span>
<span id="cb555-3"><a href="time-series-in-finance-and-economics.html#cb555-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb555-4"><a href="time-series-in-finance-and-economics.html#cb555-4" aria-hidden="true" tabindex="-1"></a><span class="co"># First for the ARIMA model</span></span>
<span id="cb555-5"><a href="time-series-in-finance-and-economics.html#cb555-5" aria-hidden="true" tabindex="-1"></a>arima_fc <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(ts_wine_forecast_arima<span class="sc">$</span>mean)</span>
<span id="cb555-6"><a href="time-series-in-finance-and-economics.html#cb555-6" aria-hidden="true" tabindex="-1"></a><span class="co"># We now apply the weights generated by the arima model to the test dataset in order to fit the data on the test set </span></span>
<span id="cb555-7"><a href="time-series-in-finance-and-economics.html#cb555-7" aria-hidden="true" tabindex="-1"></a>Arima <span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">accuracy</span>(arima_fc,TestSales))</span>
<span id="cb555-8"><a href="time-series-in-finance-and-economics.html#cb555-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb555-9"><a href="time-series-in-finance-and-economics.html#cb555-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Same for ETS</span></span>
<span id="cb555-10"><a href="time-series-in-finance-and-economics.html#cb555-10" aria-hidden="true" tabindex="-1"></a>ets_fc <span class="ot">&lt;-</span><span class="fu">as.numeric</span>(ts_wine_forecast_ets<span class="sc">$</span>mean)</span>
<span id="cb555-11"><a href="time-series-in-finance-and-economics.html#cb555-11" aria-hidden="true" tabindex="-1"></a>ets<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="fu">accuracy</span>(ets_fc,TestSales))</span>
<span id="cb555-12"><a href="time-series-in-finance-and-economics.html#cb555-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb555-13"><a href="time-series-in-finance-and-economics.html#cb555-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Bind them </span></span>
<span id="cb555-14"><a href="time-series-in-finance-and-economics.html#cb555-14" aria-hidden="true" tabindex="-1"></a>Accuracy<span class="ot">&lt;-</span> <span class="fu">rbind</span>(<span class="at">ARIMA=</span>Arima,<span class="at">ETS=</span>ets)</span>
<span id="cb555-15"><a href="time-series-in-finance-and-economics.html#cb555-15" aria-hidden="true" tabindex="-1"></a>Accuracy</span></code></pre></div>
<pre><code>##              ME     RMSE      MAE       MPE     MAPE
## ARIMA -500.7483 6212.893 4066.676 -5.913015 15.96556
## ETS   -685.8625 6361.358 4219.720 -6.712627 16.60415</code></pre>
<p>Given the RMSE and the fact that the Arima model also outperformed in terms of the AIC, we will proceed with the Arima model for the final estimation. That is, we use:</p>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb557-1"><a href="time-series-in-finance-and-economics.html#cb557-1" aria-hidden="true" tabindex="-1"></a>ts_wine_forecast_arima <span class="ot">&lt;-</span> <span class="fu">stlf</span>(wine_ts, </span>
<span id="cb557-2"><a href="time-series-in-finance-and-economics.html#cb557-2" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># Define the number of periods for forecastings</span></span>
<span id="cb557-3"><a href="time-series-in-finance-and-economics.html#cb557-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">h =</span> <span class="dv">12</span>, </span>
<span id="cb557-4"><a href="time-series-in-finance-and-economics.html#cb557-4" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># seasonal component behaviour with periodicity of 12 months (yearly seasonality - if months = 4, weeks = 7)</span></span>
<span id="cb557-5"><a href="time-series-in-finance-and-economics.html#cb557-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">s.window =</span> <span class="dv">12</span>, </span>
<span id="cb557-6"><a href="time-series-in-finance-and-economics.html#cb557-6" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># Define here the value of the optimal span</span></span>
<span id="cb557-7"><a href="time-series-in-finance-and-economics.html#cb557-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">t.window =</span> span_opt,</span>
<span id="cb557-8"><a href="time-series-in-finance-and-economics.html#cb557-8" aria-hidden="true" tabindex="-1"></a>                         <span class="co"># Method to use for forecasting the seasonally adjusted series</span></span>
<span id="cb557-9"><a href="time-series-in-finance-and-economics.html#cb557-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">method =</span> <span class="fu">c</span>(<span class="st">&quot;arima&quot;</span>))</span></code></pre></div>
<p>and we can plot the result of our fit and the actual data as:</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb558-1"><a href="time-series-in-finance-and-economics.html#cb558-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitted df</span></span>
<span id="cb558-2"><a href="time-series-in-finance-and-economics.html#cb558-2" aria-hidden="true" tabindex="-1"></a>fitted <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(ts_wine_forecast_arima<span class="sc">$</span>fitted)</span>
<span id="cb558-3"><a href="time-series-in-finance-and-economics.html#cb558-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a time-series object</span></span>
<span id="cb558-4"><a href="time-series-in-finance-and-economics.html#cb558-4" aria-hidden="true" tabindex="-1"></a>wine_est_arima <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(wine_est, fitted))</span>
<span id="cb558-5"><a href="time-series-in-finance-and-economics.html#cb558-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(wine_est_arima) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Sales&quot;</span>, <span class="st">&quot;Period&quot;</span>, <span class="st">&quot;Estimated (Fitted) Sales&quot;</span>)</span>
<span id="cb558-6"><a href="time-series-in-finance-and-economics.html#cb558-6" aria-hidden="true" tabindex="-1"></a>wine_est_arima_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(wine_est_arima[,<span class="sc">-</span><span class="dv">2</span>], <span class="at">order.by =</span> <span class="fu">as.Date</span>(wine_est_arima[,<span class="dv">2</span>]))</span>
<span id="cb558-7"><a href="time-series-in-finance-and-economics.html#cb558-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb558-8"><a href="time-series-in-finance-and-economics.html#cb558-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb558-9"><a href="time-series-in-finance-and-economics.html#cb558-9" aria-hidden="true" tabindex="-1"></a>wine_est_arima_ts <span class="sc">%&gt;%</span> <span class="fu">tidy</span>()  <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>index, <span class="at">y=</span>value, <span class="at">color =</span> series)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb558-10"><a href="time-series-in-finance-and-economics.html#cb558-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Period&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Sales of Wine&quot;</span>) <span class="sc">+</span></span>
<span id="cb558-11"><a href="time-series-in-finance-and-economics.html#cb558-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Wine Sales Data&quot;</span>) <span class="sc">+</span></span>
<span id="cb558-12"><a href="time-series-in-finance-and-economics.html#cb558-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb558-13"><a href="time-series-in-finance-and-economics.html#cb558-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb558-14"><a href="time-series-in-finance-and-economics.html#cb558-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb558-15"><a href="time-series-in-finance-and-economics.html#cb558-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb558-16"><a href="time-series-in-finance-and-economics.html#cb558-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb558-17"><a href="time-series-in-finance-and-economics.html#cb558-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb558-18"><a href="time-series-in-finance-and-economics.html#cb558-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb558-19"><a href="time-series-in-finance-and-economics.html#cb558-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb558-20"><a href="time-series-in-finance-and-economics.html#cb558-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb558-21"><a href="time-series-in-finance-and-economics.html#cb558-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb558-22"><a href="time-series-in-finance-and-economics.html#cb558-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-385-1.png" width="672" /></p>
<p></p>
<p>As already covered, we need to conduct an analysis of the error terms in order to account for the kind of behaviour the series needs to model. For instance, we discovered that a seasonal pattern prevails which cannot be captured by LOESS. Now, including a seasonal parameter in form of an arima model, we may find different results. Let’s see.</p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb559-1"><a href="time-series-in-finance-and-economics.html#cb559-1" aria-hidden="true" tabindex="-1"></a><span class="fu">checkresiduals</span>(ts_wine_forecast_arima<span class="sc">$</span>residuals)</span></code></pre></div>
<pre><code>## Warning in modeldf.default(object): Could not find appropriate degrees of freedom for this model.</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-386-1.png" width="672" /></p>
<p>That’s great. We were now able to account for autocorrelation and non-normality due to seasonality. Moreover, there appears to be no heteroskedasticity present.</p>
<p>We can dig a little deeper into the normality concept by observing so-called <strong>QQ-Plots</strong>. These are plots comparing the quantiles of the residuals with the quantiles of a Gaussian distribution to show how close both distributions match.</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb561-1"><a href="time-series-in-finance-and-economics.html#cb561-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(ts_wine_forecast_arima<span class="sc">$</span>residuals, <span class="at">pch =</span> <span class="dv">1</span>, <span class="at">frame =</span> <span class="cn">FALSE</span>);</span>
<span id="cb561-2"><a href="time-series-in-finance-and-economics.html#cb561-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(ts_wine_forecast_arima<span class="sc">$</span>residuals, <span class="at">col =</span> <span class="st">&quot;steelblue&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-387-1.png" width="672" /></p>
<p>As we can see in the Q-Q plot, there is a normal behavior of the waste series.</p>
<p>Why do we care then so much about normality of the residuals? Well, it can be traced back to th same idea as in non time-series settings. We need to make sure that the errors are IID and thus are randomly sampled, without which we could not make any inferential statements and perform deductive statistics. Now, through a time-series decomposition we effectively decompose the series into an <em>observable part</em> (characterised by the trend and seasonality) and an unobservable part (characterised by the residuals). A correct model allows to capture efficiently the behaviour of the time series such that the only thing that remains is, effectively, <strong>white noise</strong>. As we covered, this is random variation that <em>simply cannot be predicted</em>. Note the term white noise again. We stated that time series models obtain a covariance stationarity form. This form defines that only the mean, variance and (auto-)covariance terms are stationary. We stated that white noise models are models which are this form of stationary and IID. Now, we also stated that it is possible to attain covariance stationarity by assuming that the data we work with is normally distributed (as it is defined by only its first two moments). However, since time series data is not covariance stationary, we first need to model it accordingly to account for the seasonal and trend characteristics. If we do this successfully, we arrive at a remaining variation which, if we assume is normally distributed, upholds to the principles of white noise models, enabling us to conduct procedures common in deductive statistics.</p>
<p>As such, if the residuals are approximately normally distributed, then we can assume that we successfully accounted for all the variation which disabled white noise characteristics in the data. Having accounted for this, we can proceed to conduct the same statistical inference as before.</p>
<p></p>
<p>Once the almost normal behavior of the residuals is contrasted, and obtaining a model with a fairly acceptable RMSE, we can proceed to carry out the forecast of the series and make the comparison with the original test series. First, we can make the model forecast chart using the autoplot function, which is inside the ggplot2 package.</p>
<p>Note: it must be remembered that the autoplot function only works with time series, so that when we want to occupy the function the series must be established as a series of time using the ts function.</p>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb562-1"><a href="time-series-in-finance-and-economics.html#cb562-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the train and test series</span></span>
<span id="cb562-2"><a href="time-series-in-finance-and-economics.html#cb562-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(ts_wine_forecast_arima) <span class="sc">+</span></span>
<span id="cb562-3"><a href="time-series-in-finance-and-economics.html#cb562-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">xlab</span>(<span class="st">&quot;Period&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Sales of Wine&quot;</span>) <span class="sc">+</span></span>
<span id="cb562-4"><a href="time-series-in-finance-and-economics.html#cb562-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Wine Sales Data - Forecasting with ARIMA + TSL &quot;</span>) <span class="sc">+</span></span>
<span id="cb562-5"><a href="time-series-in-finance-and-economics.html#cb562-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb562-6"><a href="time-series-in-finance-and-economics.html#cb562-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb562-7"><a href="time-series-in-finance-and-economics.html#cb562-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb562-8"><a href="time-series-in-finance-and-economics.html#cb562-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb562-9"><a href="time-series-in-finance-and-economics.html#cb562-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb562-10"><a href="time-series-in-finance-and-economics.html#cb562-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb562-11"><a href="time-series-in-finance-and-economics.html#cb562-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb562-12"><a href="time-series-in-finance-and-economics.html#cb562-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb562-13"><a href="time-series-in-finance-and-economics.html#cb562-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb562-14"><a href="time-series-in-finance-and-economics.html#cb562-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb562-15"><a href="time-series-in-finance-and-economics.html#cb562-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-388-1.png" width="672" /></p>
<p>Let’s observe this a little more closely.</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb563-1"><a href="time-series-in-finance-and-economics.html#cb563-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the fitted values and the CI</span></span>
<span id="cb563-2"><a href="time-series-in-finance-and-economics.html#cb563-2" aria-hidden="true" tabindex="-1"></a>fitted_arima <span class="ot">&lt;-</span> ts_wine_forecast_arima<span class="sc">$</span>mean</span>
<span id="cb563-3"><a href="time-series-in-finance-and-economics.html#cb563-3" aria-hidden="true" tabindex="-1"></a>upper_arima <span class="ot">&lt;-</span> ts_wine_forecast_arima<span class="sc">$</span>upper[,<span class="dv">1</span>]</span>
<span id="cb563-4"><a href="time-series-in-finance-and-economics.html#cb563-4" aria-hidden="true" tabindex="-1"></a>lower_arima <span class="ot">&lt;-</span> ts_wine_forecast_arima<span class="sc">$</span>lower[,<span class="dv">1</span>]</span>
<span id="cb563-5"><a href="time-series-in-finance-and-economics.html#cb563-5" aria-hidden="true" tabindex="-1"></a>actual_wine <span class="ot">&lt;-</span> wine_est[<span class="dv">154</span><span class="sc">:</span><span class="dv">165</span>,]</span>
<span id="cb563-6"><a href="time-series-in-finance-and-economics.html#cb563-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb563-7"><a href="time-series-in-finance-and-economics.html#cb563-7" aria-hidden="true" tabindex="-1"></a>df_wine <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(actual_wine, fitted_arima, upper_arima, lower_arima))</span>
<span id="cb563-8"><a href="time-series-in-finance-and-economics.html#cb563-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb563-9"><a href="time-series-in-finance-and-economics.html#cb563-9" aria-hidden="true" tabindex="-1"></a>df_wine <span class="sc">%&gt;%</span> </span>
<span id="cb563-10"><a href="time-series-in-finance-and-economics.html#cb563-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Period)) <span class="sc">+</span> </span>
<span id="cb563-11"><a href="time-series-in-finance-and-economics.html#cb563-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> fitted_arima), <span class="at">col =</span> <span class="st">&quot;violetred3&quot;</span>, <span class="at">size=</span><span class="dv">3</span>, <span class="at">shape=</span><span class="dv">21</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>) <span class="sc">+</span> </span>
<span id="cb563-12"><a href="time-series-in-finance-and-economics.html#cb563-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>lower_arima, <span class="at">ymax=</span>upper_arima), <span class="at">color =</span> <span class="st">&quot;lightsteelblue3&quot;</span>) <span class="sc">+</span> </span>
<span id="cb563-13"><a href="time-series-in-finance-and-economics.html#cb563-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Sales), <span class="at">col =</span> <span class="st">&quot;goldenrod&quot;</span>, <span class="at">size=</span><span class="dv">3</span>, <span class="at">shape=</span><span class="dv">21</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb563-14"><a href="time-series-in-finance-and-economics.html#cb563-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Sales), <span class="at">col =</span> <span class="st">&quot;goldenrod4&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">+</span> </span>
<span id="cb563-15"><a href="time-series-in-finance-and-economics.html#cb563-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Period&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Sales of Wine&quot;</span>) <span class="sc">+</span></span>
<span id="cb563-16"><a href="time-series-in-finance-and-economics.html#cb563-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Wine Sales Data - Forecasting with ARIMA + TSL &quot;</span>) <span class="sc">+</span></span>
<span id="cb563-17"><a href="time-series-in-finance-and-economics.html#cb563-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb563-18"><a href="time-series-in-finance-and-economics.html#cb563-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb563-19"><a href="time-series-in-finance-and-economics.html#cb563-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb563-20"><a href="time-series-in-finance-and-economics.html#cb563-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb563-21"><a href="time-series-in-finance-and-economics.html#cb563-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb563-22"><a href="time-series-in-finance-and-economics.html#cb563-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb563-23"><a href="time-series-in-finance-and-economics.html#cb563-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb563-24"><a href="time-series-in-finance-and-economics.html#cb563-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb563-25"><a href="time-series-in-finance-and-economics.html#cb563-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb563-26"><a href="time-series-in-finance-and-economics.html#cb563-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb563-27"><a href="time-series-in-finance-and-economics.html#cb563-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<pre><code>## Don&#39;t know how to automatically pick scale for object of type ts. Defaulting to continuous.</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-389-1.png" width="672" /></p>
<p>Here, we can see that the model performed quite well. Although it slightly failed to cover the 95% CI of the estimated observations in the first part, it is very precise in the second part of the estimation procedure.</p>
<p>Et voilà! We have officially created our first proper time series model. We showed how to train the data to best possibly account for trends and seasonality, how to combine both in order to retrieve the best model, how to capture both AIC and RMSE values to best possibly depict the model and how to check whether the model allows us to assume that we can conduct statistically valid tests.</p>
</div>
<div id="time-series-models-and-predictor-variables" class="section level3" number="9.4.5">
<h3><span class="header-section-number">9.4.5</span> Time-Series Models and Predictor Variables</h3>
<p>There are two main differences for forecasting time-series: <strong>Explanatory Models</strong> and <strong>Time-Series Models</strong>.</p>
<p>Explanatory Models use predominantly different, explanatory variables to predict a dependent variable or relationship. For instance, if we want to forecast the daily flight schedule of the airline SWISS during the fall holidays in Switzerland, we may want to forecast a model with the following predictors:</p>
<p><span class="math display">\[
SwissPass_{t} = f(\text{Weather in Switzerland}_t, \text{Economic Growth}_t, \text{Income Growth}_t, \text{Day}_t, \text{Weekend-Dummy}_t, \text{COVID strength}_t, \text{error}_t)
\]</span></p>
<p>We understand that the relationship can never be exactly replicated, which is why we need to include an error term at each observation. But we call this an explanatory model because we define causes that may explain the variation in passenger transports of SWISS.</p>
<p>Time-Series Models use predominantly the same explanatory variable in a lagged format to predict the variable or the relationship.</p>
<p><span class="math display">\[
SwissPass_{t+1} = f(SwissPass_{t}, SwissPass_{t-1}, SwissPass_{t-2}, \text{error}_t)
\]</span></p>
<p>Here, prediction of the future is based on past values of a variable, but not on external variables that may affect the system.</p>
<p>Lastly, we can also combine prediction and time-series models to obtain so-called <strong>mixed models</strong>.</p>
<p><span class="math display">\[
SwissPass_{t+1} = f(SwissPass_{t}, (SwissPass_{t-1})^2, \text{Economic Growth}_t, \text{Income Growth}_t, \text{Day}_t, \text{Weekend-Dummy}_t, \text{COVID strength}_t, \text{error}_t)
\]</span></p>
<p>These models are also known as <em>Dynamic Regression Models</em> or <em>Panel-Data Models</em>.</p>
<p>Although the use of the distinct models is not deterministic, it greatly depends on data availability, computational power as well as theoretical understanding of the problem at hand. Thereby, the model selection process is situation-specific, as we will see later on.</p>
</div>
</div>
<div id="autoregressive-and-moving-average-processes" class="section level2" number="9.5">
<h2><span class="header-section-number">9.5</span> Autoregressive and Moving Average Processes</h2>
<p>In the previous two chapters, we came to understand how we can remove trends and seasonality in the variation of time series data. In essence, we obtained a <strong>stationary residual with short-term autocorrelation</strong>. In both the Regression and Moving Average Smoothing section, we described ways to decompose the time series such that we can discriminate the variation into seaonal and trend as well as residual variation. Especially, in the Decomposition methodology section, we elaborated on why this stationarity principle is important for the furhter usage of the time series. Having accounted for trends and seasonal patterns, we essentially obtain (covariance) stationary time series data. In this case, it is assumed that the stochastic process to be modeled is <strong>covariance stationary and ergodic</strong>. Then, the main feature of the process to be modeled is the time dependence between the random variables. In this section, we illustrate some simple processes and models for covariance stationary and ergodic time series that exhibit particular types of linear time dependence captured by autocorrelations. Especially, we describe the two main classes of time series processes for this type of data, which are called <strong>Autoregressive (AR)</strong> as well as <strong>Moving Average (MA)</strong> Processes.</p>
<div id="ma-processes" class="section level3" number="9.5.1">
<h3><span class="header-section-number">9.5.1</span> MA Processes</h3>
<p>The definition of MA processes is the following. Let <span class="math inline">\(Z_t\)</span> be a purely random process with mean 0 and variance <span class="math inline">\(\sigma^2\)</span>. Then, a <strong>moving average process of order q</strong>, denoted as MA(q), is given by:</p>
<p><span class="math display">\[
X_t = \lambda_0Z_t + \lambda_1Z_{t-1} + \dots + \lambda_qZ_{t-q}
\]</span></p>
<p>Usually, the <span class="math inline">\(\lambda_0\)</span> is set to 1.</p>
<p>We can re-write this model using Backshift Operation, <span class="math inline">\(BZ_t = Z_{t-1}\)</span>, and attain:</p>
<p><span class="math display">\[
\begin{align}
X_t &amp;= Z_t + \lambda_1Z_{t-1} + \dots + \lambda_qZ_{t-q} \\
&amp;= (1 + \lambda_1B + \dots + \lambda_qB^q)Z_t \\
&amp;= \theta(B)Z_t
\end{align}
\]</span></p>
<p>Whereas <span class="math inline">\(\theta(B) = 1 + \lambda_1B + \dots + \lambda_qB^q\)</span> is called the <strong>characteristic polynomial</strong>.</p>
<p>We then obtain correlation between <span class="math inline">\(X_t\)</span> and <span class="math inline">\(X_{t-1}\)</span> due to the fact that both values depend on the elements of the purely random process <span class="math inline">\(Z_{t-1}, \dots, Z_{t-q}\)</span>.</p>
<div id="mean-and-variance-moments" class="section level4" number="9.5.1.1">
<h4><span class="header-section-number">9.5.1.1</span> Mean and Variance Moments</h4>
<p>We can write the MA process as:</p>
<p><span class="math display">\[
X_t = \sum_{j=0}^q\lambda_jZ_{t-j}
\]</span></p>
<p>Based on this, we obtain as the first two moments of the MA process.</p>
<p></p>
<p><span class="math display">\[
\begin{align}
E[X_t] &amp;= E[\sum_{j=0}^q\lambda_jZ_{t-j}] \\
&amp;= \sum_{j=0}^q\lambda_jE[Z_{t-j}] \\
&amp;= 0
\end{align}
\]</span></p>
<p>Consequently, each <strong>MA(q) process has mean 0</strong>.</p>
<p></p>
<p><span class="math display">\[
\begin{align}
Var[X_t] &amp;= Var[\sum_{j=0}^q\lambda_jZ_{t-j}] \\
&amp;= \sum_{j=1}^q\lambda_j^2Var[Z_{t-j}] \\
&amp;= \sigma_z^2\sum_{j=0}^q\lambda_j^2\\
&amp;= \sigma_z^2(1+\sum_{j=1}^q\lambda_j^2)
\end{align}
\]</span></p>
<p>Further, there are <strong>no covariance terms</strong> because we assume the time series to be a <strong>purely random process</strong>. Consequently, we get that:</p>
<p><span class="math display">\[
Cov(Z_t, Z_{t-k}) = 0 
\]</span></p>
<p>for all k.</p>
</div>
<div id="autocorrelation-functions" class="section level4" number="9.5.1.2">
<h4><span class="header-section-number">9.5.1.2</span> Autocorrelation functions</h4>
<p>The autocovariance function is calculated as:</p>
<p><span class="math display">\[
\begin{align}
Cov(X_t, X_{t+\tau}) &amp;=  E[X_tX_{t+\tau}] - E[X_t]E[X_{t+\tau}]\\
&amp;= E[X_tX_{t+\tau}] &amp;&amp; \text{remember the expected value is 0 so the latter term is 0}\\
&amp;= E[\sum_{j=0}^q\lambda_jZ_{t-j} \times \sum_{k=0}^q\lambda_kZ_{t-k+\tau}] \\
&amp;= \sum_{j=0}^q\sum_{k=0}^q\lambda_j\lambda_kE[Z_{t-j}Z_{t-k+\tau}]
\end{align}
\]</span></p>
<p>Let’s consider the temporal correlation a little more in depth. We can see that only the <span class="math inline">\(Z_t\)</span> included in both <span class="math inline">\(X_t\)</span> and <span class="math inline">\(X_{t+\tau}\)</span> contribute to the temporal covariance function. Consequently, only these terms will influence the correlation and, as such, only the correlation will diminish throughout time.</p>
<p>Let’s see this:</p>
<ul>
<li>When <span class="math inline">\(\tau = 0\)</span>, then <span class="math inline">\(Z_t, \dots, Z_{t-q}\)</span> are both in <span class="math inline">\(X_t\)</span> and <span class="math inline">\(X_t\)</span></li>
<li>When <span class="math inline">\(\tau = 1\)</span>, then <span class="math inline">\(Z_t, \dots, Z_{t-q+1}\)</span> are both in <span class="math inline">\(X_t\)</span> and <span class="math inline">\(X_{t+1}\)</span></li>
<li>When <span class="math inline">\(\tau = q-1\)</span>, then <span class="math inline">\(Z_t, Z_{t-1}\)</span> are both in <span class="math inline">\(X_t\)</span> and <span class="math inline">\(X_{t+q-1}\)</span></li>
<li>When <span class="math inline">\(\tau = q\)</span>, then <span class="math inline">\(Z_{t}\)</span> is both in <span class="math inline">\(X_t\)</span> and <span class="math inline">\(X_{t+q}\)</span></li>
<li>When <span class="math inline">\(\tau = q+1\)</span>, then there are no elements in common</li>
</ul>
<p>As such, the temporal diminishing factor induces the following <strong>autocovariance function</strong></p>
<p><span class="math display">\[
\gamma_\tau = Cov(X_t, X_{t+\tau}) = 
\begin{cases}
\sigma_z^2\sum_{j=0}^q\lambda_j\lambda_{j+\tau} &amp;&amp; \text{if }\tau = 0,1,\dots,q \\
0 &amp;&amp; \tau &gt; q
\end{cases}
\]</span></p>
<p>Therein, the <strong>autocorrelation function</strong> is given as:</p>
<p><span class="math display">\[
\rho_\tau = 
\begin{cases}
1 &amp;&amp; \text{if } \tau = 0 \\
\frac{\sum_{j=0}^q\lambda_j\lambda_{j+\tau}}{\sum_{j=0}^q\lambda_j^2} &amp;&amp; \text{if }\tau = 0,1,\dots,q \\
0 &amp;&amp; \tau &gt; q
\end{cases}
\]</span></p>
<p>As we can see, the <strong>autocorrelation function does not depend on t</strong>. Therefore, we have that the first two moments are finite and we have a time invariant autocorrelation, implying that <strong>MA(q) is weakly stationary</strong>.</p>
<p>Further, the autocorrelation function of an MA(q) process is positive at lags 1, …, q. This gives us a method for <strong>detecting whether an MA(q) process is an appropriate model for a given data set</strong>, namely if we have only trend variation.</p>
</div>
<div id="examples" class="section level4" number="9.5.1.3">
<h4><span class="header-section-number">9.5.1.3</span> Examples</h4>
<p>Let’s consider two specific MA processes. The first is an MA(1) and the second an MA(2) process. Let’s first define both processes.</p>
<p>The MA(1) process is given as:</p>
<p><span class="math display">\[
X_t = Z_t + \lambda_1Z_{t-1}
\]</span></p>
<p>Then, its variance is given by:</p>
<p><span class="math display">\[
Var(X_t) = Var(Z_t + Z_{t-1}) = \sigma_z^2(1+\lambda_1^2)
\]</span></p>
<p>And the 1-lag autocovariance function is defined as:</p>
<p><span class="math display">\[
\begin{align}
Cov(X_t, X_{t+1}) &amp;= Cov(Z_t + \lambda_1Z_{t-1}, Z_{t+1} + \lambda_2Z_t) \\
&amp;= Cov(Z_t, Z_{t+1}) +\underbrace{ Cov(Z_t, \lambda_2Z_t)}_{\text{the only term which is overlapping in an MA(1) model}} + Cov(Z_{t+1}\lambda_1Z_{t-1}) + Cov(\lambda_1Z_{t-1}, \lambda_2Z_t) \\
&amp;= Cov(Z_t, Z_{t+1}) + \lambda_2Cov(Z_t, Z_t) + \lambda_1(Z_{t+1},Z_{t-1}) + \lambda_1\lambda_2Cov(Z_{t-1}, Z_{t}) \\
&amp;= \lambda_2\sigma_z^2 &amp;&amp; \text{b/c the covariance is zero!} 
\end{align}
\]</span></p>
<p>While the 2-lag autocovariance function is defined as:</p>
<p><span class="math display">\[
\begin{align}
Cov(X_t, X_{t+2}) &amp;= Cov(Z_t + \lambda_2Z_{t-1}, Z_{t+2} + \lambda_3Z_{t+1}) \\
&amp;= Cov(Z_t, Z_{t+2}) + Cov(Z_t, \lambda_2Z_{t+1}) + Cov(Z_{t+2}\lambda_1Z_{t-1}) + Cov(\lambda_1Z_{t-1}, \lambda_3Z_{t+1}) \\
&amp;= Cov(Z_t, Z_{t+2}) + \lambda_2Cov(Z_t, Z_{t+1}) + \lambda_1(Z_{t+2},Z_{t-1}) + \lambda_1\lambda_3Cov(Z_{t-1}, Z_{t+1}) \\
&amp;= 0
\end{align}
\]</span></p>
<p>Which can be generalised to <span class="math inline">\(\tau &gt; 2\)</span>. This is intuitive as we said that only the <span class="math inline">\(Z_t\)</span> included in both <span class="math inline">\(X_t\)</span> and <span class="math inline">\(X_{t+\tau}\)</span> contribute to the temporal covariance function. This is made clear by the fact that the temporal covariance function is defined as the correlation between the terms. If the terms only affect one period, then the movements of two periods apart will, by logic, not be affected by this type of variation.</p>
<p>Let’s just consider the MA(2) process for completeness as:</p>
<p><span class="math display">\[
X_t = Z_t + 0.5Z_{t-1} + 0.3Z_{t-2}
\]</span></p>
<p>In this case, the variance is:</p>
<p><span class="math display">\[
Var(X_t) = Var(Z_t + 0.5Z_{t-1} + 0.3Z_{t-2}) = \sigma_z^2(1+\lambda_1^2 + \lambda_2^2) = 1.34\sigma_z^2
\]</span></p>
<p>And the 1-lag autocovariance function is given by:</p>
<p><span class="math display">\[
\begin{align}
Cov(X_t, X_{t+1}) &amp;= Cov(Z_t + 0.5Z_{t-1} + 0.3Z_{t-2}, Z_{t+1} + 0.5Z_{t} + 0.3Z_{t-1}) \\
&amp;= Cov(Z_t, Z_{t+1}) + Cov(Z_t, 0.5Z_{t}) + Cov(Z_t, 0.3Z_{t-1}) + Cov(0.5Z_{t-1}, Z_{t+1}) + Cov(0.5Z_{t-1}, 0.5Z_{t}) + Cov(0.5Z_{t-1}, 0.3Z_{t-1}) + Cov(0.3Z_{t-2}, Z_{t+1}) + Cov( 0.3Z_{t-2}, 0.5Z_{t}) + Cov(0.3Z_{t-2}, 0.3Z_{t-1}) \\
&amp;= 0.5Cov(Z_t, Z_t) + 0.5*0.3Cov(Z_{t-1}, Z_{t-1}) \\
&amp;= 0.5\sigma_z^2 + 0.15\sigma_{z}^2 \\
&amp;= 0.65\sigma_z^2
\end{align}
\]</span></p>
<p>With the same logic, we obtain the 2-lag autocovariance function, by:</p>
<p><span class="math display">\[
\begin{align}
Cov(X_t, X_{t+1}) &amp;= Cov(Z_t + 0.5Z_{t-1} + 0.3Z_{t-2}, Z_{t+2} + 0.5Z_{t+1} + 0.3Z_{t}) \\
&amp;= 0.3Cov(Z_{t}, Z_{t})\\
&amp;= 0.3\sigma_z^2
\end{align}
\]</span></p>
<p>In this case, the autocovariance funciton is defined as:</p>
<p><span class="math display">\[
\gamma_\tau = 
\begin{cases}
1.34\sigma_z^2 &amp;&amp; \text{if } \tau = 0 \\
0.65\sigma_z^2 &amp;&amp; \text{if } \tau = 1 \\
0.3\sigma_z^2 &amp;&amp; \text{if } \tau = 2 \\
0 &amp;&amp; \text{if } \tau &gt; 0 \\
\end{cases}
\]</span></p>
<p>and its respective autocorrelation function is given by:</p>
<p><span class="math display">\[
\rho_\tau = 
\begin{cases}
1  &amp;&amp; \text{if } \tau = 0 \\
0.655  &amp;&amp; \text{if } \tau = 1 \\
0.243 &amp;&amp; \text{if } \tau = 2 \\
0 &amp;&amp; \text{if } \tau &gt; 0 \\
\end{cases}
\]</span></p>
<p>As such, we see that moving average processes have a diminishing autocovariance factor, implying that the serial codependence of the observations declines with increasing time steps. This is due to the fact that fewer of the covariance terms overlap for increasing time horizons, unless we specifically imply that the model span increases. Let’s now simulate the data at hand.</p>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb565-1"><a href="time-series-in-finance-and-economics.html#cb565-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulated MA(1) and MA(6) data</span></span>
<span id="cb565-2"><a href="time-series-in-finance-and-economics.html#cb565-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb565-3"><a href="time-series-in-finance-and-economics.html#cb565-3" aria-hidden="true" tabindex="-1"></a>sd <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb565-4"><a href="time-series-in-finance-and-economics.html#cb565-4" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="at">model =</span> <span class="fu">list</span>(<span class="at">ma =</span> <span class="fl">0.5</span>), <span class="at">n =</span> n, <span class="at">sd =</span> sd)</span>
<span id="cb565-5"><a href="time-series-in-finance-and-economics.html#cb565-5" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="at">model =</span> <span class="fu">list</span>(<span class="at">ma =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.07</span>, <span class="fl">0.03</span>)), <span class="at">n =</span> n, <span class="at">sd =</span> sd)</span>
<span id="cb565-6"><a href="time-series-in-finance-and-economics.html#cb565-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb565-7"><a href="time-series-in-finance-and-economics.html#cb565-7" aria-hidden="true" tabindex="-1"></a>df_1 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(date, <span class="fu">as.numeric</span>(data1)))</span></code></pre></div>
<pre><code>## Warning in base::cbind(...): number of rows of result is not a multiple of vector length (arg 2)</code></pre>
<div class="sourceCode" id="cb567"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb567-1"><a href="time-series-in-finance-and-economics.html#cb567-1" aria-hidden="true" tabindex="-1"></a>df_1 <span class="ot">&lt;-</span> df_1 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">V2 =</span> <span class="fu">as.numeric</span>(V2))</span>
<span id="cb567-2"><a href="time-series-in-finance-and-economics.html#cb567-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df_1) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Date&quot;</span>, <span class="st">&quot;Value&quot;</span>)</span>
<span id="cb567-3"><a href="time-series-in-finance-and-economics.html#cb567-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb567-4"><a href="time-series-in-finance-and-economics.html#cb567-4" aria-hidden="true" tabindex="-1"></a>df_2 <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(date, <span class="fu">as.numeric</span>(data2)))</span></code></pre></div>
<pre><code>## Warning in base::cbind(...): number of rows of result is not a multiple of vector length (arg 2)</code></pre>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb569-1"><a href="time-series-in-finance-and-economics.html#cb569-1" aria-hidden="true" tabindex="-1"></a>df_2 <span class="ot">&lt;-</span> df_2 <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">V2 =</span> <span class="fu">as.numeric</span>(V2))</span>
<span id="cb569-2"><a href="time-series-in-finance-and-economics.html#cb569-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df_2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Date&quot;</span>, <span class="st">&quot;Value&quot;</span>)</span>
<span id="cb569-3"><a href="time-series-in-finance-and-economics.html#cb569-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb569-4"><a href="time-series-in-finance-and-economics.html#cb569-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create time series objects</span></span>
<span id="cb569-5"><a href="time-series-in-finance-and-economics.html#cb569-5" aria-hidden="true" tabindex="-1"></a>df_1_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(df_1[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> <span class="fu">as.Date</span>(df_1[,<span class="dv">1</span>]))</span>
<span id="cb569-6"><a href="time-series-in-finance-and-economics.html#cb569-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df_1_ts)<span class="ot">&lt;-</span> <span class="st">&quot;Value&quot;</span></span>
<span id="cb569-7"><a href="time-series-in-finance-and-economics.html#cb569-7" aria-hidden="true" tabindex="-1"></a>df_2_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(df_2[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> <span class="fu">as.Date</span>(df_2[,<span class="dv">1</span>]))</span>
<span id="cb569-8"><a href="time-series-in-finance-and-economics.html#cb569-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df_2_ts)<span class="ot">&lt;-</span> <span class="st">&quot;Value&quot;</span></span>
<span id="cb569-9"><a href="time-series-in-finance-and-economics.html#cb569-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb569-10"><a href="time-series-in-finance-and-economics.html#cb569-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create the acf plots</span></span>
<span id="cb569-11"><a href="time-series-in-finance-and-economics.html#cb569-11" aria-hidden="true" tabindex="-1"></a>df_1_acf <span class="ot">&lt;-</span> df_1_ts <span class="sc">%&gt;%</span> <span class="fu">acf</span>(<span class="at">plot =</span> F)</span>
<span id="cb569-12"><a href="time-series-in-finance-and-economics.html#cb569-12" aria-hidden="true" tabindex="-1"></a>df_2_acf <span class="ot">&lt;-</span> df_2_ts <span class="sc">%&gt;%</span> <span class="fu">acf</span>(<span class="at">plot =</span> F)</span>
<span id="cb569-13"><a href="time-series-in-finance-and-economics.html#cb569-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb569-14"><a href="time-series-in-finance-and-economics.html#cb569-14" aria-hidden="true" tabindex="-1"></a>df_1_pacf <span class="ot">&lt;-</span> <span class="fu">with</span>(df_1_acf, <span class="fu">data.frame</span>(lag, acf))</span>
<span id="cb569-15"><a href="time-series-in-finance-and-economics.html#cb569-15" aria-hidden="true" tabindex="-1"></a>df_2_pacf <span class="ot">&lt;-</span> <span class="fu">with</span>(df_2_acf, <span class="fu">data.frame</span>(lag, acf))</span>
<span id="cb569-16"><a href="time-series-in-finance-and-economics.html#cb569-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb569-17"><a href="time-series-in-finance-and-economics.html#cb569-17" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">tidy</span>(df_1_ts[,<span class="dv">1</span>]) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>index,<span class="at">y=</span> value, <span class="at">color=</span>series)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb569-18"><a href="time-series-in-finance-and-economics.html#cb569-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">&quot;Price&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span></span>
<span id="cb569-19"><a href="time-series-in-finance-and-economics.html#cb569-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;MA(1)&#39;</span>) <span class="sc">+</span></span>
<span id="cb569-20"><a href="time-series-in-finance-and-economics.html#cb569-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>( <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb569-21"><a href="time-series-in-finance-and-economics.html#cb569-21" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb569-22"><a href="time-series-in-finance-and-economics.html#cb569-22" aria-hidden="true" tabindex="-1"></a><span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb569-23"><a href="time-series-in-finance-and-economics.html#cb569-23" aria-hidden="true" tabindex="-1"></a><span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb569-24"><a href="time-series-in-finance-and-economics.html#cb569-24" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb569-25"><a href="time-series-in-finance-and-economics.html#cb569-25" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb569-26"><a href="time-series-in-finance-and-economics.html#cb569-26" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb569-27"><a href="time-series-in-finance-and-economics.html#cb569-27" aria-hidden="true" tabindex="-1"></a><span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb569-28"><a href="time-series-in-finance-and-economics.html#cb569-28" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb569-29"><a href="time-series-in-finance-and-economics.html#cb569-29" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb569-30"><a href="time-series-in-finance-and-economics.html#cb569-30" aria-hidden="true" tabindex="-1"></a><span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span>
<span id="cb569-31"><a href="time-series-in-finance-and-economics.html#cb569-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb569-32"><a href="time-series-in-finance-and-economics.html#cb569-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb569-33"><a href="time-series-in-finance-and-economics.html#cb569-33" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df_1_pacf, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> lag, <span class="at">y =</span> acf)) <span class="sc">+</span></span>
<span id="cb569-34"><a href="time-series-in-finance-and-economics.html#cb569-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb569-35"><a href="time-series-in-finance-and-economics.html#cb569-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">xend =</span> lag, <span class="at">yend =</span> <span class="dv">0</span>)) <span class="sc">+</span> </span>
<span id="cb569-36"><a href="time-series-in-finance-and-economics.html#cb569-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">length</span>(stocks_SMI_ts_ret[,<span class="dv">1</span>]))), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span> </span>
<span id="cb569-37"><a href="time-series-in-finance-and-economics.html#cb569-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">length</span>(stocks_SMI_ts_ret[,<span class="dv">1</span>]))), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span> </span>
<span id="cb569-38"><a href="time-series-in-finance-and-economics.html#cb569-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>( <span class="st">&quot;khaki3&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>, <span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;tomato3&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>)) <span class="sc">+</span></span>
<span id="cb569-39"><a href="time-series-in-finance-and-economics.html#cb569-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;ACF&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Lags&quot;</span>) <span class="sc">+</span></span>
<span id="cb569-40"><a href="time-series-in-finance-and-economics.html#cb569-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb569-41"><a href="time-series-in-finance-and-economics.html#cb569-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb569-42"><a href="time-series-in-finance-and-economics.html#cb569-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb569-43"><a href="time-series-in-finance-and-economics.html#cb569-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb569-44"><a href="time-series-in-finance-and-economics.html#cb569-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb569-45"><a href="time-series-in-finance-and-economics.html#cb569-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb569-46"><a href="time-series-in-finance-and-economics.html#cb569-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb569-47"><a href="time-series-in-finance-and-economics.html#cb569-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb569-48"><a href="time-series-in-finance-and-economics.html#cb569-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb569-49"><a href="time-series-in-finance-and-economics.html#cb569-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb569-50"><a href="time-series-in-finance-and-economics.html#cb569-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb569-51"><a href="time-series-in-finance-and-economics.html#cb569-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<pre><code>## Scale for &#39;colour&#39; is already present. Adding another scale for &#39;colour&#39;, which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb571-1"><a href="time-series-in-finance-and-economics.html#cb571-1" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> <span class="fu">tidy</span>(df_2_ts[,<span class="dv">1</span>]) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>index,<span class="at">y=</span> value, <span class="at">color=</span>series)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb571-2"><a href="time-series-in-finance-and-economics.html#cb571-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ylab</span>(<span class="st">&quot;Price&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span></span>
<span id="cb571-3"><a href="time-series-in-finance-and-economics.html#cb571-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;MA(6)&#39;</span>) <span class="sc">+</span></span>
<span id="cb571-4"><a href="time-series-in-finance-and-economics.html#cb571-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>( <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb571-5"><a href="time-series-in-finance-and-economics.html#cb571-5" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb571-6"><a href="time-series-in-finance-and-economics.html#cb571-6" aria-hidden="true" tabindex="-1"></a><span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb571-7"><a href="time-series-in-finance-and-economics.html#cb571-7" aria-hidden="true" tabindex="-1"></a><span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb571-8"><a href="time-series-in-finance-and-economics.html#cb571-8" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb571-9"><a href="time-series-in-finance-and-economics.html#cb571-9" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb571-10"><a href="time-series-in-finance-and-economics.html#cb571-10" aria-hidden="true" tabindex="-1"></a><span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb571-11"><a href="time-series-in-finance-and-economics.html#cb571-11" aria-hidden="true" tabindex="-1"></a><span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb571-12"><a href="time-series-in-finance-and-economics.html#cb571-12" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb571-13"><a href="time-series-in-finance-and-economics.html#cb571-13" aria-hidden="true" tabindex="-1"></a><span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb571-14"><a href="time-series-in-finance-and-economics.html#cb571-14" aria-hidden="true" tabindex="-1"></a><span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span>
<span id="cb571-15"><a href="time-series-in-finance-and-economics.html#cb571-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb571-16"><a href="time-series-in-finance-and-economics.html#cb571-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb571-17"><a href="time-series-in-finance-and-economics.html#cb571-17" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df_2_pacf, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> lag, <span class="at">y =</span> acf)) <span class="sc">+</span></span>
<span id="cb571-18"><a href="time-series-in-finance-and-economics.html#cb571-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb571-19"><a href="time-series-in-finance-and-economics.html#cb571-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">xend =</span> lag, <span class="at">yend =</span> <span class="dv">0</span>)) <span class="sc">+</span> </span>
<span id="cb571-20"><a href="time-series-in-finance-and-economics.html#cb571-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">length</span>(stocks_SMI_ts_ret[,<span class="dv">1</span>]))), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span> </span>
<span id="cb571-21"><a href="time-series-in-finance-and-economics.html#cb571-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">length</span>(stocks_SMI_ts_ret[,<span class="dv">1</span>]))), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span> </span>
<span id="cb571-22"><a href="time-series-in-finance-and-economics.html#cb571-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>( <span class="st">&quot;khaki3&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>, <span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;tomato3&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>)) <span class="sc">+</span></span>
<span id="cb571-23"><a href="time-series-in-finance-and-economics.html#cb571-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;ACF&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Lags&quot;</span>) <span class="sc">+</span></span>
<span id="cb571-24"><a href="time-series-in-finance-and-economics.html#cb571-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb571-25"><a href="time-series-in-finance-and-economics.html#cb571-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb571-26"><a href="time-series-in-finance-and-economics.html#cb571-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb571-27"><a href="time-series-in-finance-and-economics.html#cb571-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb571-28"><a href="time-series-in-finance-and-economics.html#cb571-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb571-29"><a href="time-series-in-finance-and-economics.html#cb571-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb571-30"><a href="time-series-in-finance-and-economics.html#cb571-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb571-31"><a href="time-series-in-finance-and-economics.html#cb571-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb571-32"><a href="time-series-in-finance-and-economics.html#cb571-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb571-33"><a href="time-series-in-finance-and-economics.html#cb571-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb571-34"><a href="time-series-in-finance-and-economics.html#cb571-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb571-35"><a href="time-series-in-finance-and-economics.html#cb571-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<pre><code>## Scale for &#39;colour&#39; is already present. Adding another scale for &#39;colour&#39;, which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb573-1"><a href="time-series-in-finance-and-economics.html#cb573-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> r <span class="sc">+</span> q <span class="sc">+</span> s <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-390-1.png" width="672" /></p>
<p>As we can see, we can easily simulate the MA(q) process. We did so for an MA(1) as well as an MA(6) process. We cans see that the autocorrelation function is far more extensive for the MA(6) process because of the increased temporal overlap of its factors. Consequently, with an increasing q we can model increasingly complex time series structures.</p>
</div>
<div id="model-identification-of-ma-processes" class="section level4" number="9.5.1.4">
<h4><span class="header-section-number">9.5.1.4</span> Model identification of MA processes</h4>
<p>Given a stationary, trend and seasonality removed, time series, we may now be inclined to understand how we can define whether an MA process is valid to model the underlying structure. In essence, we need to understand:</p>
<ul>
<li>Whether an MA process is appropriate</li>
<li>Which order the MA process (q) should have</li>
</ul>
<p>We can answer both these questions using the autocorrelation function (correlogram). Recall that for an MA(q) process the ACF is given by</p>
<p><span class="math display">\[
\rho_\tau = 
\begin{cases}
1 &amp;&amp; \text{if } \tau = 0 \\
\frac{\sum_{j=0}^q\lambda_j\lambda_{j+\tau}}{\sum_{j=0}^q\lambda_j^2} &amp;&amp; \text{if }\tau = 0,1,\dots,q \\
0 &amp;&amp; \tau &gt; q
\end{cases}
\]</span></p>
<p>It can be shown that:</p>
<p><span class="math display">\[
\rho_\tau \sim N(0, \frac{1}{n})
\]</span></p>
<p>resulting in approximately 95% CI for <span class="math inline">\(\rho_\tau \pm 1.96/\sqrt{n}\)</span>.</p>
<p>Consequently, it is straightforward to identify whether an MA(q) process is appropriate by <strong>plotting the sample autocorrelation function (correlogram)</strong>. If an MA(q) process is appropriate the correlogram will be significantly different from zero at lags <span class="math inline">\(\tau = 1, \dots, q\)</span> and within the 95% CI for <span class="math inline">\(\tau &gt; q\)</span>.</p>
</div>
<div id="ma-parameter-estimation" class="section level4" number="9.5.1.5">
<h4><span class="header-section-number">9.5.1.5</span> MA Parameter estimation</h4>
<p>Now, we identified in which cases we should use MA(q) processes. Let’s now comprehend how we can estimate the parameters of the MA(q) process models.</p>
<p>Let’s consider again the MA(q) process:</p>
<p><span class="math display">\[
X_t = \mu +  \lambda_0Z_t + \lambda_1Z_{t-1} + \dots + \lambda_qZ_{t-q}
\]</span></p>
<p>where <span class="math inline">\(\mu\)</span> is the mean of the process. Let’s consider minimising this with OLS procedures. For an MA(q) process an ordinary least squares procedure would require minimisation of would require:</p>
<p><span class="math display">\[
S(\mu, \lambda_1, \dots, \lambda_q) = \sum_{i=1}^n[x_t - \mu - \lambda_1Z_{t-1} - \dots - \lambda_qZ_{t-q}]^2
\]</span></p>
<p>which is not possible because the <span class="math inline">\(Z_t\)</span> are random variables. Instead a modification of ordinary least squares is used, known as <strong>conditional least squares</strong>.</p>
<p>To comprehend how this procedure works, we will focus on an MA(1) process: <span class="math inline">\(X_t = \mu + \Z_t + \lambda_1Z_{t-1}\)</span>. The algorithm does the following:</p>
<ol style="list-style-type: decimal">
<li>Select starting values for both <span class="math inline">\(\mu\)</span> and <span class="math inline">\(\lambda_1\)</span>:</li>
</ol>
<p><span class="math display">\[
\begin{align}
\hat\mu = 1/n\sum_{i=1}^2x_t \\
\hat\rho_1 = \frac{\hat\lambda_1}{1+\hat\lambda_1}
\end{align}
\]</span></p>
<ol start="2" style="list-style-type: decimal">
<li>Calculate the conditional residual sum of squares as:</li>
</ol>
<p><span class="math display">\[
S(\hat\mu, \hat\lambda) = \sum_{i=1}^n[x_t - \hat\mu - \hat\lambda_1Z_{t-1}]^2
\]</span></p>
<p>Where <span class="math inline">\(Z_0 = 0\)</span> and <span class="math inline">\(Z_t\)</span> is calculated recursively.</p>
<ol start="3" style="list-style-type: decimal">
<li><p>Repeat step 2 for a range of values of <span class="math inline">\(\mu, \lambda_1\)</span> that are close to the initial estimates in step 1. Then determine the estimates as the values that minimise S.</p></li>
<li><p>Using the fact that the variance of an MA(1) process is <span class="math inline">\(\sigma_z^2(1+\lambda_1^2)\)</span>, we obtain that:</p></li>
</ol>
<p><span class="math display">\[
\hat\sigma_z^2 = \frac{\hat\sigma^2}{(1+\hat\lambda^2)}
\]</span></p>
<p>Then, we again calculate the standard errors as well as the corresponding test statistics in the same manner as we did for Gaussian White Noise processes. Parameter estimation for more general MA(q) processes can be implemented in a similar way, and the conditional least squares method is used by R.</p>
</div>
<div id="using-an-maq-process" class="section level4" number="9.5.1.6">
<h4><span class="header-section-number">9.5.1.6</span> Using an MA(q) process</h4>
<p>Since we now covered the MA(q) theroy fundamentals, let’s see how we can apply the model to actual data. Doing so, we will consider the entire approach. That is, we first attempt to remove trends and seasonality and, in a subsequent step, then use an MA(q) process to fit the residuals.</p>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="time-series-in-finance-and-economics.html#cb574-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Based on this, we now need to create the same tsibble datasets as before</span></span>
<span id="cb574-2"><a href="time-series-in-finance-and-economics.html#cb574-2" aria-hidden="true" tabindex="-1"></a>air_ZH_merged_ts <span class="ot">&lt;-</span>  air_ZH_merged <span class="sc">%&gt;%</span> </span>
<span id="cb574-3"><a href="time-series-in-finance-and-economics.html#cb574-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Intervall, Status, Einheit)) <span class="sc">%&gt;%</span> </span>
<span id="cb574-4"><a href="time-series-in-finance-and-economics.html#cb574-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Datum =</span> <span class="fu">as.Date</span>(Datum)) <span class="sc">%&gt;%</span> </span>
<span id="cb574-5"><a href="time-series-in-finance-and-economics.html#cb574-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Datum, Standort, Parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb574-6"><a href="time-series-in-finance-and-economics.html#cb574-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">key =</span> <span class="fu">c</span>(Standort, Parameter), <span class="at">index =</span> Datum) <span class="sc">%&gt;%</span> </span>
<span id="cb574-7"><a href="time-series-in-finance-and-economics.html#cb574-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb574-8"><a href="time-series-in-finance-and-economics.html#cb574-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>((Datum <span class="sc">&gt;=</span> <span class="st">&quot;2004-10-26&quot;</span>) <span class="sc">&amp;</span> (Datum <span class="sc">&lt;</span> <span class="st">&quot;2005-06-26&quot;</span>))</span>
<span id="cb574-9"><a href="time-series-in-finance-and-economics.html#cb574-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb574-10"><a href="time-series-in-finance-and-economics.html#cb574-10" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> air_ZH_merged_ts <span class="sc">%&gt;%</span></span>
<span id="cb574-11"><a href="time-series-in-finance-and-economics.html#cb574-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Standort <span class="sc">==</span> <span class="st">&quot;Zch_Stampfenbachstrasse&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb574-12"><a href="time-series-in-finance-and-economics.html#cb574-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from=</span>Wert, <span class="at">names_from=</span>Parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb574-13"><a href="time-series-in-finance-and-economics.html#cb574-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(O3) <span class="sc">%&gt;%</span> </span>
<span id="cb574-14"><a href="time-series-in-finance-and-economics.html#cb574-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Datum, <span class="at">y =</span> O3)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;dodgerblue4&quot;</span>) <span class="sc">+</span> </span>
<span id="cb574-15"><a href="time-series-in-finance-and-economics.html#cb574-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;µg/m3&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> </span>
<span id="cb574-16"><a href="time-series-in-finance-and-economics.html#cb574-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Concentration of O3 at Zürich Stampfenbachstrasse&quot;</span>) <span class="sc">+</span></span>
<span id="cb574-17"><a href="time-series-in-finance-and-economics.html#cb574-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb574-18"><a href="time-series-in-finance-and-economics.html#cb574-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb574-19"><a href="time-series-in-finance-and-economics.html#cb574-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb574-20"><a href="time-series-in-finance-and-economics.html#cb574-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb574-21"><a href="time-series-in-finance-and-economics.html#cb574-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb574-22"><a href="time-series-in-finance-and-economics.html#cb574-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb574-23"><a href="time-series-in-finance-and-economics.html#cb574-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb574-24"><a href="time-series-in-finance-and-economics.html#cb574-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb574-25"><a href="time-series-in-finance-and-economics.html#cb574-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb574-26"><a href="time-series-in-finance-and-economics.html#cb574-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb574-27"><a href="time-series-in-finance-and-economics.html#cb574-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span>
<span id="cb574-28"><a href="time-series-in-finance-and-economics.html#cb574-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb574-29"><a href="time-series-in-finance-and-economics.html#cb574-29" aria-hidden="true" tabindex="-1"></a>air_ZH_merged_ts_acf <span class="ot">&lt;-</span>  air_ZH_merged_ts <span class="sc">%&gt;%</span></span>
<span id="cb574-30"><a href="time-series-in-finance-and-economics.html#cb574-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Standort <span class="sc">==</span> <span class="st">&quot;Zch_Stampfenbachstrasse&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb574-31"><a href="time-series-in-finance-and-economics.html#cb574-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Standort) <span class="sc">%&gt;%</span> </span>
<span id="cb574-32"><a href="time-series-in-finance-and-economics.html#cb574-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from=</span>Wert, <span class="at">names_from=</span>Parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb574-33"><a href="time-series-in-finance-and-economics.html#cb574-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(NO)  <span class="sc">%&gt;%</span> <span class="fu">acf</span>(<span class="at">na.action =</span> na.pass, <span class="at">plot =</span> <span class="cn">FALSE</span>) </span>
<span id="cb574-34"><a href="time-series-in-finance-and-economics.html#cb574-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb574-35"><a href="time-series-in-finance-and-economics.html#cb574-35" aria-hidden="true" tabindex="-1"></a>air_ZH_merged_ts_acf_df <span class="ot">&lt;-</span> <span class="fu">with</span>(air_ZH_merged_ts_acf, <span class="fu">data.frame</span>(lag, acf))</span>
<span id="cb574-36"><a href="time-series-in-finance-and-economics.html#cb574-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb574-37"><a href="time-series-in-finance-and-economics.html#cb574-37" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> air_ZH_merged_ts_acf_df <span class="sc">%&gt;%</span> </span>
<span id="cb574-38"><a href="time-series-in-finance-and-economics.html#cb574-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lag, <span class="at">y =</span> acf)) <span class="sc">+</span></span>
<span id="cb574-39"><a href="time-series-in-finance-and-economics.html#cb574-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb574-40"><a href="time-series-in-finance-and-economics.html#cb574-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">xend =</span> lag, <span class="at">yend =</span> <span class="dv">0</span>)) <span class="sc">+</span> </span>
<span id="cb574-41"><a href="time-series-in-finance-and-economics.html#cb574-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">length</span>(stocks_SMI_ts_ret[,<span class="dv">1</span>]))), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span> </span>
<span id="cb574-42"><a href="time-series-in-finance-and-economics.html#cb574-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">length</span>(stocks_SMI_ts_ret[,<span class="dv">1</span>]))), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span> </span>
<span id="cb574-43"><a href="time-series-in-finance-and-economics.html#cb574-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>( <span class="st">&quot;khaki3&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>, <span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;tomato3&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>)) <span class="sc">+</span></span>
<span id="cb574-44"><a href="time-series-in-finance-and-economics.html#cb574-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;ACF&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Lags&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Correlogram to show the ACF of O3 concentration&quot;</span>) <span class="sc">+</span></span>
<span id="cb574-45"><a href="time-series-in-finance-and-economics.html#cb574-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb574-46"><a href="time-series-in-finance-and-economics.html#cb574-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb574-47"><a href="time-series-in-finance-and-economics.html#cb574-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb574-48"><a href="time-series-in-finance-and-economics.html#cb574-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb574-49"><a href="time-series-in-finance-and-economics.html#cb574-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb574-50"><a href="time-series-in-finance-and-economics.html#cb574-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb574-51"><a href="time-series-in-finance-and-economics.html#cb574-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb574-52"><a href="time-series-in-finance-and-economics.html#cb574-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb574-53"><a href="time-series-in-finance-and-economics.html#cb574-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb574-54"><a href="time-series-in-finance-and-economics.html#cb574-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb574-55"><a href="time-series-in-finance-and-economics.html#cb574-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb574-56"><a href="time-series-in-finance-and-economics.html#cb574-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<pre><code>## Scale for &#39;colour&#39; is already present. Adding another scale for &#39;colour&#39;, which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb576-1"><a href="time-series-in-finance-and-economics.html#cb576-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> q <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-391-1.png" width="672" /></p>
<p>As we can see, the O3 concentration has probably a quadratic trend, which we need to remove first.</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="time-series-in-finance-and-economics.html#cb577-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, we only want the O3 concentration here</span></span>
<span id="cb577-2"><a href="time-series-in-finance-and-economics.html#cb577-2" aria-hidden="true" tabindex="-1"></a>O3_conc <span class="ot">&lt;-</span> air_ZH_merged_ts <span class="sc">%&gt;%</span></span>
<span id="cb577-3"><a href="time-series-in-finance-and-economics.html#cb577-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Standort <span class="sc">==</span> <span class="st">&quot;Zch_Stampfenbachstrasse&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb577-4"><a href="time-series-in-finance-and-economics.html#cb577-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from=</span>Wert, <span class="at">names_from=</span>Parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb577-5"><a href="time-series-in-finance-and-economics.html#cb577-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(O3) <span class="sc">%&gt;%</span> </span>
<span id="cb577-6"><a href="time-series-in-finance-and-economics.html#cb577-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Datum_new =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">243</span>)</span>
<span id="cb577-7"><a href="time-series-in-finance-and-economics.html#cb577-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb577-8"><a href="time-series-in-finance-and-economics.html#cb577-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we regress a quadratic model and obtain the residuals</span></span>
<span id="cb577-9"><a href="time-series-in-finance-and-economics.html#cb577-9" aria-hidden="true" tabindex="-1"></a>lin_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(O3 <span class="sc">~</span> Datum_new <span class="sc">+</span> Datum_new<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> O3_conc)</span>
<span id="cb577-10"><a href="time-series-in-finance-and-economics.html#cb577-10" aria-hidden="true" tabindex="-1"></a>res_lm <span class="ot">&lt;-</span> O3_conc<span class="sc">$</span>O3 <span class="sc">-</span> lin_mod<span class="sc">$</span>fitted.values</span>
<span id="cb577-11"><a href="time-series-in-finance-and-economics.html#cb577-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb577-12"><a href="time-series-in-finance-and-economics.html#cb577-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we effectively eliminated the quadratic trend. </span></span>
<span id="cb577-13"><a href="time-series-in-finance-and-economics.html#cb577-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb577-14"><a href="time-series-in-finance-and-economics.html#cb577-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s create the plots again</span></span>
<span id="cb577-15"><a href="time-series-in-finance-and-economics.html#cb577-15" aria-hidden="true" tabindex="-1"></a>res_acf <span class="ot">&lt;-</span> res_lm <span class="sc">%&gt;%</span> <span class="fu">acf</span>(<span class="at">na.action =</span> na.pass, <span class="at">plot =</span> <span class="cn">FALSE</span>) </span>
<span id="cb577-16"><a href="time-series-in-finance-and-economics.html#cb577-16" aria-hidden="true" tabindex="-1"></a>res_bacf <span class="ot">&lt;-</span> <span class="fu">with</span>(res_acf, <span class="fu">data.frame</span>(lag, acf))</span>
<span id="cb577-17"><a href="time-series-in-finance-and-economics.html#cb577-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb577-18"><a href="time-series-in-finance-and-economics.html#cb577-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the dataframe for later merging</span></span>
<span id="cb577-19"><a href="time-series-in-finance-and-economics.html#cb577-19" aria-hidden="true" tabindex="-1"></a>res_lm_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(res_lm, <span class="fu">as.Date</span>(O3_conc<span class="sc">$</span>Datum)))</span>
<span id="cb577-20"><a href="time-series-in-finance-and-economics.html#cb577-20" aria-hidden="true" tabindex="-1"></a>res_lm_df <span class="ot">&lt;-</span> res_lm_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Datum =</span> <span class="fu">as.Date</span>(V2))</span>
<span id="cb577-21"><a href="time-series-in-finance-and-economics.html#cb577-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb577-22"><a href="time-series-in-finance-and-economics.html#cb577-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot both</span></span>
<span id="cb577-23"><a href="time-series-in-finance-and-economics.html#cb577-23" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> res_lm_df <span class="sc">%&gt;%</span></span>
<span id="cb577-24"><a href="time-series-in-finance-and-economics.html#cb577-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Datum, <span class="at">y =</span> res_lm)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;dodgerblue4&quot;</span>) <span class="sc">+</span> </span>
<span id="cb577-25"><a href="time-series-in-finance-and-economics.html#cb577-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Residuals&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> </span>
<span id="cb577-26"><a href="time-series-in-finance-and-economics.html#cb577-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Residuals of O3 at Zürich Stampfenbachstrasse&quot;</span>) <span class="sc">+</span></span>
<span id="cb577-27"><a href="time-series-in-finance-and-economics.html#cb577-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb577-28"><a href="time-series-in-finance-and-economics.html#cb577-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb577-29"><a href="time-series-in-finance-and-economics.html#cb577-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb577-30"><a href="time-series-in-finance-and-economics.html#cb577-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb577-31"><a href="time-series-in-finance-and-economics.html#cb577-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb577-32"><a href="time-series-in-finance-and-economics.html#cb577-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb577-33"><a href="time-series-in-finance-and-economics.html#cb577-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb577-34"><a href="time-series-in-finance-and-economics.html#cb577-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb577-35"><a href="time-series-in-finance-and-economics.html#cb577-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb577-36"><a href="time-series-in-finance-and-economics.html#cb577-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb577-37"><a href="time-series-in-finance-and-economics.html#cb577-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span>
<span id="cb577-38"><a href="time-series-in-finance-and-economics.html#cb577-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb577-39"><a href="time-series-in-finance-and-economics.html#cb577-39" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> res_bacf <span class="sc">%&gt;%</span> </span>
<span id="cb577-40"><a href="time-series-in-finance-and-economics.html#cb577-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lag, <span class="at">y =</span> acf)) <span class="sc">+</span></span>
<span id="cb577-41"><a href="time-series-in-finance-and-economics.html#cb577-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb577-42"><a href="time-series-in-finance-and-economics.html#cb577-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">xend =</span> lag, <span class="at">yend =</span> <span class="dv">0</span>)) <span class="sc">+</span> </span>
<span id="cb577-43"><a href="time-series-in-finance-and-economics.html#cb577-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">length</span>(stocks_SMI_ts_ret[,<span class="dv">1</span>]))), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span> </span>
<span id="cb577-44"><a href="time-series-in-finance-and-economics.html#cb577-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">length</span>(stocks_SMI_ts_ret[,<span class="dv">1</span>]))), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span> </span>
<span id="cb577-45"><a href="time-series-in-finance-and-economics.html#cb577-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>( <span class="st">&quot;khaki3&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>, <span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;tomato3&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>)) <span class="sc">+</span></span>
<span id="cb577-46"><a href="time-series-in-finance-and-economics.html#cb577-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;ACF&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Lags&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Correlogram to show the ACF of O3 concentration&quot;</span>) <span class="sc">+</span></span>
<span id="cb577-47"><a href="time-series-in-finance-and-economics.html#cb577-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb577-48"><a href="time-series-in-finance-and-economics.html#cb577-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb577-49"><a href="time-series-in-finance-and-economics.html#cb577-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb577-50"><a href="time-series-in-finance-and-economics.html#cb577-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb577-51"><a href="time-series-in-finance-and-economics.html#cb577-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb577-52"><a href="time-series-in-finance-and-economics.html#cb577-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb577-53"><a href="time-series-in-finance-and-economics.html#cb577-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb577-54"><a href="time-series-in-finance-and-economics.html#cb577-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb577-55"><a href="time-series-in-finance-and-economics.html#cb577-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb577-56"><a href="time-series-in-finance-and-economics.html#cb577-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb577-57"><a href="time-series-in-finance-and-economics.html#cb577-57" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb577-58"><a href="time-series-in-finance-and-economics.html#cb577-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<pre><code>## Scale for &#39;colour&#39; is already present. Adding another scale for &#39;colour&#39;, which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="time-series-in-finance-and-economics.html#cb579-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> q <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-392-1.png" width="672" /></p>
<p>The time plot suggests the residual series is stationary, while the autocorrelation function (correlogram) suggests an MA(3) process is appropriate. Consequently, let’s use this process now on the residuals.</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="time-series-in-finance-and-economics.html#cb580-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the Arima model with MA(3)</span></span>
<span id="cb580-2"><a href="time-series-in-finance-and-economics.html#cb580-2" aria-hidden="true" tabindex="-1"></a>ma_3 <span class="ot">&lt;-</span> <span class="fu">arima</span>(res_lm, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">3</span>))</span>
<span id="cb580-3"><a href="time-series-in-finance-and-economics.html#cb580-3" aria-hidden="true" tabindex="-1"></a>ma_3</span></code></pre></div>
<pre><code>## 
## Call:
## arima(x = res_lm, order = c(0, 0, 3))
## 
## Coefficients:
##          ma1     ma2     ma3  intercept
##       0.6632  0.2467  0.0261     0.0352
## s.e.  0.0643  0.0748  0.0598     1.5138
## 
## sigma^2 estimated as 149.3:  log likelihood = -953.28,  aic = 1916.56</code></pre>
<p>Finally, we should plot the residuals again to ensure they are normal</p>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb582-1"><a href="time-series-in-finance-and-economics.html#cb582-1" aria-hidden="true" tabindex="-1"></a>res_lm <span class="ot">&lt;-</span>ma_3<span class="sc">$</span>residuals</span>
<span id="cb582-2"><a href="time-series-in-finance-and-economics.html#cb582-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we effectively eliminated the quadratic trend. </span></span>
<span id="cb582-3"><a href="time-series-in-finance-and-economics.html#cb582-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb582-4"><a href="time-series-in-finance-and-economics.html#cb582-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s create the plots again</span></span>
<span id="cb582-5"><a href="time-series-in-finance-and-economics.html#cb582-5" aria-hidden="true" tabindex="-1"></a>res_acf <span class="ot">&lt;-</span> res_lm <span class="sc">%&gt;%</span> <span class="fu">acf</span>(<span class="at">na.action =</span> na.pass, <span class="at">plot =</span> <span class="cn">FALSE</span>) </span>
<span id="cb582-6"><a href="time-series-in-finance-and-economics.html#cb582-6" aria-hidden="true" tabindex="-1"></a>res_bacf <span class="ot">&lt;-</span> <span class="fu">with</span>(res_acf, <span class="fu">data.frame</span>(lag, acf))</span>
<span id="cb582-7"><a href="time-series-in-finance-and-economics.html#cb582-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb582-8"><a href="time-series-in-finance-and-economics.html#cb582-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the dataframe for later merging</span></span>
<span id="cb582-9"><a href="time-series-in-finance-and-economics.html#cb582-9" aria-hidden="true" tabindex="-1"></a>res_lm_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(res_lm, <span class="fu">as.Date</span>(O3_conc<span class="sc">$</span>Datum)))</span>
<span id="cb582-10"><a href="time-series-in-finance-and-economics.html#cb582-10" aria-hidden="true" tabindex="-1"></a>res_lm_df <span class="ot">&lt;-</span> res_lm_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Datum =</span> <span class="fu">as.Date</span>(<span class="fu">as.Date</span>(O3_conc<span class="sc">$</span>Datum)))</span>
<span id="cb582-11"><a href="time-series-in-finance-and-economics.html#cb582-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb582-12"><a href="time-series-in-finance-and-economics.html#cb582-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot both</span></span>
<span id="cb582-13"><a href="time-series-in-finance-and-economics.html#cb582-13" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> res_lm_df <span class="sc">%&gt;%</span></span>
<span id="cb582-14"><a href="time-series-in-finance-and-economics.html#cb582-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Datum, <span class="at">y =</span> res_lm)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;dodgerblue4&quot;</span>) <span class="sc">+</span> </span>
<span id="cb582-15"><a href="time-series-in-finance-and-economics.html#cb582-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Residuals&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> </span>
<span id="cb582-16"><a href="time-series-in-finance-and-economics.html#cb582-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Residuals of the MA(3) process&quot;</span>) <span class="sc">+</span></span>
<span id="cb582-17"><a href="time-series-in-finance-and-economics.html#cb582-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb582-18"><a href="time-series-in-finance-and-economics.html#cb582-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb582-19"><a href="time-series-in-finance-and-economics.html#cb582-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb582-20"><a href="time-series-in-finance-and-economics.html#cb582-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb582-21"><a href="time-series-in-finance-and-economics.html#cb582-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb582-22"><a href="time-series-in-finance-and-economics.html#cb582-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb582-23"><a href="time-series-in-finance-and-economics.html#cb582-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb582-24"><a href="time-series-in-finance-and-economics.html#cb582-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb582-25"><a href="time-series-in-finance-and-economics.html#cb582-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb582-26"><a href="time-series-in-finance-and-economics.html#cb582-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb582-27"><a href="time-series-in-finance-and-economics.html#cb582-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span>
<span id="cb582-28"><a href="time-series-in-finance-and-economics.html#cb582-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb582-29"><a href="time-series-in-finance-and-economics.html#cb582-29" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> res_bacf <span class="sc">%&gt;%</span> </span>
<span id="cb582-30"><a href="time-series-in-finance-and-economics.html#cb582-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lag, <span class="at">y =</span> acf)) <span class="sc">+</span></span>
<span id="cb582-31"><a href="time-series-in-finance-and-economics.html#cb582-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb582-32"><a href="time-series-in-finance-and-economics.html#cb582-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">xend =</span> lag, <span class="at">yend =</span> <span class="dv">0</span>)) <span class="sc">+</span> </span>
<span id="cb582-33"><a href="time-series-in-finance-and-economics.html#cb582-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">length</span>(stocks_SMI_ts_ret[,<span class="dv">1</span>]))), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span> </span>
<span id="cb582-34"><a href="time-series-in-finance-and-economics.html#cb582-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">length</span>(stocks_SMI_ts_ret[,<span class="dv">1</span>]))), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span> </span>
<span id="cb582-35"><a href="time-series-in-finance-and-economics.html#cb582-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>( <span class="st">&quot;khaki3&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>, <span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;tomato3&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>)) <span class="sc">+</span></span>
<span id="cb582-36"><a href="time-series-in-finance-and-economics.html#cb582-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;ACF&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Lags&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Correlogram to show the ACF of O3 concentration&quot;</span>) <span class="sc">+</span></span>
<span id="cb582-37"><a href="time-series-in-finance-and-economics.html#cb582-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb582-38"><a href="time-series-in-finance-and-economics.html#cb582-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb582-39"><a href="time-series-in-finance-and-economics.html#cb582-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb582-40"><a href="time-series-in-finance-and-economics.html#cb582-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb582-41"><a href="time-series-in-finance-and-economics.html#cb582-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb582-42"><a href="time-series-in-finance-and-economics.html#cb582-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb582-43"><a href="time-series-in-finance-and-economics.html#cb582-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb582-44"><a href="time-series-in-finance-and-economics.html#cb582-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb582-45"><a href="time-series-in-finance-and-economics.html#cb582-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb582-46"><a href="time-series-in-finance-and-economics.html#cb582-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb582-47"><a href="time-series-in-finance-and-economics.html#cb582-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb582-48"><a href="time-series-in-finance-and-economics.html#cb582-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<pre><code>## Scale for &#39;colour&#39; is already present. Adding another scale for &#39;colour&#39;, which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="time-series-in-finance-and-economics.html#cb584-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> q <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-394-1.png" width="672" /></p>
<p>The residuals appear to be independent, so the following model should work:</p>
<p><span class="math display">\[
X_t = \beta_0 + \beta_1t +\beta_2t^2 + Z_t + \lambda_1Z_{t-1} + \lambda_2Z_{t-2}+ \lambda_3Z_{t-3}
\]</span></p>
</div>
</div>
<div id="ra-processes" class="section level3" number="9.5.2">
<h3><span class="header-section-number">9.5.2</span> RA Processes</h3>
<p>Now, let’s consider the second basic time series process, called autoregressive processes.</p>
<p>Let <span class="math inline">\(Z_t\)</span> be a purely random process (again in the form of residuals) with again mean 0 and variance of <span class="math inline">\(\sigma_z^2\)</span>. An <strong>autoregressive process</strong> of order p, denoted as <strong>AR(p)</strong>, is given by:</p>
<p><span class="math display">\[
X_t = \alpha_1X_{t-1} + \dots + \alpha_pX_{t-p} + Z_t
\]</span></p>
<p>where we assume that <span class="math inline">\(X_0 = X_{-1} = \dots = X_{1-p} = 0\)</span>.</p>
<p>It can be written in the following alternative form:</p>
<p><span class="math display">\[
\begin{align}
X_t &amp;= \alpha_1X_{t-1} + \dots + \alpha_pX_{t-p} + Z_t\\
X_t - \alpha_1X_{t-1} + \dots + \alpha_pX_{t-p} &amp;= Z_t\\
(1 - \alpha_1B - \alpha_2B^2 - \dots - \alpha_pB^p)X_t &amp;= Z_t \\
\phi(B)X_t &amp;= Z_t
\end{align}
\]</span></p>
<p>where B is again the backshift operator. The form of <span class="math inline">\(\phi(B)\)</span> is again called the <strong>characteristic polynomial</strong>.</p>
<p>In this model correlation is introduced between the random variables by regressing <span class="math inline">\(X_t\)</span> on past values <span class="math inline">\(X_{t-1}, \dots, X_{t-p}\)</span>. The <span class="math inline">\(\alpha\)</span> values are coefficients of the autoregressive process, where <span class="math inline">\(\alpha_i\)</span> is the <strong>lag i coefficient</strong>.</p>
<p>Since we essentially regress X on its past values, we label the model as <strong>autoregressive</strong>. The rest of this chapter describes the properties of autoregressive processes, discusses how to choose the order p when modelling real data, and describes estimation of the coefficients.</p>
<div id="mean-and-variance-moments-1" class="section level4" number="9.5.2.1">
<h4><span class="header-section-number">9.5.2.1</span> Mean and Variance Moments</h4>
<p></p>
<p>The AR(p) process can be written as an infinite sum of a purely random process. That is:</p>
<p><span class="math display">\[
X_t = \alpha_1X_{t-1} + \dots + \alpha_pX_{t-p} + Z_t = \sum_{j=0}^\infty \beta_jZ_{t - j}
\]</span></p>
<p>This condition is known as <strong>invertibility</strong>. Although we won’t cover the theroetical fundaments for this idea in detail, it implies that you can <strong>change an AR(p) process into the sum of a purely random process</strong>. The mean can be calculated by using the theorem as follows.</p>
<p><span class="math display">\[
\begin{align}
E[X_t] &amp;= E[\sum_{j=0}^\infty \beta_jZ_{t-j}] \\
&amp;= \sum_{j=0}^\infty \beta_jE[Z_{t-j}] \\
&amp;= 0 
\end{align}
\]</span></p>
<p>Thus, any AR(p) process has mean 0.</p>
<p></p>
<p>As opposed to the moving average processes, the variance and autocorrelation function are calculated conditional on the process being stationary due to the computational complexity of calculating the moments by determining the <span class="math inline">\(\beta_j\)</span>. The following theorem tells us when an AR(p) process is stationary.</p>
<p>We again write the AR(p) process as <span class="math inline">\(\phi(B)X_t = Z_t\)</span>.</p>
<p>Then the process is stationary if the <strong>roots of the characteristic equation</strong>:</p>
<p><span class="math display">\[
\phi(B) = 1 - \alpha_1B - \alpha_2B^2 - \dots - \alpha_pB^p = 0
\]</span></p>
<p>have <strong>modulus greater than 1</strong>, i.e. they lie outside the unit circle. Here we consider B as the variable of the polynomial equation. Without going into proving the theorem, let’s look at the root base condition for both an AR(1) as well as an AR(2) process.</p>
<p></p>
<p>Let’s look at the AR(1) process: <span class="math inline">\(X_t = \alpha X_{t-1} + Z_t\)</span>. The characteristic polynomial is given by <span class="math inline">\(\phi(B) = 1 - \alpha B\)</span>. It has a single root, namely <span class="math inline">\(\frac{1}{\alpha}\)</span>. Consequently, the process is <strong>stationary if <span class="math inline">\(1/\alpha\)</span> is greater than 1, or if <span class="math inline">\(|\alpha|\)</span> is less than 1</strong>.</p>
<p></p>
<p>Consider the AR(2) process: <span class="math inline">\(X_t = 0.75X_{t-1} - 0.125X_{t-2} + Z_t\)</span>. The characteristics polynomial is <span class="math inline">\((1- 0.75B - 0.125B^2)X_t = 0\)</span>. We can find the roots of the quadratic equation using the <strong>Mittenachtformula</strong>, given by:</p>
<p><span class="math display">\[
MNF = \frac{-b \pm \sqrt{b^2 - 4ax}}{2a}
\]</span></p>
<p>In our case, this would be: <span class="math inline">\(\frac{0.75 \pm \sqrt{0.75^2 + 4*0.25*1}}{2*1} = {2, 4}\)</span>. Therefore as both roots have modulus greater than one the process is stationary.</p>
<p></p>
<p>Based on this property, let’s define the variance for AR(p) processes. Assuming the process is stationary, we calculate its variance as follows.</p>
<p><span class="math display">\[
\begin{align}
X_t &amp;= \alpha_1X_{t-1} + \dots + \alpha_pX_{t-p} + Z_t \\
X_t^2 &amp;= \alpha_1X_tX_{t-1} + \dots + \alpha_pX_tX_{t-p} + X_tZ_t \\ 
\\ 
E[X_t^2] &amp;= E[\alpha_1X_tX_{t-1} + \dots + \alpha_pX_tX_{t-p} + X_tZ_t] \\
&amp;= E[\alpha_1X_tX_{t-1}] + \dots + E[\alpha_pX_tX_{t-p}] + E[X_tZ_t] \\
&amp;= E[\alpha_1X_tX_{t-1}] + \dots + E[\alpha_pX_tX_{t-p}] + E[{\alpha_1X_{t-1} + \dots + \alpha_pX_{t-p} + Z_t}Z_t] \\ 
&amp;= E[\alpha_1X_tX_{t-1}] + \dots + E[\alpha_pX_tX_{t-p}] + E[{\alpha_1X_{t-1} + \dots + \alpha_pX_{t-p}}Z_t] + E[Z_t^2] \\
&amp;= E[\alpha_1X_tX_{t-1}] + \dots + E[\alpha_pX_tX_{t-p}] + E[\alpha_1X_{t-1} + \dots + \alpha_pX_{t-p}]E[Z_t] + Var[Z_t] + E[Z_t]^2 &amp;&amp; E[Z_t] = 0\\
&amp;= E[\alpha_1X_tX_{t-1}] + \dots + E[\alpha_pX_tX_{t-p}] + \sigma_z^2
\end{align}
\]</span></p>
<p>As <span class="math inline">\(E[X_t] = 0\)</span>, we get that:</p>
<p><span class="math display">\[
\begin{align}
Var[X_t] &amp;= E[X_t^2] - E[X_t]^2 = E[X_t^2]\\
\gamma_\tau &amp;= Cov(X_t,X_{t-\tau}) = E[X_tX_{t-\tau}] - E[X_t]E[X_{t-\tau}] = E[X_tX_{t-\tau}]
\end{align}
\]</span></p>
<p>Note that the variance was reduced to the term we just saw above and the covariance term can be defined as only <span class="math inline">\(E[X_t,X_{t+\tau}\)</span>, which is one of the parts of the second part of the remaining variance function. Thus, we get:</p>
<p><span class="math display">\[
\begin{align}
Var[X_t] &amp;= \sigma_z^2 + \sum_{\tau = 1}^p \alpha_\tau E[X_t,X_{t-\tau}] \\
&amp;= \sigma_z^2 + \sum_{\tau = 1}^p \alpha_\tau \gamma_\tau
\end{align}
\]</span></p>
<p>and depends on the <strong>autocovariance functions at lags 1 to p</strong>.</p>
</div>
<div id="autocorrelation-function" class="section level4" number="9.5.2.2">
<h4><span class="header-section-number">9.5.2.2</span> Autocorrelation function</h4>
<p>The autocovariance and autocorrelation functions can be calculated in the same way as the variance. That is:</p>
<p><span class="math display">\[
\begin{align}
X_t &amp;= \alpha_1X_{t-1} + \dots + \alpha_pX_{t-p} + Z_t \\
X_tX_{t-\tau} &amp;= \alpha_1X_{t-\tau}X_{t-1} + \dots + \alpha_pX_{t-\tau}X_{t-p} + X_{t-\tau}Z_t \\
E[X_tX_{t-\tau}] &amp;= E[\alpha_1X_{t-\tau}X_{t-1} + \dots + \alpha_pX_{t-\tau}X_{t-p} + X_{t-\tau}Z_t] \\
&amp;= \alpha_1E[X_{t-\tau}X_{t-1}] + \dots + \alpha_pE[X_{t-\tau}X_{t-p}]
\end{align}
\]</span></p>
<p>Since <span class="math inline">\(E[X_tX_{t-\tau}] = \gamma_\tau\)</span>, the autocovariance function is given by the recursive equation:</p>
<p><span class="math display">\[
\gamma_\tau = \alpha_1\gamma_{\tau - 1} + \dots + \alpha_p\gamma_{\tau - p}
\]</span></p>
<p>Dividing by the variance gives the autocorrelation function as:</p>
<p><span class="math display">\[
\rho_\tau = \alpha_1\rho_{\tau - 1} + \dots + \alpha_p\rho_{\tau - p}
\]</span></p>
<p>This equation is called <strong>Yule-Walker</strong> equation.</p>
<p>Importantly, we can re-write these equations in matrix form:</p>
$$
<span class="math display">\[\begin{bmatrix}
1 &amp; \rho_1 &amp; \dots &amp; \rho_{p - 1} \\
\rho_1 &amp; 1 &amp; \dots &amp; \rho_{p - 2} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
\rho_{p - 1} &amp; \rho_{p - 2} &amp; \dots &amp; 1
\end{bmatrix}\]</span>
<span class="math display">\[\begin{bmatrix}
\alpha_1 \\ \alpha_2 \\ \vdots \\ \alpha_p
\end{bmatrix}\]</span>
<p>=</p>
<span class="math display">\[\begin{bmatrix}
\rho_1 \\ \rho_2 \\ \vdots \\ \rho_p
\end{bmatrix}\]</span>
<p>$$
The Yule-Walker equations can be used repeatedly to calculate the autocorrelation function for any AR(p) process.</p>
<p>For instance, consider the AR(2) process: <span class="math inline">\(X_t = \alpha_1X_{t-1} + \alpha_2X_{t-2} + Z_t\)</span>. The Y-W with <span class="math inline">\(\tau = 1\)</span> would then give us <span class="math inline">\(\rho_1 =\alpha_+\rho_0 + \alpha_2\rho_{-1}\)</span>. As <span class="math inline">\(\rho_0 = 1\)</span> and <span class="math inline">\(\rho_{-1} = \rho_1\)</span>, this would then provide us with:</p>
<p><span class="math display">\[
\rho_1 = \frac{\alpha_1}{1 - \alpha_2}
\]</span></p>
<p>Further, using <span class="math inline">\(\tau = 2\)</span>, we get that <span class="math inline">\(\rho_2 =\alpha_1\rho_{-1} + \alpha_2\rho_0\)</span>, which would give us:</p>
<p><span class="math display">\[
\rho_2 = \alpha_2 + \alpha\rho_1 = \alpha_2 + \alpha_1\frac{\alpha_1}{1 - \alpha_2}
\]</span></p>
</div>
<div id="ra-model-identification" class="section level4" number="9.5.2.3">
<h4><span class="header-section-number">9.5.2.3</span> RA Model identification</h4>
<p>Given a stationary, trend and seasonality removed, time series, we may now be inclined to understand how we can define whether an RA process is valid to model the underlying structure. In essence, we need to understand:</p>
<ul>
<li>Whether an RA process is appropriate</li>
<li>Which order the RA process (p) should have</li>
</ul>
<p>As opposed to the case with moving averages, we cannot use the correlaogram to depict the use of an RA(p) process model. In order to define the validity of an RA(p) process, we need to use something called <strong>partial autocorrelation function (PACF)</strong> The PACF at lag <span class="math inline">\(\tau\)</span> is equal to the estimated lag <span class="math inline">\(\tau\)</span> coefficient <span class="math inline">\(\hat\alpha_\tau\)</span> obtained when fitting an AR(<span class="math inline">\(\tau\)</span>) model to a data set. It is denoted by <span class="math inline">\(\pi\tau\)</span> and represents the excess correlation in the time series that has not been accounted for by the <span class="math inline">\(\tau - 1\)</span> smaller lags. To give an example:</p>
<ul>
<li>Fit the AR(1) model: <span class="math inline">\(X_t = \alpha_1X_{t-1} + Z_t\)</span> to the time series, we get that <span class="math inline">\(\hat\alpha_1 = \pi_1\)</span></li>
<li>Fit the AR(3) model: <span class="math inline">\(X_t = \alpha_1X_{t-1} + \alpha_2X_{t-2} + \alpha_3X_{t-3} + Z_t\)</span>, we get that <span class="math inline">\(\hat\alpha_3 = \pi_3\)</span></li>
</ul>
<p>which is the excess correlation that has not been accounted for by <span class="math inline">\(\pi_1\)</span> and <span class="math inline">\(\pi_2\)</span>.</p>
<p>In essence, we can obtain the same statistical properties of the distribution of PACF as for the ACF. That is, an AR(p) process for any lag <span class="math inline">\(\tau &gt; p\)</span> is given as:</p>
<p><span class="math display">\[
\pi_\tau \sim N(o, \frac{1}{n})
\]</span></p>
<p>which gives an approximate 95% CI for <span class="math inline">\(\pi_\tau\)</span> within <span class="math inline">\(\pm 1.96/\sqrt{n}\)</span> when the true value is <span class="math inline">\(\pi_\tau = 0\)</span>. Therefore to choose the order of an AR(p) process, <strong>plot the partial autocorrelation function and choose p as the smallest value that is significantly different from zero</strong>.</p>
<p>In essence, the
- autocorrelation function (ACF) tells us whether an MA(q) process is appropriate
- partial autocorrelation function (PACF) suggests whether an AR(p) process is appropriate.</p>
<p>Therefore for a given time series, both should be plotted to show which process would be a good model.</p>
</div>
<div id="ar-parameter-estimation" class="section level4" number="9.5.2.4">
<h4><span class="header-section-number">9.5.2.4</span> AR parameter estimation</h4>
<p>Let’s quickly show to approaches how computers estimate the parameters in AR processes. For that, we consider the AR(p) process as:</p>
<p><span class="math display">\[
X_t - \mu = \alpha_1(X_{t-1} - \mu) + \dots + \alpha_p(X_{t-p} - \mu) + Z_t
\]</span></p>
<p>The parameter estimation requires us to estimate <span class="math inline">\(\alpha_i\)</span> and <span class="math inline">\(\sigma_z^2\)</span></p>
<p></p>
<p>Recall the Y-W estimation</p>
<p><span class="math display">\[
\rho_\tau = \alpha_1\rho_{\tau - 1} + \dots + \alpha_p\rho_{\tau - p}
\]</span>
or:</p>
$$
<span class="math display">\[\begin{bmatrix}
1 &amp; \rho_1 &amp; \dots &amp; \rho_{p - 1} \\
\rho_1 &amp; 1 &amp; \dots &amp; \rho_{p - 2} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
\rho_{p - 1} &amp; \rho_{p - 2} &amp; \dots &amp; 1
\end{bmatrix}\]</span>
<span class="math display">\[\begin{bmatrix}
\alpha_1 \\ \alpha_2 \\ \vdots \\ \alpha_p
\end{bmatrix}\]</span>
<p>=</p>
<span class="math display">\[\begin{bmatrix}
\rho_1 \\ \rho_2 \\ \vdots \\ \rho_p
\end{bmatrix}\]</span>
<p>$$</p>
<p>To estimate the parameters we replace the theoretical autocorrelation function by its sample estimates, <span class="math inline">\(\hat\rho_\tau\)</span>. Then, we can use the above matrix equation to estimate the <span class="math inline">\(\alpha\)</span> as:</p>
<p><span class="math display">\[
\hat\alpha =\hat R_p^{-1} \hat\rho_p
\]</span>
To retrieve the estimated variance, we simply replace the theoretical quantities by their sample estimates. This gives:</p>
<p><span class="math display">\[
\hat\sigma_z^2 = \hat\sigma^2 - \sum_{\tau = 1}^p \hat\alpha_\tau\hat\gamma_\tau
\]</span></p>
<p>which is nothing else than the theoretical variance of the time series subtracted from the autocovariance estimates.</p>
<p></p>
<p>The second effect is OLS in which we minimise again the SSR.</p>
</div>
</div>
<div id="using-an-rap-process" class="section level3" number="9.5.3">
<h3><span class="header-section-number">9.5.3</span> Using an RA(p) process</h3>
<p>Since we now covered the RA(p) theory fundamentals, let’s see how we can apply the model to actual data. Doing so, we will consider the entire approach. That is, we first attempt to remove trends and seasonality and, in a subsequent step, then use an RA(p) process to fit the residuals.</p>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb585-1"><a href="time-series-in-finance-and-economics.html#cb585-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Based on this, we now need to create the same tsibble datasets as before</span></span>
<span id="cb585-2"><a href="time-series-in-finance-and-economics.html#cb585-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb585-3"><a href="time-series-in-finance-and-economics.html#cb585-3" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">200</span></span>
<span id="cb585-4"><a href="time-series-in-finance-and-economics.html#cb585-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">243</span></span>
<span id="cb585-5"><a href="time-series-in-finance-and-economics.html#cb585-5" aria-hidden="true" tabindex="-1"></a>sd <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb585-6"><a href="time-series-in-finance-and-economics.html#cb585-6" aria-hidden="true" tabindex="-1"></a>data.ar <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="at">model =</span> <span class="fu">list</span>(<span class="at">ar =</span> <span class="fu">c</span>(<span class="fl">0.6</span>, <span class="fl">0.3</span>)), <span class="at">n =</span> n, <span class="at">sd =</span> sd)</span>
<span id="cb585-7"><a href="time-series-in-finance-and-economics.html#cb585-7" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data.ar <span class="sc">+</span> <span class="dv">30</span> <span class="sc">+</span> <span class="fl">0.05</span> <span class="sc">*</span> time</span></code></pre></div>
<pre><code>## Warning in `+.default`(data.ar + 30, 0.05 * time): longer object length is not a multiple of shorter object length</code></pre>
<div class="sourceCode" id="cb587"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb587-1"><a href="time-series-in-finance-and-economics.html#cb587-1" aria-hidden="true" tabindex="-1"></a>Dates <span class="ot">&lt;-</span> air_ZH_merged_ts <span class="sc">%&gt;%</span></span>
<span id="cb587-2"><a href="time-series-in-finance-and-economics.html#cb587-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Standort <span class="sc">==</span> <span class="st">&quot;Zch_Stampfenbachstrasse&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb587-3"><a href="time-series-in-finance-and-economics.html#cb587-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from=</span>Wert, <span class="at">names_from=</span>Parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb587-4"><a href="time-series-in-finance-and-economics.html#cb587-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Datum) </span>
<span id="cb587-5"><a href="time-series-in-finance-and-economics.html#cb587-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb587-6"><a href="time-series-in-finance-and-economics.html#cb587-6" aria-hidden="true" tabindex="-1"></a>data_ts <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(Dates<span class="sc">$</span>Datum, data))</span>
<span id="cb587-7"><a href="time-series-in-finance-and-economics.html#cb587-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb587-8"><a href="time-series-in-finance-and-economics.html#cb587-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb587-9"><a href="time-series-in-finance-and-economics.html#cb587-9" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> data_ts <span class="sc">%&gt;%</span></span>
<span id="cb587-10"><a href="time-series-in-finance-and-economics.html#cb587-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.Date</span>(Dates<span class="sc">$</span>Datum), <span class="at">y =</span> data)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;dodgerblue4&quot;</span>) <span class="sc">+</span> </span>
<span id="cb587-11"><a href="time-series-in-finance-and-economics.html#cb587-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;µg/m3&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> </span>
<span id="cb587-12"><a href="time-series-in-finance-and-economics.html#cb587-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Concentration of CO at Zürich Stampfenbachstrasse&quot;</span>) <span class="sc">+</span></span>
<span id="cb587-13"><a href="time-series-in-finance-and-economics.html#cb587-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb587-14"><a href="time-series-in-finance-and-economics.html#cb587-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb587-15"><a href="time-series-in-finance-and-economics.html#cb587-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb587-16"><a href="time-series-in-finance-and-economics.html#cb587-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb587-17"><a href="time-series-in-finance-and-economics.html#cb587-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb587-18"><a href="time-series-in-finance-and-economics.html#cb587-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb587-19"><a href="time-series-in-finance-and-economics.html#cb587-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb587-20"><a href="time-series-in-finance-and-economics.html#cb587-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb587-21"><a href="time-series-in-finance-and-economics.html#cb587-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb587-22"><a href="time-series-in-finance-and-economics.html#cb587-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb587-23"><a href="time-series-in-finance-and-economics.html#cb587-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span>
<span id="cb587-24"><a href="time-series-in-finance-and-economics.html#cb587-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb587-25"><a href="time-series-in-finance-and-economics.html#cb587-25" aria-hidden="true" tabindex="-1"></a>data_ts_acf <span class="ot">&lt;-</span> data_ts <span class="sc">%&gt;%</span> <span class="fu">select</span>(data) <span class="sc">%&gt;%</span> <span class="fu">acf</span>(<span class="at">na.action =</span> na.pass, <span class="at">plot =</span> <span class="cn">FALSE</span>) </span>
<span id="cb587-26"><a href="time-series-in-finance-and-economics.html#cb587-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb587-27"><a href="time-series-in-finance-and-economics.html#cb587-27" aria-hidden="true" tabindex="-1"></a>data_ts_acf_df <span class="ot">&lt;-</span> <span class="fu">with</span>(data_ts_acf, <span class="fu">data.frame</span>(lag, acf))</span>
<span id="cb587-28"><a href="time-series-in-finance-and-economics.html#cb587-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb587-29"><a href="time-series-in-finance-and-economics.html#cb587-29" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> data_ts_acf_df <span class="sc">%&gt;%</span> </span>
<span id="cb587-30"><a href="time-series-in-finance-and-economics.html#cb587-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lag, <span class="at">y =</span> acf)) <span class="sc">+</span></span>
<span id="cb587-31"><a href="time-series-in-finance-and-economics.html#cb587-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb587-32"><a href="time-series-in-finance-and-economics.html#cb587-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">xend =</span> lag, <span class="at">yend =</span> <span class="dv">0</span>)) <span class="sc">+</span> </span>
<span id="cb587-33"><a href="time-series-in-finance-and-economics.html#cb587-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">length</span>(stocks_SMI_ts_ret[,<span class="dv">1</span>]))), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span> </span>
<span id="cb587-34"><a href="time-series-in-finance-and-economics.html#cb587-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">length</span>(stocks_SMI_ts_ret[,<span class="dv">1</span>]))), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span> </span>
<span id="cb587-35"><a href="time-series-in-finance-and-economics.html#cb587-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>( <span class="st">&quot;khaki3&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>, <span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;tomato3&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>)) <span class="sc">+</span></span>
<span id="cb587-36"><a href="time-series-in-finance-and-economics.html#cb587-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;ACF&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Lags&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Correlogram to show the ACF of CO concentration&quot;</span>) <span class="sc">+</span></span>
<span id="cb587-37"><a href="time-series-in-finance-and-economics.html#cb587-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb587-38"><a href="time-series-in-finance-and-economics.html#cb587-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb587-39"><a href="time-series-in-finance-and-economics.html#cb587-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb587-40"><a href="time-series-in-finance-and-economics.html#cb587-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb587-41"><a href="time-series-in-finance-and-economics.html#cb587-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb587-42"><a href="time-series-in-finance-and-economics.html#cb587-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb587-43"><a href="time-series-in-finance-and-economics.html#cb587-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb587-44"><a href="time-series-in-finance-and-economics.html#cb587-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb587-45"><a href="time-series-in-finance-and-economics.html#cb587-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb587-46"><a href="time-series-in-finance-and-economics.html#cb587-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb587-47"><a href="time-series-in-finance-and-economics.html#cb587-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb587-48"><a href="time-series-in-finance-and-economics.html#cb587-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<pre><code>## Scale for &#39;colour&#39; is already present. Adding another scale for &#39;colour&#39;, which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb589"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb589-1"><a href="time-series-in-finance-and-economics.html#cb589-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> q <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-395-1.png" width="672" /></p>
<p>As we can see, the CO concentration has probably a time trend, which we need to remove first.</p>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb590-1"><a href="time-series-in-finance-and-economics.html#cb590-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, we only want the O3 concentration here</span></span>
<span id="cb590-2"><a href="time-series-in-finance-and-economics.html#cb590-2" aria-hidden="true" tabindex="-1"></a>O3_conc <span class="ot">&lt;-</span> data_ts <span class="sc">%&gt;%</span></span>
<span id="cb590-3"><a href="time-series-in-finance-and-economics.html#cb590-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Datum_new =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">243</span>)</span>
<span id="cb590-4"><a href="time-series-in-finance-and-economics.html#cb590-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb590-5"><a href="time-series-in-finance-and-economics.html#cb590-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we regress a quadratic model and obtain the residuals</span></span>
<span id="cb590-6"><a href="time-series-in-finance-and-economics.html#cb590-6" aria-hidden="true" tabindex="-1"></a>lin_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(data <span class="sc">~</span> Datum_new, <span class="at">data =</span> O3_conc)</span>
<span id="cb590-7"><a href="time-series-in-finance-and-economics.html#cb590-7" aria-hidden="true" tabindex="-1"></a>res_lm <span class="ot">&lt;-</span> O3_conc<span class="sc">$</span>data <span class="sc">-</span> lin_mod<span class="sc">$</span>fitted.values</span>
<span id="cb590-8"><a href="time-series-in-finance-and-economics.html#cb590-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb590-9"><a href="time-series-in-finance-and-economics.html#cb590-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we effectively eliminated the quadratic trend. </span></span>
<span id="cb590-10"><a href="time-series-in-finance-and-economics.html#cb590-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb590-11"><a href="time-series-in-finance-and-economics.html#cb590-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s create the plots again</span></span>
<span id="cb590-12"><a href="time-series-in-finance-and-economics.html#cb590-12" aria-hidden="true" tabindex="-1"></a>res_acf <span class="ot">&lt;-</span> res_lm <span class="sc">%&gt;%</span> <span class="fu">acf</span>(<span class="at">na.action =</span> na.pass, <span class="at">plot =</span> <span class="cn">FALSE</span>) </span>
<span id="cb590-13"><a href="time-series-in-finance-and-economics.html#cb590-13" aria-hidden="true" tabindex="-1"></a>res_bacf <span class="ot">&lt;-</span> <span class="fu">with</span>(res_acf, <span class="fu">data.frame</span>(lag, acf))</span>
<span id="cb590-14"><a href="time-series-in-finance-and-economics.html#cb590-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb590-15"><a href="time-series-in-finance-and-economics.html#cb590-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the dataframe for later merging</span></span>
<span id="cb590-16"><a href="time-series-in-finance-and-economics.html#cb590-16" aria-hidden="true" tabindex="-1"></a>res_lm_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(res_lm, <span class="fu">as.Date</span>(O3_conc<span class="sc">$</span>Datum)))</span>
<span id="cb590-17"><a href="time-series-in-finance-and-economics.html#cb590-17" aria-hidden="true" tabindex="-1"></a>res_lm_df <span class="ot">&lt;-</span> res_lm_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Datum =</span> <span class="fu">as.Date</span>(V2))</span>
<span id="cb590-18"><a href="time-series-in-finance-and-economics.html#cb590-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb590-19"><a href="time-series-in-finance-and-economics.html#cb590-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the time series</span></span>
<span id="cb590-20"><a href="time-series-in-finance-and-economics.html#cb590-20" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> res_lm_df <span class="sc">%&gt;%</span></span>
<span id="cb590-21"><a href="time-series-in-finance-and-economics.html#cb590-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Datum, <span class="at">y =</span> res_lm)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;dodgerblue4&quot;</span>) <span class="sc">+</span> </span>
<span id="cb590-22"><a href="time-series-in-finance-and-economics.html#cb590-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Residuals&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> </span>
<span id="cb590-23"><a href="time-series-in-finance-and-economics.html#cb590-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Residuals of CO at Zürich Stampfenbachstrasse&quot;</span>) <span class="sc">+</span></span>
<span id="cb590-24"><a href="time-series-in-finance-and-economics.html#cb590-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb590-25"><a href="time-series-in-finance-and-economics.html#cb590-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb590-26"><a href="time-series-in-finance-and-economics.html#cb590-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb590-27"><a href="time-series-in-finance-and-economics.html#cb590-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb590-28"><a href="time-series-in-finance-and-economics.html#cb590-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb590-29"><a href="time-series-in-finance-and-economics.html#cb590-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb590-30"><a href="time-series-in-finance-and-economics.html#cb590-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb590-31"><a href="time-series-in-finance-and-economics.html#cb590-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb590-32"><a href="time-series-in-finance-and-economics.html#cb590-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb590-33"><a href="time-series-in-finance-and-economics.html#cb590-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb590-34"><a href="time-series-in-finance-and-economics.html#cb590-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span>
<span id="cb590-35"><a href="time-series-in-finance-and-economics.html#cb590-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb590-36"><a href="time-series-in-finance-and-economics.html#cb590-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the ACF </span></span>
<span id="cb590-37"><a href="time-series-in-finance-and-economics.html#cb590-37" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> res_bacf <span class="sc">%&gt;%</span> </span>
<span id="cb590-38"><a href="time-series-in-finance-and-economics.html#cb590-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lag, <span class="at">y =</span> acf)) <span class="sc">+</span></span>
<span id="cb590-39"><a href="time-series-in-finance-and-economics.html#cb590-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb590-40"><a href="time-series-in-finance-and-economics.html#cb590-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">xend =</span> lag, <span class="at">yend =</span> <span class="dv">0</span>)) <span class="sc">+</span> </span>
<span id="cb590-41"><a href="time-series-in-finance-and-economics.html#cb590-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">dim</span>(res_lm_df)[<span class="dv">1</span>])), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span> </span>
<span id="cb590-42"><a href="time-series-in-finance-and-economics.html#cb590-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">dim</span>(res_lm_df)[<span class="dv">1</span>])), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span> </span>
<span id="cb590-43"><a href="time-series-in-finance-and-economics.html#cb590-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>( <span class="st">&quot;khaki3&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>, <span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;tomato3&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>)) <span class="sc">+</span></span>
<span id="cb590-44"><a href="time-series-in-finance-and-economics.html#cb590-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;ACF&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Lags&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Correlogram to show the ACF of CO concentration&quot;</span>) <span class="sc">+</span></span>
<span id="cb590-45"><a href="time-series-in-finance-and-economics.html#cb590-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb590-46"><a href="time-series-in-finance-and-economics.html#cb590-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb590-47"><a href="time-series-in-finance-and-economics.html#cb590-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb590-48"><a href="time-series-in-finance-and-economics.html#cb590-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb590-49"><a href="time-series-in-finance-and-economics.html#cb590-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb590-50"><a href="time-series-in-finance-and-economics.html#cb590-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb590-51"><a href="time-series-in-finance-and-economics.html#cb590-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb590-52"><a href="time-series-in-finance-and-economics.html#cb590-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb590-53"><a href="time-series-in-finance-and-economics.html#cb590-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb590-54"><a href="time-series-in-finance-and-economics.html#cb590-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb590-55"><a href="time-series-in-finance-and-economics.html#cb590-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb590-56"><a href="time-series-in-finance-and-economics.html#cb590-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<pre><code>## Scale for &#39;colour&#39; is already present. Adding another scale for &#39;colour&#39;, which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb592"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb592-1"><a href="time-series-in-finance-and-economics.html#cb592-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the PACF and plot it as well</span></span>
<span id="cb592-2"><a href="time-series-in-finance-and-economics.html#cb592-2" aria-hidden="true" tabindex="-1"></a>pacf <span class="ot">&lt;-</span> <span class="fu">pacf</span>(res_lm)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-396-1.png" width="672" /></p>
<div class="sourceCode" id="cb593"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb593-1"><a href="time-series-in-finance-and-economics.html#cb593-1" aria-hidden="true" tabindex="-1"></a>pacf_values <span class="ot">&lt;-</span> <span class="fu">c</span>(pacf<span class="sc">$</span>acf)</span>
<span id="cb593-2"><a href="time-series-in-finance-and-economics.html#cb593-2" aria-hidden="true" tabindex="-1"></a>res_bpacf <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">23</span>,<span class="dv">1</span>), pacf_values))</span></code></pre></div>
<pre><code>## Warning in base::cbind(...): number of rows of result is not a multiple of vector length (arg 2)</code></pre>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb595-1"><a href="time-series-in-finance-and-economics.html#cb595-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(res_bpacf) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;lag&quot;</span>, <span class="st">&quot;PACF&quot;</span>)</span>
<span id="cb595-2"><a href="time-series-in-finance-and-economics.html#cb595-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb595-3"><a href="time-series-in-finance-and-economics.html#cb595-3" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> res_bpacf <span class="sc">%&gt;%</span> </span>
<span id="cb595-4"><a href="time-series-in-finance-and-economics.html#cb595-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lag, <span class="at">y =</span> PACF)) <span class="sc">+</span></span>
<span id="cb595-5"><a href="time-series-in-finance-and-economics.html#cb595-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb595-6"><a href="time-series-in-finance-and-economics.html#cb595-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">xend =</span> lag, <span class="at">yend =</span> <span class="dv">0</span>)) <span class="sc">+</span> </span>
<span id="cb595-7"><a href="time-series-in-finance-and-economics.html#cb595-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>((<span class="fu">dim</span>(res_lm_df)[<span class="dv">1</span>]))), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span> </span>
<span id="cb595-8"><a href="time-series-in-finance-and-economics.html#cb595-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>((<span class="fu">dim</span>(res_lm_df)[<span class="dv">1</span>]))), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span> </span>
<span id="cb595-9"><a href="time-series-in-finance-and-economics.html#cb595-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>( <span class="st">&quot;khaki3&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>, <span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;tomato3&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb595-10"><a href="time-series-in-finance-and-economics.html#cb595-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;PACF&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Lags&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Correlogram to show the PACF of CO concentration&quot;</span>) <span class="sc">+</span></span>
<span id="cb595-11"><a href="time-series-in-finance-and-economics.html#cb595-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb595-12"><a href="time-series-in-finance-and-economics.html#cb595-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb595-13"><a href="time-series-in-finance-and-economics.html#cb595-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb595-14"><a href="time-series-in-finance-and-economics.html#cb595-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb595-15"><a href="time-series-in-finance-and-economics.html#cb595-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb595-16"><a href="time-series-in-finance-and-economics.html#cb595-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb595-17"><a href="time-series-in-finance-and-economics.html#cb595-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb595-18"><a href="time-series-in-finance-and-economics.html#cb595-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb595-19"><a href="time-series-in-finance-and-economics.html#cb595-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb595-20"><a href="time-series-in-finance-and-economics.html#cb595-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb595-21"><a href="time-series-in-finance-and-economics.html#cb595-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb595-22"><a href="time-series-in-finance-and-economics.html#cb595-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<pre><code>## Scale for &#39;colour&#39; is already present. Adding another scale for &#39;colour&#39;, which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb597-1"><a href="time-series-in-finance-and-economics.html#cb597-1" aria-hidden="true" tabindex="-1"></a>p </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-396-2.png" width="672" /></p>
<div class="sourceCode" id="cb598"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb598-1"><a href="time-series-in-finance-and-economics.html#cb598-1" aria-hidden="true" tabindex="-1"></a>q <span class="sc">+</span> r <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-396-3.png" width="672" /></p>
<p>The time plot suggests the residual series is stationary, while the partial autocorrelation function (correlogram) suggests an AR(2) process is appropriate. Note that the ACF is not really helping us here because it shows no sign when the last lag is still significantly different from zero.</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb599-1"><a href="time-series-in-finance-and-economics.html#cb599-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the Arima model with RA(3)</span></span>
<span id="cb599-2"><a href="time-series-in-finance-and-economics.html#cb599-2" aria-hidden="true" tabindex="-1"></a>ar_2 <span class="ot">&lt;-</span> <span class="fu">arima</span>(res_lm, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb599-3"><a href="time-series-in-finance-and-economics.html#cb599-3" aria-hidden="true" tabindex="-1"></a>ar_2</span></code></pre></div>
<pre><code>## 
## Call:
## arima(x = res_lm, order = c(2, 0, 0))
## 
## Coefficients:
##          ar1     ar2  intercept
##       0.6116  0.3382    -0.4395
## s.e.  0.0602  0.0605     1.3043
## 
## sigma^2 estimated as 1.237:  log likelihood = -371.78,  aic = 751.55</code></pre>
<p>Finally, we should plot the residuals again to ensure they are normal</p>
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb601-1"><a href="time-series-in-finance-and-economics.html#cb601-1" aria-hidden="true" tabindex="-1"></a>res_lm <span class="ot">&lt;-</span>ar_2<span class="sc">$</span>residuals</span>
<span id="cb601-2"><a href="time-series-in-finance-and-economics.html#cb601-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we effectively eliminated the quadratic trend. </span></span>
<span id="cb601-3"><a href="time-series-in-finance-and-economics.html#cb601-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-4"><a href="time-series-in-finance-and-economics.html#cb601-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s create the plots again</span></span>
<span id="cb601-5"><a href="time-series-in-finance-and-economics.html#cb601-5" aria-hidden="true" tabindex="-1"></a>res_acf <span class="ot">&lt;-</span> res_lm <span class="sc">%&gt;%</span> <span class="fu">acf</span>(<span class="at">na.action =</span> na.pass, <span class="at">plot =</span> <span class="cn">FALSE</span>) </span>
<span id="cb601-6"><a href="time-series-in-finance-and-economics.html#cb601-6" aria-hidden="true" tabindex="-1"></a>res_bacf <span class="ot">&lt;-</span> <span class="fu">with</span>(res_acf, <span class="fu">data.frame</span>(lag, acf))</span>
<span id="cb601-7"><a href="time-series-in-finance-and-economics.html#cb601-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-8"><a href="time-series-in-finance-and-economics.html#cb601-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the dataframe for later merging</span></span>
<span id="cb601-9"><a href="time-series-in-finance-and-economics.html#cb601-9" aria-hidden="true" tabindex="-1"></a>res_lm_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(res_lm, <span class="fu">as.Date</span>(O3_conc<span class="sc">$</span>Datum)))</span>
<span id="cb601-10"><a href="time-series-in-finance-and-economics.html#cb601-10" aria-hidden="true" tabindex="-1"></a>res_lm_df <span class="ot">&lt;-</span> res_lm_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Datum =</span> <span class="fu">as.Date</span>(<span class="fu">as.Date</span>(O3_conc<span class="sc">$</span>Datum)))</span>
<span id="cb601-11"><a href="time-series-in-finance-and-economics.html#cb601-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-12"><a href="time-series-in-finance-and-economics.html#cb601-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot both</span></span>
<span id="cb601-13"><a href="time-series-in-finance-and-economics.html#cb601-13" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> res_lm_df <span class="sc">%&gt;%</span></span>
<span id="cb601-14"><a href="time-series-in-finance-and-economics.html#cb601-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Datum, <span class="at">y =</span> res_lm)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;dodgerblue4&quot;</span>) <span class="sc">+</span> </span>
<span id="cb601-15"><a href="time-series-in-finance-and-economics.html#cb601-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Residuals&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> </span>
<span id="cb601-16"><a href="time-series-in-finance-and-economics.html#cb601-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Residuals of the AR(3) process&quot;</span>) <span class="sc">+</span></span>
<span id="cb601-17"><a href="time-series-in-finance-and-economics.html#cb601-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb601-18"><a href="time-series-in-finance-and-economics.html#cb601-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb601-19"><a href="time-series-in-finance-and-economics.html#cb601-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb601-20"><a href="time-series-in-finance-and-economics.html#cb601-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb601-21"><a href="time-series-in-finance-and-economics.html#cb601-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb601-22"><a href="time-series-in-finance-and-economics.html#cb601-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb601-23"><a href="time-series-in-finance-and-economics.html#cb601-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb601-24"><a href="time-series-in-finance-and-economics.html#cb601-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb601-25"><a href="time-series-in-finance-and-economics.html#cb601-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb601-26"><a href="time-series-in-finance-and-economics.html#cb601-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb601-27"><a href="time-series-in-finance-and-economics.html#cb601-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span>
<span id="cb601-28"><a href="time-series-in-finance-and-economics.html#cb601-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-29"><a href="time-series-in-finance-and-economics.html#cb601-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-30"><a href="time-series-in-finance-and-economics.html#cb601-30" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-398-1.png" width="672" /></p>
<p>As we can see the residuals appear to be normally distributed, but not as much as if we used an MA(q) process. This is to be expected given the examplic nature of the data time series.</p>
</div>
</div>
<div id="combining-autoregressive-and-moving-average-processes" class="section level2" number="9.6">
<h2><span class="header-section-number">9.6</span> Combining Autoregressive and moving average processes</h2>
<p>In the previous two chapters we have discussed the two most important models for stationary time series data, autoregressive and moving average processes. We elaborated the theoretical idea, showed their properties and discussed in which cases use of either model is appropriate. Especially, we stated that MA(q) models are appropriate if the autocorrelation function is constantly decreasing while the AR(p) method is appropriate in cases in which the partial autocorrelation function is declining. However, given the the autocorrelation, there may be cases in which neither model is able to fully capture the correlation structure.</p>
<p>In such cases, we need to modify the existing models. The most straight-forward option to modify them is by adding them together. Luckily for us, this method works quite well and, as such, is widely implemented in time series analysis. As such, in the following chapter, we will focus on processes that encompass both AR(p) and MA(q) processes as special cases. The first type of processes we describe are for modelling stationary data, while the second class can additionally model long-term trends.</p>
<div id="arma-processes" class="section level3" number="9.6.1">
<h3><span class="header-section-number">9.6.1</span> ARMA Processes</h3>
<p>Recall the AR(p) process, which is given as:</p>
<p><span class="math display">\[
X_t = \alpha_1X_{t-1} + \dots + \alpha_pX_{t-p} + Z_t = \sum_{j=0}^\infty \beta_jZ_{t - j}
\]</span>
as well as as well as the MA(q) process, given by:</p>
<p><span class="math display">\[
X_t = \lambda_0Z_t + \lambda_1Z_{t-1} + \dots + \lambda_qZ_{t-q}
\]</span></p>
<p>An <strong>Autoregressive Moving Average process of order (p,q)</strong>, denoted ARMA(p,q) combines both models and is given by:</p>
<p><span class="math display">\[
\begin{align}
X_t &amp;= \alpha_1X_{t-1} + \dots + \alpha_pX_{t-p} + Z_t + \lambda_0Z_t + \lambda_1Z_{t-1} + \dots + \lambda_qZ_{t-q}\\
&amp;= \sum_{j=1}^p\alpha_iX_{t-j} + \sum_{j=1}^q \lambda_jZ_{t-j} + Z_t
\end{align} 
\]</span></p>
<p>Using the backshift operator the model can be re-written as:</p>
<p><span class="math display">\[
\begin{align}
X_t &amp;= \sum_{j=1}^p\alpha_iX_{t-j} + \sum_{j=1}^q \lambda_jZ_{t-j} + Z_t \\
X_t - \sum_{j=1}^p\alpha_iX_{t-j} &amp;= \sum_{j=1}^q \lambda_jZ_{t-j} + Z_t \\
(1- \alpha_1B - \dots - \alpha_pB^p)X_t &amp;= (1 + \lambda_1B + \dots + \lambda_qB^q) \\
\phi(B)X_t = \theta(B)Z_t
\end{align}
\]</span></p>
<p>The use of this model greatly extends the flexibility of the correlation process as it combines both the previous observations as well as moving averages of some order p and q.</p>
<div id="mean-and-variance-moments-2" class="section level4" number="9.6.1.1">
<h4><span class="header-section-number">9.6.1.1</span> Mean and Variance Moments</h4>
<p></p>
<p>Any ARMA(p,q) process can be written as an infinite sum of a purely random process, i.e. an MA(<span class="math inline">\(\infty\)</span>) process. That is, we get:</p>
<p><span class="math display">\[
X_t = \sum_{j=1}^p\alpha_iX_{t-j} + \sum_{j=1}^q \lambda_jZ_{t-j} + Z_t  = \sum_{j=0}^\infty \beta_jZ_{t - j}
\]</span></p>
<p>Although we do not show this here.</p>
<p>Consequently, we can obtain that the mean will be zero as:</p>
<p><span class="math display">\[
\begin{align}
E[X_t] &amp;= E[\sum_{j=0}^\infty \beta_jZ_{t-j}] \\
&amp;= \sum_{j=0}^\infty \beta_jE[Z_{t-j}] \\
&amp;= 0 
\end{align}
\]</span></p>
<p></p>
<p>Calculating the variance and autocorrelation function for an AMRA(p,q) process can be done by assuming the process is stationary and deriving the Yule-Walker equations. However, as this becomes quite messy to write in algebraic terms, we only show the ARMA(1,1) process.</p>
<p><span class="math display">\[
\begin{align}
X_t &amp;= \alpha_1X_{t-1} + \lambda_1Z_{t-1} + Z_t \\ 
X_t^2 &amp;= \alpha_1X_tX_{t-1} + \lambda_1X_tZ_{t-1} + X_tZ_t \\
E[X_t^2] &amp;= E[\alpha_1X_tX_{t-1} + \lambda_1X_tZ_{t-1} + Z_t] \\
Var[X_t] &amp;= E[X_t^2] - \underbrace{E[X_t]^2}_{= 0 }\\
&amp;= \alpha_1E[X_tX_{t-1}] + \lambda_1E[X_tZ_{t-1}] + E[X_tZ_t] \\
&amp;= \alpha_1\gamma_1 + \lambda_1E[X_tZ_{t-1}] + E[X_tZ_t]
\end{align}
\]</span></p>
<p>Looking at the covariance, we also understand that:</p>
<p><span class="math display">\[
\begin{align}
Cov[X_t,X_{t-1}] &amp;= E[X_t,X_{t-1}]  - E[X_t]E[X_{t-1}] = E[X_t,X_{t-1}]
\end{align}
\]</span></p>
<p>Further, we know that: <span class="math inline">\(E[X_tZ_t] = E[z_t^2] = \sigma_z^2\)</span> as well as <span class="math inline">\(E[X_tZ_{t-1}] = \alpha_1 E[Z_{t-1}X_{t-1}] + \lambda_1 E[Z_{t-1}Z_{t-1}] = \alpha_1 \sigma_z^2 + \lambda_1 \sigma_z^2\)</span>.</p>
<p>This implies the following for the variance:</p>
<p><span class="math display">\[
\begin{align}
Var[X_t] &amp;= \alpha_1\gamma_1 + \lambda_1(\alpha_1 \sigma_z^2 + \lambda_1 \sigma_z^2) + \sigma_z^2 \\
&amp;= \alpha_1\gamma_1 + \sigma_z^2(\lambda_1^2 + \lambda_1\alpha_1 + 1)
\end{align}
\]</span>
And the autocovariance:</p>
<p><span class="math display">\[
\begin{align}
Cov[X_t, X_{t-1}] &amp;= E[X_t,X_{t-1}] \\
&amp;= \alpha_1E[X_t-1^2] + \lambda_1E[X_{t-1}Z_{t-1}] + E[X_{t-1}Z_t] \\
&amp;= \alpha_1\gamma_0 + \lambda_1\sigma_z^2 
\end{align}
\]</span></p>
<p>Then we obtain the autocorrelation by dividing it with the variance:</p>
<p><span class="math display">\[
\rho_1 = \alpha_1 + \frac{\lambda_1\sigma_z^2}{\alpha_1\lambda_1 + \sigma_z^2(\lambda_1^2 + \lambda_1\alpha_1 + 1)}
\]</span></p>
<p>To generalise, we then obtain that:</p>
<p><span class="math display">\[
\rho_\tau = \alpha_\tau\rho_{\tau-1}
\]</span></p>
<p>Consequently, we understand that the autocorrelation function is equal to the Yule-Walker equation in an AR(p) model. This is handy as we can directly obtain the autocorrelation coefficients by a matrix formulation.</p>
</div>
<div id="stationarity-and-invertibility" class="section level4" number="9.6.1.2">
<h4><span class="header-section-number">9.6.1.2</span> Stationarity and Invertibility</h4>
<p>From the previous two chapters we understand that an AR(p) process is always invertible while an MA(q) process is always stationary. We further defined methods to check both conditions with the roots approach. Now, combining both methods we understand that:</p>
<ul>
<li>An ARMA(p,q) process is <strong>stationary</strong> if the AR(p) part is stationary (the roots of the characteristic polynomial have modulus larger than one)</li>
<li>An ARMA(p,q) process is <strong>invertible</strong> if the MA(q) part is invertible (the roots of the characteristic polynomial have modulus larger than one)</li>
</ul>
</div>
<div id="model-identification" class="section level4" number="9.6.1.3">
<h4><span class="header-section-number">9.6.1.3</span> Model Identification</h4>
<p>Although identifying AR(p) and MA(q) processes through ACF and PACF significance plots, it is far less straight-forward to do so for ARMA plots. As such, a trial-and-error approach is most suitable to identify the models. First determine if the ACF and PACF resemble either an AR(p) or an MA(q) process. If not then adopt a trial and error approach, starting with the simplest model and increasing the complexity until the correlation has been removed.</p>
</div>
</div>
<div id="using-an-armapq-process" class="section level3" number="9.6.2">
<h3><span class="header-section-number">9.6.2</span> Using an ARMA(p,q) process</h3>
<p>Working with an ARMA(p,q) process is as straight-forward as it is with the previous models. Let’s quickly show this here.</p>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb602-1"><a href="time-series-in-finance-and-economics.html#cb602-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Based on this, we now need to create the same tsibble datasets as beforetime &lt;- 1:200</span></span>
<span id="cb602-2"><a href="time-series-in-finance-and-economics.html#cb602-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">243</span></span>
<span id="cb602-3"><a href="time-series-in-finance-and-economics.html#cb602-3" aria-hidden="true" tabindex="-1"></a>sd <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb602-4"><a href="time-series-in-finance-and-economics.html#cb602-4" aria-hidden="true" tabindex="-1"></a>data.ar <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="at">model =</span> <span class="fu">list</span>(<span class="at">ar =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.3</span>)), <span class="at">n =</span> n, <span class="at">sd =</span> sd)</span>
<span id="cb602-5"><a href="time-series-in-finance-and-economics.html#cb602-5" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data.ar <span class="sc">+</span> <span class="dv">20</span> <span class="sc">+</span> <span class="fl">0.0005</span> <span class="sc">*</span> time</span></code></pre></div>
<pre><code>## Warning in `+.default`(data.ar + 20, 5e-04 * time): longer object length is not a multiple of shorter object length</code></pre>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb604-1"><a href="time-series-in-finance-and-economics.html#cb604-1" aria-hidden="true" tabindex="-1"></a>Dates <span class="ot">&lt;-</span> air_ZH_merged_ts <span class="sc">%&gt;%</span></span>
<span id="cb604-2"><a href="time-series-in-finance-and-economics.html#cb604-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Standort <span class="sc">==</span> <span class="st">&quot;Zch_Stampfenbachstrasse&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb604-3"><a href="time-series-in-finance-and-economics.html#cb604-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">values_from=</span>Wert, <span class="at">names_from=</span>Parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb604-4"><a href="time-series-in-finance-and-economics.html#cb604-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Datum) </span>
<span id="cb604-5"><a href="time-series-in-finance-and-economics.html#cb604-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb604-6"><a href="time-series-in-finance-and-economics.html#cb604-6" aria-hidden="true" tabindex="-1"></a>data_ts <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(Dates<span class="sc">$</span>Datum, data))</span>
<span id="cb604-7"><a href="time-series-in-finance-and-economics.html#cb604-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb604-8"><a href="time-series-in-finance-and-economics.html#cb604-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb604-9"><a href="time-series-in-finance-and-economics.html#cb604-9" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> data_ts <span class="sc">%&gt;%</span></span>
<span id="cb604-10"><a href="time-series-in-finance-and-economics.html#cb604-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.Date</span>(Dates<span class="sc">$</span>Datum), <span class="at">y =</span> data)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;dodgerblue4&quot;</span>) <span class="sc">+</span> </span>
<span id="cb604-11"><a href="time-series-in-finance-and-economics.html#cb604-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;µg/m3&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> </span>
<span id="cb604-12"><a href="time-series-in-finance-and-economics.html#cb604-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Concentration of CO at Zürich Stampfenbachstrasse&quot;</span>) <span class="sc">+</span></span>
<span id="cb604-13"><a href="time-series-in-finance-and-economics.html#cb604-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb604-14"><a href="time-series-in-finance-and-economics.html#cb604-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb604-15"><a href="time-series-in-finance-and-economics.html#cb604-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb604-16"><a href="time-series-in-finance-and-economics.html#cb604-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb604-17"><a href="time-series-in-finance-and-economics.html#cb604-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb604-18"><a href="time-series-in-finance-and-economics.html#cb604-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb604-19"><a href="time-series-in-finance-and-economics.html#cb604-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb604-20"><a href="time-series-in-finance-and-economics.html#cb604-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb604-21"><a href="time-series-in-finance-and-economics.html#cb604-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb604-22"><a href="time-series-in-finance-and-economics.html#cb604-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb604-23"><a href="time-series-in-finance-and-economics.html#cb604-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span>
<span id="cb604-24"><a href="time-series-in-finance-and-economics.html#cb604-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb604-25"><a href="time-series-in-finance-and-economics.html#cb604-25" aria-hidden="true" tabindex="-1"></a>data_ts_acf <span class="ot">&lt;-</span> data_ts <span class="sc">%&gt;%</span> <span class="fu">select</span>(data) <span class="sc">%&gt;%</span> <span class="fu">acf</span>(<span class="at">na.action =</span> na.pass, <span class="at">plot =</span> <span class="cn">FALSE</span>) </span>
<span id="cb604-26"><a href="time-series-in-finance-and-economics.html#cb604-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb604-27"><a href="time-series-in-finance-and-economics.html#cb604-27" aria-hidden="true" tabindex="-1"></a>data_ts_acf_df <span class="ot">&lt;-</span> <span class="fu">with</span>(data_ts_acf, <span class="fu">data.frame</span>(lag, acf))</span>
<span id="cb604-28"><a href="time-series-in-finance-and-economics.html#cb604-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb604-29"><a href="time-series-in-finance-and-economics.html#cb604-29" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> data_ts_acf_df <span class="sc">%&gt;%</span> </span>
<span id="cb604-30"><a href="time-series-in-finance-and-economics.html#cb604-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lag, <span class="at">y =</span> acf)) <span class="sc">+</span></span>
<span id="cb604-31"><a href="time-series-in-finance-and-economics.html#cb604-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb604-32"><a href="time-series-in-finance-and-economics.html#cb604-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">xend =</span> lag, <span class="at">yend =</span> <span class="dv">0</span>)) <span class="sc">+</span> </span>
<span id="cb604-33"><a href="time-series-in-finance-and-economics.html#cb604-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">length</span>(stocks_SMI_ts_ret[,<span class="dv">1</span>]))), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span> </span>
<span id="cb604-34"><a href="time-series-in-finance-and-economics.html#cb604-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">length</span>(stocks_SMI_ts_ret[,<span class="dv">1</span>]))), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span> </span>
<span id="cb604-35"><a href="time-series-in-finance-and-economics.html#cb604-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>( <span class="st">&quot;khaki3&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>, <span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;tomato3&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>)) <span class="sc">+</span></span>
<span id="cb604-36"><a href="time-series-in-finance-and-economics.html#cb604-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;ACF&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Lags&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Correlogram to show the ACF of CO concentration&quot;</span>) <span class="sc">+</span></span>
<span id="cb604-37"><a href="time-series-in-finance-and-economics.html#cb604-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb604-38"><a href="time-series-in-finance-and-economics.html#cb604-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb604-39"><a href="time-series-in-finance-and-economics.html#cb604-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb604-40"><a href="time-series-in-finance-and-economics.html#cb604-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb604-41"><a href="time-series-in-finance-and-economics.html#cb604-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb604-42"><a href="time-series-in-finance-and-economics.html#cb604-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb604-43"><a href="time-series-in-finance-and-economics.html#cb604-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb604-44"><a href="time-series-in-finance-and-economics.html#cb604-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb604-45"><a href="time-series-in-finance-and-economics.html#cb604-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb604-46"><a href="time-series-in-finance-and-economics.html#cb604-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb604-47"><a href="time-series-in-finance-and-economics.html#cb604-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb604-48"><a href="time-series-in-finance-and-economics.html#cb604-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<pre><code>## Scale for &#39;colour&#39; is already present. Adding another scale for &#39;colour&#39;, which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb606"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb606-1"><a href="time-series-in-finance-and-economics.html#cb606-1" aria-hidden="true" tabindex="-1"></a>p <span class="sc">+</span> q <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-399-1.png" width="672" /></p>
<p>As we can see, the CO concentration has probably a time trend, which we need to remove first.</p>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb607-1"><a href="time-series-in-finance-and-economics.html#cb607-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, we only want the O3 concentration here</span></span>
<span id="cb607-2"><a href="time-series-in-finance-and-economics.html#cb607-2" aria-hidden="true" tabindex="-1"></a>O3_conc <span class="ot">&lt;-</span> data_ts <span class="sc">%&gt;%</span></span>
<span id="cb607-3"><a href="time-series-in-finance-and-economics.html#cb607-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Datum_new =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">243</span>)</span>
<span id="cb607-4"><a href="time-series-in-finance-and-economics.html#cb607-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-5"><a href="time-series-in-finance-and-economics.html#cb607-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we regress a quadratic model and obtain the residuals</span></span>
<span id="cb607-6"><a href="time-series-in-finance-and-economics.html#cb607-6" aria-hidden="true" tabindex="-1"></a>lin_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(data <span class="sc">~</span> Datum_new, <span class="at">data =</span> O3_conc)</span>
<span id="cb607-7"><a href="time-series-in-finance-and-economics.html#cb607-7" aria-hidden="true" tabindex="-1"></a>res_lm <span class="ot">&lt;-</span> O3_conc<span class="sc">$</span>data <span class="sc">-</span> lin_mod<span class="sc">$</span>fitted.values</span>
<span id="cb607-8"><a href="time-series-in-finance-and-economics.html#cb607-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-9"><a href="time-series-in-finance-and-economics.html#cb607-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we effectively eliminated the quadratic trend. </span></span>
<span id="cb607-10"><a href="time-series-in-finance-and-economics.html#cb607-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-11"><a href="time-series-in-finance-and-economics.html#cb607-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s create the plots again</span></span>
<span id="cb607-12"><a href="time-series-in-finance-and-economics.html#cb607-12" aria-hidden="true" tabindex="-1"></a>res_acf <span class="ot">&lt;-</span> res_lm <span class="sc">%&gt;%</span> <span class="fu">acf</span>(<span class="at">na.action =</span> na.pass, <span class="at">plot =</span> <span class="cn">FALSE</span>) </span>
<span id="cb607-13"><a href="time-series-in-finance-and-economics.html#cb607-13" aria-hidden="true" tabindex="-1"></a>res_bacf <span class="ot">&lt;-</span> <span class="fu">with</span>(res_acf, <span class="fu">data.frame</span>(lag, acf))</span>
<span id="cb607-14"><a href="time-series-in-finance-and-economics.html#cb607-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-15"><a href="time-series-in-finance-and-economics.html#cb607-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the dataframe for later merging</span></span>
<span id="cb607-16"><a href="time-series-in-finance-and-economics.html#cb607-16" aria-hidden="true" tabindex="-1"></a>res_lm_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(res_lm, <span class="fu">as.Date</span>(O3_conc<span class="sc">$</span>Datum)))</span>
<span id="cb607-17"><a href="time-series-in-finance-and-economics.html#cb607-17" aria-hidden="true" tabindex="-1"></a>res_lm_df <span class="ot">&lt;-</span> res_lm_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Datum =</span> <span class="fu">as.Date</span>(V2))</span>
<span id="cb607-18"><a href="time-series-in-finance-and-economics.html#cb607-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-19"><a href="time-series-in-finance-and-economics.html#cb607-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the time series</span></span>
<span id="cb607-20"><a href="time-series-in-finance-and-economics.html#cb607-20" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> res_lm_df <span class="sc">%&gt;%</span></span>
<span id="cb607-21"><a href="time-series-in-finance-and-economics.html#cb607-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Datum, <span class="at">y =</span> res_lm)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;dodgerblue4&quot;</span>) <span class="sc">+</span> </span>
<span id="cb607-22"><a href="time-series-in-finance-and-economics.html#cb607-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Residuals&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> </span>
<span id="cb607-23"><a href="time-series-in-finance-and-economics.html#cb607-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Residuals of CO at Zürich Stampfenbachstrasse&quot;</span>) <span class="sc">+</span></span>
<span id="cb607-24"><a href="time-series-in-finance-and-economics.html#cb607-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb607-25"><a href="time-series-in-finance-and-economics.html#cb607-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb607-26"><a href="time-series-in-finance-and-economics.html#cb607-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb607-27"><a href="time-series-in-finance-and-economics.html#cb607-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb607-28"><a href="time-series-in-finance-and-economics.html#cb607-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb607-29"><a href="time-series-in-finance-and-economics.html#cb607-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb607-30"><a href="time-series-in-finance-and-economics.html#cb607-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb607-31"><a href="time-series-in-finance-and-economics.html#cb607-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb607-32"><a href="time-series-in-finance-and-economics.html#cb607-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb607-33"><a href="time-series-in-finance-and-economics.html#cb607-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb607-34"><a href="time-series-in-finance-and-economics.html#cb607-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span>
<span id="cb607-35"><a href="time-series-in-finance-and-economics.html#cb607-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-36"><a href="time-series-in-finance-and-economics.html#cb607-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the ACF </span></span>
<span id="cb607-37"><a href="time-series-in-finance-and-economics.html#cb607-37" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> res_bacf <span class="sc">%&gt;%</span> </span>
<span id="cb607-38"><a href="time-series-in-finance-and-economics.html#cb607-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lag, <span class="at">y =</span> acf)) <span class="sc">+</span></span>
<span id="cb607-39"><a href="time-series-in-finance-and-economics.html#cb607-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb607-40"><a href="time-series-in-finance-and-economics.html#cb607-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">xend =</span> lag, <span class="at">yend =</span> <span class="dv">0</span>)) <span class="sc">+</span> </span>
<span id="cb607-41"><a href="time-series-in-finance-and-economics.html#cb607-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">dim</span>(res_lm_df)[<span class="dv">1</span>])), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span> </span>
<span id="cb607-42"><a href="time-series-in-finance-and-economics.html#cb607-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">dim</span>(res_lm_df)[<span class="dv">1</span>])), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span> </span>
<span id="cb607-43"><a href="time-series-in-finance-and-economics.html#cb607-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>( <span class="st">&quot;khaki3&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>, <span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;tomato3&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>)) <span class="sc">+</span></span>
<span id="cb607-44"><a href="time-series-in-finance-and-economics.html#cb607-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;ACF&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Lags&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Correlogram to show the ACF of CO concentration&quot;</span>) <span class="sc">+</span></span>
<span id="cb607-45"><a href="time-series-in-finance-and-economics.html#cb607-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb607-46"><a href="time-series-in-finance-and-economics.html#cb607-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb607-47"><a href="time-series-in-finance-and-economics.html#cb607-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb607-48"><a href="time-series-in-finance-and-economics.html#cb607-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb607-49"><a href="time-series-in-finance-and-economics.html#cb607-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb607-50"><a href="time-series-in-finance-and-economics.html#cb607-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb607-51"><a href="time-series-in-finance-and-economics.html#cb607-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb607-52"><a href="time-series-in-finance-and-economics.html#cb607-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb607-53"><a href="time-series-in-finance-and-economics.html#cb607-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb607-54"><a href="time-series-in-finance-and-economics.html#cb607-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb607-55"><a href="time-series-in-finance-and-economics.html#cb607-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb607-56"><a href="time-series-in-finance-and-economics.html#cb607-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<pre><code>## Scale for &#39;colour&#39; is already present. Adding another scale for &#39;colour&#39;, which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb609-1"><a href="time-series-in-finance-and-economics.html#cb609-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the PACF and plot it as well</span></span>
<span id="cb609-2"><a href="time-series-in-finance-and-economics.html#cb609-2" aria-hidden="true" tabindex="-1"></a>pacf <span class="ot">&lt;-</span> <span class="fu">pacf</span>(res_lm)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-400-1.png" width="672" /></p>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb610-1"><a href="time-series-in-finance-and-economics.html#cb610-1" aria-hidden="true" tabindex="-1"></a>pacf_values <span class="ot">&lt;-</span> <span class="fu">c</span>(pacf<span class="sc">$</span>acf)</span>
<span id="cb610-2"><a href="time-series-in-finance-and-economics.html#cb610-2" aria-hidden="true" tabindex="-1"></a>res_bpacf <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">23</span>,<span class="dv">1</span>), pacf_values))</span></code></pre></div>
<pre><code>## Warning in base::cbind(...): number of rows of result is not a multiple of vector length (arg 2)</code></pre>
<div class="sourceCode" id="cb612"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb612-1"><a href="time-series-in-finance-and-economics.html#cb612-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(res_bpacf) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;lag&quot;</span>, <span class="st">&quot;PACF&quot;</span>)</span>
<span id="cb612-2"><a href="time-series-in-finance-and-economics.html#cb612-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb612-3"><a href="time-series-in-finance-and-economics.html#cb612-3" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> res_bpacf <span class="sc">%&gt;%</span> </span>
<span id="cb612-4"><a href="time-series-in-finance-and-economics.html#cb612-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lag, <span class="at">y =</span> PACF)) <span class="sc">+</span></span>
<span id="cb612-5"><a href="time-series-in-finance-and-economics.html#cb612-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb612-6"><a href="time-series-in-finance-and-economics.html#cb612-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">xend =</span> lag, <span class="at">yend =</span> <span class="dv">0</span>)) <span class="sc">+</span> </span>
<span id="cb612-7"><a href="time-series-in-finance-and-economics.html#cb612-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>((<span class="fu">dim</span>(res_lm_df)[<span class="dv">1</span>]))), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span> </span>
<span id="cb612-8"><a href="time-series-in-finance-and-economics.html#cb612-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fl">1.96</span><span class="sc">/</span><span class="fu">sqrt</span>((<span class="fu">dim</span>(res_lm_df)[<span class="dv">1</span>]))), <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&#39;deepskyblue3&#39;</span>) <span class="sc">+</span> </span>
<span id="cb612-9"><a href="time-series-in-finance-and-economics.html#cb612-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>( <span class="st">&quot;khaki3&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>, <span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;tomato3&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb612-10"><a href="time-series-in-finance-and-economics.html#cb612-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;PACF&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Lags&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Correlogram to show the PACF of CO concentration&quot;</span>) <span class="sc">+</span></span>
<span id="cb612-11"><a href="time-series-in-finance-and-economics.html#cb612-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb612-12"><a href="time-series-in-finance-and-economics.html#cb612-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb612-13"><a href="time-series-in-finance-and-economics.html#cb612-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb612-14"><a href="time-series-in-finance-and-economics.html#cb612-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb612-15"><a href="time-series-in-finance-and-economics.html#cb612-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb612-16"><a href="time-series-in-finance-and-economics.html#cb612-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb612-17"><a href="time-series-in-finance-and-economics.html#cb612-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb612-18"><a href="time-series-in-finance-and-economics.html#cb612-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb612-19"><a href="time-series-in-finance-and-economics.html#cb612-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb612-20"><a href="time-series-in-finance-and-economics.html#cb612-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb612-21"><a href="time-series-in-finance-and-economics.html#cb612-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb612-22"><a href="time-series-in-finance-and-economics.html#cb612-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span></code></pre></div>
<pre><code>## Scale for &#39;colour&#39; is already present. Adding another scale for &#39;colour&#39;, which will replace the existing scale.</code></pre>
<div class="sourceCode" id="cb614"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb614-1"><a href="time-series-in-finance-and-economics.html#cb614-1" aria-hidden="true" tabindex="-1"></a>q <span class="sc">+</span> r <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>))</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-400-2.png" width="672" /></p>
<p>The time plot suggests the residual series is stationary, while we may understand that an ARMA(2,5) model is appropriate.</p>
<div class="sourceCode" id="cb615"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb615-1"><a href="time-series-in-finance-and-economics.html#cb615-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the Arima model with RA(3)</span></span>
<span id="cb615-2"><a href="time-series-in-finance-and-economics.html#cb615-2" aria-hidden="true" tabindex="-1"></a>arma_25 <span class="ot">&lt;-</span> <span class="fu">arima</span>(res_lm, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">5</span>))</span>
<span id="cb615-3"><a href="time-series-in-finance-and-economics.html#cb615-3" aria-hidden="true" tabindex="-1"></a>arma_25</span></code></pre></div>
<pre><code>## 
## Call:
## arima(x = res_lm, order = c(2, 0, 5))
## 
## Coefficients:
##           ar1     ar2     ma1      ma2     ma3     ma4     ma5  intercept
##       -0.0938  0.7671  0.4820  -0.2735  0.2399  0.0867  0.0580    -0.0067
## s.e.   0.0769  0.0759  0.0987   0.1105  0.0814  0.0879  0.0793     0.3001
## 
## sigma^2 estimated as 0.9593:  log likelihood = -340.48,  aic = 698.95</code></pre>
<p>Finally, we should plot the residuals again to ensure they are normal</p>
<div class="sourceCode" id="cb617"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb617-1"><a href="time-series-in-finance-and-economics.html#cb617-1" aria-hidden="true" tabindex="-1"></a>res_lm <span class="ot">&lt;-</span>arma_25<span class="sc">$</span>residuals</span>
<span id="cb617-2"><a href="time-series-in-finance-and-economics.html#cb617-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we effectively eliminated the quadratic trend. </span></span>
<span id="cb617-3"><a href="time-series-in-finance-and-economics.html#cb617-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb617-4"><a href="time-series-in-finance-and-economics.html#cb617-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, let&#39;s create the plots again</span></span>
<span id="cb617-5"><a href="time-series-in-finance-and-economics.html#cb617-5" aria-hidden="true" tabindex="-1"></a>res_acf <span class="ot">&lt;-</span> res_lm <span class="sc">%&gt;%</span> <span class="fu">acf</span>(<span class="at">na.action =</span> na.pass, <span class="at">plot =</span> <span class="cn">FALSE</span>) </span>
<span id="cb617-6"><a href="time-series-in-finance-and-economics.html#cb617-6" aria-hidden="true" tabindex="-1"></a>res_bacf <span class="ot">&lt;-</span> <span class="fu">with</span>(res_acf, <span class="fu">data.frame</span>(lag, acf))</span>
<span id="cb617-7"><a href="time-series-in-finance-and-economics.html#cb617-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb617-8"><a href="time-series-in-finance-and-economics.html#cb617-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the dataframe for later merging</span></span>
<span id="cb617-9"><a href="time-series-in-finance-and-economics.html#cb617-9" aria-hidden="true" tabindex="-1"></a>res_lm_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(res_lm, <span class="fu">as.Date</span>(O3_conc<span class="sc">$</span>Datum)))</span>
<span id="cb617-10"><a href="time-series-in-finance-and-economics.html#cb617-10" aria-hidden="true" tabindex="-1"></a>res_lm_df <span class="ot">&lt;-</span> res_lm_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Datum =</span> <span class="fu">as.Date</span>(<span class="fu">as.Date</span>(O3_conc<span class="sc">$</span>Datum)))</span>
<span id="cb617-11"><a href="time-series-in-finance-and-economics.html#cb617-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb617-12"><a href="time-series-in-finance-and-economics.html#cb617-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot both</span></span>
<span id="cb617-13"><a href="time-series-in-finance-and-economics.html#cb617-13" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> res_lm_df <span class="sc">%&gt;%</span></span>
<span id="cb617-14"><a href="time-series-in-finance-and-economics.html#cb617-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Datum, <span class="at">y =</span> res_lm)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;dodgerblue4&quot;</span>) <span class="sc">+</span> </span>
<span id="cb617-15"><a href="time-series-in-finance-and-economics.html#cb617-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Residuals&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> </span>
<span id="cb617-16"><a href="time-series-in-finance-and-economics.html#cb617-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Residuals of the AR(3) process&quot;</span>) <span class="sc">+</span></span>
<span id="cb617-17"><a href="time-series-in-finance-and-economics.html#cb617-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;violetred4&quot;</span>, <span class="st">&quot;lightsteelblue3&quot;</span>,<span class="st">&quot;dodgerblue4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>, <span class="st">&quot;springgreen4&quot;</span>, <span class="st">&quot;goldenrod&quot;</span>,  <span class="st">&quot;khaki3&quot;</span>)) <span class="sc">+</span></span>
<span id="cb617-18"><a href="time-series-in-finance-and-economics.html#cb617-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>,</span>
<span id="cb617-19"><a href="time-series-in-finance-and-economics.html#cb617-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">hjust=</span><span class="fl">0.5</span>,<span class="at">lineheight=</span><span class="fl">2.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">45</span>)), </span>
<span id="cb617-20"><a href="time-series-in-finance-and-economics.html#cb617-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb617-21"><a href="time-series-in-finance-and-economics.html#cb617-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb617-22"><a href="time-series-in-finance-and-economics.html#cb617-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb617-23"><a href="time-series-in-finance-and-economics.html#cb617-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb617-24"><a href="time-series-in-finance-and-economics.html#cb617-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>), </span>
<span id="cb617-25"><a href="time-series-in-finance-and-economics.html#cb617-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb617-26"><a href="time-series-in-finance-and-economics.html#cb617-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb617-27"><a href="time-series-in-finance-and-economics.html#cb617-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span>
<span id="cb617-28"><a href="time-series-in-finance-and-economics.html#cb617-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb617-29"><a href="time-series-in-finance-and-economics.html#cb617-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb617-30"><a href="time-series-in-finance-and-economics.html#cb617-30" aria-hidden="true" tabindex="-1"></a>p</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-402-1.png" width="672" /></p>
<p>This is the third option to model stationary time series.</p>
<p>Consequently, we now covered the three most widespread forms to analyse stationary time series. Importantly, we first need to detrend and remove seasonality from the time series in order to use either approach and effectively assess which approach is the correct one given the temporal correlation properties of the data. Based on either model, we can then assess the best possible model by creating training and test sets and then taking the fitted model weights to predict a stationary time series and compare the error terms.</p>
<p>Although we could do this by hand, the <code>forecast</code> package has a handy feature called <code>auto.arima</code>. This will provide you with the optimal model based on the time series at hand. To understand how it works, just use the function here:</p>
<div class="sourceCode" id="cb618"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb618-1"><a href="time-series-in-finance-and-economics.html#cb618-1" aria-hidden="true" tabindex="-1"></a><span class="fu">auto.arima</span>(data_ts<span class="sc">$</span>data, <span class="at">trace=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## 
##  Fitting models using approximations to speed things up...
## 
##  ARIMA(2,1,2) with drift         : Inf
##  ARIMA(0,1,0) with drift         : 769.5454
##  ARIMA(1,1,0) with drift         : 712.4391
##  ARIMA(0,1,1) with drift         : 706.773
##  ARIMA(0,1,0)                    : 767.5122
##  ARIMA(1,1,1) with drift         : 705.8703
##  ARIMA(2,1,1) with drift         : 707.1292
##  ARIMA(1,1,2) with drift         : 707.0857
##  ARIMA(0,1,2) with drift         : 705.1276
##  ARIMA(0,1,3) with drift         : 707.1158
##  ARIMA(1,1,3) with drift         : 708.7778
##  ARIMA(0,1,2)                    : 703.0664
##  ARIMA(0,1,1)                    : 704.7277
##  ARIMA(1,1,2)                    : 705.025
##  ARIMA(0,1,3)                    : 705.0374
##  ARIMA(1,1,1)                    : 703.8197
##  ARIMA(1,1,3)                    : 706.683
## 
##  Now re-fitting the best model(s) without approximations...
## 
##  ARIMA(0,1,2)                    : 703.4527
## 
##  Best model: ARIMA(0,1,2)</code></pre>
<pre><code>## Series: data_ts$data 
## ARIMA(0,1,2) 
## 
## Coefficients:
##           ma1     ma2
##       -0.5624  0.1357
## s.e.   0.0641  0.0688
## 
## sigma^2 estimated as 1.052:  log likelihood=-348.68
## AIC=703.35   AICc=703.45   BIC=713.82</code></pre>
<p>As we can see, when assuming stationarity, an ARIMA(1,0,2) model is most suitable.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="factor-models.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/NikolasAnic/Empirical_Finance_R_Lab/edit/master/08-Time_Series.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/NikolasAnic/Empirical_Finance_R_Lab/blob/master/08-Time_Series.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
