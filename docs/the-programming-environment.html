<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 The Programming Environment | Advanced Empirical Finance</title>
  <meta name="description" content="Chapter 2 The Programming Environment | Advanced Empirical Finance" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 The Programming Environment | Advanced Empirical Finance" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 The Programming Environment | Advanced Empirical Finance" />
  
  
  

<meta name="author" content="Nikolas Anic &amp; Lorenz Gassmann" />


<meta name="date" content="2022-02-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="statistical-properties.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Empirical Finance - Lab Course</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction to the course objectives and organisation of the course</a></li>
<li class="chapter" data-level="2" data-path="the-programming-environment.html"><a href="the-programming-environment.html"><i class="fa fa-check"></i><b>2</b> The Programming Environment</a>
<ul>
<li class="chapter" data-level="2.1" data-path="the-programming-environment.html"><a href="the-programming-environment.html#markdown-files"><i class="fa fa-check"></i><b>2.1</b> Markdown Files</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="the-programming-environment.html"><a href="the-programming-environment.html#how-to-create-a-markdown-file"><i class="fa fa-check"></i><b>2.1.1</b> How to create a Markdown File</a></li>
<li class="chapter" data-level="2.1.2" data-path="the-programming-environment.html"><a href="the-programming-environment.html#the-r-markdown-structure"><i class="fa fa-check"></i><b>2.1.2</b> The R Markdown Structure</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="the-programming-environment.html"><a href="the-programming-environment.html#coding-in-r---a-concise-overview"><i class="fa fa-check"></i><b>2.2</b> Coding In R - A concise overview</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="the-programming-environment.html"><a href="the-programming-environment.html#introduction"><i class="fa fa-check"></i><b>2.2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2.2" data-path="the-programming-environment.html"><a href="the-programming-environment.html#vectors"><i class="fa fa-check"></i><b>2.2.2</b> Vectors</a></li>
<li class="chapter" data-level="2.2.3" data-path="the-programming-environment.html"><a href="the-programming-environment.html#data-types"><i class="fa fa-check"></i><b>2.2.3</b> Data Types</a></li>
<li class="chapter" data-level="2.2.4" data-path="the-programming-environment.html"><a href="the-programming-environment.html#data-frames"><i class="fa fa-check"></i><b>2.2.4</b> Data Frames</a></li>
<li class="chapter" data-level="2.2.5" data-path="the-programming-environment.html"><a href="the-programming-environment.html#importing-data"><i class="fa fa-check"></i><b>2.2.5</b> Importing Data</a></li>
<li class="chapter" data-level="2.2.6" data-path="the-programming-environment.html"><a href="the-programming-environment.html#data-manipulation"><i class="fa fa-check"></i><b>2.2.6</b> Data Manipulation</a></li>
<li class="chapter" data-level="2.2.7" data-path="the-programming-environment.html"><a href="the-programming-environment.html#data-reshaping"><i class="fa fa-check"></i><b>2.2.7</b> Data Reshaping</a></li>
<li class="chapter" data-level="2.2.8" data-path="the-programming-environment.html"><a href="the-programming-environment.html#beautiful-graphs-with-ggplot2"><i class="fa fa-check"></i><b>2.2.8</b> Beautiful Graphs with <code>ggplot2</code></a></li>
<li class="chapter" data-level="2.2.9" data-path="the-programming-environment.html"><a href="the-programming-environment.html#dates-and-times"><i class="fa fa-check"></i><b>2.2.9</b> Dates and Times</a></li>
<li class="chapter" data-level="2.2.10" data-path="the-programming-environment.html"><a href="the-programming-environment.html#string-manipulations-in-r-the-stringr-package"><i class="fa fa-check"></i><b>2.2.10</b> String Manipulations in R: The <code>stringr()</code> package</a></li>
<li class="chapter" data-level="2.2.11" data-path="the-programming-environment.html"><a href="the-programming-environment.html#database-queries"><i class="fa fa-check"></i><b>2.2.11</b> Database Queries</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="statistical-properties.html"><a href="statistical-properties.html"><i class="fa fa-check"></i><b>3</b> Statistical Properties</a>
<ul>
<li class="chapter" data-level="3.1" data-path="statistical-properties.html"><a href="statistical-properties.html#random-variables-and-probability-distributions-introdcution"><i class="fa fa-check"></i><b>3.1</b> Random Variables and Probability Distributions: Introdcution</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="statistical-properties.html"><a href="statistical-properties.html#the-concept-of-probability-important-notions-and-definitions"><i class="fa fa-check"></i><b>3.1.1</b> The concept of Probability: Important Notions and Definitions</a></li>
<li class="chapter" data-level="3.1.2" data-path="statistical-properties.html"><a href="statistical-properties.html#random-variables"><i class="fa fa-check"></i><b>3.1.2</b> Random Variables</a></li>
<li class="chapter" data-level="3.1.3" data-path="statistical-properties.html"><a href="statistical-properties.html#discrete-random-variables-and-distributions"><i class="fa fa-check"></i><b>3.1.3</b> Discrete Random Variables and Distributions</a></li>
<li class="chapter" data-level="3.1.4" data-path="statistical-properties.html"><a href="statistical-properties.html#continuous-random-variables-and-distributions"><i class="fa fa-check"></i><b>3.1.4</b> Continuous Random Variables and Distributions</a></li>
<li class="chapter" data-level="3.1.5" data-path="statistical-properties.html"><a href="statistical-properties.html#the-cumulative-distribution"><i class="fa fa-check"></i><b>3.1.5</b> The cumulative Distribution</a></li>
<li class="chapter" data-level="3.1.6" data-path="statistical-properties.html"><a href="statistical-properties.html#continuous-distributions-with-appealing-properties"><i class="fa fa-check"></i><b>3.1.6</b> Continuous Distributions with Appealing Properties</a></li>
<li class="chapter" data-level="3.1.7" data-path="statistical-properties.html"><a href="statistical-properties.html#moments-and-properties-of-bivariate-distributions"><i class="fa fa-check"></i><b>3.1.7</b> Moments and Properties of bivariate distributions</a></li>
<li class="chapter" data-level="3.1.8" data-path="statistical-properties.html"><a href="statistical-properties.html#moments-of-probability-distributions"><i class="fa fa-check"></i><b>3.1.8</b> Moments of Probability Distributions</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="statistical-properties.html"><a href="statistical-properties.html#matrix-algebra-introduction"><i class="fa fa-check"></i><b>3.2</b> Matrix Algebra: Introduction</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="statistical-properties.html"><a href="statistical-properties.html#matrices-and-vectors"><i class="fa fa-check"></i><b>3.2.1</b> Matrices and Vectors</a></li>
<li class="chapter" data-level="3.2.2" data-path="statistical-properties.html"><a href="statistical-properties.html#basic-matrix-operations"><i class="fa fa-check"></i><b>3.2.2</b> Basic Matrix Operations</a></li>
<li class="chapter" data-level="3.2.3" data-path="statistical-properties.html"><a href="statistical-properties.html#summation-notation-in-matrix-form"><i class="fa fa-check"></i><b>3.2.3</b> Summation Notation in Matrix Form</a></li>
<li class="chapter" data-level="3.2.4" data-path="statistical-properties.html"><a href="statistical-properties.html#systems-of-linear-equations"><i class="fa fa-check"></i><b>3.2.4</b> Systems of Linear Equations</a></li>
<li class="chapter" data-level="3.2.5" data-path="statistical-properties.html"><a href="statistical-properties.html#positive-definite-pd-matrix"><i class="fa fa-check"></i><b>3.2.5</b> Positive Definite (PD) Matrix</a></li>
<li class="chapter" data-level="3.2.6" data-path="statistical-properties.html"><a href="statistical-properties.html#multivariate-probability-distributions"><i class="fa fa-check"></i><b>3.2.6</b> Multivariate Probability Distributions</a></li>
<li class="chapter" data-level="3.2.7" data-path="statistical-properties.html"><a href="statistical-properties.html#portfolio-construction-and-mathematical-properties-using-matrix-algebra"><i class="fa fa-check"></i><b>3.2.7</b> Portfolio Construction and Mathematical Properties using Matrix Algebra</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html"><i class="fa fa-check"></i><b>4</b> Inductive Statistics and Regression Analysis Fundamentals</a>
<ul>
<li class="chapter" data-level="4.1" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#inductive-statistics"><i class="fa fa-check"></i><b>4.1</b> Inductive Statistics</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#point-estimators"><i class="fa fa-check"></i><b>4.1.1</b> Point Estimators</a></li>
<li class="chapter" data-level="4.1.2" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#confidence-intervals"><i class="fa fa-check"></i><b>4.1.2</b> Confidence Intervals</a></li>
<li class="chapter" data-level="4.1.3" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#hypothesis-testing"><i class="fa fa-check"></i><b>4.1.3</b> Hypothesis Testing</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#introduction-to-regression-analysis"><i class="fa fa-check"></i><b>4.2</b> Introduction to Regression Analysis</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#the-role-of-correlation"><i class="fa fa-check"></i><b>4.2.1</b> The role of correlation</a></li>
<li class="chapter" data-level="4.2.2" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#the-simple-univariate-regression-model"><i class="fa fa-check"></i><b>4.2.2</b> The simple / univariate regression model</a></li>
<li class="chapter" data-level="4.2.3" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#the-multivariate-regression-model"><i class="fa fa-check"></i><b>4.2.3</b> The multivariate regression model</a></li>
<li class="chapter" data-level="4.2.4" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#goodness-of-fit"><i class="fa fa-check"></i><b>4.2.4</b> Goodness of Fit</a></li>
<li class="chapter" data-level="4.2.5" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#assumption-and-diagnostic-tests-of-ols"><i class="fa fa-check"></i><b>4.2.5</b> Assumption and diagnostic tests of OLS</a></li>
<li class="chapter" data-level="4.2.6" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#properties-of-the-ols-estimator"><i class="fa fa-check"></i><b>4.2.6</b> Properties of the OLS Estimator</a></li>
<li class="chapter" data-level="4.2.7" data-path="inductive-statistics-and-regression-analysis-fundamentals.html"><a href="inductive-statistics-and-regression-analysis-fundamentals.html#expected-value-and-variance-of-the-multivarite-ols-estimator-if-the-assumptions-hold"><i class="fa fa-check"></i><b>4.2.7</b> Expected Value and Variance of the multivarite OLS estimator if the assumptions hold:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="risk-and-return.html"><a href="risk-and-return.html"><i class="fa fa-check"></i><b>5</b> Risk and Return</a>
<ul>
<li class="chapter" data-level="5.1" data-path="risk-and-return.html"><a href="risk-and-return.html#the-time-series-of-returns---transformations-in-r-1"><i class="fa fa-check"></i><b>5.1</b> The time-series of Returns - Transformations in R</a></li>
<li class="chapter" data-level="5.2" data-path="risk-and-return.html"><a href="risk-and-return.html#security-returns"><i class="fa fa-check"></i><b>5.2</b> Security Returns</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="risk-and-return.html"><a href="risk-and-return.html#simple-returns"><i class="fa fa-check"></i><b>5.2.1</b> Simple Returns</a></li>
<li class="chapter" data-level="5.2.2" data-path="risk-and-return.html"><a href="risk-and-return.html#logarithmic-returns"><i class="fa fa-check"></i><b>5.2.2</b> Logarithmic Returns</a></li>
<li class="chapter" data-level="5.2.3" data-path="risk-and-return.html"><a href="risk-and-return.html#accounting-for-dividends-total-returns"><i class="fa fa-check"></i><b>5.2.3</b> Accounting for Dividends: Total Returns</a></li>
<li class="chapter" data-level="5.2.4" data-path="risk-and-return.html"><a href="risk-and-return.html#truncating-the-data"><i class="fa fa-check"></i><b>5.2.4</b> Truncating the data</a></li>
<li class="chapter" data-level="5.2.5" data-path="risk-and-return.html"><a href="risk-and-return.html#arithmetic-vs.-geometric-returns"><i class="fa fa-check"></i><b>5.2.5</b> Arithmetic vs. Geometric Returns</a></li>
<li class="chapter" data-level="5.2.6" data-path="risk-and-return.html"><a href="risk-and-return.html#cumulative-returns"><i class="fa fa-check"></i><b>5.2.6</b> Cumulative Returns</a></li>
<li class="chapter" data-level="5.2.7" data-path="risk-and-return.html"><a href="risk-and-return.html#periodic-transformation-of-returns"><i class="fa fa-check"></i><b>5.2.7</b> Periodic Transformation of Returns</a></li>
<li class="chapter" data-level="5.2.8" data-path="risk-and-return.html"><a href="risk-and-return.html#annualising-returns"><i class="fa fa-check"></i><b>5.2.8</b> Annualising Returns</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="risk-and-return.html"><a href="risk-and-return.html#portfolio-returns"><i class="fa fa-check"></i><b>5.3</b> Portfolio Returns</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="risk-and-return.html"><a href="risk-and-return.html#equal-weighted-returns"><i class="fa fa-check"></i><b>5.3.1</b> Equal-weighted Returns</a></li>
<li class="chapter" data-level="5.3.2" data-path="risk-and-return.html"><a href="risk-and-return.html#value-weighted-returns"><i class="fa fa-check"></i><b>5.3.2</b> Value-weighted Returns</a></li>
<li class="chapter" data-level="5.3.3" data-path="risk-and-return.html"><a href="risk-and-return.html#timing-of-returns"><i class="fa fa-check"></i><b>5.3.3</b> Timing of Returns</a></li>
<li class="chapter" data-level="5.3.4" data-path="risk-and-return.html"><a href="risk-and-return.html#nominal-vs.-real-returns"><i class="fa fa-check"></i><b>5.3.4</b> Nominal vs. Real Returns</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="risk-and-return.html"><a href="risk-and-return.html#individual-security-risk"><i class="fa fa-check"></i><b>5.4</b> Individual Security Risk</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="risk-and-return.html"><a href="risk-and-return.html#standard-deviation-and-variance"><i class="fa fa-check"></i><b>5.4.1</b> Standard Deviation and Variance</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="risk-and-return.html"><a href="risk-and-return.html#rolling-risk-characteristics"><i class="fa fa-check"></i><b>5.5</b> Rolling Risk Characteristics</a></li>
<li class="chapter" data-level="5.6" data-path="risk-and-return.html"><a href="risk-and-return.html#portfolio-risk"><i class="fa fa-check"></i><b>5.6</b> Portfolio Risk</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="risk-and-return.html"><a href="risk-and-return.html#portfolio-risk-of-two-securities"><i class="fa fa-check"></i><b>5.6.1</b> Portfolio Risk of two securities</a></li>
<li class="chapter" data-level="5.6.2" data-path="risk-and-return.html"><a href="risk-and-return.html#portfolio-risk-for-multiple-assets"><i class="fa fa-check"></i><b>5.6.2</b> Portfolio Risk for Multiple Assets</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="risk-and-return.html"><a href="risk-and-return.html#risk-in-extremes-and-alternative-risk-measures"><i class="fa fa-check"></i><b>5.7</b> Risk in Extremes and Alternative Risk Measures</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="risk-and-return.html"><a href="risk-and-return.html#value-at-risk-var"><i class="fa fa-check"></i><b>5.7.1</b> Value at Risk (VaR)</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="risk-and-return.html"><a href="risk-and-return.html#market-efficiency-and-independence-of-risk-and-return"><i class="fa fa-check"></i><b>5.8</b> Market Efficiency and independence of risk and return</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="risk-and-return.html"><a href="risk-and-return.html#variance-ratio-test"><i class="fa fa-check"></i><b>5.8.1</b> Variance Ratio Test</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="beta.html"><a href="beta.html"><i class="fa fa-check"></i><b>6</b> Beta</a>
<ul>
<li class="chapter" data-level="6.1" data-path="beta.html"><a href="beta.html#application-of-regression-analysis-beta-analysis-in-financial-market-settings"><i class="fa fa-check"></i><b>6.1</b> Application of Regression Analysis: <span class="math inline">\(\beta\)</span> analysis in Financial Market Settings</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="beta.html"><a href="beta.html#the-single-index-model"><i class="fa fa-check"></i><b>6.1.1</b> The Single Index Model</a></li>
<li class="chapter" data-level="6.1.2" data-path="beta.html"><a href="beta.html#estimation-of-the-sim"><i class="fa fa-check"></i><b>6.1.2</b> Estimation of the SIM</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><i class="fa fa-check"></i><b>7</b> Portfolio Theory: Mean-Variance Optimisation and the CAPM</a>
<ul>
<li class="chapter" data-level="7.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#markowitz-portfolio-theory-with-two-risky-assets"><i class="fa fa-check"></i><b>7.1</b> Markowitz Portfolio Theory with two Risky Assets</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-case-of-portfolios"><i class="fa fa-check"></i><b>7.1.1</b> The case of portfolios</a></li>
<li class="chapter" data-level="7.1.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-set-of-attainable-portfolios"><i class="fa fa-check"></i><b>7.1.2</b> The set of attainable portfolios</a></li>
<li class="chapter" data-level="7.1.3" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-minimum-variance-portfolio"><i class="fa fa-check"></i><b>7.1.3</b> The Minimum-Variance Portfolio</a></li>
<li class="chapter" data-level="7.1.4" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-role-of-correlation-on-the-frontier-of-portfolios"><i class="fa fa-check"></i><b>7.1.4</b> The role of correlation on the frontier of portfolios</a></li>
<li class="chapter" data-level="7.1.5" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#efficient-portfolios-with-two-risky-assets"><i class="fa fa-check"></i><b>7.1.5</b> Efficient Portfolios with two risky assets</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#markowitz-portfolio-theory-with-a-risky-and-a-risk-free-asset"><i class="fa fa-check"></i><b>7.2</b> Markowitz Portfolio Theory with a Risky and a Risk-Free Asset</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-capital-allocation-line-cal"><i class="fa fa-check"></i><b>7.2.1</b> The Capital Allocation Line (CAL)</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#markowitz-portfolio-theory-with-two-risky-and-a-risk-free-asset"><i class="fa fa-check"></i><b>7.3</b> Markowitz Portfolio Theory with two Risky and a Risk-Free Asset</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#tangency-portfolio"><i class="fa fa-check"></i><b>7.3.1</b> Tangency Portfolio</a></li>
<li class="chapter" data-level="7.3.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#mutual-fund-theorem-and-derivation-of-the-capital-market-line-cml"><i class="fa fa-check"></i><b>7.3.2</b> Mutual Fund Theorem and Derivation of the Capital Market Line (CML)</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#markowitz-portfolio-theory-with-n-risky-assets"><i class="fa fa-check"></i><b>7.4</b> Markowitz Portfolio Theory with N Risky Assets</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-theoretical-foundations-of-n-assets"><i class="fa fa-check"></i><b>7.4.1</b> The theoretical foundations of N Assets</a></li>
<li class="chapter" data-level="7.4.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-minimum-variance-portfolio-for-n-assets"><i class="fa fa-check"></i><b>7.4.2</b> The Minimum Variance Portfolio for N assets</a></li>
<li class="chapter" data-level="7.4.3" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-efficient-frontier-for-n-assets"><i class="fa fa-check"></i><b>7.4.3</b> The Efficient Frontier for N assets</a></li>
<li class="chapter" data-level="7.4.4" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-efficient-and-feasible-portfolio-cal-of-n-risky-assets-and-a-risk-free-asset"><i class="fa fa-check"></i><b>7.4.4</b> The Efficient and Feasible Portfolio CAL of N risky Assets and a risk-free Asset</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#the-capital-asset-pricing-model"><i class="fa fa-check"></i><b>7.5</b> The Capital Asset Pricing Model</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#intuition-of-the-capm"><i class="fa fa-check"></i><b>7.5.1</b> Intuition of the CAPM</a></li>
<li class="chapter" data-level="7.5.2" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#mathematical-derivation-of-the-security-market-line-sml"><i class="fa fa-check"></i><b>7.5.2</b> Mathematical Derivation of the Security Market Line (SML)</a></li>
<li class="chapter" data-level="7.5.3" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#similarity-of-the-cml-and-sml"><i class="fa fa-check"></i><b>7.5.3</b> Similarity of the CML and SML</a></li>
<li class="chapter" data-level="7.5.4" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#diagnostic-tests-of-the-capm"><i class="fa fa-check"></i><b>7.5.4</b> Diagnostic Tests of the CAPM</a></li>
<li class="chapter" data-level="7.5.5" data-path="portfolio-theory-mean-variance-optimisation-and-the-capm.html"><a href="portfolio-theory-mean-variance-optimisation-and-the-capm.html#fama-macbeth-1973-approach"><i class="fa fa-check"></i><b>7.5.5</b> Fama-MacBeth (1973) approach</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="factor-models.html"><a href="factor-models.html"><i class="fa fa-check"></i><b>8</b> Factor Models</a>
<ul>
<li class="chapter" data-level="8.1" data-path="factor-models.html"><a href="factor-models.html#the-idea-behind-factor-models"><i class="fa fa-check"></i><b>8.1</b> The idea behind factor models</a></li>
<li class="chapter" data-level="8.2" data-path="factor-models.html"><a href="factor-models.html#the-quest-of-detecting-anomalies"><i class="fa fa-check"></i><b>8.2</b> The quest of detecting anomalies</a></li>
<li class="chapter" data-level="8.3" data-path="factor-models.html"><a href="factor-models.html#the-fama-french-three-factor-model"><i class="fa fa-check"></i><b>8.3</b> The Fama-French Three Factor Model</a></li>
<li class="chapter" data-level="8.4" data-path="factor-models.html"><a href="factor-models.html#testing-for-factor-validity"><i class="fa fa-check"></i><b>8.4</b> Testing for factor validity</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="factor-models.html"><a href="factor-models.html#portfolio-sorts"><i class="fa fa-check"></i><b>8.4.1</b> Portfolio Sorts</a></li>
<li class="chapter" data-level="8.4.2" data-path="factor-models.html"><a href="factor-models.html#factor-construction"><i class="fa fa-check"></i><b>8.4.2</b> Factor Construction</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="factor-models.html"><a href="factor-models.html#create-your-own-factors-a-step-by-step-example"><i class="fa fa-check"></i><b>8.5</b> Create your own factors: A step-by-step example</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="factor-models.html"><a href="factor-models.html#setting-up-the-wrds-proxy"><i class="fa fa-check"></i><b>8.5.1</b> Setting up the WRDS proxy</a></li>
<li class="chapter" data-level="8.5.2" data-path="factor-models.html"><a href="factor-models.html#factors-of-interest"><i class="fa fa-check"></i><b>8.5.2</b> Factors of interest</a></li>
<li class="chapter" data-level="8.5.3" data-path="factor-models.html"><a href="factor-models.html#get-the-data-to-construct-the-factors"><i class="fa fa-check"></i><b>8.5.3</b> Get the data to construct the factors</a></li>
<li class="chapter" data-level="8.5.4" data-path="factor-models.html"><a href="factor-models.html#portfolio-sorts-for-different-factors"><i class="fa fa-check"></i><b>8.5.4</b> Portfolio Sorts for different factors</a></li>
<li class="chapter" data-level="8.5.5" data-path="factor-models.html"><a href="factor-models.html#double-sorted-portfolios"><i class="fa fa-check"></i><b>8.5.5</b> Double-sorted Portfolios</a></li>
<li class="chapter" data-level="8.5.6" data-path="factor-models.html"><a href="factor-models.html#the-importance-of-data-selection"><i class="fa fa-check"></i><b>8.5.6</b> The importance of data selection</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced Empirical Finance</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="the-programming-environment" class="section level1" number="2">
<h1><span class="header-section-number">Chapter 2</span> The Programming Environment</h1>
<p>The first week covers two baseline subjects required to work within the field of empirical financial applications.</p>
<p>The first topic covers the application environment. Therein, we cover the structure and use of the R Markdown file, on which we will write all of the subjects covered during the Lab sessions. We offer a discussion as how to create a markdown file, what makes these files so special in empirical research, how to organise and shuffle them as well as their connectivity to latex. Especially, we will consider how to write functions, how to add text-based outputs, how to construct and use coding cells as well as how to render the files.</p>
<div id="markdown-files" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Markdown Files</h2>
<p>The first part of the programming environment concerns the general programming environment. Markdown files will be used as programming interface for the Exercise and Lab sessions. Within these files, the students will describe the theoretical questions and solve the empirical exercises. Furthermore, the students will write a report and present their results in Markdown files.</p>
<p>R Markdown files work as combination of R files and Latex files. That is, they enable the use of coding results and writing a report automatically. The handy feature arises in that you don’t have to copy your code output, tables or other things into a latex file in which you write your report. However, although we advise the use of a markdown file for writing reports, it is important to stress that we do not recommend writing entire papers or theses within markdown files, as the compiling burden could render mistakes within the program. As such, we are indifferent whether you decide to provide markdown or Latex files</p>
<div id="how-to-create-a-markdown-file" class="section level3" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> How to create a Markdown File</h3>
<p>To create a markdown file, you simply open your R Studio, in the side bar you click on <code>Edit</code>, then you select <code>New File</code> and <code>R Markdown...</code>. It will pop up a new window where you need to enter the title as well as the authors. After choosing appropriate names, you can select one of the options <code>HTML</code>, <code>PDF</code> or <code>Word</code> as an output window. This is the first handy feature of markdown files: They enable different outputs, meaning you can have a multitude of channels to present it in. Further note that on the left-hand side, there is a sidebar which allows you to choose other file types, such as Shiny (supporting interactive graphs) or presentation files. Although we do not cover these throughout the lecture, they offer exciting new options.</p>
<p>Although we would advise you to use PDF as output, you can also choose HTML <a href="https://rpubs.com/nikanic/798372">to see how a HTML output would look like, just click anywhere here</a>.</p>
<p>Once you choose your desired output format, you will see that a new window pops up that looks like this:</p>
<div class="figure">
<img src="Images/Markdown_First_Look.jpg" alt="" />
<p class="caption">Figure 1: Markdown First file structure</p>
</div>
<p>In order to comprehend the structure of a markdown file, it is firstly important to understand that a markdown file consists of white spaces and grey code Chunks The white spaces are used to write text, whereas the code Chunks are used to write code. Importantly, you won’t need the part below the first code block, so just delete everything from the “## R Markdown”" title on. This will leave you with only the first code block.</p>
<p>The first code block is important because there you can get your working directory set for the entire markdown session. You set your working directory in the following way</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="the-programming-environment.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># knitr::opts_knit$set(root.dir = &quot;/This/is/your/path/to/your/files/&quot;)</span></span></code></pre></div>
<p>The working directory is your source file from which R gets all data and to which R sends all outputs, by default. You can later change your working directory or the path from which files should be read / should be written to, but it is handy to define one source that can be used for most of the files.</p>
<p>Once you enter your preferred working directory, you can continue to start entering the packages you want to use. For that, add a code block by clicking on the green tool box above and select the option “R”, just as in the image below.</p>
<div class="figure">
<img src="Images/Markdown_Select_Codeblock.jpg" alt="" />
<p class="caption">Figure 1: Markdown Select R Codeblock</p>
</div>
<p>Once you have your codenblock, you can enter the packages you need to use. It is handy to define functions which either install the packages or load the packages for that:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="the-programming-environment.html#cb2-1" aria-hidden="true" tabindex="-1"></a>packs.inst <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;readxl&quot;</span>,<span class="st">&quot;foreign&quot;</span>,<span class="st">&quot;dplyr&quot;</span>,<span class="st">&quot;tidyr&quot;</span>,<span class="st">&quot;ggplot2&quot;</span>,<span class="st">&quot;stargazer&quot;</span>,<span class="st">&quot;haven&quot;</span>,<span class="st">&quot;dummies&quot;</span>,<span class="st">&quot;Hmisc&quot;</span>, <span class="st">&quot;lmtest&quot;</span>,<span class="st">&quot;sandwich&quot;</span>, <span class="st">&quot;doBy&quot;</span>, <span class="st">&quot;multiwayvcov&quot;</span>, <span class="st">&quot;miceadds&quot;</span>,  <span class="st">&quot;car&quot;</span>, <span class="st">&quot;purrr&quot;</span>, <span class="st">&quot;knitr&quot;</span>, <span class="st">&quot;zoo&quot;</span>, <span class="st">&quot;readstata13&quot;</span>, <span class="st">&quot;tidyverse&quot;</span>, <span class="st">&quot;psych&quot;</span>, <span class="st">&quot;wesanderson&quot;</span>, <span class="st">&quot;lubridate&quot;</span>,<span class="st">&quot;reporttools&quot;</span>, <span class="st">&quot;data.table&quot;</span>, <span class="st">&quot;devtools&quot;</span>, <span class="st">&quot;rmarkdown&quot;</span>,<span class="st">&quot;estimatr&quot;</span>, <span class="st">&quot;ivpack&quot;</span>, <span class="st">&quot;Jmisc&quot;</span>, <span class="st">&quot;lfe&quot;</span>, <span class="st">&quot;plm&quot;</span>, <span class="st">&quot;tinytex&quot;</span>, <span class="st">&quot;xts&quot;</span>, <span class="st">&quot;psych&quot;</span>, <span class="st">&quot;PerformanceAnalytics&quot;</span>, <span class="st">&quot;roll&quot;</span>, <span class="st">&quot;rollRegres&quot;</span>, <span class="st">&quot;glmnet&quot;</span>, <span class="st">&quot;hdm&quot;</span>, <span class="st">&quot;broom&quot;</span>, <span class="st">&quot;RCurl&quot;</span>, <span class="st">&quot;learnr&quot;</span>, <span class="st">&quot;maps&quot;</span>, <span class="st">&quot;fGarch&quot;</span>, <span class="st">&quot;remotes&quot;</span>, <span class="st">&quot;RPostgreSQL&quot;</span>, <span class="st">&quot;wrds&quot;</span>, <span class="st">&quot;DBI&quot;</span>, <span class="st">&quot;RPostgreSQL&quot;</span>, <span class="st">&quot;remotes&quot;</span>, <span class="st">&quot;RPostgres&quot;</span>)</span>
<span id="cb2-2"><a href="the-programming-environment.html#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="the-programming-environment.html#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="the-programming-environment.html#cb2-4" aria-hidden="true" tabindex="-1"></a> packs.inst <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb2-5"><a href="the-programming-environment.html#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="the-programming-environment.html#cb2-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">lapply</span>(packs.load, require, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-7"><a href="the-programming-environment.html#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="the-programming-environment.html#cb2-8" aria-hidden="true" tabindex="-1"></a> <span class="fu">lapply</span>(packs.inst, install.packages, <span class="at">character.only =</span> <span class="cn">FALSE</span>) </span></code></pre></div>
<p>The underlying idea of this code block is that you just create a list with all the packages you need to load first and assign it a name (packs.load). Then, you uncomment the first code line (# lapply(packs.inst, require, character.only = TRUE)) to load the respective packages.</p>
<p>However, it might be the case that you did not yet install all of the necessary packages. In that case, just take all the packages you did not yet install and add them to the list called packs.inst. Then, uncomment the second code line (lapply(packs.inst, install.packages, character.only = FALSE)) and run that code.</p>
<p>The idea behind the code block is that you apply the install.packages or require command for a list of packages, instead of manually installing or loading each of them. Although these are more packages than needed for the firs sessions, it still is handy to have an overview and automate a rather cumbersome procedure.</p>
</div>
<div id="the-r-markdown-structure" class="section level3" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> The R Markdown Structure</h3>
<p>We just have created the markdown file. Now it comes to understanding how to work on this thing. For that, we first need to understand the underlying structure.</p>
<p>In general, R Markdown files are comprised of two parts: White Spaces and Grey Code Chunks</p>
<p>White spaces are the spaces you are currently reading this text. They serve as string-based Chunks, meaning that you can write human language based sentences within these cells. As such, these white spaces serve as areas for writing results of reports, explanations, formulas or in general everything that has no code-based output at the end.</p>
<p>Opposed to this, Code Chunk serve as fields in which you write your actual code. The two boxes we just added before are coding boxes. To use them, just follow th approach I described earlier. Code Chunks incorporate many nice features, which we will cover next.</p>
<div id="the-use-of-code-chunks" class="section level4" number="2.1.2.1">
<h4><span class="header-section-number">2.1.2.1</span> The use of Code Chunks</h4>
<p>Code Chunks incorporate a number of handy features that can be defined quite easily. To set certain code chunk properties, we make use of the packages <code>knitr</code>. Maybe you realised this already, we used this package before to define the working directory source. Knitr, in general, is used to handle most of the R syntax and background, or administrative, tasks, R needs to do in order to operate.</p>
<p>To set code chunk options, we just access the <code>{r}</code> field in the top row of each code chunk.</p>
<p>Markdown offers quite a range of potential options to include, so make sure <a href="https://yihui.org/knitr/options/">to check them out on this link</a>.</p>
<p>In general, the most used settings involve the following:</p>
<ul>
<li><code>eval = FALSE</code>: Do not evaluate (or run) this code chunk when knitting the RMD document. The code in this chunk will still render in our knitted <code>html</code></li>
<li><code>echo = FALSE</code>: Hide the code in the output. The code is evaluated when the Rmd file is knit, however only the output is rendered on the output document.</li>
<li><code>results = hide</code>: The code chunk will be evaluated but the results or the code will not be rendered on the output document. This is useful if you are viewing the structure of a large object (e.g. outputs of a large data.frame which is the equivalent of a spreadsheet in R).</li>
<li><code>include = FALSE</code>: runs the code, but doesn’t show the code or results in the final document. Use this for setup code that you don’t want cluttering your report.</li>
<li><code>message = FALSE</code> or <code>warnings = FALSE</code>: prevents messages or warnings from appearing in the finished file</li>
<li><code>error = TRUE</code>: causes the render to continue even if code returns an error. This is rarely something you’ll want to include in the final version of your report, but can be very useful if you need to debug exactly what is going on inside your Rmd.</li>
<li><code>tidy = TRUE</code>: tidy code for display</li>
<li><code>cache = TRUE</code>: When the cache is turned on, knitr will skip the execution of this code chunk if it has been executed before and nothing in the code chunk has changed since then. This is useful if you have very time-consuming codes. These would then be skipped if they haven’t been changed since the last rendering.</li>
<li><code>comment=""</code>: By default, R code output will have two hashes ## inserted in front of the text output. We can alter this behavior through the comment chunk option by e.g. stating an empty space.</li>
</ul>
<p>Furthermore, we can use specific options for figures to include in the files:</p>
<ul>
<li><code>fig.width =</code>: Defines the figure width in the chunk</li>
<li><code>fig.height =</code>: Defines the figure height in the chunk</li>
<li><code>fig.align =</code>: Defines the alignment of the figure (left, center, right)</li>
<li><code>fig.cap =</code>; Defines the caption of the figure</li>
</ul>
</div>
<div id="the-use-of-white-spaces" class="section level4" number="2.1.2.2">
<h4><span class="header-section-number">2.1.2.2</span> The use of White Spaces</h4>
<p>White spaces are commonly used to define the text we write in a markdown file. Markdown white spaces have the handy feature that they follow the same syntax as Latex files. Consequently, it is very easy to write formulas, expressions, definitions or other features commonly used in Latex based tools or applications. However, since this is not a drag-and-drop interface, commonly used ways of working in other programs, such as Microsoft Word, do not work here. But since we are working within an academic setting, we should definitively foster the use of non Latex-based writing.</p>
<p>We also call the white space writing Pandoc’s Markdown. The most important features of it are the following:</p>
<p><em>Structure of an Rmd File</em></p>
<p>To structure different markdown files, we need to define headers that indicate in which part of the file we currently are. We define headers by using the <code>#</code> sign. We have, in total, six headers available, that increase in specification with increasing amount of <code>#</code>:</p>
<ul>
<li><code>#</code>: Header 1</li>
<li><code>##</code>: Header 2</li>
<li><code>###</code>: Header 3</li>
<li><code>####</code>: Header 4</li>
<li><code>#####</code>: Header 5</li>
<li><code>######</code>: Header 6</li>
</ul>
<p><em>Different Font Styles</em></p>
<p>In general, we use three different styles to design the font:</p>
<ul>
<li><code>textbf{}</code> or <code>** **</code>: This is to indicate a bold text (write either in brackets or between the arcteryx)</li>
<li><code>textit{}</code> or <code>* *</code>: This is to indicate an italic text</li>
<li><code>underline{}</code>: This is to indicate an underlined text</li>
<li><code>verbatim</code>: This is to indicate the verbatim text - it is a text in this grey box which is more strongly visible</li>
</ul>
<p><em>Numbering and Lists</em></p>
<p>We can define lists with several properties:</p>
<ul>
<li><p><code>*</code>: This will render an item in an unordered list</p></li>
<li><p><code>+</code>: This will render a sub-item in an unordered list</p></li>
<li><p><code>-</code>: This will render a sub-sub-item in an unordered list</p></li>
<li><p><code>1.</code>: This will render an item in an ordered list</p></li>
<li><p><code>i)</code>: This will render a sub-item in an ordered list</p></li>
<li><p><code>A.</code>: This will render a sub-sub-item in an ordered list</p></li>
</ul>
<p><em>Jumping and Linking</em></p>
<ul>
<li><code>[link](name)</code>: This will render a link to a specific URL code</li>
<li><code>Jump to [Header 1](#anchor)</code>: This will jump to a certain part in the Rmd. In this case, Header 1</li>
</ul>
<p><em>Images and how to include them</em></p>
<p><code>![Caption](File/to/png/file)</code>: This will include the image from a given file path on your computer and add a caption</p>
<p><span class="math inline">\(\textbf{Showing output in markdown file}\)</span></p>
<ul>
<li><code>$$  $$</code>: This forms a code block in which math mode or other modes can be used (just like with latex). Neatly, the output is shown immediately</li>
<li><code>$ $</code>: This is the same as the double-dollar-sign, but you can use it in a sentence just to write some mathematical notion in a string-based text</li>
</ul>
<p><em>Mathematical Symbols</em></p>
<p>Rmd offers a great range of different mathematical symbols and equations. They follow the same syntax as in latex files. To get a good overview, <a href="https://www.caam.rice.edu/~heinken/latex/symbols.pdf">just visit the following link</a>.</p>
<p>Importantly, if you want to use lower- or upper subscripted letters, such as in mathematical notations, you need to use <code>x_t</code> or <code>x^t</code> to do so. Note that, if you have more than one letter or one mathematical symbol, these subscripts must always be in <code>{}</code>. That is: <code>x_{t,p}</code> or <code>x^{t,p}</code>.</p>
<p><em>Equations</em></p>
<p>To create equations, we simply use the following syntaxes:</p>
<p>If we only want to use an easy mathematical equation, we can use the following:</p>
<p><span class="math display">\[
p(x) = \sum_{w_i \in E} p_i
\]</span></p>
<p>If we want to use more complex mathematical symbols, we need to use the <code>\begin{equation} ... \end{equation}</code> command:</p>
<p><span class="math display">\[
\begin{equation}
\textbf{C} = 
\left(
\begin{matrix}
1 &amp; \rho_{12} &amp; \dots &amp; \rho_{1n} \\
\rho_{12} &amp; 1 &amp; \dots &amp; \rho_{2n} \\
\vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
\rho_{1n} &amp; \rho_{2n} &amp; \dots &amp; 1
\end{matrix}
\right)
\end{equation}
\]</span></p>
<p>Lastly, if we have proofs to write or want an order to show many calculation steps within a formula, then we need to use the <code>\begin{align} ... \end{align}</code> command:</p>
<p><span class="math display">\[
\begin{align}
var(aX + bY) &amp;= E[(aX + bY - E[aX]E[bY])^2]\\
&amp;= E[((aX - E(aX)) + (bY - E(bY)))^2] \\
&amp;= E[(a(X-E(X)) + b(Y-E(Y)))^2] \\
&amp;= a^2E[X-E(X)]^2 + b^2(Y-E(Y))^2 + 2 ab(X-E(X))(Y-E(Y))\\
&amp;= a^2\cdot var(X) + b^2\cdot var(Y) + 2\cdot a \cdot b \cdot cov(X,Y)
\end{align}
\]</span></p>
</div>
</div>
</div>
<div id="coding-in-r---a-concise-overview" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Coding In R - A concise overview</h2>
<p>Now that we understand the most important concepts of creating and maintaining the programming environment, it is now time to actually start programming. While we are doing this in this file, I want to emphasize that much of the content is taken by Derek L. Sonderegger, who <a href="https://dereksonderegger.github.io/570L/index.html">created an awesome bookdown book in which he explains the most important first steps of using R very concisely</a>.</p>
<p>We will cover most of what he’s written in this Markdown. But, if you have any further questions, you can also stick to his files. Note that we do not expect you to understand everything that is written here. However, it should serve as a guideline to show you what is all available for R and what you could use R for. Furthermore, we will introduce some of the most important concepts of his work within our own domain.</p>
<div id="introduction" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Introduction</h3>
<p>In the first chapter, we cover the basics of R. R is a open-source program that is commonly used in Statistics. It runs on almost every platform and is completely free and is available at www.r-project.org. Most of the cutting-edge statistical research is first available on R.</p>
<p>Finding help about a certain function is very easy. At the prompt, just type <code>help(function.name)</code> or <code>?function.name</code>. If you don’t know the name of the function, your best bet is to go the the web page  which will search various R resources for your keyword(s). Another great resource is the coding question and answer site stackoverflow.</p>
</div>
<div id="vectors" class="section level3" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Vectors</h3>
<div id="creating-vectors" class="section level4" number="2.2.2.1">
<h4><span class="header-section-number">2.2.2.1</span> Creating Vectors</h4>
<p>R operates on vectors where we think of a vector as a collection of objects, usually numbers. In R, we can define vectors with <strong>three</strong> functions.</p>
<p><strong>Arbitrary Vectors</strong></p>
<p>The first thing we need to be able to do is define an arbitrary collection using the <code>c()</code> function.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="the-programming-environment.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a vector of numbers: </span></span>
<span id="cb3-2"><a href="the-programming-environment.html#cb3-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>)</span>
<span id="cb3-3"><a href="the-programming-environment.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(a)</span></code></pre></div>
<pre><code>##  num [1:4] 1 2 3 4</code></pre>
<p>An important feature of vector creation is that we can repeat certain entries multiple times to get a vector of only those entries (instead of manually typing in the same number n times). We can do so by using the function <code>rep(x, times)</code>, which just repeats x a the number times specified by times:</p>
<p><strong>Vectors with repeating elements</strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="the-programming-environment.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This repeats 2 and 3 five times</span></span>
<span id="cb5-2"><a href="the-programming-environment.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>), <span class="dv">5</span>)</span></code></pre></div>
<pre><code>##  [1] 2 3 2 3 2 3 2 3 2 3</code></pre>
<p><strong>Vectors with a sequence</strong></p>
<p>If we want to define a sequence of numbers, we can do so by using the function <code>seq(from, to, by, length.out)</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="the-programming-environment.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a sequence from 1 to 10 but only take each second element:</span></span>
<span id="cb7-2"><a href="the-programming-environment.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">seq</span>(<span class="at">from=</span><span class="dv">1</span>, <span class="at">to=</span><span class="dv">10</span>, <span class="at">by=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 1 3 5 7 9</code></pre>
<p>The <code>by =</code> argument is especially handy here, since it allows us to draw any arbitrary sequence.</p>
</div>
<div id="accessing-vector-elements" class="section level4" number="2.2.2.2">
<h4><span class="header-section-number">2.2.2.2</span> Accessing Vector Elements</h4>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="the-programming-environment.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We create a vector first:</span></span>
<span id="cb9-2"><a href="the-programming-environment.html#cb9-2" aria-hidden="true" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">8</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">9</span>)</span></code></pre></div>
<p><strong>Accessing Single Elements</strong></p>
<p>We can access elements of vectors by calling a squared bracket around the vector item <code>[]</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="the-programming-environment.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the 3rd element</span></span>
<span id="cb10-2"><a href="the-programming-environment.html#cb10-2" aria-hidden="true" tabindex="-1"></a>vec[<span class="dv">3</span>]</span></code></pre></div>
<pre><code>## [1] 8</code></pre>
<p><strong>Accessing Multiple Elements</strong></p>
<p>As before, we can access multiple elements by using the <code>c()</code> function in the squared brackets</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="the-programming-environment.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the second and fourth element</span></span>
<span id="cb12-2"><a href="the-programming-environment.html#cb12-2" aria-hidden="true" tabindex="-1"></a>vec[<span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>)]</span></code></pre></div>
<pre><code>## [1] 3 5</code></pre>
<p><strong>Special Accessing</strong></p>
<p>If we only want to get a sequence, we do so with <code>:</code>.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="the-programming-environment.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get elements 1 to 3</span></span>
<span id="cb14-2"><a href="the-programming-environment.html#cb14-2" aria-hidden="true" tabindex="-1"></a>vec[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span></code></pre></div>
<pre><code>## [1] 1 3 8</code></pre>
<p>If we want to get a sequence, we do so by using <code>:</code> as well as a comma separating the non-sequential gap.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="the-programming-environment.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get elements 1 to 3 and 5. </span></span>
<span id="cb16-2"><a href="the-programming-environment.html#cb16-2" aria-hidden="true" tabindex="-1"></a>vec[<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">5</span>)]</span></code></pre></div>
<pre><code>## [1] 1 3 8 1</code></pre>
<p>If we want everything but the first element, we use a <code>-</code> sign.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="the-programming-environment.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get everything except the first element</span></span>
<span id="cb18-2"><a href="the-programming-environment.html#cb18-2" aria-hidden="true" tabindex="-1"></a>vec[<span class="sc">-</span><span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] 3 8 5 1 9</code></pre>
<p>If we want everything except the first i elements, we use <code>-1*c(1,i)</code>.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="the-programming-environment.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get everything except the first three elements and the fifth element</span></span>
<span id="cb20-2"><a href="the-programming-environment.html#cb20-2" aria-hidden="true" tabindex="-1"></a>vec[<span class="sc">-</span><span class="dv">1</span><span class="sc">*</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">5</span>)]</span></code></pre></div>
<pre><code>## [1] 5 9</code></pre>
</div>
<div id="scalar-functions-and-vector-algebra" class="section level4" number="2.2.2.3">
<h4><span class="header-section-number">2.2.2.3</span> Scalar Functions and Vector Algebra</h4>
<p>We can perform operations on all elements of a vector simultaneously. These operations could be additive, multiplicative, exponentially, logarithmic, absolute etc. Pretty much any calculation you know from mathematics can be done using vectors. Although we introduce to you vector operations in Chapter 3.2.1 and 3.2.2 expect you to go over it yourself, let’s give you a quick introduction what we mean by working on vectors:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="the-programming-environment.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a vector</span></span>
<span id="cb22-2"><a href="the-programming-environment.html#cb22-2" aria-hidden="true" tabindex="-1"></a>x_vec <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">2</span>)</span>
<span id="cb22-3"><a href="the-programming-environment.html#cb22-3" aria-hidden="true" tabindex="-1"></a>x_vec</span></code></pre></div>
<pre><code>##  [1] -10  -8  -6  -4  -2   0   2   4   6   8  10</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="the-programming-environment.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the absolute values</span></span>
<span id="cb24-2"><a href="the-programming-environment.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abs</span>(x_vec) </span></code></pre></div>
<pre><code>##  [1] 10  8  6  4  2  0  2  4  6  8 10</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="the-programming-environment.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get divided by two values</span></span>
<span id="cb26-2"><a href="the-programming-environment.html#cb26-2" aria-hidden="true" tabindex="-1"></a>x_vec<span class="sc">/</span><span class="dv">2</span></span></code></pre></div>
<pre><code>##  [1] -5 -4 -3 -2 -1  0  1  2  3  4  5</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="the-programming-environment.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get exponential values</span></span>
<span id="cb28-2"><a href="the-programming-environment.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(x_vec)</span></code></pre></div>
<pre><code>##  [1] 4.539993e-05 3.354626e-04 2.478752e-03 1.831564e-02 1.353353e-01 1.000000e+00 7.389056e+00 5.459815e+01 4.034288e+02 2.980958e+03 2.202647e+04</code></pre>
<p>Furthermore, we can use vector algebra such as we can use matrix algebra in R.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="the-programming-environment.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define another vector </span></span>
<span id="cb30-2"><a href="the-programming-environment.html#cb30-2" aria-hidden="true" tabindex="-1"></a>y_vec <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">1</span>)</span>
<span id="cb30-3"><a href="the-programming-environment.html#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="the-programming-environment.html#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use vector additivity</span></span>
<span id="cb30-5"><a href="the-programming-environment.html#cb30-5" aria-hidden="true" tabindex="-1"></a>x_vec <span class="sc">+</span> y_vec</span></code></pre></div>
<pre><code>##  [1]  0  3  6  9 12 15 18 21 24 27 30</code></pre>
<p><strong>Commonly used Vector functions</strong></p>
<p>There are some commonly used vector functions:</p>
<pre><code>##   Vector Function                             Description
## 1          min(x)               Minimum value in vector x
## 2          max(x)               Maximum value in vector x
## 3       length(x)          Number of elements in vector x
## 4          sum(x)     Sum of all the elements in vector x
## 5         mean(x)        Mean of the elements in vector x
## 6       median(x)      Median of the elements in vector x
## 7          var(x)    Variance of the elements in vector x
## 8           sd(x) Standard deviation of the elements in x</code></pre>
</div>
</div>
<div id="data-types" class="section level3" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Data Types</h3>
<p>R operates with five major data types: Integers, Numerics, Character Strings, Factors and Logicals.</p>
<p><strong>Integers</strong></p>
<p>These are the integer numbers. That is, they can only be <strong>full numbers</strong> without any decimal point. To convert a number to an integer, you use <code>as.integer()</code>.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="the-programming-environment.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform to integer</span></span>
<span id="cb33-2"><a href="the-programming-environment.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.integer</span>(<span class="fl">1.233</span>)</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p><strong>Numerics</strong></p>
<p>These could be any number (whole number or decimal). To convert another type to numeric you may use the function <code>as.numeric()</code>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="the-programming-environment.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="fl">1.20</span>)</span></code></pre></div>
<pre><code>## [1] 1.2</code></pre>
<p><strong>Strings</strong></p>
<p>These are a collection of characters (example: Storing a student’s last name). To convert another type to a string, use <code>as.character()</code>.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="the-programming-environment.html#cb37-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="st">&quot;Hello World&quot;</span></span>
<span id="cb37-2"><a href="the-programming-environment.html#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="the-programming-environment.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="fu">as.character</span>(x)</span></code></pre></div>
<pre><code>## [1] &quot;Hello World&quot;</code></pre>
<p><strong>Factors</strong></p>
<p>R handles categorical variables in terms of factors. R does this in a two step pattern. First it figures out how many categories there are and remembers which category an observation belongs two and second, it keeps a vector character strings that correspond to the names of each of the categories. This is done with the function <code>factor()</code>.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="the-programming-environment.html#cb39-1" aria-hidden="true" tabindex="-1"></a>z_vec <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;D&quot;</span>), <span class="dv">4</span>)</span>
<span id="cb39-2"><a href="the-programming-environment.html#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">factor</span>(z_vec)</span></code></pre></div>
<pre><code>##  [1] A B D A B D A B D A B D
## Levels: A B D</code></pre>
<p>Often we wish to take a continuous numerical vector and transform it into a factor. The function <code>cut()</code> takes a vector of numerical data and creates a factor based on your give cut-points.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="the-programming-environment.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Divide x_vec into four groups of equal length:</span></span>
<span id="cb41-2"><a href="the-programming-environment.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cut</span>(x_vec, <span class="at">breaks=</span><span class="dv">4</span>)</span></code></pre></div>
<pre><code>##  [1] (-10,-5] (-10,-5] (-10,-5] (-5,0]   (-5,0]   (-5,0]   (0,5]    (0,5]    (5,10]   (5,10]   (5,10]  
## Levels: (-10,-5] (-5,0] (0,5] (5,10]</code></pre>
<p>We can also set the break points individually</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="the-programming-environment.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set breaks individually</span></span>
<span id="cb43-2"><a href="the-programming-environment.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cut</span>(x_vec, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">0</span>, <span class="fl">2.5</span>, <span class="fl">5.0</span>, <span class="fl">7.5</span>, <span class="dv">10</span>))</span></code></pre></div>
<pre><code>##  [1] &lt;NA&gt;     (-10,0]  (-10,0]  (-10,0]  (-10,0]  (-10,0]  (0,2.5]  (2.5,5]  (5,7.5]  (7.5,10] (7.5,10]
## Levels: (-10,0] (0,2.5] (2.5,5] (5,7.5] (7.5,10]</code></pre>
<p><strong>Logicals</strong></p>
<p>We can test vector levels in R. This is useful if we need to make a comparison and test if something is equal to something else, or if one thing is bigger than another. To test these, we will use the <code>&lt;</code>, <code>&lt;=</code> <code>==</code>, <code>&gt;=</code>, <code>&gt;</code>, and <code>!=</code> operators.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="the-programming-environment.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># See which values are larger than or equal to zero</span></span>
<span id="cb45-2"><a href="the-programming-environment.html#cb45-2" aria-hidden="true" tabindex="-1"></a>x_vec <span class="sc">&gt;=</span> <span class="dv">0</span></span></code></pre></div>
<pre><code>##  [1] FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="the-programming-environment.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># which vector elements are &gt; 0</span></span>
<span id="cb47-2"><a href="the-programming-environment.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(x_vec <span class="sc">&gt;</span> <span class="dv">0</span>)  </span></code></pre></div>
<pre><code>## [1]  7  8  9 10 11</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="the-programming-environment.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grab these</span></span>
<span id="cb49-2"><a href="the-programming-environment.html#cb49-2" aria-hidden="true" tabindex="-1"></a>x_vec[<span class="fu">which</span>(x_vec <span class="sc">&gt;</span> <span class="dv">0</span>)]</span></code></pre></div>
<pre><code>## [1]  2  4  6  8 10</code></pre>
<p>In order to make <strong>multiple comparisons</strong> we use the <code>&amp;</code> = <code>and</code> as well as <code>|</code> = <code>or</code> signs.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="the-programming-environment.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s make an and comparison:</span></span>
<span id="cb51-2"><a href="the-programming-environment.html#cb51-2" aria-hidden="true" tabindex="-1"></a>x_vec[<span class="fu">which</span>(x_vec <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> y_vec <span class="sc">&gt;</span> <span class="dv">5</span>)]</span></code></pre></div>
<pre><code>## [1]  2  4  6  8 10</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="the-programming-environment.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s make an or comparison:</span></span>
<span id="cb53-2"><a href="the-programming-environment.html#cb53-2" aria-hidden="true" tabindex="-1"></a>x_vec[<span class="fu">which</span>(x_vec <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">|</span> y_vec <span class="sc">&gt;</span> <span class="dv">5</span>)]</span></code></pre></div>
<pre><code>##  [1] -10  -8  -6  -4  -2   0   2   4   6   8  10</code></pre>
</div>
<div id="data-frames" class="section level3" number="2.2.4">
<h3><span class="header-section-number">2.2.4</span> Data Frames</h3>
<p>Data Frames are the most common tool to display matrices within R. To generalize our concept of a matrix to include these types of data, R incorporates a structure called a <code>data.frame</code>. These are like simple Excel spreadsheet where each column represents a different trait or measurement type and each row will represent an individual. For instance, we create a data frame object like this:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="the-programming-environment.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a data frame object </span></span>
<span id="cb55-2"><a href="the-programming-environment.html#cb55-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb55-3"><a href="the-programming-environment.html#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Type =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>),</span>
<span id="cb55-4"><a href="the-programming-environment.html#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Solution =</span> <span class="fu">c</span>(<span class="st">&quot;9&quot;</span>, <span class="st">&quot;10&quot;</span>, <span class="st">&quot;4&quot;</span>)</span>
<span id="cb55-5"><a href="the-programming-environment.html#cb55-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-6"><a href="the-programming-environment.html#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="the-programming-environment.html#cb55-7" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>##   Type Solution
## 1    A        9
## 2    B       10
## 3    C        4</code></pre>
<p>If we already have vectors that we may want to combine to a data frame, we can also create data frames by using the functions <code>cbind()</code> and <code>rbind()</code>. cbind binds <strong>vectors into columns</strong> and rbind binds <strong>vectors into rows</strong>.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="the-programming-environment.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s create a matrix and corresponding data frame with cbind()</span></span>
<span id="cb57-2"><a href="the-programming-environment.html#cb57-2" aria-hidden="true" tabindex="-1"></a>column_bind <span class="ot">&lt;-</span> <span class="fu">cbind</span>(x_vec, y_vec)</span>
<span id="cb57-3"><a href="the-programming-environment.html#cb57-3" aria-hidden="true" tabindex="-1"></a>df_cb <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(column_bind)</span>
<span id="cb57-4"><a href="the-programming-environment.html#cb57-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-5"><a href="the-programming-environment.html#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s change the column names: </span></span>
<span id="cb57-6"><a href="the-programming-environment.html#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df_cb) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;X Vector&quot;</span>, <span class="st">&quot;Y Vector&quot;</span>)</span>
<span id="cb57-7"><a href="the-programming-environment.html#cb57-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-8"><a href="the-programming-environment.html#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print it: </span></span>
<span id="cb57-9"><a href="the-programming-environment.html#cb57-9" aria-hidden="true" tabindex="-1"></a>df_cb</span></code></pre></div>
<pre><code>##    X Vector Y Vector
## 1       -10       10
## 2        -8       11
## 3        -6       12
## 4        -4       13
## 5        -2       14
## 6         0       15
## 7         2       16
## 8         4       17
## 9         6       18
## 10        8       19
## 11       10       20</code></pre>
<p>Because a data frame feels like a matrix, R also allows matrix notation for <strong>accessing particular values</strong>.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="the-programming-environment.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s grab the first row and column element:</span></span>
<span id="cb59-2"><a href="the-programming-environment.html#cb59-2" aria-hidden="true" tabindex="-1"></a>df_cb[<span class="dv">1</span>,<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## [1] -10</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="the-programming-environment.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grab all elements from the first column</span></span>
<span id="cb61-2"><a href="the-programming-environment.html#cb61-2" aria-hidden="true" tabindex="-1"></a>df_cb[,<span class="dv">1</span>]</span></code></pre></div>
<pre><code>##  [1] -10  -8  -6  -4  -2   0   2   4   6   8  10</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="the-programming-environment.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grab all elements except for the first three and fifth row </span></span>
<span id="cb63-2"><a href="the-programming-environment.html#cb63-2" aria-hidden="true" tabindex="-1"></a>df_cb[<span class="sc">-</span><span class="dv">1</span><span class="sc">*</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">5</span>),]</span></code></pre></div>
<pre><code>##    X Vector Y Vector
## 4        -4       13
## 6         0       15
## 7         2       16
## 8         4       17
## 9         6       18
## 10        8       19
## 11       10       20</code></pre>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="the-programming-environment.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Grab all elements of the second column except for the first three and fifth row </span></span>
<span id="cb65-2"><a href="the-programming-environment.html#cb65-2" aria-hidden="true" tabindex="-1"></a>df_cb[<span class="sc">-</span><span class="dv">1</span><span class="sc">*</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">5</span>), <span class="dv">2</span>]</span></code></pre></div>
<pre><code>## [1] 13 15 16 17 18 19 20</code></pre>
<p>Note that we need to adjust the access formula by <strong>separating rows and columns with a comma (“,”)</strong>. In front of the coma, we define options for rows, and behind for columns.</p>
<p>Although data frames are just generalised matrices, we still cover the underlying principles of matrices in Chapter 3.2 and expect you to understand this on your own.</p>
</div>
<div id="importing-data" class="section level3" number="2.2.5">
<h3><span class="header-section-number">2.2.5</span> Importing Data</h3>
<p>Now that we know more about how to handle data, we need to understand how to actually read in the data into R. It is most common for data to be in a data-frame like storage, such as a MS Excel workbook, so we will concentrate on reading data into a data.frame.</p>
<div id="working-directory" class="section level4" number="2.2.5.1">
<h4><span class="header-section-number">2.2.5.1</span> Working Directory</h4>
<p>As we have already discussed, the Working Directory is the source in which R will look for files that you need to upload. As we already covered, you can set a global working directory in R Markdown in the first grey code chunk that appears when opening a new file, with the command <code>knitr::opts_knit$set(root.dir = "/This/is/your/path/to/your/files/")</code>.</p>
<p>To see where your working directory currently is, use the function <code>getwd()</code>.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="the-programming-environment.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getwd</span>()</span></code></pre></div>
<pre><code>## [1] &quot;/Users/nikolasanic/Desktop/Advanced_Empirical_Finance_UZH_2022&quot;</code></pre>
<p>If you need to temporarily adjust your working directory, you can do so by defining it new for any given code chunk. That is, you can define your new working directory when calling an individual path to the files you want to upload instead of taking the given path.</p>
<p>For instance, if I want to just upload a csv file called first_return from the usual working directory, I do so by calling: <code>read_csv("first_return.csv")</code>.</p>
<p>However, if I need to get it from another source (let’s say from the folder “Empirical Codes”), I need to enter: <code>read_csv("~/Desktop/Empirical_Codes/first_return.csv")</code>.</p>
<p>As such, we need to define the source path which otherwise would automatically be assumed by R to be the given working directory.</p>
</div>
<div id="reading-in-data" class="section level4" number="2.2.5.2">
<h4><span class="header-section-number">2.2.5.2</span> Reading in Data</h4>
<p>In order to read in the data, we need to understand the <code>data path</code>, the <code>data type</code> as well as the <code>separation properties</code> of the data and the general <code>structure of columns and rows</code>. In general, this gives us three questions:</p>
<ul>
<li>What is the path of the data (is it on your laptop or external)?</li>
<li>What is the separation character of the data (comma, semicolon etc.)?</li>
<li>Is the first row column names or already data to work on?</li>
</ul>
<p><strong>Common data formats</strong></p>
<p>The most common data formats that you will encounter are text, csv and Stata files. You read in text and csv files by calling the function <code>read_csv()</code>, and stata files by calling <code>read_dta13()</code>.</p>
<p>Both reading functions have certain attributes you need to specify:</p>
<pre><code>##     Argument
## 1       file
## 2     header
## 3        sep
## 4       skip
## 5 na.strings
##                                                                                                                                 Description
## 1                                                                                             A character string denoting the file location
## 2                                                                                                         Is the first line column headers?
## 3                                                                                                          What character separates columns
## 4 The number of lines to skip before reading data. This is useful when there are lines of text that describe the data or aren’t actual data
## 5                                                                What values represent missing data. Can have multiple. E.g. c(&#39;NA&#39;, -9999)</code></pre>
<p>Let’s now read in some data:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="the-programming-environment.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We read in some dataset with </span></span>
<span id="cb70-2"><a href="the-programming-environment.html#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">read.csv</span>(<span class="st">&quot;~/Desktop/Master UZH/Data/A1_dataset_01.txt&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>,  <span class="at">dec =</span> <span class="st">&#39;.&#39;</span>)</span></code></pre></div>
<pre><code>##          Date    ABB Actelion  Adecco Alcon Alusuisse Baloise Ciba_SC Ciba_Geigy_I Ciba_Geigy_PS Clariant Compagnie_Financiere_Richemont
## 1  1988-06-30  5.294       NA 155.845    NA        NA      NA      NA       668.55        305.75       NA                             NA
## 2  1988-07-29  4.982       NA 157.232    NA        NA      NA      NA       649.82        301.81       NA                             NA
## 3  1988-08-31  5.049       NA 162.319    NA        NA      NA      NA       648.83        315.62       NA                             NA
## 4  1988-09-30  5.527       NA 171.476    NA        NA      NA      NA       668.55        327.45       NA                             NA
## 5  1988-10-31  5.928       NA 175.730    NA        NA      NA      NA       685.31        353.10       NA                             NA
## 6  1988-11-30  6.161       NA 171.080    NA        NA      NA      NA       534.45        398.47       NA                             NA
## 7  1988-12-30  6.117       NA 168.004    NA        NA      NA      NA       521.63        418.19       NA                             NA
## 8  1989-01-31  6.473       NA 153.299    NA        NA      NA      NA       595.58        441.86       NA                             NA
## 9  1989-02-28  6.539       NA 149.935    NA        NA      NA      NA       621.22        507.95       NA                             NA
## 10 1989-03-31  7.162       NA 146.475    NA        NA      NA      NA       685.31        559.24       NA                             NA
## 11 1989-04-28  7.763       NA 158.777    NA        NA      NA      NA       694.19        579.95       NA                             NA
## 12 1989-05-31  8.386       NA 154.741    NA        NA      NA      NA       702.08        542.47       NA                             NA
## 13 1989-06-30  9.609       NA 160.988    NA        NA      NA      NA       767.16        638.14       NA                             NA
## 14 1989-07-31  9.553       NA 163.391    NA        NA      NA      NA       828.29        645.04       NA                             NA
## 15 1989-08-31 10.899       NA 170.119    NA        NA      NA      NA       888.44        694.36       NA                             NA
##    Credit_Suisse_Group Credit_Suisse_Holding Elektrowatt EMS_Chemie_Holding Geberit Georg_Fischer Givaudan Holcim Jacobs_Suchard Julius_Baer_Group
## 1                   NA                 76.45      296.70                 NA      NA            NA       NA  98.75           7890                NA
## 2                   NA                 77.05      294.23                 NA      NA            NA       NA  97.82           7700                NA
## 3                   NA                 75.54      286.81                 NA      NA            NA       NA  97.36           7500                NA
## 4                   NA                 80.83      279.89                 NA      NA       184.400       NA  98.29           7750                NA
## 5                   NA                 87.03      292.75                 NA      NA       179.771       NA  99.77           7680                NA
## 6                   NA                 81.28      274.94                 NA      NA       169.741       NA  95.04           6850                NA
## 7                   NA                 81.59      281.87                 NA      NA       189.030       NA  95.04           6815                NA
## 8                   NA                 84.46      291.76                 NA      NA       196.745       NA  94.11           7175                NA
## 9                   NA                 80.38      286.81                 NA      NA       208.318       NA  93.19           7260                NA
## 10                  NA                 87.48      288.79                 NA      NA       223.749       NA  94.02           7300                NA
## 11                  NA                 87.09      288.79                 NA      NA       216.034       NA  98.29           7370                NA
## 12                  NA                 82.58      274.94                 NA      NA       217.577       NA 104.78           6860                NA
## 13                  NA                 84.33      293.73                 NA      NA       243.038       NA 113.12           7025                NA
## 14                  NA                 96.75      308.57                 NA      NA            NA       NA 111.08           7330                NA
## 15                  NA                 98.32      301.65                 NA      NA            NA       NA 109.41           7490                NA
##    Kudelski LafargeHolcim Lonza_Group Merck_Serono Nestle_I Nestle_PS Nobel_Biocare_Holding Novartis_I Novartis_N OC_Oerlikon_Corporation
## 1        NA            NA          NA           NA   834.87     4.103                    NA         NA         NA                  17.294
## 2        NA            NA          NA           NA   817.19     4.006                    NA         NA         NA                  16.325
## 3        NA            NA          NA           NA   816.69     4.123                    NA         NA         NA                  19.715
## 4        NA            NA          NA           NA   859.42     4.133                    NA         NA         NA                  21.444
## 5        NA            NA          NA           NA   873.17     4.264                    NA         NA         NA                  20.960
## 6        NA            NA          NA           NA   675.26     5.829                    NA         NA         NA                  21.790
## 7        NA            NA          NA           NA   711.11     6.521                    NA         NA         NA                  25.456
## 8        NA            NA          NA           NA   721.91     6.618                    NA         NA         NA                  26.771
## 9        NA            NA          NA           NA   690.48     6.233                    NA         NA         NA                  25.595
## 10       NA            NA          NA           NA   715.04     6.452                    NA         NA         NA                  28.293
## 11       NA            NA          NA           NA   740.57     6.560                    NA         NA         NA                  27.324
## 12       NA            NA          NA           NA   697.36     6.209                    NA         NA         NA                  26.840
## 13       NA            NA          NA           NA   786.00     7.260                    NA         NA         NA                  27.808
## 14       NA            NA          NA           NA   839.00     8.002                    NA         NA         NA                  28.846
## 15       NA            NA          NA           NA   884.00     8.338                    NA         NA         NA                  28.500
##    Pargesa_Holding Partners_Group Roche_Holding SAirGroup Sandoz_PS Sandoz_N Schweizerische_Volksbank_StN Schweizerische_Volksbank_ST SGS Sika
## 1           30.672             NA        11.166        NA    467.50       NA                       158.67                          NA  NA   NA
## 2           31.068             NA        11.329        NA    491.85       NA                       155.73                          NA  NA   NA
## 3           31.661             NA        11.119        NA    478.21       NA                       154.75                          NA  NA   NA
## 4           33.541             NA        11.935        NA    481.13       NA                       152.79                          NA  NA   NA
## 5           32.057             NA        11.842        NA    479.19       NA                           NA                          NA  NA   NA
## 6           30.276             NA        11.655        NA    411.98       NA                           NA                          NA  NA   NA
## 7           32.255             NA        11.795        NA    373.02       NA                           NA                          NA  NA   NA
## 8           31.266             NA        12.844        NA    381.79       NA                           NA                          NA  NA   NA
## 9           30.672             NA        12.727        NA    384.71       NA                           NA                          NA  NA   NA
## 10          32.453             NA        13.753        NA    394.45       NA                           NA                          NA  NA   NA
## 11          33.640             NA        15.152        NA    441.20       NA                           NA                          NA  NA   NA
## 12          34.630             NA        15.105        NA    412.96       NA                           NA                          NA  NA   NA
## 13          34.176             NA        15.781        NA    467.50       NA                           NA                       170.5  NA   NA
## 14          36.774             NA        17.879        NA    467.50       NA                           NA                       185.5  NA   NA
## 15          35.675             NA        20.031        NA    498.66       NA                           NA                       182.0  NA   NA
##    Societe_Internationale_Pirelli Sulzer Swiss_Bank_I Swiss_Bank_PS Swiss_Bank_N Swiss_Life_Holding_I Swiss_Life_Holding_N Swiss_Re Swissair
## 1                          222.89     NA          351           292           NA                   NA                   NA   16.554  1068.24
## 2                          217.00     NA          380           299           NA                   NA                   NA   16.637  1125.22
## 3                          212.80     NA          357           291           NA                   NA                   NA   16.802  1082.49
## 4                          207.75     NA          375           303           NA                   NA                   NA   16.940  1101.48
## 5                          224.57     NA          391           313           NA                   NA                   NA   17.518  1125.22
## 6                          209.43     NA          363           296           NA                   NA                   NA   19.006  1035.01
## 7                          212.80     NA          339           292           NA                   NA                   NA   20.493  1025.51
## 8                          222.89     NA          338           296           NA                   NA                   NA   19.667   968.54
## 9                          233.83     NA          316           274           NA                   NA                   NA   19.832   978.04
## 10                         231.30     NA          323           292           NA                   NA                   NA   21.044  1044.50
## 11                         244.76     NA          320           284           NA                   NA                   NA   22.793   987.53
## 12                         262.42     NA          292           265           NA                   NA                   NA   20.590  1013.93
## 13                         317.10     NA          336           282           NA                   NA                   NA   21.210  1057.81
## 14                         338.12     NA          372           303           NA                   NA                   NA   24.928  1145.55
## 15                         344.85     NA          368           307           NA                   NA                   NA   24.446  1403.91
##    Swisscom Syngenta Synthes The_Swatch_Group_I The_Swatch_Group_N Transocean UBS_N UBS_PS  UBS_I Winterthur Zurich_Insurance_Group_I
## 1        NA       NA      NA                 NA                 NA         NA    NA  112.5 610.87     955.02                  1406.93
## 2        NA       NA      NA                 NA                 NA         NA    NA  116.0 648.19     972.96                  1397.30
## 3        NA       NA      NA                 NA                 NA         NA    NA  113.5 624.61     937.09                  1319.00
## 4        NA       NA      NA                 NA                 NA         NA    NA  114.5 639.35    1008.82                  1373.21
## 5        NA       NA      NA                 NA                 NA         NA    NA  123.0 675.68     998.96                  1409.34
## 6        NA       NA      NA                 NA                 NA         NA    NA  114.0 613.81     824.99                  1144.34
## 7        NA       NA      NA                 NA                 NA         NA    NA  114.5 628.54     755.05                  1038.34
## 8        NA       NA      NA                 NA                 NA         NA    NA  121.0 642.29     744.29                  1068.45
## 9        NA       NA      NA                 NA                 NA         NA    NA  112.0 599.08     735.32                  1046.77
## 10       NA       NA      NA                 NA                 NA         NA    NA  117.5 634.44     772.98                  1150.36
## 11       NA       NA      NA                 NA                 NA         NA    NA  116.0 636.40     842.93                  1204.57
## 12       NA       NA      NA                 NA                 NA         NA    NA  113.5 599.08     780.16                  1088.93
## 13       NA       NA      NA                 NA                 NA         NA    NA  117.0 654.08     802.58                  1148.65
## 14       NA       NA      NA                 NA                 NA         NA    NA  128.5 750.32     936.10                  1371.09
## 15       NA       NA      NA                 NA                 NA         NA    NA  137.5 795.50     950.50                  1386.89
##    Zurich_Insurance_Group_N
## 1                        NA
## 2                        NA
## 3                        NA
## 4                        NA
## 5                        NA
## 6                        NA
## 7                        NA
## 8                        NA
## 9                        NA
## 10                       NA
## 11                       NA
## 12                       NA
## 13                       NA
## 14                       NA
## 15                       NA
##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 378 rows ]</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="the-programming-environment.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here: </span></span>
<span id="cb72-2"><a href="the-programming-environment.html#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="the-programming-environment.html#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="do">## file = &quot;~/Desktop/Master UZH/Data/A1_dataset_01.txt&quot; --&gt; an own defined path different from the current working directory</span></span>
<span id="cb72-4"><a href="the-programming-environment.html#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="do">## header = T --&gt; the first column is a header</span></span>
<span id="cb72-5"><a href="the-programming-environment.html#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="do">## sep = &quot;\t&quot; --&gt; the separation is a \t sign </span></span>
<span id="cb72-6"><a href="the-programming-environment.html#cb72-6" aria-hidden="true" tabindex="-1"></a><span class="do">## dec = &quot;.&quot; --&gt; decimals should be separated with a dot</span></span></code></pre></div>
</div>
</div>
<div id="data-manipulation" class="section level3" number="2.2.6">
<h3><span class="header-section-number">2.2.6</span> Data Manipulation</h3>
<p>In order to explore and modify our data, we use data manipulation techniques. Most of the time, our data is in the form of a data frame and we are interested in exploring the relationships. In order to effectively manipulate the data, we can work with the function <code>dplyr</code>. Although it requires you to think a little differently about the code and how it is constructed, it is a very handy feature to explore your data.</p>
<div id="classical-functions" class="section level4" number="2.2.6.1">
<h4><span class="header-section-number">2.2.6.1</span> Classical functions</h4>
<p>We first start with more classical functions.</p>
<p><strong>Summary</strong></p>
<p><code>summary()</code> is to calculate some basic summary statistics (minimum, 25th, 50th, 75th percentiles, maximum and mean) of each column. If a column is categorical, the summary function will return the number of observations in each category.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="the-programming-environment.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s use the dataset from before: </span></span>
<span id="cb73-2"><a href="the-programming-environment.html#cb73-2" aria-hidden="true" tabindex="-1"></a>df_1 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;~/Desktop/Master UZH/Data/A1_dataset_01.txt&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>,  <span class="at">dec =</span> <span class="st">&#39;.&#39;</span>)</span>
<span id="cb73-3"><a href="the-programming-environment.html#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="co"># We just cut it quickly such that it is better visible</span></span>
<span id="cb73-4"><a href="the-programming-environment.html#cb73-4" aria-hidden="true" tabindex="-1"></a>df_1 <span class="ot">&lt;-</span> df_1[,<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>]</span>
<span id="cb73-5"><a href="the-programming-environment.html#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="the-programming-environment.html#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a summary</span></span>
<span id="cb73-7"><a href="the-programming-environment.html#cb73-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df_1)</span></code></pre></div>
<pre><code>##       ABB            Actelion          Adecco            Alcon         Alusuisse         Baloise      
##  Min.   : 1.458   Min.   : 29.45   Min.   :  8.766   Min.   :45.10   Min.   : 142.7   Min.   : 31.60  
##  1st Qu.:10.778   1st Qu.: 45.59   1st Qu.: 51.257   1st Qu.:54.85   1st Qu.: 234.3   1st Qu.: 59.15  
##  Median :18.060   Median : 57.37   Median : 61.820   Median :58.39   Median : 416.6   Median : 94.50  
##  Mean   :17.048   Mean   : 84.13   Mean   : 68.789   Mean   :57.05   Mean   : 479.2   Mean   : 96.42  
##  3rd Qu.:21.800   3rd Qu.:111.77   3rd Qu.: 75.948   3rd Qu.:58.94   3rd Qu.: 732.0   3rd Qu.:124.77  
##  Max.   :38.775   Max.   :274.75   Max.   :175.730   Max.   :64.00   Max.   :1081.1   Max.   :180.81  
##                   NA&#39;s   :289      NA&#39;s   :72        NA&#39;s   :370     NA&#39;s   :276      NA&#39;s   :235</code></pre>
<p><strong>Apply</strong></p>
<p><code>apply()</code> is commonly used if we want the ability to pick another function to apply to each column and possibly to each row. To demonstrate this, let’s say we want the <strong>mean value of each column</strong> for the given data frame.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="the-programming-environment.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize each column by calculating the mean.</span></span>
<span id="cb75-2"><a href="the-programming-environment.html#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(df_1,        <span class="co"># Set the dataframe you want to apply something on</span></span>
<span id="cb75-3"><a href="the-programming-environment.html#cb75-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">MARGIN =</span> <span class="dv">2</span>, <span class="co"># Set whether rows or cols should be accessed. </span></span>
<span id="cb75-4"><a href="the-programming-environment.html#cb75-4" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># rows = 1, columns = 2, (same order as [rows, cols]</span></span>
<span id="cb75-5"><a href="the-programming-environment.html#cb75-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">FUN =</span> mean, <span class="co"># Set which function should be accessed </span></span>
<span id="cb75-6"><a href="the-programming-environment.html#cb75-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> T)  <span class="co"># Set whether NA values should be ignored</span></span></code></pre></div>
<pre><code>##       ABB  Actelion    Adecco     Alcon Alusuisse   Baloise 
##  17.04789  84.12846  68.78897  57.05391 479.15547  96.41629</code></pre>
<p>This gives us the mean value of each company’s prices.</p>
<p>If we want to get the <strong>standard deviation of prices on the first ten dates</strong>, then we just need to change <code>MARGIN == 1</code>.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="the-programming-environment.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize each column by calculating the mean.</span></span>
<span id="cb77-2"><a href="the-programming-environment.html#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(df_1[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,],        <span class="co"># Set the dataframe you want to apply something on</span></span>
<span id="cb77-3"><a href="the-programming-environment.html#cb77-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">MARGIN =</span> <span class="dv">1</span>, <span class="co"># Set whether rows or cols should be accessed. </span></span>
<span id="cb77-4"><a href="the-programming-environment.html#cb77-4" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># rows = 1, columns = 2, (same order as [rows, cols]</span></span>
<span id="cb77-5"><a href="the-programming-environment.html#cb77-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">FUN =</span> sd, <span class="co"># Set which function should be accessed </span></span>
<span id="cb77-6"><a href="the-programming-environment.html#cb77-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> T)  <span class="co"># Set whether NA values should be ignored</span></span></code></pre></div>
<pre><code>##         1         2         3         4         5         6         7         8         9        10 
## 106.45563 107.65701 111.20668 117.34366 120.06815 116.61534 114.47140 103.82166 101.39628  98.50917</code></pre>
</div>
<div id="package-dplyr" class="section level4" number="2.2.6.2">
<h4><span class="header-section-number">2.2.6.2</span> Package <code>dplyr</code></h4>
<p>The package <code>dplyr</code> strives to provide a convenient and consistent set of functions to handle the most common data frame manipulations and a mechanism for chaining these operations together to perform complex tasks.</p>
<p>The most important operator using the deployer (= dplyr) package is the pipe command <code>%&gt;%</code>. It allows for better or easier readable code. The idea is that the %&gt;% operator works by translating the command a %&gt;% f(b) to the expression f(a,b). The handy feature arises once you have multiple functions you need to incorporate into each other.</p>
<p>For example, if we wanted to start with x, and first apply function f(), then g(), and then h(), the usual R command would be h(g(f(x))) which is hard to read because you have to start reading at the innermost set of parentheses. Using the pipe command %&gt;%, this sequence of operations becomes x %&gt;% f() %&gt;% g() %&gt;% h().</p>
<p>In dplyr, all the functions below take a data set as its first argument and outputs an appropriately modified data set. This will allow me to <strong>chain together commands in a readable fashion</strong>.</p>
<p><strong>Verbs</strong></p>
<p>The foundational operations to perform on a data set are:</p>
<p>– <code>select</code>: Selecting a <em>subset of columns</em> by name or <em>column number</em>.</p>
<p>– <code>filter</code>: Selecting a <em>subset of rows</em> from a data frame based on <em>logical expressions</em>.</p>
<p>– <code>slice</code>: Selecting a <em>subset of rows</em> by <em>row number</em>.</p>
<ul>
<li><p><code>arrange</code>: <em>Re-ordering</em> the rows of a data frame.</p></li>
<li><p><code>mutate</code>: Add a <em>new column</em> that is some <em>function of other columns</em>.</p></li>
<li><p><code>summarise</code>: Calculate some <em>summary statistic</em> of a column of data. This collapses a set of rows into a single row.</p></li>
</ul>
<p>Let’s apply these commands now in the sliced Swiss Markets dataset of earlier.</p>
<p><em><code>select</code></em></p>
<p>We already understand how we can simply select columns by using square brackets [, col], where col is (are) the column(s) of interest. Instead, we can also use <code>select</code> in order to select the columns we want:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="the-programming-environment.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, let&#39;s select the first three columns. To not exagerate the output, let&#39;s only take the first five rows</span></span>
<span id="cb79-2"><a href="the-programming-environment.html#cb79-2" aria-hidden="true" tabindex="-1"></a>df_1[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,] <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>))</span></code></pre></div>
<pre><code>##     ABB Actelion  Adecco
## 1 5.294       NA 155.845
## 2 4.982       NA 157.232
## 3 5.049       NA 162.319
## 4 5.527       NA 171.476
## 5 5.928       NA 175.730</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="the-programming-environment.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we can also write the names of the columns instead of their indexes</span></span>
<span id="cb81-2"><a href="the-programming-environment.html#cb81-2" aria-hidden="true" tabindex="-1"></a>df_1[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,] <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">c</span>(ABB<span class="sc">:</span>Adecco))</span></code></pre></div>
<pre><code>##     ABB Actelion  Adecco
## 1 5.294       NA 155.845
## 2 4.982       NA 157.232
## 3 5.049       NA 162.319
## 4 5.527       NA 171.476
## 5 5.928       NA 175.730</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="the-programming-environment.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Also, not selecting works as well. For instance, get all except the second column. </span></span>
<span id="cb83-2"><a href="the-programming-environment.html#cb83-2" aria-hidden="true" tabindex="-1"></a>df_1[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,] <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="dv">2</span>))</span></code></pre></div>
<pre><code>##     ABB  Adecco Alcon Alusuisse Baloise
## 1 5.294 155.845    NA        NA      NA
## 2 4.982 157.232    NA        NA      NA
## 3 5.049 162.319    NA        NA      NA
## 4 5.527 171.476    NA        NA      NA
## 5 5.928 175.730    NA        NA      NA</code></pre>
<p>The <code>select()</code> command has a few other tricks. There are functional calls that describe the columns you wish to select that take advantage of pattern matching. The most commonly used are:</p>
<ul>
<li><code>starts_with()</code>: Show columns that start with a certain pattern (e.g. Letter, Name)</li>
<li><code>ends_with()</code>: Show columns that end with a certain pattern</li>
<li><code>contains()</code>: Show columns containing a certain pattern</li>
<li><code>matches()</code>: Show columns with a regular expression</li>
</ul>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="the-programming-environment.html#cb85-1" aria-hidden="true" tabindex="-1"></a>df_1[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,] <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;B&quot;</span>))</span></code></pre></div>
<pre><code>##   Baloise
## 1      NA
## 2      NA
## 3      NA
## 4      NA
## 5      NA</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="the-programming-environment.html#cb87-1" aria-hidden="true" tabindex="-1"></a>df_1[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,] <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">&quot;B&quot;</span>))</span></code></pre></div>
<pre><code>##     ABB
## 1 5.294
## 2 4.982
## 3 5.049
## 4 5.527
## 5 5.928</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="the-programming-environment.html#cb89-1" aria-hidden="true" tabindex="-1"></a>df_1[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,] <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&quot;B&quot;</span>))</span></code></pre></div>
<pre><code>##     ABB Baloise
## 1 5.294      NA
## 2 4.982      NA
## 3 5.049      NA
## 4 5.527      NA
## 5 5.928      NA</code></pre>
<p><em><code>filter</code></em></p>
<p>It is common to want to select particular <em>rows</em> where we have some logically expression to pick the rows.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="the-programming-environment.html#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s only select the rows in which ABB has a larger Share Price than 30</span></span>
<span id="cb91-2"><a href="the-programming-environment.html#cb91-2" aria-hidden="true" tabindex="-1"></a>df_1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(., ABB <span class="sc">&gt;</span> <span class="dv">30</span>)</span></code></pre></div>
<pre><code>##       ABB Actelion  Adecco Alcon Alusuisse Baloise
## 1  36.045       NA 122.465    NA   1078.38 124.621
## 2  33.778       NA 122.564    NA   1081.14 129.793
## 3  32.852       NA 130.366    NA    936.93 129.296
## 4  35.351       NA 113.576    NA    964.48 142.623
## 5  35.444       NA 139.748    NA   1001.22 142.922
## 6  38.775       NA 131.551    NA    981.02 157.343
## 7  36.138       NA 136.884    NA    976.42 161.123
## 8  36.832       NA 134.711    NA   1054.50 172.560
## 9  36.091       NA 131.847    NA   1061.85 175.842
## 10 31.094       NA 110.613    NA    946.11 167.090
## 11 31.973       NA 100.737    NA        NA 177.036
## 12 30.169       NA 108.638    NA        NA 176.041
## 13 32.512       NA  68.788    NA        NA 123.100
## 14 30.963       NA  62.319    NA        NA 109.300
## 15 30.440       NA  60.492    NA        NA 111.500
## 16 31.597       NA  58.714    NA        NA 118.600</code></pre>
<p>We can also use the <code>&amp;</code> and <code>|</code> operators to combine filtering.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="the-programming-environment.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only rows in which ABB is above 30 and Adecco below 90</span></span>
<span id="cb93-2"><a href="the-programming-environment.html#cb93-2" aria-hidden="true" tabindex="-1"></a>df_1 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="st">&quot;ABB&quot;</span> <span class="sc">&gt;</span> <span class="dv">30</span> <span class="sc">&amp;</span> <span class="st">&quot;Adecco&quot;</span> <span class="sc">&lt;</span> <span class="dv">90</span>)</span></code></pre></div>
<pre><code>## [1] ABB       Actelion  Adecco    Alcon     Alusuisse Baloise  
## &lt;0 rows&gt; (or 0-length row.names)</code></pre>
<p>We can also now start combining the select and filter commands.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="the-programming-environment.html#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only ABB, Adecco and Baloise and then filter such that ABB is above 30 and Adecco below 90</span></span>
<span id="cb95-2"><a href="the-programming-environment.html#cb95-2" aria-hidden="true" tabindex="-1"></a>df_1 <span class="sc">%&gt;%</span> </span>
<span id="cb95-3"><a href="the-programming-environment.html#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ABB, Adecco, Baloise) <span class="sc">%&gt;%</span> </span>
<span id="cb95-4"><a href="the-programming-environment.html#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ABB <span class="sc">&gt;</span> <span class="dv">30</span> <span class="sc">&amp;</span> Adecco <span class="sc">&lt;</span> <span class="dv">90</span>)</span></code></pre></div>
<pre><code>##      ABB Adecco Baloise
## 1 32.512 68.788   123.1
## 2 30.963 62.319   109.3
## 3 30.440 60.492   111.5
## 4 31.597 58.714   118.6</code></pre>
<p><em><code>slice</code></em></p>
<p>When you want to filter rows based on row number, this is called slicing. This is the same as with columns, just for rows</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="the-programming-environment.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Take only the first three rows</span></span>
<span id="cb97-2"><a href="the-programming-environment.html#cb97-2" aria-hidden="true" tabindex="-1"></a>df_1 <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>##     ABB Actelion  Adecco Alcon Alusuisse Baloise
## 1 5.294       NA 155.845    NA        NA      NA
## 2 4.982       NA 157.232    NA        NA      NA
## 3 5.049       NA 162.319    NA        NA      NA</code></pre>
<p><em><code>arrange</code></em></p>
<p>We often need to re-order the rows of a data frame. Although this is, in a security setting with a time-series, not the most useful tool (given that anyway anything is sorted according to date), it still is very useful for many other applications.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="the-programming-environment.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrange according to the Share Prices of ABB</span></span>
<span id="cb99-2"><a href="the-programming-environment.html#cb99-2" aria-hidden="true" tabindex="-1"></a>df_1[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,] <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(ABB)</span></code></pre></div>
<pre><code>##     ABB Actelion  Adecco Alcon Alusuisse Baloise
## 1 4.982       NA 157.232    NA        NA      NA
## 2 5.049       NA 162.319    NA        NA      NA
## 3 5.294       NA 155.845    NA        NA      NA
## 4 5.527       NA 171.476    NA        NA      NA
## 5 5.928       NA 175.730    NA        NA      NA</code></pre>
<p>Although this tells us not much in the given context, it stil is useful for other sorting purposes. For that, let’s create another small example. How about treatment level and then gender. That would make more sense to have an overview then.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="the-programming-environment.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataframe </span></span>
<span id="cb101-2"><a href="the-programming-environment.html#cb101-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-3"><a href="the-programming-environment.html#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Note that treat is a factor and thus must be assigned a level to show which values are &quot;lower&quot; than others. </span></span>
<span id="cb101-4"><a href="the-programming-environment.html#cb101-4" aria-hidden="true" tabindex="-1"></a>treatment <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">treat =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;Low&quot;</span>, <span class="st">&quot;Med&quot;</span>, <span class="st">&quot;Med&quot;</span>, <span class="st">&quot;Low&quot;</span>, <span class="st">&quot;High&quot;</span>, <span class="st">&quot;High&quot;</span>, <span class="st">&quot;Extreme&quot;</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Low&quot;</span>, <span class="st">&quot;Med&quot;</span>, <span class="st">&quot;High&quot;</span>, <span class="st">&quot;Extreme&quot;</span>)),</span>
<span id="cb101-5"><a href="the-programming-environment.html#cb101-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">gender =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;X&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;M&quot;</span>,<span class="st">&quot;F&quot;</span>, <span class="st">&quot;F&quot;</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;F&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;X&quot;</span>)), </span>
<span id="cb101-6"><a href="the-programming-environment.html#cb101-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">age =</span> <span class="fu">c</span>(<span class="dv">41</span>,<span class="dv">40</span>,<span class="dv">88</span>,<span class="dv">14</span>,<span class="dv">10</span>,<span class="dv">55</span>,<span class="dv">31</span>), </span>
<span id="cb101-7"><a href="the-programming-environment.html#cb101-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">7</span>,<span class="dv">4</span>))</span>
<span id="cb101-8"><a href="the-programming-environment.html#cb101-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-9"><a href="the-programming-environment.html#cb101-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Now arrange / sort the dataframe according to multiple rows: </span></span>
<span id="cb101-10"><a href="the-programming-environment.html#cb101-10" aria-hidden="true" tabindex="-1"></a>treatment <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(treat, gender, <span class="fu">desc</span>(age))</span></code></pre></div>
<pre><code>##     treat gender age y
## 1     Low      M  41 3
## 2     Low      M  14 1
## 3     Med      F  40 4
## 4     Med      X  88 5
## 5    High      F  55 7
## 6    High      M  10 2
## 7 Extreme      F  31 4</code></pre>
<p>Great, now we have a better overview, as we sorted first according to treatment, then within treatment according gender, and then within gender according to age (descending). This “layered sorting” is quite handy when using the arrange function.</p>
<p><em><code>mutate</code></em></p>
<p>The perhaps most important function is <code>mutate</code>. It is used to create a new column according to functions used from other variables. To do so, let’s show you the two different ways to create new variables.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="the-programming-environment.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s do it the old-fashioned way. We define a high indicator each time ABB is larger its average </span></span>
<span id="cb103-2"><a href="the-programming-environment.html#cb103-2" aria-hidden="true" tabindex="-1"></a>df_1<span class="sc">$</span>High_Indicator <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(df_1<span class="sc">$</span>ABB <span class="sc">&gt;</span> <span class="fu">mean</span>(df_1<span class="sc">$</span>ABB, <span class="at">na.rm =</span> T), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb103-3"><a href="the-programming-environment.html#cb103-3" aria-hidden="true" tabindex="-1"></a>df_1<span class="sc">$</span>High_Indicator</span></code></pre></div>
<pre><code>##   [1] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [72] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
## [143] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [214] 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 1 1 1
## [285] 1 1 0 0 0 1 0 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1
## [356] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</code></pre>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="the-programming-environment.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s delete the column again: </span></span>
<span id="cb105-2"><a href="the-programming-environment.html#cb105-2" aria-hidden="true" tabindex="-1"></a>df_1<span class="sc">$</span>High_Indicator <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="the-programming-environment.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, the dplyr way. </span></span>
<span id="cb106-2"><a href="the-programming-environment.html#cb106-2" aria-hidden="true" tabindex="-1"></a>df_1[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">High_Indicator =</span> <span class="fu">ifelse</span>(ABB <span class="sc">&gt;</span> <span class="fu">mean</span>(ABB, <span class="at">na.rm =</span> T), <span class="dv">1</span>,<span class="dv">0</span>))</span></code></pre></div>
<pre><code>##     ABB Actelion  Adecco Alcon Alusuisse Baloise High_Indicator
## 1 5.294       NA 155.845    NA        NA      NA              0
## 2 4.982       NA 157.232    NA        NA      NA              0
## 3 5.049       NA 162.319    NA        NA      NA              0
## 4 5.527       NA 171.476    NA        NA      NA              1
## 5 5.928       NA 175.730    NA        NA      NA              1</code></pre>
<p>The nice thing is that you can also use it to create multiple columns simultaneously, and you can <em>even refer to columns that were created in the same mutate() command</em>.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="the-programming-environment.html#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s do this again. Let&#39;s create the High Indicator and create a High times Price element</span></span>
<span id="cb108-2"><a href="the-programming-environment.html#cb108-2" aria-hidden="true" tabindex="-1"></a>df_1 <span class="sc">%&gt;%</span>  <span class="fu">mutate</span>(<span class="at">High_Indicator =</span> <span class="fu">ifelse</span>(ABB <span class="sc">&gt;</span> <span class="fu">mean</span>(ABB, <span class="at">na.rm =</span> T), <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb108-3"><a href="the-programming-environment.html#cb108-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">High_Price =</span> High_Indicator <span class="sc">*</span> ABB)</span></code></pre></div>
<pre><code>##        ABB Actelion  Adecco Alcon Alusuisse Baloise High_Indicator High_Price
## 1    5.294       NA 155.845    NA        NA      NA              0      0.000
## 2    4.982       NA 157.232    NA        NA      NA              0      0.000
## 3    5.049       NA 162.319    NA        NA      NA              0      0.000
## 4    5.527       NA 171.476    NA        NA      NA              0      0.000
## 5    5.928       NA 175.730    NA        NA      NA              0      0.000
## 6    6.161       NA 171.080    NA        NA      NA              0      0.000
## 7    6.117       NA 168.004    NA        NA      NA              0      0.000
## 8    6.473       NA 153.299    NA        NA      NA              0      0.000
## 9    6.539       NA 149.935    NA        NA      NA              0      0.000
## 10   7.162       NA 146.475    NA        NA      NA              0      0.000
## 11   7.763       NA 158.777    NA        NA      NA              0      0.000
## 12   8.386       NA 154.741    NA        NA      NA              0      0.000
## 13   9.609       NA 160.988    NA        NA      NA              0      0.000
## 14   9.553       NA 163.391    NA        NA      NA              0      0.000
## 15  10.899       NA 170.119    NA        NA      NA              0      0.000
## 16  10.788       NA 173.963    NA        NA      NA              0      0.000
## 17  11.411       NA 153.299    NA        NA      NA              0      0.000
## 18  11.455       NA 163.391    NA        NA      NA              0      0.000
## 19  11.411       NA 150.174    NA        NA      NA              0      0.000
## 20  12.011       NA 129.901    NA        NA      NA              0      0.000
## 21  12.389       NA 109.252    NA        NA      NA              0      0.000
## 22  11.733       NA 116.385    NA        NA      NA              0      0.000
## 23  12.345       NA 103.996    NA        NA      NA              0      0.000
## 24  13.567       NA 125.020    NA        NA      NA              0      0.000
## 25  13.288       NA 118.262    NA        NA      NA              0      0.000
## 26  13.779       NA 108.596    NA        NA      NA              0      0.000
## 27  11.233       NA  87.653    NA        NA      NA              0      0.000
## 28   8.777       NA  72.527    NA        NA      NA              0      0.000
## 29   9.849       NA  70.588    NA        NA      NA              0      0.000
## 30   8.844       NA  69.036    NA        NA      NA              0      0.000
## 31   8.665       NA  69.036    NA        NA      NA              0      0.000
## 32   8.866       NA  61.667    NA    193.45      NA              0      0.000
## 33  10.519       NA  75.242    NA    234.28      NA              0      0.000
## 34  10.608       NA  68.261    NA    245.03      NA              0      0.000
## 35   9.916       NA  65.934    NA    229.98      NA              0      0.000
## 36  10.385       NA  61.279    NA    232.13      NA              0      0.000
## 37   9.938       NA  62.831    NA    232.13      NA              0      0.000
## 38  10.742       NA  70.373    NA    223.97      NA              0      0.000
## 39  10.452       NA  63.580    NA    206.34      NA              0      0.000
## 40   9.849       NA  62.396    NA    202.04      NA              0      0.000
## 41   9.112       NA  63.186    NA    193.45      NA              0      0.000
## 42   7.169       NA  35.226    NA    169.80      NA              0      0.000
## 43   7.258       NA  31.514    NA    171.09      NA              0      0.000
## 44   8.017       NA  34.673    NA    174.10      NA              0      0.000
## 45   8.218       NA  36.569    NA    182.70      NA              0      0.000
## 46   8.576       NA  32.699    NA    197.74      NA              0      0.000
## 47   9.067       NA  31.751    NA    204.62      NA              0      0.000
## 48   9.670       NA  29.618    NA    214.94      NA              0      0.000
## 49   9.469       NA  29.223    NA    206.34      NA              0      0.000
## 50   8.375       NA  17.534    NA    182.27      NA              0      0.000
## 51   8.129       NA  17.218    NA    167.22      NA              0      0.000
## 52   8.218       NA  18.166    NA    158.20      NA              0      0.000
## 53   7.749       NA  14.849    NA    142.72      NA              0      0.000
## 54   7.660       NA  15.638    NA    144.01      NA              0      0.000
## 55   8.017       NA  15.480    NA    176.25      NA              0      0.000
## 56   8.017       NA  12.400    NA    188.72      NA              0      0.000
## 57   8.955       NA  11.215    NA    202.90      NA              0      0.000
## 58   9.156       NA   8.925    NA    210.64      NA              0      0.000
## 59   9.223       NA   8.766    NA    200.32      NA              0      0.000
## 60   9.346       NA  11.430    NA    207.18      NA              0      0.000
## 61   9.034       NA  12.375    NA    209.81      NA              0      0.000
## 62  10.005       NA  12.891    NA    233.46      NA              0      0.000
## 63  10.161       NA  15.039    NA    237.84      NA              0      0.000
## 64   9.916       NA  11.860    NA    235.21      NA              0      0.000
## 65  11.189       NA  13.235    NA    236.53      NA              0      0.000
## 66  11.245       NA  14.438    NA    235.65      NA              0      0.000
## 67  12.127       NA  18.567    NA    282.96      NA              0      0.000
## 68  12.808       NA      NA    NA    277.26      NA              0      0.000
## 69  11.725       NA      NA    NA    281.64      NA              0      0.000
## 70  13.087       NA      NA    NA    282.60      NA              0      0.000
## 71  14.405       NA      NA    NA    309.94      NA              0      0.000
## 72  14.070       NA      NA    NA    300.83      NA              0      0.000
## 73  13.109       NA      NA    NA    293.54      NA              0      0.000
## 74  13.724       NA      NA    NA    319.97      NA              0      0.000
## 75  13.478       NA      NA    NA    315.41      NA              0      0.000
## 76  12.395       NA      NA    NA    307.21      NA              0      0.000
## 77  12.037       NA      NA    NA    285.33      NA              0      0.000
## 78  12.428       NA      NA    NA    296.73      NA              0      0.000
## 79  12.585       NA      NA    NA    298.55      NA              0      0.000
## 80  12.473       NA      NA    NA    302.20      NA              0      0.000
## 81  12.026       NA      NA    NA    299.00      NA              0      0.000
## 82  12.015       NA      NA    NA    279.86      NA              0      0.000
## 83  12.629       NA      NA    NA    288.98      NA              0      0.000
## 84  13.299       NA      NA    NA    313.59      NA              0      0.000
## 85  13.310       NA      NA    NA    329.09      NA              0      0.000
## 86  13.523       NA      NA    NA    349.14      NA              0      0.000
## 87  14.192       NA      NA    NA    379.68      NA              0      0.000
## 88  14.952       NA      NA    NA    390.62      NA              0      0.000
## 89  14.706       NA      NA    NA    394.27      NA              0      0.000
## 90  15.075       NA      NA    NA    434.83      NA              0      0.000
## 91  14.963       NA      NA    NA    416.60      NA              0      0.000
## 92  15.577       NA      NA    NA    429.36      NA              0      0.000
## 93  16.035       NA      NA    NA    438.94      NA              0      0.000
## 94  16.158       NA      NA    NA    455.34      NA              0      0.000
## 95  16.705       NA      NA    NA    457.17      NA              0      0.000
## 96  16.705       NA      NA    NA    448.05      NA              0      0.000
## 97  17.286       NA      NA    NA    470.84      NA              1     17.286
## 98  15.834       NA      NA    NA    420.25  39.246              0      0.000
## 99  16.515       NA      NA    NA    428.91  41.699              0      0.000
## 100 17.129       NA      NA    NA    428.91  42.925              1     17.129
## 101 17.442       NA      NA    NA    420.25  43.170              1     17.442
## 102 18.212       NA      NA    NA    474.94  47.586              1     18.212
## 103 18.592       NA      NA    NA    486.34  43.988              1     18.592
## 104 20.323       NA      NA    NA    532.83  45.787              1     20.323
## 105 18.715       NA      NA    NA    540.12  47.422              1     18.715
## 106 19.318       NA      NA    NA    554.25  48.076              1     19.318
## 107 19.932       NA      NA    NA    569.75  50.856              1     19.932
## 108 21.685       NA      NA    NA    608.49  50.856              1     21.685
## 109 24.678       NA      NA    NA    689.17  56.907              1     24.678
## 110 24.537       NA      NA    NA    626.73  60.341              1     24.537
## 111 25.039       NA      NA    NA    583.42  63.284              1     25.039
## 112 24.457       NA      NA    NA    649.52  74.981              1     24.457
## 113 20.838       NA      NA    NA    572.03  83.979              1     20.838
## 114 21.660       NA      NA    NA    596.64  84.645              1     21.660
## 115 20.952       NA      NA    NA    639.49  90.077              1     20.952
## 116 21.466       NA      NA    NA    735.66  94.476              1     21.466
## 117 22.836       NA      NA    NA    772.58 106.473              1     22.836
## 118 26.010       NA      NA    NA    843.23 103.807              1     26.010
## 119 28.088       NA      NA    NA    875.14 115.771              1     28.088
## 120 28.659       NA      NA    NA    907.04 117.470              1     28.659
## 121 25.576       NA      NA    NA    888.52 123.527              1     25.576
## 122 25.222       NA      NA    NA    842.34 148.591              1     25.222
## 123 19.239       NA      NA    NA    676.55 109.802              1     19.239
## 124 16.042       NA      NA    NA    609.13  84.042              0      0.000
## 125 18.520       NA      NA    NA    714.88 111.194              1     18.520
##  [ reached &#39;max&#39; / getOption(&quot;max.print&quot;) -- omitted 268 rows ]</code></pre>
<p>Another situation I often run into is the need to select many columns, and calculate a sum or mean across them. This can be used when combining the <code>mutate</code> function with the <code>apply</code> function we discussed earlier.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="the-programming-environment.html#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here, we only take the mean values of ABB, Actelion and Adecco and create another variable called Average_Price_AAAD</span></span>
<span id="cb110-2"><a href="the-programming-environment.html#cb110-2" aria-hidden="true" tabindex="-1"></a>df_1[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,] <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Average_Price_AAAD =</span> <span class="fu">select</span>(., ABB<span class="sc">:</span>Adecco) <span class="sc">%&gt;%</span> <span class="fu">apply</span>(<span class="dv">1</span>, mean, <span class="at">na.rm =</span> T))</span></code></pre></div>
<pre><code>##     ABB Actelion  Adecco Alcon Alusuisse Baloise Average_Price_AAAD
## 1 5.294       NA 155.845    NA        NA      NA            80.5695
## 2 4.982       NA 157.232    NA        NA      NA            81.1070
## 3 5.049       NA 162.319    NA        NA      NA            83.6840
## 4 5.527       NA 171.476    NA        NA      NA            88.5015
## 5 5.928       NA 175.730    NA        NA      NA            90.8290</code></pre>
<p><em><code>summarise</code></em></p>
<p><code>summarise</code> is used to calculate summary statistics using any or all of the data columns.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="the-programming-environment.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s get the mean and standard deviation for ABB</span></span>
<span id="cb112-2"><a href="the-programming-environment.html#cb112-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-3"><a href="the-programming-environment.html#cb112-3" aria-hidden="true" tabindex="-1"></a>df_1 <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">ABB_Mean =</span> <span class="fu">mean</span>(ABB), <span class="at">ABB_SD =</span> <span class="fu">sd</span>(ABB))</span></code></pre></div>
<pre><code>##   ABB_Mean   ABB_SD
## 1 17.04789 7.376436</code></pre>
<p>We can also use <code>summarise_all</code> to get the summary statistics of each variable we selected</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="the-programming-environment.html#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here, we take the variables of ABB and Actelion and calculate their mean, variances and standard deviation</span></span>
<span id="cb114-2"><a href="the-programming-environment.html#cb114-2" aria-hidden="true" tabindex="-1"></a>df_1 <span class="sc">%&gt;%</span> </span>
<span id="cb114-3"><a href="the-programming-environment.html#cb114-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.,ABB<span class="sc">:</span>Actelion) <span class="sc">%&gt;%</span> </span>
<span id="cb114-4"><a href="the-programming-environment.html#cb114-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(<span class="fu">funs</span>(mean, var, sd), <span class="at">na.rm =</span> T)</span></code></pre></div>
<pre><code>## Warning: `funs()` was deprecated in dplyr 0.8.0.
## Please use a list of either functions or lambdas: 
## 
##   # Simple named list: 
##   list(mean = mean, median = median)
## 
##   # Auto named with `tibble::lst()`: 
##   tibble::lst(mean, median)
## 
##   # Using lambdas
##   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<pre><code>##   ABB_mean Actelion_mean  ABB_var Actelion_var   ABB_sd Actelion_sd
## 1 17.04789      84.12846 54.41181      3045.52 7.376436    55.18623</code></pre>
</div>
<div id="using-multiple-commands-including-split-apply-and-combine-functions" class="section level4" number="2.2.6.3">
<h4><span class="header-section-number">2.2.6.3</span> Using multiple commands including split, apply and combine functions</h4>
<p>The major strength of the dplyr package is the ability to split a data frame into a bunch of sub-data frames, apply a sequence of one or more of the operations we just described, and then combine results back together. Thus, let’s now look at how to combine some of the commands.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="the-programming-environment.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s create a slightly more advanced data frame than we had previously by looking at the treatment data set again and enhancing it</span></span>
<span id="cb117-2"><a href="the-programming-environment.html#cb117-2" aria-hidden="true" tabindex="-1"></a>treatment <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">treat =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;Low&quot;</span>, <span class="st">&quot;Med&quot;</span>, <span class="st">&quot;Med&quot;</span>, <span class="st">&quot;Low&quot;</span>, <span class="st">&quot;High&quot;</span>, <span class="st">&quot;High&quot;</span>, <span class="st">&quot;Extreme&quot;</span>, <span class="st">&quot;Med&quot;</span>, <span class="st">&quot;High&quot;</span>, <span class="st">&quot;Low&quot;</span>, <span class="st">&quot;Low&quot;</span>, <span class="st">&quot;Med&quot;</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Low&quot;</span>, <span class="st">&quot;Med&quot;</span>, <span class="st">&quot;High&quot;</span>, <span class="st">&quot;Extreme&quot;</span>)),</span>
<span id="cb117-3"><a href="the-programming-environment.html#cb117-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">gender =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;X&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;M&quot;</span>,<span class="st">&quot;F&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;X&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;F&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;X&quot;</span>)), </span>
<span id="cb117-4"><a href="the-programming-environment.html#cb117-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">age =</span> <span class="fu">c</span>(<span class="dv">41</span>,<span class="dv">40</span>,<span class="dv">88</span>,<span class="dv">14</span>,<span class="dv">10</span>,<span class="dv">55</span>,<span class="dv">31</span>, <span class="dv">55</span>, <span class="dv">23</span>, <span class="dv">46</span>, <span class="dv">97</span>, <span class="dv">12</span>), </span>
<span id="cb117-5"><a href="the-programming-environment.html#cb117-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">glyphs =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">7</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">12</span>,<span class="dv">8</span>,<span class="dv">6</span>), </span>
<span id="cb117-6"><a href="the-programming-environment.html#cb117-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cells =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;W&quot;</span>, <span class="st">&quot;W&quot;</span>, <span class="st">&quot;R&quot;</span>, <span class="st">&quot;W&quot;</span>, <span class="st">&quot;R&quot;</span>, <span class="st">&quot;W&quot;</span>,<span class="st">&quot;W&quot;</span>, <span class="st">&quot;W&quot;</span>, <span class="st">&quot;R&quot;</span>, <span class="st">&quot;W&quot;</span>, <span class="st">&quot;R&quot;</span>, <span class="st">&quot;W&quot;</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;R&quot;</span>, <span class="st">&quot;W&quot;</span>)),</span>
<span id="cb117-7"><a href="the-programming-environment.html#cb117-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">smoke =</span> <span class="fu">c</span>(<span class="st">&quot;Y&quot;</span>, <span class="st">&quot;N&quot;</span>, <span class="st">&quot;N&quot;</span>, <span class="st">&quot;N&quot;</span>, <span class="st">&quot;Y&quot;</span>, <span class="st">&quot;N&quot;</span>, <span class="st">&quot;Y&quot;</span>, <span class="st">&quot;N&quot;</span>, <span class="st">&quot;N&quot;</span>, <span class="st">&quot;N&quot;</span>, <span class="st">&quot;Y&quot;</span>, <span class="st">&quot;N&quot;</span>))</span>
<span id="cb117-8"><a href="the-programming-environment.html#cb117-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-9"><a href="the-programming-environment.html#cb117-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s do the following now:</span></span>
<span id="cb117-10"><a href="the-programming-environment.html#cb117-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-11"><a href="the-programming-environment.html#cb117-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 1) Select all except for the &quot;glyphs&quot; column</span></span>
<span id="cb117-12"><a href="the-programming-environment.html#cb117-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 2) Filter according to male and female individuals without extreme treatment status</span></span>
<span id="cb117-13"><a href="the-programming-environment.html#cb117-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 3) Group by cells</span></span>
<span id="cb117-14"><a href="the-programming-environment.html#cb117-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 4) Calculate the mean age for each group </span></span>
<span id="cb117-15"><a href="the-programming-environment.html#cb117-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 5) Calculate smoking average age levels </span></span>
<span id="cb117-16"><a href="the-programming-environment.html#cb117-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-17"><a href="the-programming-environment.html#cb117-17" aria-hidden="true" tabindex="-1"></a>treatment <span class="sc">%&gt;%</span> </span>
<span id="cb117-18"><a href="the-programming-environment.html#cb117-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>glyphs) <span class="sc">%&gt;%</span> </span>
<span id="cb117-19"><a href="the-programming-environment.html#cb117-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(treat <span class="sc">!=</span> <span class="st">&quot;Extreme&quot;</span> <span class="sc">&amp;</span> gender <span class="sc">!=</span> <span class="st">&quot;X&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb117-20"><a href="the-programming-environment.html#cb117-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cells) <span class="sc">%&gt;%</span> </span>
<span id="cb117-21"><a href="the-programming-environment.html#cb117-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_age =</span> <span class="fu">mean</span>(age)) <span class="sc">%&gt;%</span> </span>
<span id="cb117-22"><a href="the-programming-environment.html#cb117-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">smoke_mean_age =</span> <span class="fu">ifelse</span>(smoke <span class="sc">==</span> <span class="st">&quot;Y&quot;</span>, mean_age, <span class="st">&quot;NA&quot;</span>)) </span></code></pre></div>
<pre><code>## # A tibble: 9 × 7
## # Groups:   cells [2]
##   treat gender   age cells smoke mean_age smoke_mean_age  
##   &lt;fct&gt; &lt;fct&gt;  &lt;dbl&gt; &lt;fct&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;           
## 1 Low   M         41 W     Y         34.7 34.6666666666667
## 2 Med   F         40 W     N         34.7 NA              
## 3 Low   M         14 W     N         34.7 NA              
## 4 High  M         10 R     Y         43.3 43.3333333333333
## 5 High  F         55 W     N         34.7 NA              
## 6 High  F         23 R     N         43.3 NA              
## 7 Low   M         46 W     N         34.7 NA              
## 8 Low   M         97 R     Y         43.3 43.3333333333333
## 9 Med   F         12 W     N         34.7 NA</code></pre>
</div>
</div>
<div id="data-reshaping" class="section level3" number="2.2.7">
<h3><span class="header-section-number">2.2.7</span> Data Reshaping</h3>
<p>Another important feature in R is Data Reshaping. The idea behind data reshaping is the ability to shape the data frame between a <code>wide</code> and a <code>long</code> format. Long format is a format in which <strong>each row is an observation and each column is a covariate</strong> (such as time-series formats). In practice, the data is often not stored like that and the data comes to us with repeated observations included on a single row. This is often done as a memory saving technique or because there is some structure in the data that makes the ‘wide’ format attractive.</p>
<p>Building on this, we may want a way to join data frames together. This makes the data easier to modify, and more likely to maintain consistence.</p>
<div id="tidyr" class="section level4" number="2.2.7.1">
<h4><span class="header-section-number">2.2.7.1</span> <code>tidyr</code></h4>
<p>As described, the perhaps most important tidying action we need is to transform wide to long format tables. Just like with other packages, there are two main arguments to note here.</p>
<ul>
<li><code>gather</code>: Gather multiple columns that are related into two columns that contain the original column name and the value.</li>
<li><code>spread</code>: This is the opposite of gather. This takes a key column (or columns) and a results column and forms a new column for each level of the key column(s)</li>
</ul>
<p>Although this sound somewhat complicated now, it’s actually quite easy to get your head around.</p>
<p><strong><code>gather</code></strong></p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="the-programming-environment.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s create another treatment dataframe</span></span>
<span id="cb119-2"><a href="the-programming-environment.html#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="the-programming-environment.html#cb119-3" aria-hidden="true" tabindex="-1"></a>treat_tests <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Patient =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>,<span class="st">&quot;C&quot;</span>, <span class="st">&quot;D&quot;</span>), </span>
<span id="cb119-4"><a href="the-programming-environment.html#cb119-4" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;D&quot;</span>)),</span>
<span id="cb119-5"><a href="the-programming-environment.html#cb119-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Test_1 =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">4</span>), </span>
<span id="cb119-6"><a href="the-programming-environment.html#cb119-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Test_2 =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">4</span>), </span>
<span id="cb119-7"><a href="the-programming-environment.html#cb119-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">Test_3 =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">1</span>))</span>
<span id="cb119-8"><a href="the-programming-environment.html#cb119-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-9"><a href="the-programming-environment.html#cb119-9" aria-hidden="true" tabindex="-1"></a>treat_tests</span></code></pre></div>
<pre><code>##   Patient Test_1 Test_2 Test_3
## 1       A      1      2      5
## 2       B      3      4      3
## 3       C      5      6      2
## 4       D      4      4      1</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="the-programming-environment.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we want to understand the overall test scores (or average test scores). We do so by using the long format to get the overall scores per patient. </span></span>
<span id="cb121-2"><a href="the-programming-environment.html#cb121-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-3"><a href="the-programming-environment.html#cb121-3" aria-hidden="true" tabindex="-1"></a>treat_tests_all <span class="ot">&lt;-</span> treat_tests <span class="sc">%&gt;%</span> </span>
<span id="cb121-4"><a href="the-programming-environment.html#cb121-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> Test,</span>
<span id="cb121-5"><a href="the-programming-environment.html#cb121-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">value =</span> Scores, </span>
<span id="cb121-6"><a href="the-programming-environment.html#cb121-6" aria-hidden="true" tabindex="-1"></a>         Test_1<span class="sc">:</span>Test_3)</span>
<span id="cb121-7"><a href="the-programming-environment.html#cb121-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-8"><a href="the-programming-environment.html#cb121-8" aria-hidden="true" tabindex="-1"></a>treat_tests_all</span></code></pre></div>
<pre><code>##    Patient   Test Scores
## 1        A Test_1      1
## 2        B Test_1      3
## 3        C Test_1      5
## 4        D Test_1      4
## 5        A Test_2      2
## 6        B Test_2      4
## 7        C Test_2      6
## 8        D Test_2      4
## 9        A Test_3      5
## 10       B Test_3      3
## 11       C Test_3      2
## 12       D Test_3      1</code></pre>
<p>Accordingly, we now have an observation per patient and test score, instead of three test observations in one row.</p>
<p>This is the main idea of transforming from wide to long formats. It basically constitutes that you <strong>define columns that you transform into rows, based on given attributes</strong>. In our case, we used the Test Scores columns and transformed them into one column where we indicated with Test gave which score. This is also quite handy to use with time-series transformation, which is what we will look at later in the course.</p>
<p><strong><code>spread</code></strong></p>
<p>Spread is the opposite of gather. That is, you transform one column to multiple columns, based on some attributes.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="the-programming-environment.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s transform it back</span></span>
<span id="cb123-2"><a href="the-programming-environment.html#cb123-2" aria-hidden="true" tabindex="-1"></a>treat_test_back <span class="ot">&lt;-</span> treat_tests_all <span class="sc">%&gt;%</span> </span>
<span id="cb123-3"><a href="the-programming-environment.html#cb123-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(<span class="at">key =</span> Test, </span>
<span id="cb123-4"><a href="the-programming-environment.html#cb123-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">value =</span> Scores)</span>
<span id="cb123-5"><a href="the-programming-environment.html#cb123-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-6"><a href="the-programming-environment.html#cb123-6" aria-hidden="true" tabindex="-1"></a>treat_test_back</span></code></pre></div>
<pre><code>##   Patient Test_1 Test_2 Test_3
## 1       A      1      2      5
## 2       B      3      4      3
## 3       C      5      6      2
## 4       D      4      4      1</code></pre>
<p>As such, we just reversed what we did before. That is, we transformed one column according to the key attributes from another column.</p>
</div>
</div>
<div id="beautiful-graphs-with-ggplot2" class="section level3" number="2.2.8">
<h3><span class="header-section-number">2.2.8</span> Beautiful Graphs with <code>ggplot2</code></h3>
<p>Plotting and graphing data, commonly known as visualising, is perhaps one of the most important abilities you can have as data scientist or analyst. Although the usual plot functions work on R, they are quite ugly. Consequently, I would not recommend you to present any of your output in a general baseline plot, unless you just want to assess the data yourself and no one except you can see it.</p>
<p>However, once you need to present your data, visualisation is key. Even the best analysis may easily fail with an ugly plot, but you can stretch a bad analysis pretty far if you can deliver on the plot. As such, we will introduce you to the plotting technique required for this course. This comes in form of the package <code>ggplot</code>. Although it may be a little tricky to understand its inner workings, you will get the hang out of it soon. And, once you get it, the effort-return relation is pretty nice.</p>
<p>So, let’s get started.</p>
<div id="basic-workings-and-options" class="section level4" number="2.2.8.1">
<h4><span class="header-section-number">2.2.8.1</span> Basic Workings and Options</h4>
<p>First, it should be noted that <code>ggplot2</code> is designed to act on data frames. It is actually hard to just draw three data points and for simple graphs it might be easier to use the base graphing system in R. However for any real data analysis project, most data will already be in the required format.</p>
<p>There are many defined graphing functions within ggplot. This makes it easy to stack multiple graphs on each other and create quite complicated structures with just some lines of code. The <a href="https://ggplot2.tidyverse.org/reference/">entire list of options can be found here</a>, but the main geometries to display data are the following:</p>
<div class="figure">
<img src="/Users/nikolasanic/Desktop/Empirical%20Asset%20Management/R/Images/GGPlot_Geometries.jpg" alt="" />
<p class="caption">Figure 3: Geometries in ggplot</p>
</div>
<p>A graph can be built up layer by layer, where:</p>
<ul>
<li>Each layer corresponds to a geom, each of which requires a dataset and a mapping between an aesthetic and a column of the data set.</li>
<li>If you don’t specify either, then the layer inherits everything defined in the ggplot() command.</li>
<li>You can have different datasets for each layer!</li>
<li>Layers can be added with a +, or you can define two plots and add them together (second one over-writes anything that conflicts).</li>
</ul>
</div>
<div id="metling-a-dataframe" class="section level4" number="2.2.8.2">
<h4><span class="header-section-number">2.2.8.2</span> Metling a dataframe</h4>
<p>An important notion for using ggplots is that you need to define which columns should be accessed. This is where the <strong>wide to long format</strong> transformation comes into play. Let’s say we have multiple columns that we would like to plot. In order for ggplot to understand which columns we want to print, it is often easier to transform the columns of interest into a long format, implying that you summarise the columns into one single column and have an index column telling you which values belong to which former column.</p>
<p>This can be done by using the <code>melt()</code> function. The melt function does exactly what we did before when transofming wide to long formats. As such, I will primarily stick with this function while using ggplots.</p>
</div>
<div id="graph-geometry-options" class="section level4" number="2.2.8.3">
<h4><span class="header-section-number">2.2.8.3</span> Graph Geometry Options</h4>
<p>In this section, we quickly show you the most important geometries and how to apply them. We will use the <code>mpg</code> dataset for the illustration purposes. This is a dataset summarising car attributes.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="the-programming-environment.html#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb125-2"><a href="the-programming-environment.html#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(mpg, <span class="at">package =</span> <span class="st">&quot;ggplot2&quot;</span>)</span>
<span id="cb125-3"><a href="the-programming-environment.html#cb125-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mpg)</span></code></pre></div>
<pre><code>## tibble [234 × 11] (S3: tbl_df/tbl/data.frame)
##  $ manufacturer: chr [1:234] &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; &quot;audi&quot; ...
##  $ model       : chr [1:234] &quot;a4&quot; &quot;a4&quot; &quot;a4&quot; &quot;a4&quot; ...
##  $ displ       : num [1:234] 1.8 1.8 2 2 2.8 2.8 3.1 1.8 1.8 2 ...
##  $ year        : int [1:234] 1999 1999 2008 2008 1999 1999 2008 1999 1999 2008 ...
##  $ cyl         : int [1:234] 4 4 4 4 6 6 6 4 4 4 ...
##  $ trans       : chr [1:234] &quot;auto(l5)&quot; &quot;manual(m5)&quot; &quot;manual(m6)&quot; &quot;auto(av)&quot; ...
##  $ drv         : chr [1:234] &quot;f&quot; &quot;f&quot; &quot;f&quot; &quot;f&quot; ...
##  $ cty         : int [1:234] 18 21 20 21 16 18 18 18 16 20 ...
##  $ hwy         : int [1:234] 29 29 31 30 26 26 27 26 25 28 ...
##  $ fl          : chr [1:234] &quot;p&quot; &quot;p&quot; &quot;p&quot; &quot;p&quot; ...
##  $ class       : chr [1:234] &quot;compact&quot; &quot;compact&quot; &quot;compact&quot; &quot;compact&quot; ...</code></pre>
<p><strong>Bar Charts</strong></p>
<p>The simplest graphs are Bar Charts and Histograms. In them, we try to understand some statistical properties about the data, without assessing any relationship thoroughly.</p>
<p>We may be interested in knowing the count of each class of car first.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="the-programming-environment.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># General Structure of a ggplot: </span></span>
<span id="cb127-2"><a href="the-programming-environment.html#cb127-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-3"><a href="the-programming-environment.html#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Lastly </span></span>
<span id="cb127-4"><a href="the-programming-environment.html#cb127-4" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>class)) <span class="sc">+</span> <span class="co"># you first define the dataset you want to operate on and assing the tidy sign %&gt;% </span></span>
<span id="cb127-5"><a href="the-programming-environment.html#cb127-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Then, you call the ggplot() function and define the aesthetics. Those are the values of the x and y variable, if required</span></span>
<span id="cb127-6"><a href="the-programming-environment.html#cb127-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="co"># Lastly, you call the respective geometry you want for the given display</span></span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-63-1.png" width="672" /></p>
<p>The general way how we constructed a data frame here is:</p>
<ul>
<li><p>The data set we wish to use is specified using <code>mpg %&gt;% ...</code></p></li>
<li><p>The column in the data that we wish to investigate is defined in the aes(x=class) part. This means the x-axis will be the car’s class, which is indicated by the column named class</p></li>
<li><p>The way we want to display this information is using a bar chart, which define after the + sign</p></li>
</ul>
<p><strong>Histograms</strong></p>
<p>We use histograms if we want to find the distribution of a single discrete variable.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="the-programming-environment.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s analyse the distribution of cty:</span></span>
<span id="cb128-2"><a href="the-programming-environment.html#cb128-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-3"><a href="the-programming-environment.html#cb128-3" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>cty)) <span class="sc">+</span></span>
<span id="cb128-4"><a href="the-programming-environment.html#cb128-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>()</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-64-1.png" width="672" /></p>
<p><code>geom_histogram</code> breaks up the distribution of the variable into distinct bins. The default bin size is 30. However, we can change the bin size manually:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="the-programming-environment.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s analyse the distribution of cty and change the bin size:</span></span>
<span id="cb130-2"><a href="the-programming-environment.html#cb130-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-3"><a href="the-programming-environment.html#cb130-3" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>cty)) <span class="sc">+</span></span>
<span id="cb130-4"><a href="the-programming-environment.html#cb130-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-65-1.png" width="672" /></p>
<p>Often, instead of using counts, we want to display the <em>density</em> on the y-axis. In order to calculate the density instead of counts, we simply add the option <code>y=..density..</code> to the <code>aes()</code> list that specifies that the y-axis should be the density.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="the-programming-environment.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s analyse the distribution of cty and change the bin size and density on the y axis:</span></span>
<span id="cb131-2"><a href="the-programming-environment.html#cb131-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-3"><a href="the-programming-environment.html#cb131-3" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>cty, <span class="at">y =</span> ..density..)) <span class="sc">+</span></span>
<span id="cb131-4"><a href="the-programming-environment.html#cb131-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">10</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-66-1.png" width="672" /></p>
<p><strong>Scatter Plots</strong></p>
<p>Scatter Plots are used to portray a relationship between two variables based on two to three attributes.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="the-programming-environment.html#cb132-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>cty, <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb132-2"><a href="the-programming-environment.html#cb132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-67-1.png" width="672" /></p>
<p>The only difference between histograms / bar charts and scatter plots is that we <strong>need to define a value on the y-axis</strong> as we are <em>plotting a relationship</em>. In our case, this relationship is highly positively correlated.</p>
<p>If we want to add a further attribute to distinguish the data, we do so by calling the <code>color =</code> argument.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="the-programming-environment.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Still add the relationship between hwy and cty, but now we also add a third dimension in form of the colours for easch distinct transmitter object</span></span>
<span id="cb133-2"><a href="the-programming-environment.html#cb133-2" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> cty, <span class="at">y =</span> hwy, <span class="at">color =</span> trans)) <span class="sc">+</span> <span class="co"># Here, just add color</span></span>
<span id="cb133-3"><a href="the-programming-environment.html#cb133-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.3</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
<p><strong>Line Plots</strong></p>
<p>Line Plots are quite similar to scatterplots, but they just connect the dots with actual lines.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="the-programming-environment.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s quickly create a line plot with new data</span></span>
<span id="cb134-2"><a href="the-programming-environment.html#cb134-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3"><a href="the-programming-environment.html#cb134-3" aria-hidden="true" tabindex="-1"></a>new_dat_line <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">dose =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>), </span>
<span id="cb134-4"><a href="the-programming-environment.html#cb134-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">treat =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">7</span>,<span class="dv">9</span>))</span>
<span id="cb134-5"><a href="the-programming-environment.html#cb134-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-6"><a href="the-programming-environment.html#cb134-6" aria-hidden="true" tabindex="-1"></a>new_dat_line <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>dose, <span class="at">y =</span> treat)) <span class="sc">+</span></span>
<span id="cb134-7"><a href="the-programming-environment.html#cb134-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-69-1.png" width="672" /></p>
<p>We can fine-tune the underlying relation then a little</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="the-programming-environment.html#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s quickly create a line plot and fine tune the relation </span></span>
<span id="cb135-2"><a href="the-programming-environment.html#cb135-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-3"><a href="the-programming-environment.html#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Here, we create a dashed line plot with red dots indicating the x value observation</span></span>
<span id="cb135-4"><a href="the-programming-environment.html#cb135-4" aria-hidden="true" tabindex="-1"></a>new_dat_line <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>dose, <span class="at">y =</span> treat)) <span class="sc">+</span></span>
<span id="cb135-5"><a href="the-programming-environment.html#cb135-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span> </span>
<span id="cb135-6"><a href="the-programming-environment.html#cb135-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.3</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-70-1.png" width="672" /></p>
<p><strong>Box Plots</strong></p>
<p>Box Plots are used to show a categorical variable on the x-axis and continuous on the y-axis.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="the-programming-environment.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s create a boxplot for each class and define its cty distributional parameters</span></span>
<span id="cb136-2"><a href="the-programming-environment.html#cb136-2" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>class, <span class="at">y =</span> cty)) <span class="sc">+</span></span>
<span id="cb136-3"><a href="the-programming-environment.html#cb136-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-71-1.png" width="672" /></p>
<p>Note again how a boxplot is constructed:</p>
<ul>
<li>line below box: show the smallest non-outlier observations</li>
<li>lower line of box: show the 25th percentile observation</li>
<li>fat middle line of box: show the median, or 50th percentile, observation</li>
<li>upper line of box: show the 75th percentile observation</li>
<li>line above box: show the largest non-outlier observations</li>
<li>dots: show the outliers</li>
</ul>
<p><strong>Density Plot</strong></p>
<p>If we want to plot the distribution of one continuous variable, we need to plot a density distribution plot. This is the continuous conuterpart to a histogram. In order to do so, R requires us to define a y variable that can plot the values on the y-axis, such that we can have dot combinations that show a filed area. In order to do so, we need to modify our plot of a density distribution. That is, we need to make use of both the <code>melt()</code> function as well as the <code>geom_density()</code> geometry as a plot.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="the-programming-environment.html#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s create the function for only one variable distribution plot</span></span>
<span id="cb137-2"><a href="the-programming-environment.html#cb137-2" aria-hidden="true" tabindex="-1"></a>hwy <span class="ot">&lt;-</span> mpg[,<span class="fu">c</span>(<span class="st">&quot;hwy&quot;</span>)]</span>
<span id="cb137-3"><a href="the-programming-environment.html#cb137-3" aria-hidden="true" tabindex="-1"></a>melt_hwy<span class="ot">&lt;-</span> <span class="fu">melt</span>(hwy)</span>
<span id="cb137-4"><a href="the-programming-environment.html#cb137-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-5"><a href="the-programming-environment.html#cb137-5" aria-hidden="true" tabindex="-1"></a><span class="co"># This creates of the two columns wide format a one column long format which summarises both columns (indicated as value column). Based on this, we have a column that indicates which of the two former columns is assigned to which value, to now be able to plot multiple column density plots.  </span></span>
<span id="cb137-6"><a href="the-programming-environment.html#cb137-6" aria-hidden="true" tabindex="-1"></a>melt_hwy <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> variable)) <span class="sc">+</span></span>
<span id="cb137-7"><a href="the-programming-environment.html#cb137-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-72-1.png" width="672" /></p>
</div>
<div id="added-geometry-options" class="section level4" number="2.2.8.4">
<h4><span class="header-section-number">2.2.8.4</span> Added Geometry Options</h4>
<p><strong>Smooth</strong></p>
<p>If we have a scatterplot, we can easily add a line to show the average relation between both variables. This is done using the <code>geom_smooth()</code> geometry option.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="the-programming-environment.html#cb138-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> cty, <span class="at">y =</span> hwy)) <span class="sc">+</span></span>
<span id="cb138-2"><a href="the-programming-environment.html#cb138-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.3</span>) <span class="sc">+</span> </span>
<span id="cb138-3"><a href="the-programming-environment.html#cb138-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="co"># This is the geom_smmoth option</span></span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
<p>Here, we add a linear model regression line to define the relation between both variables. The grey area around it is the 95% Confidende Interval. Inerestingly, if we would add a third dimension in form of the colour argument, then we could see that R produces mutliple smooth lines for each of the z variable values, if the z variable is categorical</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="the-programming-environment.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s create a smooth line for each unique element of the z variable called &quot;drv&quot;</span></span>
<span id="cb140-2"><a href="the-programming-environment.html#cb140-2" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> cty, <span class="at">y =</span> hwy, <span class="at">color =</span> drv)) <span class="sc">+</span></span>
<span id="cb140-3"><a href="the-programming-environment.html#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.3</span>) <span class="sc">+</span> </span>
<span id="cb140-4"><a href="the-programming-environment.html#cb140-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="co"># This is the geom_smmoth option</span></span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
<p><strong>Errorbar</strong></p>
<p>Error Bars are also a useful feature to determine more about the structure of the underlying data. You can use error bars in the same fashion as you would use a confidence interval band we’ve seen in the <code>geom_smooth</code> example. Just opposed to the smooth example, error bars are not continuous. They basically indicate an upper and lower bar compared to some pre-defined value you set. In order to use error bars, we make use of the <code>geom_errorbar()</code> geometry.</p>
<p>The most common case to define error bars is to set a mean value and then draw the benchmarks that are <span class="math inline">\(\pm\)</span> 1 standard deviation in proximity to the mean. As such, we mainly use it for further statistical analysis of our underlying variable(s) based on different characteristics.</p>
<p>For instance, we could aim to find out what the upper and lower standard deviation bounds are for the cty characteristic, and distinguish this for the individual classes.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="the-programming-environment.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, define new variables for each class. Here, we:</span></span>
<span id="cb142-2"><a href="the-programming-environment.html#cb142-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-3"><a href="the-programming-environment.html#cb142-3" aria-hidden="true" tabindex="-1"></a>mpg <span class="ot">&lt;-</span> mpg <span class="sc">%&gt;%</span> </span>
<span id="cb142-4"><a href="the-programming-environment.html#cb142-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Group by classes </span></span>
<span id="cb142-5"><a href="the-programming-environment.html#cb142-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(class) <span class="sc">%&gt;%</span> </span>
<span id="cb142-6"><a href="the-programming-environment.html#cb142-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the mean and sd values for the cty variable based on its class</span></span>
<span id="cb142-7"><a href="the-programming-environment.html#cb142-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_cty =</span> <span class="fu">mean</span>(cty)) <span class="sc">%&gt;%</span> </span>
<span id="cb142-8"><a href="the-programming-environment.html#cb142-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sd_cty =</span> <span class="fu">sd</span>(cty)) <span class="sc">%&gt;%</span> </span>
<span id="cb142-9"><a href="the-programming-environment.html#cb142-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create lower and upper bounds per class </span></span>
<span id="cb142-10"><a href="the-programming-environment.html#cb142-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lwr_cty =</span> mean_cty <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>sd_cty) <span class="sc">%&gt;%</span> </span>
<span id="cb142-11"><a href="the-programming-environment.html#cb142-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">upr_cty =</span> mean_cty <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>sd_cty)</span>
<span id="cb142-12"><a href="the-programming-environment.html#cb142-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-13"><a href="the-programming-environment.html#cb142-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the error bar plot for each class</span></span>
<span id="cb142-14"><a href="the-programming-environment.html#cb142-14" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> class)) <span class="sc">+</span> <span class="co"># Still get in the x axis the individual classes</span></span>
<span id="cb142-15"><a href="the-programming-environment.html#cb142-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the error bars per class</span></span>
<span id="cb142-16"><a href="the-programming-environment.html#cb142-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>lwr_cty, <span class="at">ymax=</span>upr_cty)) <span class="sc">+</span> </span>
<span id="cb142-17"><a href="the-programming-environment.html#cb142-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the mean points per class</span></span>
<span id="cb142-18"><a href="the-programming-environment.html#cb142-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean_cty), <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">size=</span><span class="dv">3</span>, <span class="at">shape=</span><span class="dv">21</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
</div>
<div id="plotting-multiple-variables" class="section level4" number="2.2.8.5">
<h4><span class="header-section-number">2.2.8.5</span> Plotting Multiple Variables</h4>
<p>Plotting multiple variables can, at times, be tricky in ggplot. However, especially when considering time-series data or distributional characteristics, it may be important to display multiple columns in the same plot. This is the case when considering histograms or density plots. In order to circumvent this issue, one (although not the only) approach is to transform multiple columns into one column. We’ve seen this already when we introduced the wide to long transformation format.</p>
<p>This type of transformation is possible by using the function <code>melt()</code> that we’ve introduced while working with density plots. In essence, melt takes the columns of interest and creates two additional columns: A <code>value</code> column, which includes all the values of the baseline columns stacked beneath each other, as well as a <code>variable</code> column, which assigns to each value cell the respective variable name of the baseline columns.</p>
<p>By using melt, R understands that multiple values are assigned specific to specific variables. By using a two-column organisation, ggplot is able to draw a x-y combination of data, making it easier to handle the relationship.</p>
<p>Let’s apply this. For instance, take two variables:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="the-programming-environment.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To create a density function, we first need to define a density to melt the respective variables into one column</span></span>
<span id="cb143-2"><a href="the-programming-environment.html#cb143-2" aria-hidden="true" tabindex="-1"></a>hwy_cty <span class="ot">&lt;-</span> mpg[,<span class="fu">c</span>(<span class="st">&quot;hwy&quot;</span>, <span class="st">&quot;cty&quot;</span>)]</span>
<span id="cb143-3"><a href="the-programming-environment.html#cb143-3" aria-hidden="true" tabindex="-1"></a>melt_hwy_cty <span class="ot">&lt;-</span> <span class="fu">melt</span>(hwy_cty)</span>
<span id="cb143-4"><a href="the-programming-environment.html#cb143-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-5"><a href="the-programming-environment.html#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="co"># This creates of the two columns wide format a one column long format which summarises both columns (indicated as value column). Based on this, we have a column that indicates which of the two former columns is assigned to which value, to now be able to plot multiple column density plots.  </span></span>
<span id="cb143-6"><a href="the-programming-environment.html#cb143-6" aria-hidden="true" tabindex="-1"></a>melt_hwy_cty <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> variable)) <span class="sc">+</span></span>
<span id="cb143-7"><a href="the-programming-environment.html#cb143-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="the-programming-environment.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can also create a histogram from it</span></span>
<span id="cb144-2"><a href="the-programming-environment.html#cb144-2" aria-hidden="true" tabindex="-1"></a>melt_hwy_cty <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> variable)) <span class="sc">+</span></span>
<span id="cb144-3"><a href="the-programming-environment.html#cb144-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-77-1.png" width="672" /></p>
</div>
<div id="plotting-time-series" class="section level4" number="2.2.8.6">
<h4><span class="header-section-number">2.2.8.6</span> Plotting Time-Series</h4>
<p>Plotting time-series objects will be especially important throughout this course. In essence we want to see how different variables behave throughout time. Remember that we always use an xts object transformation to work with time-series data. Also note that all data manipulation strategies work exactly in the same way as when working with non time-series based data.</p>
<p><strong>Line Plots</strong></p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="the-programming-environment.html#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s load some of the data on the SMI again</span></span>
<span id="cb146-2"><a href="the-programming-environment.html#cb146-2" aria-hidden="true" tabindex="-1"></a>df_2 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;~/Desktop/Master UZH/Data/A1_dataset_01.txt&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>,  <span class="at">dec =</span> <span class="st">&#39;.&#39;</span>)[,<span class="fu">c</span>(<span class="st">&quot;Date&quot;</span>, <span class="st">&quot;ABB&quot;</span>, <span class="st">&quot;Adecco&quot;</span>, <span class="st">&quot;Nestle_PS&quot;</span>, <span class="st">&quot;Roche_Holding&quot;</span>)]</span>
<span id="cb146-3"><a href="the-programming-environment.html#cb146-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-4"><a href="the-programming-environment.html#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use a Date column</span></span>
<span id="cb146-5"><a href="the-programming-environment.html#cb146-5" aria-hidden="true" tabindex="-1"></a>df_ts_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(df_2<span class="sc">$</span>Date)</span>
<span id="cb146-6"><a href="the-programming-environment.html#cb146-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-7"><a href="the-programming-environment.html#cb146-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform the new dataset into an xts object</span></span>
<span id="cb146-8"><a href="the-programming-environment.html#cb146-8" aria-hidden="true" tabindex="-1"></a>df_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(df_2[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> df_ts_date)</span>
<span id="cb146-9"><a href="the-programming-environment.html#cb146-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-10"><a href="the-programming-environment.html#cb146-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the Returns (We show you everything on this next week)</span></span>
<span id="cb146-11"><a href="the-programming-environment.html#cb146-11" aria-hidden="true" tabindex="-1"></a>df_2_ret_ts <span class="ot">&lt;-</span> <span class="fu">Return.calculate</span>(df_ts)</span>
<span id="cb146-12"><a href="the-programming-environment.html#cb146-12" aria-hidden="true" tabindex="-1"></a>df_2_ret_ts <span class="ot">&lt;-</span> df_2_ret_ts[<span class="st">&quot;1999-09-30/2010-12-31&quot;</span>]</span>
<span id="cb146-13"><a href="the-programming-environment.html#cb146-13" aria-hidden="true" tabindex="-1"></a>df_2_ret_ts_cum <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(<span class="dv">1</span><span class="sc">+</span>df_2_ret_ts)</span>
<span id="cb146-14"><a href="the-programming-environment.html#cb146-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-15"><a href="the-programming-environment.html#cb146-15" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df_2_ret_ts_cum)</span></code></pre></div>
<pre><code>##                  ABB   Adecco Nestle_PS Roche_Holding
## 1999-09-30 1.0032523 1.004790 0.9431438      0.991155
## 1999-10-29 0.9935303 1.106589 0.9832776      1.044520
## 1999-11-30 1.0178003 1.217969 0.9571906      1.095894
## 1999-12-31 1.2605351 1.485036 0.9755853      1.078769
## 2000-01-31 1.1812555 1.486237 0.9050167      1.015982
## 2000-02-29 1.1488722 1.580845 0.9408027      1.026258</code></pre>
<p>Now, we created a time-series return data frame that we will use for further elaboration. Especially, we are interested in understanding the return behaviour over time of the securities under consideration. Doing so, we need to work with the <code>tidy()</code> function that we introduced earlier.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="the-programming-environment.html#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here, we create a tidied time-series function on which we then run the ggplot</span></span>
<span id="cb148-2"><a href="the-programming-environment.html#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(df_2_ret_ts_cum) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> index, <span class="at">y =</span> value, <span class="at">color =</span> series)) <span class="sc">+</span> </span>
<span id="cb148-3"><a href="the-programming-environment.html#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The ggplot aesthetics block takes three arguments: </span></span>
<span id="cb148-4"><a href="the-programming-environment.html#cb148-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1) x = index (Time-Series (Years here))</span></span>
<span id="cb148-5"><a href="the-programming-environment.html#cb148-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 2) y = value (The actual cumulative returns data)</span></span>
<span id="cb148-6"><a href="the-programming-environment.html#cb148-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 3) color = series (The different securities)</span></span>
<span id="cb148-7"><a href="the-programming-environment.html#cb148-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-79-1.png" width="672" /></p>
<p>This is a very handy feature to define a ggplot time series. Note the steps that we performed:</p>
<ul>
<li>We created a tidy-time-series (TTS). This is, to some extent, a similar format as what we get when using the <code>melt()</code> function.</li>
<li>From this, the program operates as if we merge the multiple columns of the time-series returns for the different securities into one column and assign the respective security names to each time-series return structure.</li>
<li>We then created a ggplot aesthetics block with the following arguments:</li>
<li>x = index</li>
<li>This takes the index column of the dataframe and assigns it to the x-axis of the plot</li>
<li>Since we work with an xts object, the date column is the index column</li>
<li>We assigned the index status to the date column by setting the <code>group.by =</code> to the respective date column we defined</li>
<li>y = value</li>
<li>This takes the artificially created value column and prints its values on the y-axis</li>
<li>Since we used a <code>tidy()</code> command for our dataset, we artificially melted the different security columns into one stock column</li>
<li>This column is now assigned the name “value” and is the long-format from the previous wide format of securities</li>
<li>color = series</li>
<li>This takes the artificially created variable column and assigns the time-series relation of each distinct value component to its respective group (in this case: the respective company)</li>
<li>Since we used a <code>tidy()</code> command for our dataset, we artificially melted the different column names of the wide dataset for each security return into one company column</li>
<li>This column is now assigned the name “series” and is identical to the variable column we defined in melt</li>
</ul>
<p><strong>Density Plots</strong></p>
<p>Working with time-series, we can use the same format structure to create many plots:</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="the-programming-environment.html#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s plot the densities:</span></span>
<span id="cb149-2"><a href="the-programming-environment.html#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(df_2_ret_ts_cum) <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> series, <span class="at">color =</span> series)) <span class="sc">+</span></span>
<span id="cb149-3"><a href="the-programming-environment.html#cb149-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We define here: </span></span>
<span id="cb149-4"><a href="the-programming-environment.html#cb149-4" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1) x = value: These are the cumulative returns used on the x-axis </span></span>
<span id="cb149-5"><a href="the-programming-environment.html#cb149-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 2) fill &amp; color = series: These are the y-axis attributes that give you </span></span>
<span id="cb149-6"><a href="the-programming-environment.html#cb149-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">### (1) the color which defines the density attributes for each stock</span></span>
<span id="cb149-7"><a href="the-programming-environment.html#cb149-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">### (2) the filling of the density for each security (if you remove the fill command, you just get lines)</span></span>
<span id="cb149-8"><a href="the-programming-environment.html#cb149-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>)</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
<p>Here, we defined the same set-up as with the line plots, but just had to re-shuffle in order not to use the time-series character of the data.</p>
<p><strong>Melt and Tidy</strong></p>
<p>By using this set-up, we are able to draw a time-series relationship of multiple stocks and distinguish them by color. Note that this is <strong>identical to the melt set-up</strong> we used to create two differently coloured histograms or density plots for each of the two variables. In effect, looking at the both datasets, we see their identity:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="the-programming-environment.html#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(df_2_ret_ts_cum)</span></code></pre></div>
<pre><code>## # A tibble: 544 × 3
##    index      series        value
##    &lt;date&gt;     &lt;chr&gt;         &lt;dbl&gt;
##  1 1999-09-30 ABB           1.00 
##  2 1999-09-30 Adecco        1.00 
##  3 1999-09-30 Nestle_PS     0.943
##  4 1999-09-30 Roche_Holding 0.991
##  5 1999-10-29 ABB           0.994
##  6 1999-10-29 Adecco        1.11 
##  7 1999-10-29 Nestle_PS     0.983
##  8 1999-10-29 Roche_Holding 1.04 
##  9 1999-11-30 ABB           1.02 
## 10 1999-11-30 Adecco        1.22 
## # … with 534 more rows</code></pre>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="the-programming-environment.html#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(melt_hwy)</span></code></pre></div>
<pre><code>##   variable value
## 1      hwy    29
## 2      hwy    29
## 3      hwy    31
## 4      hwy    30
## 5      hwy    26
## 6      hwy    26</code></pre>
<p>The only, but MAJOR, difference is, that you should use:</p>
<ul>
<li>A <strong>tidy</strong> dataset for <strong>Time-Series</strong></li>
<li>A <strong>melt</strong> dataset for <strong>Cross-Sections</strong></li>
</ul>
</div>
<div id="further-aesthetics" class="section level4" number="2.2.8.7">
<h4><span class="header-section-number">2.2.8.7</span> Further Aesthetics</h4>
<p>We now have seen how to use the basic plotting options, how to add geometry features and how to apply them to multiple variables in both cross-sectional as well as time-series structures. Now, we can start fine-tuning our plots. That is, we can start to make them more visually appealing and add important information surrounding the data. <a href="https://ggplot2.tidyverse.org/reference/">The entire documentation can be found here</a>, but we will go over the major arguments.</p>
<p><strong>Colours</strong></p>
<p>First, let’s look at the color scales offered. ggplot offers over 150 distinct colors that you can use. These colours can be used on any plot, to define lines, histogram fillings, points, bars, regions etc. A general overview of all available colours is in the image below</p>
<p><img src="/Users/nikolasanic/Desktop/Empirical%20Asset%20Management/R/Images/ggplot2_colors.jpg" alt="Figure 4: Colors in ggplot" />.</p>
<p>Further, we can use colour scales. These are ranges of colours that enable the use of continuous colour formats, which are often used enable a better distinction between certain values based on the color attribute (e.g. blue are low and red high values).</p>
<div class="figure">
<img src="/Users/nikolasanic/Desktop/Empirical%20Asset%20Management/R/Images/ggplot2_color_ranges.jpg" alt="" />
<p class="caption">Figure 5: Color Ranges in <code>ggplot</code></p>
</div>
<p>In general, ggplot offers some color combinations for all geometries. There are numerous main arguments to use:</p>
<ul>
<li><p><code>scale_color_manual()</code>: Manually add colors for lines and points in the plots</p></li>
<li><p><code>scale_colour_steps()</code>: Step-wise add colors for lines and points in the plots</p></li>
<li><p><code>scale_colour_gradient()</code>: Gradient color format for lines and points in the plots (e.g. scale colors)</p></li>
<li><p><code>scale_colour_grey()</code>: Grey-scale colours for lines and points in the plots</p></li>
<li><p><code>scale_fill_manual()</code>: Manually add colors used for the filling of areas or densities</p></li>
<li><p><code>scale_fill_steps()</code>: Step-wise add colors used for the filling of areas or densities</p></li>
<li><p><code>scale_fill_gradient()</code>: Gradient color format for the filling of areas or densities</p></li>
<li><p><code>scale_fill_grey()</code>: Grey-scale colours used for the filling of areas or densities</p></li>
</ul>
<p><strong>Shapes, Radii, Sizes</strong></p>
<p>Despite distinguishing data by colour, we can also find discrepancies by using different forms:</p>
<ul>
<li><code>scale_linetype()</code>: Automatically assign line types to different variables</li>
<li><code>scale_shape()</code>: Automatically assign point shape types to different variables</li>
<li><code>scale_size()</code>: Automatically assign point size or radius to different variables</li>
</ul>
<p><strong>Scales</strong></p>
<ul>
<li><code>ggtitle()</code>: Set the title of a plot</li>
<li><code>xlab()</code>, <code>ylab()</code>: Set the x-axis and y-axis titles</li>
<li><code>xlim()</code>, <code>ylim()</code>: Set the x-axis and y-axis limits</li>
<li><code>labs()</code>: Set the title of the legend</li>
</ul>
<p><strong>Themes</strong></p>
<ul>
<li><code>theme()</code>: Used as an umbrella term to define sizes, margins, colours and grids of the background of a plot. In it you get:</li>
<li><code>plot.title</code>: Used to define the plot title design. Main arguments used:</li>
<li><code>element_text()</code>: Used to define the elements of the title design, including: <code>size</code>: Title Size, <code>color</code> = Title Colour, <code>hjust</code> = Horizontal Adjustment (How centered the title should be), <code>lineheight</code> = Height between the lines if the title has multiple lines, <code>margin</code> = The exact positioning between the upper end of the image and the actual plot</li>
<li><code>axis.title.x</code>, <code>axis.title.y</code>: Used to define the plot x-axis and y-axis title design. Main arguments used are identical to <code>plot.title</code></li>
<li><code>panel.background</code>: Used to define the background of the panel (part that includes the roaster with data). Main argument used:</li>
<li><code>element_rect</code>: Used to define the filling (<code>fill</code>) and the colour (<code>colour</code>) of the panel background</li>
<li><code>plot.background</code>: Used to define the background of the plot excluding the panel. Main arguments used are identical to <code>panel.background</code></li>
<li><code>panel.grid.major.x</code>, <code>panel.grid.major.y</code>: Used to define the design of the major vertical and horizontal lines on the x and y axis (if needed). Main arguments are:</li>
<li><code>size</code>: Get the size of the line</li>
<li><code>linetype</code>: Get the type of the line</li>
<li><code>colour</code>: Get the colour of the line</li>
<li><code>element_blank()</code>: Do not add any line</li>
<li><code>panel.grid.minor.x</code>, <code>panel.grid.minor.y</code>: Used to define the design of the minor vertical and horizontal lines on the x and y axis (if needed). Main arguments identical to the major options
<code>axis.line</code>: Used to define the design of the x and y axis. Main argument is:</li>
<li><code>element_line()</code>: Gives the colour of the x and y axis</li>
</ul>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="the-programming-environment.html#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot</span></span>
<span id="cb154-2"><a href="the-programming-environment.html#cb154-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-3"><a href="the-programming-environment.html#cb154-3" aria-hidden="true" tabindex="-1"></a>figure <span class="ot">&lt;-</span> <span class="fu">tidy</span>(df_2_ret_ts_cum) <span class="sc">%&gt;%</span> </span>
<span id="cb154-4"><a href="the-programming-environment.html#cb154-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot design in general</span></span>
<span id="cb154-5"><a href="the-programming-environment.html#cb154-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>index,<span class="at">y=</span>value, <span class="at">color=</span>series)) <span class="sc">+</span> </span>
<span id="cb154-6"><a href="the-programming-environment.html#cb154-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Plot geometry(ies)</span></span>
<span id="cb154-7"><a href="the-programming-environment.html#cb154-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb154-8"><a href="the-programming-environment.html#cb154-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Line, Point and Fill colours</span></span>
<span id="cb154-9"><a href="the-programming-environment.html#cb154-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;goldenrod&quot;</span>, <span class="st">&quot;darkorchid4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>,<span class="st">&quot;dodgerblue1&quot;</span>, <span class="st">&quot;springgreen2&quot;</span>,  <span class="st">&quot;darkorchid4&quot;</span>, <span class="st">&quot;dodgerblue4&quot;</span>))  <span class="sc">+</span></span>
<span id="cb154-10"><a href="the-programming-environment.html#cb154-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;goldenrod&quot;</span>, <span class="st">&quot;darkorchid4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>,<span class="st">&quot;dodgerblue1&quot;</span>, <span class="st">&quot;springgreen2&quot;</span>,  <span class="st">&quot;darkorchid4&quot;</span>, <span class="st">&quot;dodgerblue4&quot;</span>)) <span class="sc">+</span></span>
<span id="cb154-11"><a href="the-programming-environment.html#cb154-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-12"><a href="the-programming-environment.html#cb154-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># IMPORTANTLY, IF YOU HAVE MULTIPLE COLOURS, THE COLOUR SORTING (WHICH VARIABLE GETS WHICH COLOUR) IS BASED ON THE NAME OF THE VARIABLE, NOT ITS POSITION IN THE DATAFRAME. E.G.: HERE, THE SEQUENCE OF VARIABLE NAMES IS: 10K-PHYS, 10K-REG, 8K-GEN, MC-GEN, MC-PHYS, MC-REG, MC-OPPTY </span></span>
<span id="cb154-13"><a href="the-programming-environment.html#cb154-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --&gt; THIS IS THE WAY HOW GGPLOT ASSIGNS COLOURS ABOVE!</span></span>
<span id="cb154-14"><a href="the-programming-environment.html#cb154-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-15"><a href="the-programming-environment.html#cb154-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># X and Y axis string</span></span>
<span id="cb154-16"><a href="the-programming-environment.html#cb154-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Cumulative Returns&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> </span>
<span id="cb154-17"><a href="the-programming-environment.html#cb154-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Title string</span></span>
<span id="cb154-18"><a href="the-programming-environment.html#cb154-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Relationship of Cumulative Returns of some SMI Securities&quot;</span>) <span class="sc">+</span></span>
<span id="cb154-19"><a href="the-programming-environment.html#cb154-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb154-20"><a href="the-programming-environment.html#cb154-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb154-21"><a href="the-programming-environment.html#cb154-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Title Elements</span></span>
<span id="cb154-22"><a href="the-programming-environment.html#cb154-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">0.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb154-23"><a href="the-programming-environment.html#cb154-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Axis Elements</span></span>
<span id="cb154-24"><a href="the-programming-environment.html#cb154-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb154-25"><a href="the-programming-environment.html#cb154-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb154-26"><a href="the-programming-environment.html#cb154-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Background colour and fill</span></span>
<span id="cb154-27"><a href="the-programming-environment.html#cb154-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb154-28"><a href="the-programming-environment.html#cb154-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb154-29"><a href="the-programming-environment.html#cb154-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Major Panel Grids</span></span>
<span id="cb154-30"><a href="the-programming-environment.html#cb154-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-31"><a href="the-programming-environment.html#cb154-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb154-32"><a href="the-programming-environment.html#cb154-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Minor Panel Grids</span></span>
<span id="cb154-33"><a href="the-programming-environment.html#cb154-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-34"><a href="the-programming-environment.html#cb154-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb154-35"><a href="the-programming-environment.html#cb154-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Line colour of the x and y axis</span></span>
<span id="cb154-36"><a href="the-programming-environment.html#cb154-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)) </span>
<span id="cb154-37"><a href="the-programming-environment.html#cb154-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-38"><a href="the-programming-environment.html#cb154-38" aria-hidden="true" tabindex="-1"></a>figure</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-83-1.png" width="672" /></p>
</div>
<div id="facetting-plots" class="section level4" number="2.2.8.8">
<h4><span class="header-section-number">2.2.8.8</span> Facetting plots</h4>
<p>The goal with faceting is to make many panels of graphics where each panel represents the same relationship between variables, but based on attributes of a third variable. This is basically the same as if we would print relationships according to colour, where colour defines the third attribute under consideration. We use this tool with the function <code>facet_grid()</code>.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="the-programming-environment.html#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s create a faceted ggplot by drawing the relationship of cty and hwy on a scatterplot</span></span>
<span id="cb155-2"><a href="the-programming-environment.html#cb155-2" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> cty, <span class="at">y =</span> hwy)) <span class="sc">+</span> </span>
<span id="cb155-3"><a href="the-programming-environment.html#cb155-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb155-4"><a href="the-programming-environment.html#cb155-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Here, we define that it should print the same relation just for each year separately</span></span>
<span id="cb155-5"><a href="the-programming-environment.html#cb155-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> year) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-84-1.png" width="672" /></p>
<p>The <code>facet_grid()</code> tells ggplot to plot the relationship of hwy and cty twice, for each year separately.</p>
<p>Note that we can easily extend this relation up to multiple dimensions. Let’s take another variable into the equation.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="the-programming-environment.html#cb156-1" aria-hidden="true" tabindex="-1"></a>mpg <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> cty, <span class="at">y =</span> hwy)) <span class="sc">+</span> </span>
<span id="cb156-2"><a href="the-programming-environment.html#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb156-3"><a href="the-programming-environment.html#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Here, we define that it should print the same relation just for each year separately</span></span>
<span id="cb156-4"><a href="the-programming-environment.html#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(drv <span class="sc">~</span> year) </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-85-1.png" width="672" /></p>
<p>Here, we take the relation between hwy and cty in a scatterplot, but we do this depending on the <strong>combination of two variables</strong> now. The first is the year of construction, the second is the driving gear (four-wheel, rear or forward drive). As such, we introduce another dimension on the facet grid. As such, we can see relations for both the driving gear and the year of production.</p>
</div>
<div id="adjusting-scales" class="section level4" number="2.2.8.9">
<h4><span class="header-section-number">2.2.8.9</span> Adjusting Scales</h4>
<p>It is often useful to scale the x and y axis in order to display logarithms, exponentials or other forms of transformations. For this, let’s take a data set that incorporates income and age.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="the-programming-environment.html#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data set</span></span>
<span id="cb157-2"><a href="the-programming-environment.html#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;Lock5Data&quot;</span>)</span></code></pre></div>
<pre><code>## 
## The downloaded binary packages are in
##  /var/folders/97/v7mhh7_10r54n7qdx4ykd6wc0000gn/T//RtmpBcpnf2/downloaded_packages</code></pre>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="the-programming-environment.html#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Lock5Data)</span>
<span id="cb159-2"><a href="the-programming-environment.html#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(ACS)</span></code></pre></div>
<p>First print income to age in a normal relation:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="the-programming-environment.html#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Unadjusted scatterplot</span></span>
<span id="cb160-2"><a href="the-programming-environment.html#cb160-2" aria-hidden="true" tabindex="-1"></a>ACS <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Age, <span class="at">y =</span> Income)) <span class="sc">+</span></span>
<span id="cb160-3"><a href="the-programming-environment.html#cb160-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() </span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-87-1.png" width="672" /></p>
<p>Here, the data is not well structured, as certain values skew the display of the data considerably.</p>
<p>Consequently, we need two adjustments:</p>
<ol style="list-style-type: decimal">
<li>We need to adjust the y values in order to get a better shape of the data</li>
<li>We need to adjust the y-axis to represent the scaled the y values correctly</li>
</ol>
<p>If we now want to use a log-transformation, we do so by the following code:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="the-programming-environment.html#cb161-1" aria-hidden="true" tabindex="-1"></a>ACS <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Age, <span class="at">y =</span> Income)) <span class="sc">+</span> </span>
<span id="cb161-2"><a href="the-programming-environment.html#cb161-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb161-3"><a href="the-programming-environment.html#cb161-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Here, we add the log-transformation on the y-axis</span></span>
<span id="cb161-4"><a href="the-programming-environment.html#cb161-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_y_log10</span>(<span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">100</span>, <span class="dv">1000</span>),</span>
<span id="cb161-5"><a href="the-programming-environment.html#cb161-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># First define the major break lines according to the log-scale</span></span>
<span id="cb161-6"><a href="the-programming-environment.html#cb161-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">minor=</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb161-7"><a href="the-programming-environment.html#cb161-7" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">100</span>,<span class="at">by=</span><span class="dv">10</span> ),</span>
<span id="cb161-8"><a href="the-programming-environment.html#cb161-8" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">seq</span>(<span class="dv">100</span>,<span class="dv">1000</span>,<span class="at">by=</span><span class="dv">100</span>))) <span class="sc">+</span></span>
<span id="cb161-9"><a href="the-programming-environment.html#cb161-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Then, set the minor break lines as sequence from to and by a given amount</span></span>
<span id="cb161-10"><a href="the-programming-environment.html#cb161-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># to get the e^10 distributional marks </span></span>
<span id="cb161-11"><a href="the-programming-environment.html#cb161-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Income in 1&#39;000 US Dollars&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Transformation introduced infinite values in continuous y-axis</code></pre>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-88-1.png" width="672" /></p>
<p>The handy property of the scaling of the y-axis is that it <strong>directly transforms the values on the y axis</strong> such that they are correctly positioned in the graph. As such, we see that the area between <strong>1 and 10 is the same 10 to 100 and 100 to 1000</strong>. Consequently, we can better show the relations, since they are <strong>proportionally transformed</strong>.</p>
<p>Note that we also added some minor gridlines in the form of either 1000, 10000 or 100000 for the respective horizontal levels. This is to better distinguish and identify the appropriate salary levels.</p>
<p><strong>More Transformations</strong></p>
<p>Apparently, logarithmic transformation is not the only scaling option. <a href="https://ggplot2.tidyverse.org/reference/">To get an overview, visit the summary page of ggplot here</a>.</p>
</div>
</div>
<div id="dates-and-times" class="section level3" number="2.2.9">
<h3><span class="header-section-number">2.2.9</span> Dates and Times</h3>
<p>We will be working often times with time-series data. This implies that dates are key when administering and operating with the data. However, dates come in many forms and shapes and are quite unsimilar to each other sometimes. Although the financial industry tries to have common notions regarding date formatting, there still is a discrepancy between the European and Anglosaxen way of writing dates.</p>
<div id="creating-date-and-time-objects" class="section level4" number="2.2.9.1">
<h4><span class="header-section-number">2.2.9.1</span> Creating Date and Time Objects</h4>
<p>To create a Date object, we need to take a string or number that represents a date and tell the computer how to figure out which bits are the year, which are the month, and which are the day. The <code>lubridate</code> package is designed for exactly this purpose.</p>
<div class="figure">
<img src="/Users/nikolasanic/Desktop/Empirical%20Asset%20Management/R/Images/Dates_R.jpg" alt="" />
<p class="caption">Figure 5: Different Date types in <code>lubridate</code></p>
</div>
<p>Usually, in time-series formats for asset pricing, we always use the <code>ymd()</code> specification. Accordingly, the <code>lubridate</code> package works such that it is able to <strong>transform any of these six orders into the <code>ymd()</code></strong> format. To see this, look at the following:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="the-programming-environment.html#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s transform a date written in month, day and year to a ymd() object</span></span>
<span id="cb163-2"><a href="the-programming-environment.html#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mdy</span>( <span class="st">&#39;May 31, 1996&#39;</span>, <span class="st">&#39;May 31 96&#39;</span>, <span class="st">&#39;5-31-96&#39;</span>, <span class="st">&#39;05-31-1996&#39;</span>, <span class="st">&#39;5/31/96&#39;</span>, <span class="st">&#39;5-31/96&#39;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1996-05-31&quot; &quot;1996-05-31&quot; &quot;1996-05-31&quot; &quot;1996-05-31&quot; &quot;1996-05-31&quot; &quot;1996-05-31&quot;</code></pre>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="the-programming-environment.html#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s transform a date written in day, month and year to a ymd() object</span></span>
<span id="cb165-2"><a href="the-programming-environment.html#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dmy</span>(<span class="st">&quot;31st May 1996&quot;</span>, <span class="st">&quot;31.05.1996&quot;</span>, <span class="st">&quot;31 May 96&quot;</span>, <span class="st">&quot;31 May 1996&quot;</span>, <span class="st">&quot;31-5-96&quot;</span>, <span class="st">&quot;31-5-1996&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1996-05-31&quot; &quot;1996-05-31&quot; &quot;1996-05-31&quot; &quot;1996-05-31&quot; &quot;1996-05-31&quot; &quot;1996-05-31&quot;</code></pre>
<p>As we can see, you can tell lubridate which format your date cell is in and it will automatically transform the date into a <code>dmy()</code> format. Especially, we see that the all of the other common date formats can be transformed to this. Especially, we see that this all is possible:</p>
<ul>
<li>“31.05.1996”: German / European Date format</li>
<li>“31st May 1996”: Anglosaxen format with String in dmy</li>
<li>“May 31, 1996”: Anglosaxen format with String in mdy</li>
<li>‘5-31-96’, ‘05-31-1996’: Anglosaxen format without String in mdy</li>
</ul>
<p>In our case, we usually need to create a <code>date()</code> variable which we then use to define an order in an <code>xts</code> object. We can easily do so by combining a <code>lubridate</code> command with the <code>as.Date()</code> command.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="the-programming-environment.html#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s say our data is in a European format. This implies the entire date column of the data frame is given as: dd.mm.yyyy (e.g. 31.05.1996)</span></span>
<span id="cb167-2"><a href="the-programming-environment.html#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We can now easily transform this to a ymd() and then to a date column</span></span>
<span id="cb167-3"><a href="the-programming-environment.html#cb167-3" aria-hidden="true" tabindex="-1"></a>date_test <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">dmy</span>(<span class="st">&quot;31.05.1996&quot;</span>))</span>
<span id="cb167-4"><a href="the-programming-environment.html#cb167-4" aria-hidden="true" tabindex="-1"></a>date_test</span></code></pre></div>
<pre><code>## [1] &quot;1996-05-31&quot;</code></pre>
<p>And here, we see that we were able to transform the data into the correct format which we can use for <code>xts</code> objects.</p>
</div>
<div id="adding-time-to-date" class="section level4" number="2.2.9.2">
<h4><span class="header-section-number">2.2.9.2</span> Adding time to date</h4>
<p>If we want to add a time to a date, we will use a function with the suffix <code>_hm()</code> or <code>hms()</code>, (= hour-minute-second).</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="the-programming-environment.html#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s transform a date written in day, month and year to a ymd_hms() object</span></span>
<span id="cb169-2"><a href="the-programming-environment.html#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dmy_hms</span>(<span class="st">&quot;31st May 1996 16:05:11&quot;</span>, <span class="st">&quot;31.05.1996 16:05:11&quot;</span>, <span class="st">&quot;31 May 96 16:05:11&quot;</span>, <span class="st">&quot;31 May 1996 16:05:11&quot;</span>, <span class="st">&quot;31-5-96 16:05:11&quot;</span>, <span class="st">&quot;31-5-1996 16:05:11&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1996-05-31 16:05:11 UTC&quot; &quot;1996-05-31 16:05:11 UTC&quot; &quot;1996-05-31 16:05:11 UTC&quot; &quot;1996-05-31 16:05:11 UTC&quot; &quot;1996-05-31 16:05:11 UTC&quot;
## [6] &quot;1996-05-31 16:05:11 UTC&quot;</code></pre>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="the-programming-environment.html#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s transform a date written in day, month and year including HMS to a ymd_hms() object</span></span>
<span id="cb171-2"><a href="the-programming-environment.html#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dmy_hms</span>(<span class="st">&quot;31st May 1996 16:05:11&quot;</span>, <span class="st">&quot;31.05.1996 16:05:11&quot;</span>, <span class="st">&quot;31 May 96 16:05:11&quot;</span>, <span class="st">&quot;31 May 1996 16:05:11&quot;</span>, <span class="st">&quot;31-5-96 16:05:11&quot;</span>, <span class="st">&quot;31-5-1996 16:05:11&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1996-05-31 16:05:11 UTC&quot; &quot;1996-05-31 16:05:11 UTC&quot; &quot;1996-05-31 16:05:11 UTC&quot; &quot;1996-05-31 16:05:11 UTC&quot; &quot;1996-05-31 16:05:11 UTC&quot;
## [6] &quot;1996-05-31 16:05:11 UTC&quot;</code></pre>
<p>As we see, the exact same strategy works as before. Consequently, the <code>lubridate</code> package can transform both only dates as well as date and time objects into a classical date and time structure.</p>
<p>This is also interesting for us when transforming date and time objects of a different structure into date objects of structure <code>yyyy-mm-dd</code>. For instance, some dates we get online incorrectly include a time attribute. This is the same time attribute for each date and it contains no information about the data. We can get rid of this time infromation accordingly:</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="the-programming-environment.html#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s say again our data is in a European format. This implies the entire date column of the data frame is given as: dd.mm.yyyy (e.g. 31.05.1996). Further we get the same time object, e.g. 16:05:11 (maybe b/c the data was gathered then).</span></span>
<span id="cb173-2"><a href="the-programming-environment.html#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We can now easily transform this to a ymd_hms() and then to a pure date column</span></span>
<span id="cb173-3"><a href="the-programming-environment.html#cb173-3" aria-hidden="true" tabindex="-1"></a>date_time_test <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="fu">dmy_hms</span>(<span class="st">&quot;31.05.1996 16:05:11&quot;</span>))</span>
<span id="cb173-4"><a href="the-programming-environment.html#cb173-4" aria-hidden="true" tabindex="-1"></a>date_time_test</span></code></pre></div>
<pre><code>## [1] &quot;1996-05-31&quot;</code></pre>
<p>As we can see, we excluded the time part of the object and can thus only work with dates.</p>
</div>
<div id="extracting-information-from-a-date" class="section level4" number="2.2.9.3">
<h4><span class="header-section-number">2.2.9.3</span> Extracting information from a date</h4>
<p>We can get the specific information of a date column in R. For instance, we can get the weekday, the month, the second, or the quarter in which the date is. This may be handy for transformation and grouping purposes of time-series data. A full list is available below:</p>
<div class="figure">
<img src="/Users/nikolasanic/Desktop/Empirical%20Asset%20Management/R/Images/Date_Info_Extraction.jpg" alt="" />
<p class="caption">Figure 6: Extracting information from a date-time object in <code>lubridate</code></p>
</div>
</div>
<div id="the-time-series-of-returns---transformations-in-r" class="section level4" number="2.2.9.4">
<h4><span class="header-section-number">2.2.9.4</span> The time-series of Returns - Transformations in R</h4>
<p>Note that security analysis is always given within a time-series format. We now saw how we can transform date objects to get a common fomrat or how we can extract information from date objects.</p>
<p>Next, we will show you how to <strong>create a time-series object</strong>. We will often work with data which is not pre-defined as a time-series object. However, in order to use many of the analytics functions needed in empirical asset management, we first need to modify the data set into a time-series format. We do so by using the package <code>xts</code>. In the next code block, we will show you how to create such an object and what the structure of this object is. This is the common procedure of transformation in order to get the data in a format with which we can use all the required packages for our analysis.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="the-programming-environment.html#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in the dataset with your path</span></span>
<span id="cb175-2"><a href="the-programming-environment.html#cb175-2" aria-hidden="true" tabindex="-1"></a>A1 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;~/Desktop/Master UZH/Data/A1_dataset_01.txt&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>,  <span class="at">dec =</span> <span class="st">&#39;.&#39;</span>)</span>
<span id="cb175-3"><a href="the-programming-environment.html#cb175-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-4"><a href="the-programming-environment.html#cb175-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Look the data set to get a better overview</span></span>
<span id="cb175-5"><a href="the-programming-environment.html#cb175-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(A1)</span></code></pre></div>
<pre><code>##         Date   ABB Actelion  Adecco Alcon Alusuisse Baloise Ciba_SC Ciba_Geigy_I Ciba_Geigy_PS Clariant Compagnie_Financiere_Richemont
## 1 1988-06-30 5.294       NA 155.845    NA        NA      NA      NA       668.55        305.75       NA                             NA
## 2 1988-07-29 4.982       NA 157.232    NA        NA      NA      NA       649.82        301.81       NA                             NA
## 3 1988-08-31 5.049       NA 162.319    NA        NA      NA      NA       648.83        315.62       NA                             NA
## 4 1988-09-30 5.527       NA 171.476    NA        NA      NA      NA       668.55        327.45       NA                             NA
## 5 1988-10-31 5.928       NA 175.730    NA        NA      NA      NA       685.31        353.10       NA                             NA
## 6 1988-11-30 6.161       NA 171.080    NA        NA      NA      NA       534.45        398.47       NA                             NA
##   Credit_Suisse_Group Credit_Suisse_Holding Elektrowatt EMS_Chemie_Holding Geberit Georg_Fischer Givaudan Holcim Jacobs_Suchard Julius_Baer_Group
## 1                  NA                 76.45      296.70                 NA      NA            NA       NA  98.75           7890                NA
## 2                  NA                 77.05      294.23                 NA      NA            NA       NA  97.82           7700                NA
## 3                  NA                 75.54      286.81                 NA      NA            NA       NA  97.36           7500                NA
## 4                  NA                 80.83      279.89                 NA      NA       184.400       NA  98.29           7750                NA
## 5                  NA                 87.03      292.75                 NA      NA       179.771       NA  99.77           7680                NA
## 6                  NA                 81.28      274.94                 NA      NA       169.741       NA  95.04           6850                NA
##   Kudelski LafargeHolcim Lonza_Group Merck_Serono Nestle_I Nestle_PS Nobel_Biocare_Holding Novartis_I Novartis_N OC_Oerlikon_Corporation
## 1       NA            NA          NA           NA   834.87     4.103                    NA         NA         NA                  17.294
## 2       NA            NA          NA           NA   817.19     4.006                    NA         NA         NA                  16.325
## 3       NA            NA          NA           NA   816.69     4.123                    NA         NA         NA                  19.715
## 4       NA            NA          NA           NA   859.42     4.133                    NA         NA         NA                  21.444
## 5       NA            NA          NA           NA   873.17     4.264                    NA         NA         NA                  20.960
## 6       NA            NA          NA           NA   675.26     5.829                    NA         NA         NA                  21.790
##   Pargesa_Holding Partners_Group Roche_Holding SAirGroup Sandoz_PS Sandoz_N Schweizerische_Volksbank_StN Schweizerische_Volksbank_ST SGS Sika
## 1          30.672             NA        11.166        NA    467.50       NA                       158.67                          NA  NA   NA
## 2          31.068             NA        11.329        NA    491.85       NA                       155.73                          NA  NA   NA
## 3          31.661             NA        11.119        NA    478.21       NA                       154.75                          NA  NA   NA
## 4          33.541             NA        11.935        NA    481.13       NA                       152.79                          NA  NA   NA
## 5          32.057             NA        11.842        NA    479.19       NA                           NA                          NA  NA   NA
## 6          30.276             NA        11.655        NA    411.98       NA                           NA                          NA  NA   NA
##   Societe_Internationale_Pirelli Sulzer Swiss_Bank_I Swiss_Bank_PS Swiss_Bank_N Swiss_Life_Holding_I Swiss_Life_Holding_N Swiss_Re Swissair
## 1                         222.89     NA          351           292           NA                   NA                   NA   16.554  1068.24
## 2                         217.00     NA          380           299           NA                   NA                   NA   16.637  1125.22
## 3                         212.80     NA          357           291           NA                   NA                   NA   16.802  1082.49
## 4                         207.75     NA          375           303           NA                   NA                   NA   16.940  1101.48
## 5                         224.57     NA          391           313           NA                   NA                   NA   17.518  1125.22
## 6                         209.43     NA          363           296           NA                   NA                   NA   19.006  1035.01
##   Swisscom Syngenta Synthes The_Swatch_Group_I The_Swatch_Group_N Transocean UBS_N UBS_PS  UBS_I Winterthur Zurich_Insurance_Group_I
## 1       NA       NA      NA                 NA                 NA         NA    NA  112.5 610.87     955.02                  1406.93
## 2       NA       NA      NA                 NA                 NA         NA    NA  116.0 648.19     972.96                  1397.30
## 3       NA       NA      NA                 NA                 NA         NA    NA  113.5 624.61     937.09                  1319.00
## 4       NA       NA      NA                 NA                 NA         NA    NA  114.5 639.35    1008.82                  1373.21
## 5       NA       NA      NA                 NA                 NA         NA    NA  123.0 675.68     998.96                  1409.34
## 6       NA       NA      NA                 NA                 NA         NA    NA  114.0 613.81     824.99                  1144.34
##   Zurich_Insurance_Group_N
## 1                       NA
## 2                       NA
## 3                       NA
## 4                       NA
## 5                       NA
## 6                       NA</code></pre>
<p>Here, we see how the data is structured. Although it already is in a long format, we still need to transform it to a time-series. Especially, we need to ensure that the Date column is located in the index of the data frame. We do so by following this code:</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="the-programming-environment.html#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the date column in the dataset as as.Date()</span></span>
<span id="cb177-2"><a href="the-programming-environment.html#cb177-2" aria-hidden="true" tabindex="-1"></a>date <span class="ot">=</span> <span class="fu">as.Date</span>(A1[,<span class="dv">1</span>]) </span>
<span id="cb177-3"><a href="the-programming-environment.html#cb177-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-4"><a href="the-programming-environment.html#cb177-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Here, we first assign a date format to the date variable, otherwise the xts package cannot read it. </span></span>
<span id="cb177-5"><a href="the-programming-environment.html#cb177-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Other forms of transformation (as.POSIXct etc.) would certainly also work. </span></span>
<span id="cb177-6"><a href="the-programming-environment.html#cb177-6" aria-hidden="true" tabindex="-1"></a>A1ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> A1[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> date)</span>
<span id="cb177-7"><a href="the-programming-environment.html#cb177-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-8"><a href="the-programming-environment.html#cb177-8" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(A1ts) <span class="co"># Print the structure of Returns</span></span></code></pre></div>
<pre><code>## An &#39;xts&#39; object on 1988-06-30/2021-02-26 containing:
##   Data: num [1:393, 1:62] 5.29 4.98 5.05 5.53 5.93 ...
##  - attr(*, &quot;dimnames&quot;)=List of 2
##   ..$ : NULL
##   ..$ : chr [1:62] &quot;ABB&quot; &quot;Actelion&quot; &quot;Adecco&quot; &quot;Alcon&quot; ...
##   Indexed by objects of class: [Date] TZ: UTC
##   xts Attributes:  
##  NULL</code></pre>
<p>As you can see, the date column is now an index. We need this to be an index to be better able to calculate through it.</p>
<p><strong>Small Primer into using lag()</strong></p>
<p><code>lag()</code> is one of the most commonly used functions when working with time-series. You can use lag(1) for instance to define a variable that is lagged by 1 period. Like that, you can calculate returns manually. However, there is an <em>important caveat when using lag()</em>. That is: <strong>if the package <code>dplyr</code> is loaded, lag won’t work when trying to render or knit the document</strong>. This is b/c the lag function is available in both the <code>stats</code> and <code>dplyr</code> package. Thus, when we do ont specify from which package we should take the lag function, it will take the function automatically from a “higher-order” package, in this case dplyr. However, since the dplyr lag function cannot be rendered, we need to specify that we want to take the lag function explicitly from the stats package. That is, we need to write: <code>stats::lag()</code> to use the function.</p>
</div>
<div id="checking-the-time-series-dimensions-of-different-dataframes" class="section level4" number="2.2.9.5">
<h4><span class="header-section-number">2.2.9.5</span> Checking the time-series dimensions of different dataframes</h4>
<p>Usually, we may work with different dataframes. It is not given that they share the same format of dates. Luckily, we found a way to circumvent this issue and to put all respective dates to the same format.</p>
<p>However, another issue which commonly occurs is related to the correct <strong>timing of the dates</strong>. This implies that different datasets have a slightly different date for certain observations. It might be that some dates are just incorrectly defined. Other times, it can be that different dataframes have different rules for which date they want to use. For instance, when looking at monthly data, some datasets may regard the <strong>last weekday date</strong> of a given month as final date. However, others may regard the <strong>actual last date</strong> of a given month as final date.</p>
<p>To put this clearly, let’s say data frame A regards the last <em>Friday</em> of a month as final date. Let’s say that this is the <em>29th of January in 2018</em>. However, other datasets regard the last actual day of the month as final date. In our case, this would be the <em>Sunday, 31st of January in 2018</em>.</p>
<p>This is, unfortunately, a common issue when considering periodic datasets. Unfortunately, many financial algorithms we use require an <strong>exact match of dates</strong> when we feed them with data of different sources. Otherwise, they will just return an error. And often, this error is not automatically traced back to the date issue, and you may spend hours looking for the bug before realizing that it was a simple date mismatch.</p>
<p>Consequently, it is essential to understand how we can notice and flag non-matching date observations and to comprehend how we can match the dates such that we have the same date structure and format for all our distinct data.</p>
<p>Let’s show you how to do this:</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="the-programming-environment.html#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load two datasets with different dates</span></span>
<span id="cb179-2"><a href="the-programming-environment.html#cb179-2" aria-hidden="true" tabindex="-1"></a>A1 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;~/Desktop/Master UZH/Data/A2_dataset_01.txt&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb179-3"><a href="the-programming-environment.html#cb179-3" aria-hidden="true" tabindex="-1"></a>A2 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;~/Desktop/Master UZH/Data/A2_dataset_02.txt&quot;</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>)</span>
<span id="cb179-4"><a href="the-programming-environment.html#cb179-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-5"><a href="the-programming-environment.html#cb179-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a time-series as usual and calculate the bond return as usual</span></span>
<span id="cb179-6"><a href="the-programming-environment.html#cb179-6" aria-hidden="true" tabindex="-1"></a>A1_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(A1<span class="sc">$</span>Date)</span>
<span id="cb179-7"><a href="the-programming-environment.html#cb179-7" aria-hidden="true" tabindex="-1"></a>A1_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> A1[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> A1_date)</span>
<span id="cb179-8"><a href="the-programming-environment.html#cb179-8" aria-hidden="true" tabindex="-1"></a>A1_ts_returns <span class="ot">&lt;-</span> <span class="fu">Return.calculate</span>(A1_ts, <span class="at">method =</span> <span class="st">&quot;discrete&quot;</span>)[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb179-9"><a href="the-programming-environment.html#cb179-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-10"><a href="the-programming-environment.html#cb179-10" aria-hidden="true" tabindex="-1"></a>A2_date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(A2<span class="sc">$</span>Date)</span>
<span id="cb179-11"><a href="the-programming-environment.html#cb179-11" aria-hidden="true" tabindex="-1"></a>A2_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="at">x =</span> A2[,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> A2_date)</span>
<span id="cb179-12"><a href="the-programming-environment.html#cb179-12" aria-hidden="true" tabindex="-1"></a>A2_ts_1_year <span class="ot">&lt;-</span> A2_ts<span class="sc">$</span>SWISS.CONFEDERATION.BOND.<span class="fl">1.</span>YEAR...RED..YIELD <span class="sc">/</span> <span class="dv">100</span></span>
<span id="cb179-13"><a href="the-programming-environment.html#cb179-13" aria-hidden="true" tabindex="-1"></a>A2_ts_1_year_monthly <span class="ot">&lt;-</span> ((<span class="dv">1</span> <span class="sc">+</span> A2_ts_1_year)<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>) <span class="sc">-</span> <span class="dv">1</span>)[<span class="sc">-</span><span class="dv">1</span>,]</span>
<span id="cb179-14"><a href="the-programming-environment.html#cb179-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-15"><a href="the-programming-environment.html#cb179-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine the two dataframes</span></span>
<span id="cb179-16"><a href="the-programming-environment.html#cb179-16" aria-hidden="true" tabindex="-1"></a>df_dates_comp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(<span class="fu">index</span>(A1_ts_returns), <span class="fu">index</span>(A2_ts_1_year_monthly)))</span>
<span id="cb179-17"><a href="the-programming-environment.html#cb179-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-18"><a href="the-programming-environment.html#cb179-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the dates again (transform them from numeric arguments to dates again)</span></span>
<span id="cb179-19"><a href="the-programming-environment.html#cb179-19" aria-hidden="true" tabindex="-1"></a>df_dates_comp_real <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">lapply</span>(df_dates_comp, <span class="cf">function</span>(x) <span class="fu">as.Date</span>(x)))</span>
<span id="cb179-20"><a href="the-programming-environment.html#cb179-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-21"><a href="the-programming-environment.html#cb179-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Add an index for later sourcing </span></span>
<span id="cb179-22"><a href="the-programming-environment.html#cb179-22" aria-hidden="true" tabindex="-1"></a>df_dates_comp_real<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="fu">seq.int</span>(<span class="fu">nrow</span>(df_dates_comp_real))</span>
<span id="cb179-23"><a href="the-programming-environment.html#cb179-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-24"><a href="the-programming-environment.html#cb179-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Column names</span></span>
<span id="cb179-25"><a href="the-programming-environment.html#cb179-25" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(df_dates_comp_real) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Stocks_TS&quot;</span>, <span class="st">&quot;Risk_Free_TS&quot;</span>, <span class="st">&quot;Index&quot;</span>)</span>
<span id="cb179-26"><a href="the-programming-environment.html#cb179-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-27"><a href="the-programming-environment.html#cb179-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Match the dates</span></span>
<span id="cb179-28"><a href="the-programming-environment.html#cb179-28" aria-hidden="true" tabindex="-1"></a>df_dates_comp_real<span class="sc">$</span>compared <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(df_dates_comp_real<span class="sc">$</span>Stocks_TS <span class="sc">==</span> df_dates_comp_real<span class="sc">$</span>Risk_Free_TS, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb179-29"><a href="the-programming-environment.html#cb179-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-30"><a href="the-programming-environment.html#cb179-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter which dates are not aligned</span></span>
<span id="cb179-31"><a href="the-programming-environment.html#cb179-31" aria-hidden="true" tabindex="-1"></a>df_dates_comp_real <span class="sc">%&gt;%</span> <span class="fu">filter</span>(compared <span class="sc">==</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>##    Stocks_TS Risk_Free_TS Index compared
## 1 2018-01-29   2018-01-31   355        0</code></pre>
<p>Here, we see the small discrepancy that may be very annoying in our time. Of nearly 400 observations, there is exactly one that does not match due to an issue we don’t know. However, in order to use the funcitonalities of time-series management in R, we need to align these dates. Luckily, we also defined an index column. Based on this index column, we can then change the respective observation in the risk-free dataframe.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="the-programming-environment.html#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Change the respective index</span></span>
<span id="cb181-2"><a href="the-programming-environment.html#cb181-2" aria-hidden="true" tabindex="-1"></a><span class="fu">index</span>(A2_ts_1_year_monthly)[<span class="dv">355</span>] <span class="ot">&lt;-</span> <span class="st">&quot;2018-01-29&quot;</span></span>
<span id="cb181-3"><a href="the-programming-environment.html#cb181-3" aria-hidden="true" tabindex="-1"></a>A2_ts_1_year_monthly[<span class="dv">355</span>]</span></code></pre></div>
<pre><code>##            SWISS.CONFEDERATION.BOND.1.YEAR...RED..YIELD
## 2018-01-29                                -0.0006263197</code></pre>
<p>And here we are. We now were able to change the date accordingly.</p>
</div>
</div>
<div id="string-manipulations-in-r-the-stringr-package" class="section level3" number="2.2.10">
<h3><span class="header-section-number">2.2.10</span> String Manipulations in R: The <code>stringr()</code> package</h3>
<p>Strings are a major component of data in R. They are needed to perform a wide range of data manipulation tasks. However, in order to use strings, we cannot use the exactly same syntax and approaches as we did for numeric data. Using strings will enable us to vastly widen our programming abilities, since we need strings in large data classes. For instance, the correct use of string manipulation may be extremely handy if you need to perform large, identical operations for dozens or hundreds of individual data frames. Things like loading multiple frames with different, but similar names, assigning names to columns / rows, extracting features of specific data frames and creating new data frames with individual names are very common manipulation techniques as data scientist. These operations are often used in terms of for loops, where you take multiple distinct data sources, run the exact same experiment on each, and obtain individual outputs with distinct names again. You can repeat all steps manually for each data source, but if you have more than 10 sources, then this will get quite messy and exhausting. So let’s see how we can lever these techniques.</p>
<p><code>stringr()</code> is the main package when operating and manipulating strings in R. It adds more functionality to the <em>base functions</em> for handling strings in R, and is also compatible with <em>regular expressions</em> (we’ll cover what they are in the second part, but they are immensely powerful!). In general, stringr offers a wide range of string manipulation techniques and is using consistent function arguments to match structural patterns with other R packages.</p>
<div id="basic-string-operations" class="section level4" number="2.2.10.1">
<h4><span class="header-section-number">2.2.10.1</span> Basic string operations</h4>
<p>The main basic functions are the following:</p>
<div class="figure">
<img src="/Users/nikolasanic/Desktop/Empirical%20Asset%20Management/R/Images/stringr_basic_ops.jpg" alt="" />
<p class="caption">Figure 7: Main basic manipulation operations in <code>stringr</code></p>
</div>
<p><strong>Concatenate: <code>str_c()</code></strong></p>
<p>The function <code>str_c()</code> is used to concatenate different strings with one another. This is equivalent to the <code>paste()</code> function we saw earlier when printing some of the results.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="the-programming-environment.html#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s create a small example:</span></span>
<span id="cb183-2"><a href="the-programming-environment.html#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_c</span>(<span class="st">&quot;The&quot;</span>, <span class="st">&quot;SMI&quot;</span>, <span class="st">&quot;gained&quot;</span>, <span class="st">&quot;five&quot;</span>, <span class="st">&quot;percent&quot;</span>, <span class="st">&quot;annually&quot;</span>, <span class="at">sep =</span> <span class="st">&quot; &quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;The SMI gained five percent annually&quot;</code></pre>
<p><strong>Character length: str_length()</strong></p>
<p>We use str_length() to count the character length of each string under consideration. That is:</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="the-programming-environment.html#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s create a small example to count the length of each word</span></span>
<span id="cb185-2"><a href="the-programming-environment.html#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_length</span>(<span class="fu">c</span>(<span class="st">&quot;The&quot;</span>, <span class="st">&quot;SMI&quot;</span>, <span class="st">&quot;gained&quot;</span>, <span class="st">&quot;five&quot;</span>, <span class="st">&quot;percent&quot;</span>, <span class="st">&quot;annually&quot;</span>))</span></code></pre></div>
<pre><code>## [1] 3 3 6 4 7 8</code></pre>
<p><strong>Substring characters: str_sub()</strong></p>
<p>To extract substrings from a character vector stringr provides <code>str_sub()</code>. The main function of it is the following.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="the-programming-environment.html#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s only get part of the string</span></span>
<span id="cb187-2"><a href="the-programming-environment.html#cb187-2" aria-hidden="true" tabindex="-1"></a>text <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;The&quot;</span>, <span class="st">&quot;SMI&quot;</span>, <span class="st">&quot;gained&quot;</span>, <span class="st">&quot;five&quot;</span>, <span class="st">&quot;percent&quot;</span>, <span class="st">&quot;annually&quot;</span>)</span>
<span id="cb187-3"><a href="the-programming-environment.html#cb187-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(text, <span class="at">start =</span> <span class="dv">1</span>, <span class="at">end =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## [1] &quot;The&quot; &quot;SMI&quot; &quot;gai&quot; &quot;fiv&quot; &quot;per&quot; &quot;ann&quot;</code></pre>
<p>v
This returns the substring that contains the first until the third letter of the word “hello”.</p>
<p>We can basically perform any manipulation operation as we did it when using select and other methods:</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="the-programming-environment.html#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s only get the last three strings:</span></span>
<span id="cb189-2"><a href="the-programming-environment.html#cb189-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(text, <span class="at">start =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">end =</span> <span class="sc">-</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;The&quot; &quot;SMI&quot; &quot;ned&quot; &quot;ive&quot; &quot;ent&quot; &quot;lly&quot;</code></pre>
<p>We can use the command to replace things</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="the-programming-environment.html#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s increase all strings:</span></span>
<span id="cb191-2"><a href="the-programming-environment.html#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(text, <span class="dv">1</span>, <span class="dv">3</span>) <span class="ot">&lt;-</span> <span class="st">&quot;$$&quot;</span></span>
<span id="cb191-3"><a href="the-programming-environment.html#cb191-3" aria-hidden="true" tabindex="-1"></a>text</span></code></pre></div>
<pre><code>## [1] &quot;$$&quot;      &quot;$$&quot;      &quot;$$ned&quot;   &quot;$$e&quot;     &quot;$$cent&quot;  &quot;$$ually&quot;</code></pre>
<p><strong>Duplicate: str_dup()</strong></p>
<p>We can also duplicate words:</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="the-programming-environment.html#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let&#39;s duplicate: </span></span>
<span id="cb193-2"><a href="the-programming-environment.html#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_dup</span>(text, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] &quot;$$$$&quot;           &quot;$$$$&quot;           &quot;$$ned$$ned&quot;     &quot;$$e$$e&quot;         &quot;$$cent$$cent&quot;   &quot;$$ually$$ually&quot;</code></pre>
<p><strong>Padding with str_pad()</strong></p>
<p>Here, the idea is to take a string and pad it with leading or trailing characters to a specified total width. That is, you get a character and you define its overall length, then you can pad it to the specific length with some filling character(s) of your choice. The general form of it is: <code>str_pad(text, width = , side = , pad = )</code>. For instance, we can add two connecting lines on either side of the word “hashtag”, by defining the following function:</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="the-programming-environment.html#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_pad</span>(<span class="st">&quot;hashtag&quot;</span>, <span class="at">width =</span> <span class="dv">11</span>, <span class="at">side =</span> <span class="st">&quot;both&quot;</span>, <span class="at">pad =</span> <span class="st">&quot;-&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;--hashtag--&quot;</code></pre>
<p><strong>Trimming with str_trim()</strong></p>
<p>One of the typical tasks of string processing is that of parsing a text into individual words. Usually, you end up with words that have blank spaces, called whitespaces, on either end of the word. In this situation, you can use the str_trim() function to remove any number of whitespaces.</p>
<p>For instance:</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="the-programming-environment.html#cb197-1" aria-hidden="true" tabindex="-1"></a>text_white <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;This&quot;</span>, <span class="st">&quot; example &quot;</span>, <span class="st">&quot;has several   &quot;</span>, <span class="st">&quot;   whitespaces &quot;</span>)</span>
<span id="cb197-2"><a href="the-programming-environment.html#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_trim</span>(text_white, <span class="at">side =</span> <span class="st">&quot;right&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;This&quot;           &quot; example&quot;       &quot;has several&quot;    &quot;   whitespaces&quot;</code></pre>
<p>Like this, we create a text with only one white space and make it readable for text.</p>
<p><strong>Replacing with str_replace()</strong></p>
<p><code>str_replace()</code> is quite handy if we need to replace some sub-string within our data. For instance, let’s assume we have dates.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="the-programming-environment.html#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a date vector:</span></span>
<span id="cb199-2"><a href="the-programming-environment.html#cb199-2" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;2008:Feb&quot;</span>, <span class="st">&quot;2010-Mar&quot;</span>, <span class="st">&quot;2005-Jun&quot;</span>, <span class="st">&quot;2003-Nov&quot;</span>)</span>
<span id="cb199-3"><a href="the-programming-environment.html#cb199-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-4"><a href="the-programming-environment.html#cb199-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace the : with - </span></span>
<span id="cb199-5"><a href="the-programming-environment.html#cb199-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace</span>(dates, <span class="st">&quot;:&quot;</span>, <span class="st">&quot;-&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;2008-Feb&quot; &quot;2010-Mar&quot; &quot;2005-Jun&quot; &quot;2003-Nov&quot;</code></pre>
<p><strong>Splitting with str_split()</strong></p>
<p>Also, we can use <code>str_split()</code> to split strings at given intervals.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="the-programming-environment.html#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Split at the - signs</span></span>
<span id="cb201-2"><a href="the-programming-environment.html#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split_fixed</span>(<span class="fu">str_replace</span>(dates, <span class="st">&quot;:&quot;</span>, <span class="st">&quot;-&quot;</span>), <span class="at">pattern=</span><span class="fu">fixed</span>(<span class="st">&#39;-&#39;</span>), <span class="at">n=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>##      [,1]   [,2] 
## [1,] &quot;2008&quot; &quot;Feb&quot;
## [2,] &quot;2010&quot; &quot;Mar&quot;
## [3,] &quot;2005&quot; &quot;Jun&quot;
## [4,] &quot;2003&quot; &quot;Nov&quot;</code></pre>
<p>These are the most common string manipulation operations.</p>
</div>
<div id="using-for-loops-with-paste0-and-assign-to-create-new-variables-dynamically" class="section level4" number="2.2.10.2">
<h4><span class="header-section-number">2.2.10.2</span> Using for loops with <code>paste0()</code> and <code>assign()</code> to create new variables dynamically</h4>
<p>Let’s now get to an exciting use case of string transformation: Repeating string manipulations for multiple data frames using for loops. Imagine that you have multiple data frames and you need to perform the same set of operations for each of them. Either, you can do this manually by writing the function for each frame itself, but this may be extremely cumbersome once you need to work with potentially hundreds or thousands of individual data frames. Consequently, we need to find a way load, store and output each file automatically to get the desired output.</p>
<p>We can facilitate this operation by using the functions <code>paste0()</code> and <code>assign()</code>.</p>
<p><code>assign()</code> basically assigns a name to a variable. This is nothing special in general, but it is handy when considering that we can use the function to assign a variable name to a newly generated variable, which then is unique based on the for-loop characteristic.</p>
<p><code>paste0()</code> is similar to the paste function we know from earlier. In a for-loop characteristic, we can use the function ot define a unique string argument that the for loop should create. This is handy, as it can also automatically paste strings into a function, to indicate, for instance, which variable should be created or selected.</p>
<p>In essence, we can use the <strong>assign function in combination with the paste0 function to create new variable names within a for-loop dynamically</strong>. For that, let’s assume that we have multiple portfolios and we need to load them, transform them to a time-series object and, ultimately, plot their cumulative returns. The exact operation will make more sense once we covered risk and return, but we focus more on the technical aspects of creating variables and data frames dynamically.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="the-programming-environment.html#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We have a folder consisting of seven distinct but identical datasets. It is our aim to perform the same operations on each of the dataset. For that, we need to define a way to make R understand which datasets it should read in, how to differentiate these datasets from each other, and how to use the same functions on all of the datasets to get the outputs of interest. </span></span>
<span id="cb203-2"><a href="the-programming-environment.html#cb203-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-3"><a href="the-programming-environment.html#cb203-3" aria-hidden="true" tabindex="-1"></a><span class="co"># As we have multiple data frames, we want to do this all within a for loop structure. </span></span>
<span id="cb203-4"><a href="the-programming-environment.html#cb203-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-5"><a href="the-programming-environment.html#cb203-5" aria-hidden="true" tabindex="-1"></a><span class="co"># First, we want to read in the data. To do so, we need to tell R what the name of the different data files is, and where they are located. </span></span>
<span id="cb203-6"><a href="the-programming-environment.html#cb203-6" aria-hidden="true" tabindex="-1"></a><span class="co"># We know that the usual command for reading in a csv file is: read_csv(&quot;way/to/path/file.csv&quot;, header = , sep = &quot;&quot;, dec = &quot;&quot;). </span></span>
<span id="cb203-7"><a href="the-programming-environment.html#cb203-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Further, we know that the path to our files is the same for each of them, namely: &quot;~/Desktop/EMMA/Excel_Files/Cumulative_Returns/filenames.csv&quot;</span></span>
<span id="cb203-8"><a href="the-programming-environment.html#cb203-8" aria-hidden="true" tabindex="-1"></a><span class="co"># As a consequence, we need to change the &quot;filenames.csv&quot; to the respective name of the individual csv files such that read_csv() can read them in. </span></span>
<span id="cb203-9"><a href="the-programming-environment.html#cb203-9" aria-hidden="true" tabindex="-1"></a><span class="co"># To do this in a for loop, we need to define the respective names of each csv file in a vector. This is done below. </span></span>
<span id="cb203-10"><a href="the-programming-environment.html#cb203-10" aria-hidden="true" tabindex="-1"></a>data_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Cum_Ret_MC_Gen&quot;</span>, <span class="st">&quot;Cum_Ret_MC_Phys&quot;</span>, <span class="st">&quot;Cum_Ret_MC_Reg&quot;</span>, <span class="st">&quot;Cum_Ret_MC_Oppty&quot;</span>, </span>
<span id="cb203-11"><a href="the-programming-environment.html#cb203-11" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;Cum_Ret_10K_Phys&quot;</span>, <span class="st">&quot;Cum_Ret_10K_Reg&quot;</span>, <span class="st">&quot;Cum_Ret_8K_Gen&quot;</span>)</span>
<span id="cb203-12"><a href="the-programming-environment.html#cb203-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-13"><a href="the-programming-environment.html#cb203-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we have the names. We now need to tell R to:</span></span>
<span id="cb203-14"><a href="the-programming-environment.html#cb203-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-15"><a href="the-programming-environment.html#cb203-15" aria-hidden="true" tabindex="-1"></a><span class="do">## loop through each element of these names</span></span>
<span id="cb203-16"><a href="the-programming-environment.html#cb203-16" aria-hidden="true" tabindex="-1"></a><span class="do">## paste each element together with the path structure to get the file path of each csv file </span></span>
<span id="cb203-17"><a href="the-programming-environment.html#cb203-17" aria-hidden="true" tabindex="-1"></a><span class="do">## run the csv_read() command for the respective filepath to read in each file </span></span>
<span id="cb203-18"><a href="the-programming-environment.html#cb203-18" aria-hidden="true" tabindex="-1"></a><span class="do">## assign a name to each uploaded csv file (otherwise we would just overwrite each file over and again while running the loop, resulting in only the last file being read in and saved)</span></span>
<span id="cb203-19"><a href="the-programming-environment.html#cb203-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-20"><a href="the-programming-environment.html#cb203-20" aria-hidden="true" tabindex="-1"></a><span class="co"># This is one of the ways to proceed </span></span>
<span id="cb203-21"><a href="the-programming-environment.html#cb203-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data_names)){</span>
<span id="cb203-22"><a href="the-programming-environment.html#cb203-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># First, we tell R to loop through each element in the vector &quot;data_names&quot; which contains the names of the csv files</span></span>
<span id="cb203-23"><a href="the-programming-environment.html#cb203-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="fu">assign</span>(<span class="fu">paste0</span>(<span class="st">&quot;data&quot;</span>, i),</span>
<span id="cb203-24"><a href="the-programming-environment.html#cb203-24" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Here, we create a name for the data frame we read in (in our case data1 - data7). These are the names of the read-in csv files</span></span>
<span id="cb203-25"><a href="the-programming-environment.html#cb203-25" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Here, we assign the created names to the individual read-in csv files (this is identical to e.g.: data1 = read.csv(...)) which is how we            would assign a name if we would read in the data manually </span></span>
<span id="cb203-26"><a href="the-programming-environment.html#cb203-26" aria-hidden="true" tabindex="-1"></a>         <span class="fu">read.csv</span>(<span class="fu">paste0</span>(<span class="st">&quot;~/Desktop/MA_Fundamentals_Non_Coding/Excel_Files/Cumulative_Returns/&quot;</span>, data_names[i], <span class="st">&quot;.csv&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;,&quot;</span>)))</span>
<span id="cb203-27"><a href="the-programming-environment.html#cb203-27" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Here, we read-in the data. We use another paste0 command to paste together the:</span></span>
<span id="cb203-28"><a href="the-programming-environment.html#cb203-28" aria-hidden="true" tabindex="-1"></a>          <span class="do">## 1) path to the files </span></span>
<span id="cb203-29"><a href="the-programming-environment.html#cb203-29" aria-hidden="true" tabindex="-1"></a>          <span class="do">## 2) respective data name </span></span>
<span id="cb203-30"><a href="the-programming-environment.html#cb203-30" aria-hidden="true" tabindex="-1"></a>          <span class="do">## 3) csv indicator</span></span>
<span id="cb203-31"><a href="the-programming-environment.html#cb203-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># E.g. for the first element of the files, paste0 creates the following string:     </span></span>
<span id="cb203-32"><a href="the-programming-environment.html#cb203-32" aria-hidden="true" tabindex="-1"></a>          <span class="do">##&quot;~/Desktop/EMMA/Excel_Files/Cumulative_Returns/Cum_Ret_MC_Gen.csv&quot;</span></span>
<span id="cb203-33"><a href="the-programming-environment.html#cb203-33" aria-hidden="true" tabindex="-1"></a>        <span class="co"># This looks identical to when we usually type in the data path and name manually. </span></span>
<span id="cb203-34"><a href="the-programming-environment.html#cb203-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb203-35"><a href="the-programming-environment.html#cb203-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We repeat this for all the individual csv files at the given location. As such, we read-in seven csv files and named them data1 - data7</span></span>
<span id="cb203-36"><a href="the-programming-environment.html#cb203-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb203-37"><a href="the-programming-environment.html#cb203-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb203-38"><a href="the-programming-environment.html#cb203-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-39"><a href="the-programming-environment.html#cb203-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Great, we now know how to read in data from multiple sources into R. If we look at them, we realize they are cumulative products of portfolios for a given time period. However, they are not yet in the desired xts object format. In order to change that, let&#39;s use another for loop to create xts objects for each of the data frames we have now. </span></span>
<span id="cb203-40"><a href="the-programming-environment.html#cb203-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-41"><a href="the-programming-environment.html#cb203-41" aria-hidden="true" tabindex="-1"></a><span class="co"># In order to create time-series objects from the data frames defined, we need to re-frame the data frames. That is, we need to define a vector with all current data frames and define a list with names to define how their time-series objects should be called. This is done below:</span></span>
<span id="cb203-42"><a href="the-programming-environment.html#cb203-42" aria-hidden="true" tabindex="-1"></a>list_df <span class="ot">&lt;-</span> <span class="fu">list</span>(data1, data2, data3, data4, data5, data6, data7)</span>
<span id="cb203-43"><a href="the-programming-environment.html#cb203-43" aria-hidden="true" tabindex="-1"></a>list_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Cum_Ret_MC_Gen_ts&quot;</span>, <span class="st">&quot;Cum_Ret_MC_Phys_ts&quot;</span>, <span class="st">&quot;Cum_Ret_MC_Reg_ts&quot;</span>, <span class="st">&quot;Cum_Ret_MC_Oppty_ts&quot;</span>, <span class="st">&quot;Cum_Ret_10K_Phys_ts&quot;</span>, <span class="st">&quot;Cum_Ret_10K_Reg_ts&quot;</span>, <span class="st">&quot;Cum_Ret_8K_Gen_ts&quot;</span>)</span>
<span id="cb203-44"><a href="the-programming-environment.html#cb203-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-45"><a href="the-programming-environment.html#cb203-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, we need to again loop through each element of the list with all the data frames</span></span>
<span id="cb203-46"><a href="the-programming-environment.html#cb203-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(list_df)){</span>
<span id="cb203-47"><a href="the-programming-environment.html#cb203-47" aria-hidden="true" tabindex="-1"></a> <span class="co"># First, we tell R to loop through each element in the vector &quot;list_df&quot; which contains the read-in csv files</span></span>
<span id="cb203-48"><a href="the-programming-environment.html#cb203-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-49"><a href="the-programming-environment.html#cb203-49" aria-hidden="true" tabindex="-1"></a> <span class="co"># Now, we just use the same steps as before to create an xts object, just within a loop format  </span></span>
<span id="cb203-50"><a href="the-programming-environment.html#cb203-50" aria-hidden="true" tabindex="-1"></a> list_df[[i]] <span class="ot">&lt;-</span> list_df[[i]][,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb203-51"><a href="the-programming-environment.html#cb203-51" aria-hidden="true" tabindex="-1"></a> <span class="co"># First, we exclude the first column from the current data frames since this is just an empty column. Note that we need a double bracket [[]] as </span></span>
<span id="cb203-52"><a href="the-programming-environment.html#cb203-52" aria-hidden="true" tabindex="-1"></a> <span class="co"># we first need to access the individual file from the file list and then the variable from that file</span></span>
<span id="cb203-53"><a href="the-programming-environment.html#cb203-53" aria-hidden="true" tabindex="-1"></a> list_df[[i]]<span class="sc">$</span>Date <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">as.Date</span>(list_df[[i]]<span class="sc">$</span>Date), <span class="st">&quot;%Y-%m-%d&quot;</span>)</span>
<span id="cb203-54"><a href="the-programming-environment.html#cb203-54" aria-hidden="true" tabindex="-1"></a> <span class="co"># Next, we need to transform the dates into an actual date column of ymd format (note this is equivalent to: as.Date(ymd(list_df[[i]]$Date)))</span></span>
<span id="cb203-55"><a href="the-programming-environment.html#cb203-55" aria-hidden="true" tabindex="-1"></a> list_df_Date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(list_df[[i]]<span class="sc">$</span>Date)</span>
<span id="cb203-56"><a href="the-programming-environment.html#cb203-56" aria-hidden="true" tabindex="-1"></a> <span class="co"># Then, we create another variable which is just the date variable (this is identical to the step 2 of creating an xts object)</span></span>
<span id="cb203-57"><a href="the-programming-environment.html#cb203-57" aria-hidden="true" tabindex="-1"></a> <span class="fu">assign</span>(<span class="fu">paste</span>(list_names[i],<span class="at">sep=</span><span class="st">&#39;&#39;</span>), </span>
<span id="cb203-58"><a href="the-programming-environment.html#cb203-58" aria-hidden="true" tabindex="-1"></a>        <span class="fu">xts</span>(<span class="at">x =</span> list_df[[i]][,<span class="sc">-</span><span class="dv">1</span>], <span class="at">order.by =</span> list_df_Date))</span>
<span id="cb203-59"><a href="the-programming-environment.html#cb203-59" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Here, we again create the xts objects for each data frame, simply by defining getting all except for the date column and then ordering </span></span>
<span id="cb203-60"><a href="the-programming-environment.html#cb203-60" aria-hidden="true" tabindex="-1"></a>        <span class="co"># them by the respective ymd date. </span></span>
<span id="cb203-61"><a href="the-programming-environment.html#cb203-61" aria-hidden="true" tabindex="-1"></a> <span class="co"># Lastly, we again need to assign a name to the newly created xts objects. We do so by pasting the respective element from the list_names vector</span></span>
<span id="cb203-62"><a href="the-programming-environment.html#cb203-62" aria-hidden="true" tabindex="-1"></a> <span class="co"># and then assigning this name to the created time-series file</span></span>
<span id="cb203-63"><a href="the-programming-environment.html#cb203-63" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb203-64"><a href="the-programming-environment.html#cb203-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-65"><a href="the-programming-environment.html#cb203-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Like that, we performed the time-series transformation for each of the variables and now have seven distinct xts objects named with the elements of list_names. </span></span>
<span id="cb203-66"><a href="the-programming-environment.html#cb203-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-67"><a href="the-programming-environment.html#cb203-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Lastly, we want to create ggplots for each of the files. </span></span>
<span id="cb203-68"><a href="the-programming-environment.html#cb203-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-69"><a href="the-programming-environment.html#cb203-69" aria-hidden="true" tabindex="-1"></a><span class="co"># For that, we define a list again with the xts objects.</span></span>
<span id="cb203-70"><a href="the-programming-environment.html#cb203-70" aria-hidden="true" tabindex="-1"></a>list_df_ts <span class="ot">&lt;-</span> <span class="fu">list</span>(Cum_Ret_MC_Gen_ts, Cum_Ret_MC_Phys_ts, Cum_Ret_MC_Reg_ts, Cum_Ret_MC_Oppty_ts, Cum_Ret_10K_Phys_ts, Cum_Ret_10K_Reg_ts, Cum_Ret_8K_Gen_ts)</span>
<span id="cb203-71"><a href="the-programming-environment.html#cb203-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-72"><a href="the-programming-environment.html#cb203-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-73"><a href="the-programming-environment.html#cb203-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Running the loop to create multiple plots is actually quite straight forward, the only thing we need to adjust the name of each plot</span></span>
<span id="cb203-74"><a href="the-programming-environment.html#cb203-74" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(list_df_ts)){</span>
<span id="cb203-75"><a href="the-programming-environment.html#cb203-75" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Here, R loops through each xts object again</span></span>
<span id="cb203-76"><a href="the-programming-environment.html#cb203-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="fu">paste</span>(<span class="st">&quot;figure_&quot;</span>,list_names[i],<span class="at">sep =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb203-77"><a href="the-programming-environment.html#cb203-77" aria-hidden="true" tabindex="-1"></a>         <span class="co"># Here, we define the name again for each created ggplot</span></span>
<span id="cb203-78"><a href="the-programming-environment.html#cb203-78" aria-hidden="true" tabindex="-1"></a>         <span class="fu">tidy</span>(list_df_ts[[i]]) <span class="sc">%&gt;%</span> </span>
<span id="cb203-79"><a href="the-programming-environment.html#cb203-79" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Here, we then assign the name to the ggplot that we created, based on each tidy element of the list_df_ts (our xts objects)</span></span>
<span id="cb203-80"><a href="the-programming-environment.html#cb203-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb203-81"><a href="the-programming-environment.html#cb203-81" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Below, we just run our usual code to define some good-looking plots!</span></span>
<span id="cb203-82"><a href="the-programming-environment.html#cb203-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb203-83"><a href="the-programming-environment.html#cb203-83" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>index,<span class="at">y=</span>value, <span class="at">color=</span>series)) <span class="sc">+</span> </span>
<span id="cb203-84"><a href="the-programming-environment.html#cb203-84" aria-hidden="true" tabindex="-1"></a>          <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb203-85"><a href="the-programming-environment.html#cb203-85" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Line, Point and Fill colours</span></span>
<span id="cb203-86"><a href="the-programming-environment.html#cb203-86" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;goldenrod&quot;</span>, <span class="st">&quot;darkorchid4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>,<span class="st">&quot;dodgerblue1&quot;</span>, <span class="st">&quot;springgreen2&quot;</span>,  <span class="st">&quot;darkorchid4&quot;</span>, <span class="st">&quot;dodgerblue4&quot;</span>))  <span class="sc">+</span></span>
<span id="cb203-87"><a href="the-programming-environment.html#cb203-87" aria-hidden="true" tabindex="-1"></a>          <span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;goldenrod&quot;</span>, <span class="st">&quot;darkorchid4&quot;</span>, <span class="st">&quot;darkorange2&quot;</span>,<span class="st">&quot;dodgerblue1&quot;</span>, <span class="st">&quot;springgreen2&quot;</span>,  <span class="st">&quot;darkorchid4&quot;</span>, <span class="st">&quot;dodgerblue4&quot;</span>)) <span class="sc">+</span>  </span>
<span id="cb203-88"><a href="the-programming-environment.html#cb203-88" aria-hidden="true" tabindex="-1"></a>          <span class="co"># X and Y axis string</span></span>
<span id="cb203-89"><a href="the-programming-environment.html#cb203-89" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ylab</span>(<span class="st">&quot;Cumulative Returns&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time&quot;</span>) <span class="sc">+</span> </span>
<span id="cb203-90"><a href="the-programming-environment.html#cb203-90" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Title string</span></span>
<span id="cb203-91"><a href="the-programming-environment.html#cb203-91" aria-hidden="true" tabindex="-1"></a>          <span class="fu">ggtitle</span>(<span class="st">&quot;Relationship of Cumulative Returns of some SMI Securities&quot;</span>) <span class="sc">+</span></span>
<span id="cb203-92"><a href="the-programming-environment.html#cb203-92" aria-hidden="true" tabindex="-1"></a>          <span class="fu">labs</span>(<span class="at">color=</span><span class="st">&#39;Factor Portfolios&#39;</span>) <span class="sc">+</span></span>
<span id="cb203-93"><a href="the-programming-environment.html#cb203-93" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme</span>(</span>
<span id="cb203-94"><a href="the-programming-environment.html#cb203-94" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Title Elements</span></span>
<span id="cb203-95"><a href="the-programming-environment.html#cb203-95" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.title=</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">14</span>, <span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">hjust=</span><span class="fl">0.3</span>,<span class="at">lineheight=</span><span class="fl">0.4</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">15</span>,<span class="dv">0</span>,<span class="dv">15</span>,<span class="dv">0</span>)), </span>
<span id="cb203-96"><a href="the-programming-environment.html#cb203-96" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Axis Elements</span></span>
<span id="cb203-97"><a href="the-programming-environment.html#cb203-97" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>)),</span>
<span id="cb203-98"><a href="the-programming-environment.html#cb203-98" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">color=</span><span class="st">&quot;grey26&quot;</span>, <span class="at">size=</span><span class="dv">12</span>, <span class="at">margin=</span><span class="fu">margin</span>(<span class="dv">10</span>,<span class="dv">0</span>,<span class="dv">10</span>,<span class="dv">0</span>)),</span>
<span id="cb203-99"><a href="the-programming-environment.html#cb203-99" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Background colour and fill</span></span>
<span id="cb203-100"><a href="the-programming-environment.html#cb203-100" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb203-101"><a href="the-programming-environment.html#cb203-101" aria-hidden="true" tabindex="-1"></a>          <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;#f7f7f7&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#f7f7f7&quot;</span>),</span>
<span id="cb203-102"><a href="the-programming-environment.html#cb203-102" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Major Panel Grids</span></span>
<span id="cb203-103"><a href="the-programming-environment.html#cb203-103" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb203-104"><a href="the-programming-environment.html#cb203-104" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.major.y =</span> <span class="fu">element_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;solid&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey&quot;</span>),</span>
<span id="cb203-105"><a href="the-programming-environment.html#cb203-105" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Minor Panel Grids</span></span>
<span id="cb203-106"><a href="the-programming-environment.html#cb203-106" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb203-107"><a href="the-programming-environment.html#cb203-107" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb203-108"><a href="the-programming-environment.html#cb203-108" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Line colour of the x and y axis</span></span>
<span id="cb203-109"><a href="the-programming-environment.html#cb203-109" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;grey&quot;</span>)))</span>
<span id="cb203-110"><a href="the-programming-environment.html#cb203-110" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb203-111"><a href="the-programming-environment.html#cb203-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-112"><a href="the-programming-environment.html#cb203-112" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that we can even further aggregate these things by, for instance, changing the ggtitle accordingly. Try this out yourself :-) </span></span></code></pre></div>
<p>And there we are! This may all be a little much if you have never really worked with such formats before. We do not expect you to draw these things on your own, but we still find it very important to have because exactly these structures can save you potentially a lifetime during your projects. This is especially because these functions are massively scalable. If you want to do this for 10000 data frames, no problem. All you have to do is execute the code and wait until R has done the job (and the best part, if you’re getting paid for it you can write the hours it takes R to compute :-) ).</p>
<p>Now, let’s look at one of the outputs:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="the-programming-environment.html#cb204-1" aria-hidden="true" tabindex="-1"></a>figure_Cum_Ret_MC_Phys_ts</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-110-1.png" width="672" /></p>
<p>Great, we now have seen how to use string adjustments to enforce highly scalable data manipulation techniques!</p>
</div>
<div id="matching-patterns-with-regular-expressions-regex" class="section level4" number="2.2.10.3">
<h4><span class="header-section-number">2.2.10.3</span> Matching Patterns with Regular Expressions (RegEx)</h4>
<p>Regexps are a very terse language that allow you to describe patterns in strings. They take a little while to get your head around, but once you understand them, you’ll find them extremely useful. To learn regular expressions, we’ll use <code>str_view()</code>and <code>str_view_all()</code>. These functions take a character vector and a regular expression, and show you how they match.</p>
</div>
</div>
<div id="database-queries" class="section level3" number="2.2.11">
<h3><span class="header-section-number">2.2.11</span> Database Queries</h3>
<p>We understand how to retrieve data from local sources. However, most larger datasets are not usually stored somewhere locally, but rather they exist within databases. Databases are remote hubs that allow the user to access data remotely. The main advantage, at least of relational databases, is that you can retrieve much larger datasets from a multitude of sources.</p>
<p>Operating with databases in R is a great method for working efficiently. This is because you can largely automate any data retrieval process, instead of having to drop-and-drag all the desired variables on the company web pages or Desktop sources. We will show you that we can retrieve thousands of parameters in a short period of time with these algorithms.</p>
<p>In order to access databases, we need to work with queries. These are methods to access the server where the data is stored through a range of functions. We do so by retrieving a host and, if necessary, using certain credentials to open up a connection.</p>
<p>The perhaps most known data source that can operate on queries in both Python and R is the WRDS database. As most relational databases, it works with a SQL based syntax, so it’s syntax is comparable to most other databases. It serves as a consortium for multiple data providers, such as Compustat, SECM, Reuters or Bloomberg. The handy thing about the WRDS connection is that you can retrieve data from multiple sources simultaneously, thereby enabling an even more efficient use of database queries.</p>
<div id="open-the-connection-to-wrds" class="section level4" number="2.2.11.1">
<h4><span class="header-section-number">2.2.11.1</span> Open the connection to WRDS</h4>
<p>We first need to import two packages in order to be able to open a connection. Then, we define a <code>dbConnect()</code> function which accesses the WRDS host. We need to define the host, port, database name, as well as the user and password.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="the-programming-environment.html#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Import the important packages: </span></span>
<span id="cb205-2"><a href="the-programming-environment.html#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(remotes)</span>
<span id="cb205-3"><a href="the-programming-environment.html#cb205-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RPostgres)</span>
<span id="cb205-4"><a href="the-programming-environment.html#cb205-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-5"><a href="the-programming-environment.html#cb205-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the connection </span></span>
<span id="cb205-6"><a href="the-programming-environment.html#cb205-6" aria-hidden="true" tabindex="-1"></a>wrds <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(<span class="fu">Postgres</span>(),</span>
<span id="cb205-7"><a href="the-programming-environment.html#cb205-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">host=</span><span class="st">&#39;wrds-pgdata.wharton.upenn.edu&#39;</span>,</span>
<span id="cb205-8"><a href="the-programming-environment.html#cb205-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">port=</span><span class="dv">9737</span>,</span>
<span id="cb205-9"><a href="the-programming-environment.html#cb205-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dbname=</span><span class="st">&#39;wrds&#39;</span>,</span>
<span id="cb205-10"><a href="the-programming-environment.html#cb205-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sslmode=</span><span class="st">&#39;require&#39;</span>,</span>
<span id="cb205-11"><a href="the-programming-environment.html#cb205-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">user=</span><span class="st">&#39;gostlow&#39;</span>,</span>
<span id="cb205-12"><a href="the-programming-environment.html#cb205-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">password =</span> <span class="st">&quot;climaterisk8K&quot;</span>)</span></code></pre></div>
</div>
<div id="data-sources-on-wrds" class="section level4" number="2.2.11.2">
<h4><span class="header-section-number">2.2.11.2</span> Data Sources on WRDS</h4>
<p>The most important data sources that we can retrieve with the WRDS host are the following:</p>
<ul>
<li><p>CompuStat:</p></li>
<li><p>Comp.funda: Annual Financial Data only for Domestic Firms</p></li>
<li><p>Comp.fundq: Quarterly Financial Data only for Domestic Firms</p></li>
<li><p>Comp.g_funda: Annual Financial Data only for International Firms</p></li>
<li><p>Comp.g_fundq: Quarterly Financial Data only for International Firms</p></li>
<li><p>Comp.secm: Monthly stock file</p></li>
<li><p>For CRSP:</p></li>
<li><p>Crsp.dsf: Daily stock file</p></li>
<li><p>Crsp.msf: Monthly stock file</p></li>
<li><p>Crsp.dsi: Daily market returns</p></li>
<li><p>Crsp.msi: Monthly market returns</p></li>
<li><p>For I/B/E/S:</p></li>
<li><p>Ibes.actpsum_epsus: Summary history EPS actual and pricing - adjusted</p></li>
<li><p>Ibes.actpsumu_epsus:Summary history EPS actual and pricing - unadjusted</p></li>
<li><p>For Fama-French Factors:</p></li>
<li><p>FF.factors_daily: Daily portfolio four factors</p></li>
<li><p>FF.factors_monthly: Monthly portfolio four factors</p></li>
</ul>
<p><a href="https://studyres.com/doc/21204961/common-wrds-datasets-compustat-comp.funda-annual-financial">For a full list, visit this page</a>.</p>
<p>From these four databases, we are likely to retrieve all the data that we need on company financials as well as security data for portfolio management purposes. From each of the respective data sources, we can retrieve specific variables, such as the stock price, total assets or dividends. However, we need to know the names of the respective variables. The easiest way to do this is to access the WRDS Data retrieval homepage and simply source manually for the variables of interest. For instance, when you <a href="https://wrds-www.wharton.upenn.edu/pages/get-data/compustat-capital-iq-standard-poors/compustat/north-america-daily/security-monthly/">open this link and type in valid credentials</a>, you will be redirected to the US Security Monthly database source from Compustat. Therein, you can choose the selections on query variables and then take the shortname of the required variables. These shortnames are used when you access variables either from R or Python (e.g. if you want the Ticker Symbol, the shortname is: TIC). Later, we will show you a full list of potential variables.</p>
</div>
<div id="syntax-of-sql-in-wrds" class="section level4" number="2.2.11.3">
<h4><span class="header-section-number">2.2.11.3</span> Syntax of SQL in WRDS</h4>
<p>Note that we won’t thoroughly teach you how to write in the SQL way. But note that it’s actually quite quick to understand the logic behind it. SQL is a mostly “text-written” language, so, compared to R or Python, the input you have to write to get what you need is more intuitive.</p>
<p>In general, in order to retrieve data from multiple sources on WRDS, we need the following logic:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="the-programming-environment.html#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the Query manually</span></span>
<span id="cb206-2"><a href="the-programming-environment.html#cb206-2" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">dbSendQuery</span>(wrds, <span class="st">&quot;select a.gvkey, a.datadate, a.tic,</span></span>
<span id="cb206-3"><a href="the-programming-environment.html#cb206-3" aria-hidden="true" tabindex="-1"></a><span class="st">                   a.conm, a.at, a.lt, b.prccm, b.cshoq</span></span>
<span id="cb206-4"><a href="the-programming-environment.html#cb206-4" aria-hidden="true" tabindex="-1"></a><span class="st">                   from comp.funda a join comp.secm b</span></span>
<span id="cb206-5"><a href="the-programming-environment.html#cb206-5" aria-hidden="true" tabindex="-1"></a><span class="st">                   on a.gvkey = b.gvkey</span></span>
<span id="cb206-6"><a href="the-programming-environment.html#cb206-6" aria-hidden="true" tabindex="-1"></a><span class="st">                   and a.datadate = b.datadate</span></span>
<span id="cb206-7"><a href="the-programming-environment.html#cb206-7" aria-hidden="true" tabindex="-1"></a><span class="st">                   where a.tic = &#39;IBM&#39;</span></span>
<span id="cb206-8"><a href="the-programming-environment.html#cb206-8" aria-hidden="true" tabindex="-1"></a><span class="st">                   and a.datafmt = &#39;STD&#39;</span></span>
<span id="cb206-9"><a href="the-programming-environment.html#cb206-9" aria-hidden="true" tabindex="-1"></a><span class="st">                   and a.consol = &#39;C&#39;</span></span>
<span id="cb206-10"><a href="the-programming-environment.html#cb206-10" aria-hidden="true" tabindex="-1"></a><span class="st">                   and a.indfmt = &#39;INDL&#39;&quot;</span>)</span>
<span id="cb206-11"><a href="the-programming-environment.html#cb206-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-12"><a href="the-programming-environment.html#cb206-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch data</span></span>
<span id="cb206-13"><a href="the-programming-environment.html#cb206-13" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">dbFetch</span>(res)</span>
<span id="cb206-14"><a href="the-programming-environment.html#cb206-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-15"><a href="the-programming-environment.html#cb206-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Close database</span></span>
<span id="cb206-16"><a href="the-programming-environment.html#cb206-16" aria-hidden="true" tabindex="-1"></a><span class="fu">dbClearResult</span>(res)</span>
<span id="cb206-17"><a href="the-programming-environment.html#cb206-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-18"><a href="the-programming-environment.html#cb206-18" aria-hidden="true" tabindex="-1"></a><span class="co"># See data</span></span>
<span id="cb206-19"><a href="the-programming-environment.html#cb206-19" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span></code></pre></div>
<pre><code>##    gvkey   datadate tic                        conm       at       lt    prccm cshoq
## 1 006066 1962-12-31 IBM INTL BUSINESS MACHINES CORP 2112.301  731.700 389.9996    NA
## 2 006066 1963-12-31 IBM INTL BUSINESS MACHINES CORP 2373.857  782.119 506.9994    NA
## 3 006066 1964-12-31 IBM INTL BUSINESS MACHINES CORP 3309.152 1055.072 409.4995    NA
## 4 006066 1965-12-31 IBM INTL BUSINESS MACHINES CORP 3744.917 1166.771 498.9991    NA
## 5 006066 1966-12-31 IBM INTL BUSINESS MACHINES CORP 4660.777 1338.149 371.4997    NA
## 6 006066 1967-12-31 IBM INTL BUSINESS MACHINES CORP 5598.668 1767.067 626.9995    NA</code></pre>
<p>Therein, we make use of the function <code>dbSendQuery()</code>, which effectively accesses and retrieves the data we specified from the WRDS host. The syntax is as follows:</p>
<ul>
<li><code>select</code>
** This command is needed to select all the identifiers and quantitative variables we want to gather (such as Ticker, Company Name, Price etc.)
** We can retrieve different variables from multiple data sources easily
** To symbol SQL which variables belong to which data source, we need to add a specific letter and a dot in front of each variable
*** e.g.: a.gvkey selects one of the identifier variables for companies from the first data source
*** e.g.: b.prccm selects the share price variable for companies from the second data source</li>
<li><code>from</code>
** This command tells SQL from which primary data source (if we have multiple) we retrieve the variables
** If we have multiple, we also need to add the same letter as for the variables
*** e.g.: comp.funda a tells that we retrieve all the variables indicated by a. from this data sources</li>
<li><code>join</code>
** This command is needed if we have MULTIPLE data sources
** In this case we have comp.funda and comp.secm and retrieve different variables from either source
** We define for both data sources the respective letter such that SQL knows which variables belong to which source
*** e.g. comp.funda a join comp.secm b then joins the variables from both sources</li>
<li><code>on</code>
** This command is needed to tell SQL on which variables we join both data sources
** e.g. here we join them based on identity of the GVKEY company identifier and the Date</li>
<li><code>where</code>
** This command is needed to tell SQL for which companies to retrieve the data and in what format the data should be displayed
** Usually, you can leave <code>datafmt</code>, <code>consol</code> and <code>indfmt</code> as they are defined above
** Then, to define which companies you want, you can select based on four identifiers
*** tic: Ticker of companies
*** gvkey: GVKEY number of companies
*** usip: CUSIP number of companies
*** cik: CIK / SIC number of companies</li>
</ul>
<p>In essence, the command above means, literally translated, the following:</p>
<ul>
<li><ol style="list-style-type: upper-roman">
<li>Select the GVKEY identifier, Date, Ticker, Company Name, Total Assets and Total Liabilities from the source Compustat - Annual Fundamentals</li>
</ol></li>
<li><ol start="2" style="list-style-type: upper-roman">
<li>Select the Share Price and the Shares Outstanding from the source Compustat - Securities Monthly</li>
</ol></li>
<li><ol start="3" style="list-style-type: upper-roman">
<li>Merge both data sources on GVKEY identifier and Date</li>
</ol></li>
<li><ol start="4" style="list-style-type: upper-roman">
<li>For the company whose ticker is “IBM”</li>
</ol></li>
<li><ol start="22" style="list-style-type: upper-alpha">
<li>And display it with the specified data format, consol and keyset format</li>
</ol></li>
</ul>
<p>This is quite handy and allows us to retrieve data with a simple command line.</p>
</div>
<div id="automating-sql-with-a-pre-defined-function" class="section level4" number="2.2.11.4">
<h4><span class="header-section-number">2.2.11.4</span> Automating SQL with a pre-defined function</h4>
<p>We now have seen how to retrieve some variables from one company. However, what if we want to fetch hundreds of variables from thousand of companies? In this case, it may be very cumbersome to manually write all the required commands yourself. Rather, it may be smart to have a function in which you only need to enter the respective variables and then let the function do the writing of the query and compiling of the database access. This is what we provide you with below.</p>
<p>Don’t worry, the function looks more complicated than it is. But the main idea behind it is that it creates a query fetch syntax, just as we have seen above, from variables we specify. Like that, instead of manually copy-pasting hundreds of company tickers, we can just define the respective column of a dataframe in which all the tickers are saved and enter this into the function.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="the-programming-environment.html#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a function to automate the data retrieval jobs on SQL</span></span>
<span id="cb208-2"><a href="the-programming-environment.html#cb208-2" aria-hidden="true" tabindex="-1"></a>dataset_a <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb208-3"><a href="the-programming-environment.html#cb208-3" aria-hidden="true" tabindex="-1"></a>dataset_b <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb208-4"><a href="the-programming-environment.html#cb208-4" aria-hidden="true" tabindex="-1"></a>dataset_sql <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb208-5"><a href="the-programming-environment.html#cb208-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-6"><a href="the-programming-environment.html#cb208-6" aria-hidden="true" tabindex="-1"></a>datafmt <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb208-7"><a href="the-programming-environment.html#cb208-7" aria-hidden="true" tabindex="-1"></a>consol <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb208-8"><a href="the-programming-environment.html#cb208-8" aria-hidden="true" tabindex="-1"></a>indfmt <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb208-9"><a href="the-programming-environment.html#cb208-9" aria-hidden="true" tabindex="-1"></a>sic <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb208-10"><a href="the-programming-environment.html#cb208-10" aria-hidden="true" tabindex="-1"></a>gvkey <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb208-11"><a href="the-programming-environment.html#cb208-11" aria-hidden="true" tabindex="-1"></a>tic<span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb208-12"><a href="the-programming-environment.html#cb208-12" aria-hidden="true" tabindex="-1"></a>cusip<span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb208-13"><a href="the-programming-environment.html#cb208-13" aria-hidden="true" tabindex="-1"></a>isin <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb208-14"><a href="the-programming-environment.html#cb208-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-15"><a href="the-programming-environment.html#cb208-15" aria-hidden="true" tabindex="-1"></a>filters_list<span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb208-16"><a href="the-programming-environment.html#cb208-16" aria-hidden="true" tabindex="-1"></a>filters_list_final<span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb208-17"><a href="the-programming-environment.html#cb208-17" aria-hidden="true" tabindex="-1"></a>filters_list_tweaked<span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb208-18"><a href="the-programming-environment.html#cb208-18" aria-hidden="true" tabindex="-1"></a>filters_list_tweaked_final<span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb208-19"><a href="the-programming-environment.html#cb208-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-20"><a href="the-programming-environment.html#cb208-20" aria-hidden="true" tabindex="-1"></a>query_sql <span class="ot">&lt;-</span></span>
<span id="cb208-21"><a href="the-programming-environment.html#cb208-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(dataset_a, dataset_b, column_a, column_b, column_sql, start, end, datafmt, consol, indfmt, sic, gvkey, tic, cusip, isin, <span class="at">multi_function =</span> <span class="cn">TRUE</span>, <span class="at">reuters_ds =</span> <span class="cn">FALSE</span>){</span>
<span id="cb208-22"><a href="the-programming-environment.html#cb208-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-23"><a href="the-programming-environment.html#cb208-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (reuters_ds <span class="sc">==</span> <span class="cn">FALSE</span>){</span>
<span id="cb208-24"><a href="the-programming-environment.html#cb208-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-25"><a href="the-programming-environment.html#cb208-25" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(column_a)) {</span>
<span id="cb208-26"><a href="the-programming-environment.html#cb208-26" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(column_a)) {</span>
<span id="cb208-27"><a href="the-programming-environment.html#cb208-27" aria-hidden="true" tabindex="-1"></a>      column_a[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.&quot;</span>, column_a[i], <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb208-28"><a href="the-programming-environment.html#cb208-28" aria-hidden="true" tabindex="-1"></a>      column_filter_a <span class="ot">=</span> <span class="fu">paste</span>(column_a, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>)</span>
<span id="cb208-29"><a href="the-programming-environment.html#cb208-29" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-30"><a href="the-programming-environment.html#cb208-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb208-31"><a href="the-programming-environment.html#cb208-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb208-32"><a href="the-programming-environment.html#cb208-32" aria-hidden="true" tabindex="-1"></a>      columns_filter_a <span class="ot">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb208-33"><a href="the-programming-environment.html#cb208-33" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb208-34"><a href="the-programming-environment.html#cb208-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-35"><a href="the-programming-environment.html#cb208-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(column_b)) {</span>
<span id="cb208-36"><a href="the-programming-environment.html#cb208-36" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(column_b)) {</span>
<span id="cb208-37"><a href="the-programming-environment.html#cb208-37" aria-hidden="true" tabindex="-1"></a>      column_b[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;b.&quot;</span>, column_b[i], <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb208-38"><a href="the-programming-environment.html#cb208-38" aria-hidden="true" tabindex="-1"></a>      column_filter_b <span class="ot">=</span> <span class="fu">paste</span>(column_b, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>)</span>
<span id="cb208-39"><a href="the-programming-environment.html#cb208-39" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-40"><a href="the-programming-environment.html#cb208-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb208-41"><a href="the-programming-environment.html#cb208-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb208-42"><a href="the-programming-environment.html#cb208-42" aria-hidden="true" tabindex="-1"></a>      columns_filter_b <span class="ot">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb208-43"><a href="the-programming-environment.html#cb208-43" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb208-44"><a href="the-programming-environment.html#cb208-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-45"><a href="the-programming-environment.html#cb208-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(column_sql)) {</span>
<span id="cb208-46"><a href="the-programming-environment.html#cb208-46" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(column_sql)) {</span>
<span id="cb208-47"><a href="the-programming-environment.html#cb208-47" aria-hidden="true" tabindex="-1"></a>      column_sql[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;b.&quot;</span>, column_sql[i], <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb208-48"><a href="the-programming-environment.html#cb208-48" aria-hidden="true" tabindex="-1"></a>      column_filter_sql <span class="ot">=</span> <span class="fu">paste</span>(column_sql, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>)</span>
<span id="cb208-49"><a href="the-programming-environment.html#cb208-49" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-50"><a href="the-programming-environment.html#cb208-50" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb208-51"><a href="the-programming-environment.html#cb208-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb208-52"><a href="the-programming-environment.html#cb208-52" aria-hidden="true" tabindex="-1"></a>      columns_filter_sql <span class="ot">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb208-53"><a href="the-programming-environment.html#cb208-53" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb208-54"><a href="the-programming-environment.html#cb208-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-55"><a href="the-programming-environment.html#cb208-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(start) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(end)){</span>
<span id="cb208-56"><a href="the-programming-environment.html#cb208-56" aria-hidden="true" tabindex="-1"></a>      date_filter <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.datadate BETWEEN &#39;&quot;</span>, start, <span class="st">&quot;&#39; AND &#39;&quot;</span>, end, <span class="st">&quot;&#39;&quot;</span>)</span>
<span id="cb208-57"><a href="the-programming-environment.html#cb208-57" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb208-58"><a href="the-programming-environment.html#cb208-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-59"><a href="the-programming-environment.html#cb208-59" aria-hidden="true" tabindex="-1"></a>    sic_filter <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb208-60"><a href="the-programming-environment.html#cb208-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(sic)) {</span>
<span id="cb208-61"><a href="the-programming-environment.html#cb208-61" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sic)) {</span>
<span id="cb208-62"><a href="the-programming-environment.html#cb208-62" aria-hidden="true" tabindex="-1"></a>      sic[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;&#39;&quot;</span>, sic[i], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb208-63"><a href="the-programming-environment.html#cb208-63" aria-hidden="true" tabindex="-1"></a>      sic_filter <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.sic IN (&quot;</span>, <span class="fu">paste</span>(sic, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb208-64"><a href="the-programming-environment.html#cb208-64" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-65"><a href="the-programming-environment.html#cb208-65" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb208-66"><a href="the-programming-environment.html#cb208-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-67"><a href="the-programming-environment.html#cb208-67" aria-hidden="true" tabindex="-1"></a>    gvkey_filter <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb208-68"><a href="the-programming-environment.html#cb208-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(gvkey)) {</span>
<span id="cb208-69"><a href="the-programming-environment.html#cb208-69" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(gvkey)) {</span>
<span id="cb208-70"><a href="the-programming-environment.html#cb208-70" aria-hidden="true" tabindex="-1"></a>      gvkey[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;&#39;&quot;</span>, gvkey[i], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb208-71"><a href="the-programming-environment.html#cb208-71" aria-hidden="true" tabindex="-1"></a>      gvkey_filter <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.gvkey IN (&quot;</span>, <span class="fu">paste</span>(gvkey, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb208-72"><a href="the-programming-environment.html#cb208-72" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-73"><a href="the-programming-environment.html#cb208-73" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb208-74"><a href="the-programming-environment.html#cb208-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-75"><a href="the-programming-environment.html#cb208-75" aria-hidden="true" tabindex="-1"></a>    tic_filter <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb208-76"><a href="the-programming-environment.html#cb208-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(tic)) {</span>
<span id="cb208-77"><a href="the-programming-environment.html#cb208-77" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tic)) {</span>
<span id="cb208-78"><a href="the-programming-environment.html#cb208-78" aria-hidden="true" tabindex="-1"></a>      tic[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;&#39;&quot;</span>, tic[i], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb208-79"><a href="the-programming-environment.html#cb208-79" aria-hidden="true" tabindex="-1"></a>      tic_filter <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.tic IN (&quot;</span>, <span class="fu">paste</span>(tic, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb208-80"><a href="the-programming-environment.html#cb208-80" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-81"><a href="the-programming-environment.html#cb208-81" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb208-82"><a href="the-programming-environment.html#cb208-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-83"><a href="the-programming-environment.html#cb208-83" aria-hidden="true" tabindex="-1"></a>    cusip_filter <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb208-84"><a href="the-programming-environment.html#cb208-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(cusip)) {</span>
<span id="cb208-85"><a href="the-programming-environment.html#cb208-85" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cusip)) {</span>
<span id="cb208-86"><a href="the-programming-environment.html#cb208-86" aria-hidden="true" tabindex="-1"></a>      cusip[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;&#39;&quot;</span>, cusip[i], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb208-87"><a href="the-programming-environment.html#cb208-87" aria-hidden="true" tabindex="-1"></a>      cusip_filter <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.cusip IN (&quot;</span>, <span class="fu">paste</span>(cusip, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb208-88"><a href="the-programming-environment.html#cb208-88" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-89"><a href="the-programming-environment.html#cb208-89" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb208-90"><a href="the-programming-environment.html#cb208-90" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-91"><a href="the-programming-environment.html#cb208-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(datafmt)) {</span>
<span id="cb208-92"><a href="the-programming-environment.html#cb208-92" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(datafmt)) {</span>
<span id="cb208-93"><a href="the-programming-environment.html#cb208-93" aria-hidden="true" tabindex="-1"></a>      datafmt[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.datafmt =  &#39;&quot;</span>, datafmt[i], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb208-94"><a href="the-programming-environment.html#cb208-94" aria-hidden="true" tabindex="-1"></a>      datafmt_filter <span class="ot">=</span> <span class="fu">paste</span>(datafmt, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>)</span>
<span id="cb208-95"><a href="the-programming-environment.html#cb208-95" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb208-96"><a href="the-programming-environment.html#cb208-96" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-97"><a href="the-programming-environment.html#cb208-97" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb208-98"><a href="the-programming-environment.html#cb208-98" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-99"><a href="the-programming-environment.html#cb208-99" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(consol)) {</span>
<span id="cb208-100"><a href="the-programming-environment.html#cb208-100" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(consol)) {</span>
<span id="cb208-101"><a href="the-programming-environment.html#cb208-101" aria-hidden="true" tabindex="-1"></a>      consol[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.consol =  &#39;&quot;</span>, consol[i], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb208-102"><a href="the-programming-environment.html#cb208-102" aria-hidden="true" tabindex="-1"></a>      consol_filter <span class="ot">=</span> <span class="fu">paste</span>(consol, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>)</span>
<span id="cb208-103"><a href="the-programming-environment.html#cb208-103" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb208-104"><a href="the-programming-environment.html#cb208-104" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-105"><a href="the-programming-environment.html#cb208-105" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb208-106"><a href="the-programming-environment.html#cb208-106" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-107"><a href="the-programming-environment.html#cb208-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(indfmt)) {</span>
<span id="cb208-108"><a href="the-programming-environment.html#cb208-108" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(indfmt)) {</span>
<span id="cb208-109"><a href="the-programming-environment.html#cb208-109" aria-hidden="true" tabindex="-1"></a>      indfmt[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.indfmt =  &#39;&quot;</span>, indfmt[i], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb208-110"><a href="the-programming-environment.html#cb208-110" aria-hidden="true" tabindex="-1"></a>      indfmt_filter <span class="ot">=</span> <span class="fu">paste</span>(indfmt, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>)</span>
<span id="cb208-111"><a href="the-programming-environment.html#cb208-111" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb208-112"><a href="the-programming-environment.html#cb208-112" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-113"><a href="the-programming-environment.html#cb208-113" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb208-114"><a href="the-programming-environment.html#cb208-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-115"><a href="the-programming-environment.html#cb208-115" aria-hidden="true" tabindex="-1"></a>    filters <span class="ot">=</span> <span class="fu">c</span>(date_filter, cusip_filter, tic_filter, gvkey_filter, sic_filter, datafmt_filter, consol_filter, indfmt_filter)</span>
<span id="cb208-116"><a href="the-programming-environment.html#cb208-116" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-117"><a href="the-programming-environment.html#cb208-117" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(filters)){</span>
<span id="cb208-118"><a href="the-programming-environment.html#cb208-118" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(filters[i])){</span>
<span id="cb208-119"><a href="the-programming-environment.html#cb208-119" aria-hidden="true" tabindex="-1"></a>        filters_list[i] <span class="ot">=</span> <span class="fu">paste</span>(filters[i], <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb208-120"><a href="the-programming-environment.html#cb208-120" aria-hidden="true" tabindex="-1"></a>        filters_list_final <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot; WHERE &quot;</span>, <span class="fu">paste</span>(filters_list, <span class="at">collapse =</span> <span class="st">&quot; AND &quot;</span>))</span>
<span id="cb208-121"><a href="the-programming-environment.html#cb208-121" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-122"><a href="the-programming-environment.html#cb208-122" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb208-123"><a href="the-programming-environment.html#cb208-123" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb208-124"><a href="the-programming-environment.html#cb208-124" aria-hidden="true" tabindex="-1"></a>    filters_tweaked <span class="ot">=</span> <span class="fu">c</span>(date_filter, cusip_filter, tic_filter, gvkey_filter, sic_filter)</span>
<span id="cb208-125"><a href="the-programming-environment.html#cb208-125" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-126"><a href="the-programming-environment.html#cb208-126" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(filters_tweaked[i])){</span>
<span id="cb208-127"><a href="the-programming-environment.html#cb208-127" aria-hidden="true" tabindex="-1"></a>       <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(filters_tweaked)){</span>
<span id="cb208-128"><a href="the-programming-environment.html#cb208-128" aria-hidden="true" tabindex="-1"></a>        filters_list_tweaked[i] <span class="ot">=</span> <span class="fu">paste</span>(filters_tweaked[i], <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb208-129"><a href="the-programming-environment.html#cb208-129" aria-hidden="true" tabindex="-1"></a>        filters_list_tweaked_final <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot; WHERE &quot;</span>, <span class="fu">paste</span>(filters_list_tweaked, <span class="at">collapse =</span> <span class="st">&quot; AND &quot;</span>))</span>
<span id="cb208-130"><a href="the-programming-environment.html#cb208-130" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-131"><a href="the-programming-environment.html#cb208-131" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb208-132"><a href="the-programming-environment.html#cb208-132" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-133"><a href="the-programming-environment.html#cb208-133" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (multi_function <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb208-134"><a href="the-programming-environment.html#cb208-134" aria-hidden="true" tabindex="-1"></a>      sql <span class="ot">=</span> (<span class="fu">paste</span>(<span class="st">&quot;SELECT &quot;</span>, </span>
<span id="cb208-135"><a href="the-programming-environment.html#cb208-135" aria-hidden="true" tabindex="-1"></a>                   column_filter_a, </span>
<span id="cb208-136"><a href="the-programming-environment.html#cb208-136" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;, &quot;</span>, column_filter_b,</span>
<span id="cb208-137"><a href="the-programming-environment.html#cb208-137" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot; FROM  &quot;</span>, dataset_a, <span class="st">&quot; a&quot;</span>,</span>
<span id="cb208-138"><a href="the-programming-environment.html#cb208-138" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot; inner join &quot;</span>, dataset_b, <span class="st">&quot; b&quot;</span>, </span>
<span id="cb208-139"><a href="the-programming-environment.html#cb208-139" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot; on &quot;</span>, column_a[<span class="dv">1</span>], <span class="st">&quot; = &quot;</span>, column_sql[<span class="dv">1</span>], </span>
<span id="cb208-140"><a href="the-programming-environment.html#cb208-140" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot; and &quot;</span>, column_a[<span class="dv">2</span>], <span class="st">&quot; = &quot;</span>, column_sql[<span class="dv">2</span>], </span>
<span id="cb208-141"><a href="the-programming-environment.html#cb208-141" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot; and &quot;</span>, column_a[<span class="dv">3</span>], <span class="st">&quot; = &quot;</span>, column_sql[<span class="dv">3</span>],</span>
<span id="cb208-142"><a href="the-programming-environment.html#cb208-142" aria-hidden="true" tabindex="-1"></a>                   filters_list_final))</span>
<span id="cb208-143"><a href="the-programming-environment.html#cb208-143" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb208-144"><a href="the-programming-environment.html#cb208-144" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-145"><a href="the-programming-environment.html#cb208-145" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb208-146"><a href="the-programming-environment.html#cb208-146" aria-hidden="true" tabindex="-1"></a>      sql <span class="ot">=</span> (<span class="fu">paste</span>(<span class="st">&quot;SELECT &quot;</span>, </span>
<span id="cb208-147"><a href="the-programming-environment.html#cb208-147" aria-hidden="true" tabindex="-1"></a>                   column_filter_a, </span>
<span id="cb208-148"><a href="the-programming-environment.html#cb208-148" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot; FROM  &quot;</span>, dataset_a, <span class="st">&quot; a&quot;</span>,</span>
<span id="cb208-149"><a href="the-programming-environment.html#cb208-149" aria-hidden="true" tabindex="-1"></a>                   filters_list_tweaked_final))</span>
<span id="cb208-150"><a href="the-programming-environment.html#cb208-150" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb208-151"><a href="the-programming-environment.html#cb208-151" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb208-152"><a href="the-programming-environment.html#cb208-152" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb208-153"><a href="the-programming-environment.html#cb208-153" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-154"><a href="the-programming-environment.html#cb208-154" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb208-155"><a href="the-programming-environment.html#cb208-155" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(column_a)) {</span>
<span id="cb208-156"><a href="the-programming-environment.html#cb208-156" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(column_a)) {</span>
<span id="cb208-157"><a href="the-programming-environment.html#cb208-157" aria-hidden="true" tabindex="-1"></a>        column_a[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.&quot;</span>, column_a[i], <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb208-158"><a href="the-programming-environment.html#cb208-158" aria-hidden="true" tabindex="-1"></a>        column_filter_a <span class="ot">=</span> <span class="fu">paste</span>(column_a, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>)</span>
<span id="cb208-159"><a href="the-programming-environment.html#cb208-159" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb208-160"><a href="the-programming-environment.html#cb208-160" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-161"><a href="the-programming-environment.html#cb208-161" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb208-162"><a href="the-programming-environment.html#cb208-162" aria-hidden="true" tabindex="-1"></a>        columns_filter_a <span class="ot">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb208-163"><a href="the-programming-environment.html#cb208-163" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-164"><a href="the-programming-environment.html#cb208-164" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb208-165"><a href="the-programming-environment.html#cb208-165" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(column_b)) {</span>
<span id="cb208-166"><a href="the-programming-environment.html#cb208-166" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(column_b)) {</span>
<span id="cb208-167"><a href="the-programming-environment.html#cb208-167" aria-hidden="true" tabindex="-1"></a>        column_b[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;b.&quot;</span>, column_b[i], <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb208-168"><a href="the-programming-environment.html#cb208-168" aria-hidden="true" tabindex="-1"></a>        column_filter_b <span class="ot">=</span> <span class="fu">paste</span>(column_b, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>)</span>
<span id="cb208-169"><a href="the-programming-environment.html#cb208-169" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb208-170"><a href="the-programming-environment.html#cb208-170" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-171"><a href="the-programming-environment.html#cb208-171" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb208-172"><a href="the-programming-environment.html#cb208-172" aria-hidden="true" tabindex="-1"></a>        columns_filter_b <span class="ot">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb208-173"><a href="the-programming-environment.html#cb208-173" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-174"><a href="the-programming-environment.html#cb208-174" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb208-175"><a href="the-programming-environment.html#cb208-175" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(column_sql)) {</span>
<span id="cb208-176"><a href="the-programming-environment.html#cb208-176" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(column_sql)) {</span>
<span id="cb208-177"><a href="the-programming-environment.html#cb208-177" aria-hidden="true" tabindex="-1"></a>        column_sql[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;b.&quot;</span>, column_sql[i], <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb208-178"><a href="the-programming-environment.html#cb208-178" aria-hidden="true" tabindex="-1"></a>        column_filter_sql <span class="ot">=</span> <span class="fu">paste</span>(column_sql, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>)</span>
<span id="cb208-179"><a href="the-programming-environment.html#cb208-179" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb208-180"><a href="the-programming-environment.html#cb208-180" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-181"><a href="the-programming-environment.html#cb208-181" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb208-182"><a href="the-programming-environment.html#cb208-182" aria-hidden="true" tabindex="-1"></a>        columns_filter_sql <span class="ot">=</span> <span class="st">&quot;&quot;</span></span>
<span id="cb208-183"><a href="the-programming-environment.html#cb208-183" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-184"><a href="the-programming-environment.html#cb208-184" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb208-185"><a href="the-programming-environment.html#cb208-185" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(start) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(end)){</span>
<span id="cb208-186"><a href="the-programming-environment.html#cb208-186" aria-hidden="true" tabindex="-1"></a>        date_filter <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.year_ BETWEEN &#39;&quot;</span>, start, <span class="st">&quot;&#39; AND &#39;&quot;</span>, end, <span class="st">&quot;&#39;&quot;</span>)</span>
<span id="cb208-187"><a href="the-programming-environment.html#cb208-187" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-188"><a href="the-programming-environment.html#cb208-188" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb208-189"><a href="the-programming-environment.html#cb208-189" aria-hidden="true" tabindex="-1"></a>      sic_filter <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb208-190"><a href="the-programming-environment.html#cb208-190" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(sic)) {</span>
<span id="cb208-191"><a href="the-programming-environment.html#cb208-191" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sic)) {</span>
<span id="cb208-192"><a href="the-programming-environment.html#cb208-192" aria-hidden="true" tabindex="-1"></a>        sic[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;&#39;&quot;</span>, sic[i], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb208-193"><a href="the-programming-environment.html#cb208-193" aria-hidden="true" tabindex="-1"></a>        sic_filter <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.sic IN (&quot;</span>, <span class="fu">paste</span>(sic, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb208-194"><a href="the-programming-environment.html#cb208-194" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb208-195"><a href="the-programming-environment.html#cb208-195" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-196"><a href="the-programming-environment.html#cb208-196" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb208-197"><a href="the-programming-environment.html#cb208-197" aria-hidden="true" tabindex="-1"></a>      gvkey_filter <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb208-198"><a href="the-programming-environment.html#cb208-198" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(gvkey)) {</span>
<span id="cb208-199"><a href="the-programming-environment.html#cb208-199" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(gvkey)) {</span>
<span id="cb208-200"><a href="the-programming-environment.html#cb208-200" aria-hidden="true" tabindex="-1"></a>        gvkey[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;&#39;&quot;</span>, gvkey[i], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb208-201"><a href="the-programming-environment.html#cb208-201" aria-hidden="true" tabindex="-1"></a>        gvkey_filter <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.gvkey IN (&quot;</span>, <span class="fu">paste</span>(gvkey, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb208-202"><a href="the-programming-environment.html#cb208-202" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb208-203"><a href="the-programming-environment.html#cb208-203" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-204"><a href="the-programming-environment.html#cb208-204" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb208-205"><a href="the-programming-environment.html#cb208-205" aria-hidden="true" tabindex="-1"></a>      tic_filter <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb208-206"><a href="the-programming-environment.html#cb208-206" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(tic)) {</span>
<span id="cb208-207"><a href="the-programming-environment.html#cb208-207" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tic)) {</span>
<span id="cb208-208"><a href="the-programming-environment.html#cb208-208" aria-hidden="true" tabindex="-1"></a>        tic[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;&#39;&quot;</span>, tic[i], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb208-209"><a href="the-programming-environment.html#cb208-209" aria-hidden="true" tabindex="-1"></a>        tic_filter <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.item5601 IN (&quot;</span>, <span class="fu">paste</span>(tic, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb208-210"><a href="the-programming-environment.html#cb208-210" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb208-211"><a href="the-programming-environment.html#cb208-211" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-212"><a href="the-programming-environment.html#cb208-212" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb208-213"><a href="the-programming-environment.html#cb208-213" aria-hidden="true" tabindex="-1"></a>      cusip_filter <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb208-214"><a href="the-programming-environment.html#cb208-214" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(cusip)) {</span>
<span id="cb208-215"><a href="the-programming-environment.html#cb208-215" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cusip)) {</span>
<span id="cb208-216"><a href="the-programming-environment.html#cb208-216" aria-hidden="true" tabindex="-1"></a>        cusip[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;&#39;&quot;</span>, cusip[i], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb208-217"><a href="the-programming-environment.html#cb208-217" aria-hidden="true" tabindex="-1"></a>        cusip_filter <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.item6004 IN (&quot;</span>, <span class="fu">paste</span>(cusip, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb208-218"><a href="the-programming-environment.html#cb208-218" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb208-219"><a href="the-programming-environment.html#cb208-219" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-220"><a href="the-programming-environment.html#cb208-220" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb208-221"><a href="the-programming-environment.html#cb208-221" aria-hidden="true" tabindex="-1"></a>      isin_filter <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb208-222"><a href="the-programming-environment.html#cb208-222" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(isin)) {</span>
<span id="cb208-223"><a href="the-programming-environment.html#cb208-223" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(isin)) {</span>
<span id="cb208-224"><a href="the-programming-environment.html#cb208-224" aria-hidden="true" tabindex="-1"></a>        isin[i] <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;&#39;&quot;</span>, isin[i], <span class="st">&quot;&#39;&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb208-225"><a href="the-programming-environment.html#cb208-225" aria-hidden="true" tabindex="-1"></a>        isin_filter <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;a.item6008 IN (&quot;</span>, <span class="fu">paste</span>(isin, <span class="at">collapse =</span> <span class="st">&#39;,&#39;</span>), <span class="st">&quot;)&quot;</span>)</span>
<span id="cb208-226"><a href="the-programming-environment.html#cb208-226" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb208-227"><a href="the-programming-environment.html#cb208-227" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-228"><a href="the-programming-environment.html#cb208-228" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb208-229"><a href="the-programming-environment.html#cb208-229" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb208-230"><a href="the-programming-environment.html#cb208-230" aria-hidden="true" tabindex="-1"></a>      filters <span class="ot">=</span> <span class="fu">c</span>(date_filter, cusip_filter, tic_filter, gvkey_filter, sic_filter, isin_filter)</span>
<span id="cb208-231"><a href="the-programming-environment.html#cb208-231" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb208-232"><a href="the-programming-environment.html#cb208-232" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(filters)){</span>
<span id="cb208-233"><a href="the-programming-environment.html#cb208-233" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(filters[i])){</span>
<span id="cb208-234"><a href="the-programming-environment.html#cb208-234" aria-hidden="true" tabindex="-1"></a>          filters_list[i] <span class="ot">=</span> <span class="fu">paste</span>(filters[i], <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb208-235"><a href="the-programming-environment.html#cb208-235" aria-hidden="true" tabindex="-1"></a>          filters_list_final <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot; WHERE &quot;</span>, <span class="fu">paste</span>(filters_list, <span class="at">collapse =</span> <span class="st">&quot; AND &quot;</span>))</span>
<span id="cb208-236"><a href="the-programming-environment.html#cb208-236" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb208-237"><a href="the-programming-environment.html#cb208-237" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-238"><a href="the-programming-environment.html#cb208-238" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb208-239"><a href="the-programming-environment.html#cb208-239" aria-hidden="true" tabindex="-1"></a>      filters_tweaked <span class="ot">=</span> <span class="fu">c</span>(date_filter, cusip_filter, tic_filter, gvkey_filter, sic_filter, isin_filter)</span>
<span id="cb208-240"><a href="the-programming-environment.html#cb208-240" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb208-241"><a href="the-programming-environment.html#cb208-241" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(filters_tweaked[i])){</span>
<span id="cb208-242"><a href="the-programming-environment.html#cb208-242" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(filters_tweaked)){</span>
<span id="cb208-243"><a href="the-programming-environment.html#cb208-243" aria-hidden="true" tabindex="-1"></a>          filters_list_tweaked[i] <span class="ot">=</span> <span class="fu">paste</span>(filters_tweaked[i], <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb208-244"><a href="the-programming-environment.html#cb208-244" aria-hidden="true" tabindex="-1"></a>          filters_list_tweaked_final <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot; WHERE &quot;</span>, <span class="fu">paste</span>(filters_list_tweaked, <span class="at">collapse =</span> <span class="st">&quot; AND &quot;</span>))</span>
<span id="cb208-245"><a href="the-programming-environment.html#cb208-245" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb208-246"><a href="the-programming-environment.html#cb208-246" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-247"><a href="the-programming-environment.html#cb208-247" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb208-248"><a href="the-programming-environment.html#cb208-248" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (multi_function <span class="sc">==</span> <span class="cn">TRUE</span>){</span>
<span id="cb208-249"><a href="the-programming-environment.html#cb208-249" aria-hidden="true" tabindex="-1"></a>        sql <span class="ot">=</span> (<span class="fu">paste</span>(<span class="st">&quot;SELECT &quot;</span>, </span>
<span id="cb208-250"><a href="the-programming-environment.html#cb208-250" aria-hidden="true" tabindex="-1"></a>                     column_filter_a, </span>
<span id="cb208-251"><a href="the-programming-environment.html#cb208-251" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;, &quot;</span>, column_filter_b,</span>
<span id="cb208-252"><a href="the-programming-environment.html#cb208-252" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot; FROM  &quot;</span>, dataset_a, <span class="st">&quot; a&quot;</span>,</span>
<span id="cb208-253"><a href="the-programming-environment.html#cb208-253" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot; inner join &quot;</span>, dataset_b, <span class="st">&quot; b&quot;</span>, </span>
<span id="cb208-254"><a href="the-programming-environment.html#cb208-254" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot; on &quot;</span>, column_a[<span class="dv">1</span>], <span class="st">&quot; = &quot;</span>, column_sql[<span class="dv">1</span>], </span>
<span id="cb208-255"><a href="the-programming-environment.html#cb208-255" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot; and &quot;</span>, column_a[<span class="dv">2</span>], <span class="st">&quot; = &quot;</span>, column_sql[<span class="dv">2</span>], </span>
<span id="cb208-256"><a href="the-programming-environment.html#cb208-256" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot; and &quot;</span>, column_a[<span class="dv">3</span>], <span class="st">&quot; = &quot;</span>, column_sql[<span class="dv">3</span>],</span>
<span id="cb208-257"><a href="the-programming-environment.html#cb208-257" aria-hidden="true" tabindex="-1"></a>                     filters_list_final))</span>
<span id="cb208-258"><a href="the-programming-environment.html#cb208-258" aria-hidden="true" tabindex="-1"></a>      } </span>
<span id="cb208-259"><a href="the-programming-environment.html#cb208-259" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb208-260"><a href="the-programming-environment.html#cb208-260" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span> {</span>
<span id="cb208-261"><a href="the-programming-environment.html#cb208-261" aria-hidden="true" tabindex="-1"></a>        sql <span class="ot">=</span> (<span class="fu">paste</span>(<span class="st">&quot;SELECT &quot;</span>, </span>
<span id="cb208-262"><a href="the-programming-environment.html#cb208-262" aria-hidden="true" tabindex="-1"></a>                     column_filter_a, </span>
<span id="cb208-263"><a href="the-programming-environment.html#cb208-263" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot; FROM  &quot;</span>, dataset_a, <span class="st">&quot; a&quot;</span>,</span>
<span id="cb208-264"><a href="the-programming-environment.html#cb208-264" aria-hidden="true" tabindex="-1"></a>                     filters_list_tweaked_final))</span>
<span id="cb208-265"><a href="the-programming-environment.html#cb208-265" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb208-266"><a href="the-programming-environment.html#cb208-266" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb208-267"><a href="the-programming-environment.html#cb208-267" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb208-268"><a href="the-programming-environment.html#cb208-268" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
<p>Let’s see how this works. In the next text block, we define the function inputs. As we see, the function requires the following arguments (or variables):</p>
<ul>
<li>dataset_a: Defines the first data source (e.g. comp.funda)</li>
<li>dataset_b Defines the second data source (e.g. comp.secm)</li>
<li>column_a: Defines the list of variables we want to retrieve from the first data source</li>
<li>column_b: Defines the list of variables we want to retrieve from the second data source</li>
<li>column_sql: Defines on which variables we want to merge both data sources</li>
<li>start: Start date of the retrieval</li>
<li>end: End data of the retrieval</li>
<li>datafmt: Data Format (usually “STD”)</li>
<li>consol: Consol (usually “C”)</li>
<li>indfmt: Key Format (usually “INDL”)</li>
<li>sic: Potential Company Identifier</li>
<li>gvkey: Potential Company Identifier</li>
<li>tic: Potential Company Identifier</li>
<li>cusip: Potential Company Identifier</li>
<li>multi_function: Logical argument idicating if we draw data from multiple source or only one source. Default: TRUE</li>
<li>reuters_ds: Logical argument indicating if we take data from Reuters Datastream or Compustat/CRSP. Default: FALSE</li>
</ul>
<p>Note that if we want to take data from Reuters, we need different input parameters as when we take data from CRSP / Compustat. As such, we need to change both input parameters for date and company variables. This will be shown in a later chapter.</p>
<p>Great, now we can just define lists for the variables within column_a, column_b and column_sql, enter which sources we want to retrieve the data from in dataset_a and dataset_b and which identifier to use (here I used a list of unique gvkeys for over 5’000 companies). Note that, by default, all arguments are NULL and thus, if you don’t want to change some of the variables you can just leave them with the identity command (e.g. sic = sic, etc.)</p>
<p>What this does now is it creates a string-based query input identical to the one above. We can directly take this query input and send it to the database through <code>dbSendQuery(wrds, query)</code> (whereas query represents the fetching command we wrote manually before).</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="the-programming-environment.html#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the first database, used for the keys from the fundamentals annually list</span></span>
<span id="cb209-2"><a href="the-programming-environment.html#cb209-2" aria-hidden="true" tabindex="-1"></a>column_a <span class="ot">=</span> <span class="fu">list</span>(<span class="st">&#39;gvkey&#39;</span>, <span class="st">&#39;iid&#39;</span>, <span class="st">&#39;datadate&#39;</span>, <span class="st">&#39;cik&#39;</span>, <span class="st">&#39;conm&#39;</span>, <span class="st">&#39;tic&#39;</span>, <span class="st">&#39;cusip&#39;</span>, <span class="st">&#39;exchg&#39;</span>,</span>
<span id="cb209-3"><a href="the-programming-environment.html#cb209-3" aria-hidden="true" tabindex="-1"></a>             <span class="st">&#39;atq&#39;</span>, <span class="st">&#39;actq&#39;</span>, <span class="st">&#39;ltq&#39;</span>, <span class="st">&#39;lctq&#39;</span>, <span class="st">&#39;ceqq&#39;</span>, <span class="st">&#39;teqq&#39;</span>, <span class="st">&#39;revtq&#39;</span>, <span class="st">&#39;cogsq&#39;</span>, <span class="st">&#39;xintq&#39;</span>, <span class="st">&#39;xsgaq&#39;</span>, <span class="st">&#39;ugiq&#39;</span>, <span class="st">&#39;niq&#39;</span>, <span class="st">&#39;epspxq&#39;</span>, <span class="st">&#39;dvpspq&#39;</span>)</span>
<span id="cb209-4"><a href="the-programming-environment.html#cb209-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-5"><a href="the-programming-environment.html#cb209-5" aria-hidden="true" tabindex="-1"></a><span class="co"># This is to connect the both databases without duplicating their output in the end</span></span>
<span id="cb209-6"><a href="the-programming-environment.html#cb209-6" aria-hidden="true" tabindex="-1"></a>column_sql <span class="ot">=</span> <span class="fu">list</span>(<span class="st">&#39;gvkey&#39;</span>, <span class="st">&#39;iid&#39;</span>, <span class="st">&#39;datadate&#39;</span>)</span>
<span id="cb209-7"><a href="the-programming-environment.html#cb209-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-8"><a href="the-programming-environment.html#cb209-8" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the second database, used for the keys from the securities monthly list</span></span>
<span id="cb209-9"><a href="the-programming-environment.html#cb209-9" aria-hidden="true" tabindex="-1"></a>column_b <span class="ot">=</span> <span class="fu">list</span>(<span class="st">&#39;secstat&#39;</span>, <span class="st">&#39;cshtrm&#39;</span>)</span>
<span id="cb209-10"><a href="the-programming-environment.html#cb209-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-11"><a href="the-programming-environment.html#cb209-11" aria-hidden="true" tabindex="-1"></a><span class="co"># This is the query output. It is a string that replicates what one would write in the SQL server to obtain data from a (multiple) source(s)</span></span>
<span id="cb209-12"><a href="the-programming-environment.html#cb209-12" aria-hidden="true" tabindex="-1"></a>gvkey <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;~/Desktop/Empirical Asset Management/Data/SQL_Query_Check/calls_us_climate_final_df.csv&quot;</span>, <span class="at">header =</span> T)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb209-13"><a href="the-programming-environment.html#cb209-13" aria-hidden="true" tabindex="-1"></a>gvkey <span class="ot">=</span> <span class="fu">unique</span>(gvkey)</span>
<span id="cb209-14"><a href="the-programming-environment.html#cb209-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-15"><a href="the-programming-environment.html#cb209-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the quarterly data on company financials</span></span>
<span id="cb209-16"><a href="the-programming-environment.html#cb209-16" aria-hidden="true" tabindex="-1"></a>query <span class="ot">=</span> <span class="fu">query_sql</span>(<span class="at">dataset_a =</span> <span class="st">&quot;comp.fundq&quot;</span>,</span>
<span id="cb209-17"><a href="the-programming-environment.html#cb209-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dataset_b =</span> <span class="st">&quot;comp.secm&quot;</span>,</span>
<span id="cb209-18"><a href="the-programming-environment.html#cb209-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">multi_function =</span> <span class="cn">TRUE</span>,</span>
<span id="cb209-19"><a href="the-programming-environment.html#cb209-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">column_a =</span> column_a,</span>
<span id="cb209-20"><a href="the-programming-environment.html#cb209-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">column_b =</span> column_b,</span>
<span id="cb209-21"><a href="the-programming-environment.html#cb209-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">column_sql =</span> column_sql,</span>
<span id="cb209-22"><a href="the-programming-environment.html#cb209-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">gvkey =</span> gvkey,</span>
<span id="cb209-23"><a href="the-programming-environment.html#cb209-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sic =</span> sic,</span>
<span id="cb209-24"><a href="the-programming-environment.html#cb209-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tic =</span> tic,</span>
<span id="cb209-25"><a href="the-programming-environment.html#cb209-25" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cusip =</span> cusip, </span>
<span id="cb209-26"><a href="the-programming-environment.html#cb209-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">datafmt =</span> <span class="st">&#39;STD&#39;</span>, </span>
<span id="cb209-27"><a href="the-programming-environment.html#cb209-27" aria-hidden="true" tabindex="-1"></a>                  <span class="at">consol =</span> <span class="st">&#39;C&#39;</span>, </span>
<span id="cb209-28"><a href="the-programming-environment.html#cb209-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">indfmt =</span> <span class="st">&#39;INDL&#39;</span>,</span>
<span id="cb209-29"><a href="the-programming-environment.html#cb209-29" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start =</span> <span class="st">&#39;2000-01-01&#39;</span>,</span>
<span id="cb209-30"><a href="the-programming-environment.html#cb209-30" aria-hidden="true" tabindex="-1"></a>                  <span class="at">end =</span> <span class="st">&#39;2010-01-01&#39;</span>) </span>
<span id="cb209-31"><a href="the-programming-environment.html#cb209-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-32"><a href="the-programming-environment.html#cb209-32" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">dbSendQuery</span>(wrds, query)</span>
<span id="cb209-33"><a href="the-programming-environment.html#cb209-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-34"><a href="the-programming-environment.html#cb209-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Fetch data</span></span>
<span id="cb209-35"><a href="the-programming-environment.html#cb209-35" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">dbFetch</span>(res)</span>
<span id="cb209-36"><a href="the-programming-environment.html#cb209-36" aria-hidden="true" tabindex="-1"></a><span class="co"># See data</span></span>
<span id="cb209-37"><a href="the-programming-environment.html#cb209-37" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;GVKEY&#39;</span>, <span class="st">&#39;IID&#39;</span>, <span class="st">&#39;Date_t&#39;</span>, <span class="st">&#39;CIK&#39;</span>, <span class="st">&#39;Comp_name&#39;</span>, <span class="st">&#39;Ticker&#39;</span>, <span class="st">&#39;CUSIP&#39;</span>, <span class="st">&#39;Exchange_Code&#39;</span>,</span>
<span id="cb209-38"><a href="the-programming-environment.html#cb209-38" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&#39;Total_Assets_t&#39;</span>, <span class="st">&#39;Current_Assets_t&#39;</span>, <span class="st">&#39;Total_Liab_t&#39;</span>, <span class="st">&#39;Current_Liab_t&#39;</span>, <span class="st">&#39;Common_Equity_t&#39;</span>,</span>
<span id="cb209-39"><a href="the-programming-environment.html#cb209-39" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&#39;Shareholder_Equity_t&#39;</span>, <span class="st">&#39;Revenue_Tot_t&#39;</span>, <span class="st">&#39;COGS_t&#39;</span>, <span class="st">&#39;Interest_Exp_t&#39;</span>, <span class="st">&#39;SGA_t&#39;</span>, <span class="st">&#39;Gross_Income_t&#39;</span>, <span class="st">&#39;Net_Income_t&#39;</span>,</span>
<span id="cb209-40"><a href="the-programming-environment.html#cb209-40" aria-hidden="true" tabindex="-1"></a>                         <span class="st">&#39;EPS_t&#39;</span>, <span class="st">&#39;DPS_t&#39;</span>, <span class="st">&#39;Security_Status&#39;</span>, <span class="st">&quot;Traded_Shares&quot;</span>)</span>
<span id="cb209-41"><a href="the-programming-environment.html#cb209-41" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span></code></pre></div>
<pre><code>##    GVKEY IID     Date_t        CIK                  Comp_name Ticker     CUSIP Exchange_Code Total_Assets_t Current_Assets_t Total_Liab_t
## 1 110721  01 2000-01-31 0001057709              CARREKER CORP   CANI 144433109            14         82.823           71.943       17.417
## 2 117768  01 2000-01-31 0001045810                NVIDIA CORP   NVDA 67066G104            14        202.250          173.175       77.687
## 3 118267  01 2000-01-31 0000056679                 KORN FERRY    KFY 500643200            11        403.259          222.951      191.364
## 4 118321  01 2000-01-31 0001073967        SERENA SOFTWARE INC SRNA.1 817492101            14        149.059          118.938       34.535
## 5 120513  01 2000-01-31 0001080359                  ALLOY INC   ALOY 019855303            14         57.668           42.639       12.460
## 6 120774  01 2000-01-31 0001009626 BROCADE COMMUNICATIONS SYS   BRCD 111621306            14        135.112          124.951       41.932
##   Current_Liab_t Common_Equity_t Shareholder_Equity_t Revenue_Tot_t COGS_t Interest_Exp_t  SGA_t Gross_Income_t Net_Income_t EPS_t DPS_t
## 1         15.413          65.406                   NA        21.599  9.214             NA  8.320             NA        2.612  0.14     0
## 2         76.225         124.563                   NA       128.455 79.809             NA 24.944             NA       14.587  0.47     0
## 3        136.430         209.058                   NA       122.075 68.514          1.437 35.345             NA        8.285  0.23     0
## 4         29.307         114.524                   NA        24.373  3.835          0.000 10.960             NA        6.010  0.24     0
## 5         12.460          45.208                   NA        16.947  6.824             NA 15.030             NA       -4.359 -0.30     0
## 6         41.932          93.180                   NA        42.740 20.084             NA 14.591             NA        7.308  0.12     0
##   Security_Status Traded_Shares
## 1               I       2658200
## 2               A      10294300
## 3               A       1235200
## 4               I       3061200
## 5               I       5301400
## 6               I      28782800</code></pre>
<p>This is great. In under a minute we were able to retrieve over 36’000 rows and 24 columns of data. This is definitively quicker than doing this via drag-and-drop (btw: now you know why GS Investment Banking Interns work 100+ hours - b/c they don’t know these commands :-) ).</p>
</div>
<div id="upsample-data" class="section level4" number="2.2.11.5">
<h4><span class="header-section-number">2.2.11.5</span> Upsample Data</h4>
<p>We now retrieved much of the data we need. But, unfortunately, most of company fundamentals data is only available in quarterly or annual format (this makes sense as they only report in this periodicity). However, most of the security data (returns, dividends, share amounts, OHLC) is given in much higher intervals. Now, if we want to combine both data sources, we need to sample them both onto the same periodicity.</p>
<p>Throughout the lecture, we mostly work with monthly data. As such, in order to be able to compare fundamentals with security data, we should upsample the periodicity of the fundamentals. In principle, this means that we need to duplicate the rows within a given period. For instance, if we have quarterly data and transform it to monthly data, we need to replicate each quarter row twice to get three identical rows for quarterly financials of a given company per quarter. Although this does not necessarily add any new information, this will make it extremely handy to use the data for later analysis (especially for factor creation).</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="the-programming-environment.html#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the upsampled time-series to obtain monthly intervals (from quarterly)</span></span>
<span id="cb211-2"><a href="the-programming-environment.html#cb211-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3"><a href="the-programming-environment.html#cb211-3" aria-hidden="true" tabindex="-1"></a><span class="do">## First, delete rows that SQL incorrectly retrieved multiple times</span></span>
<span id="cb211-4"><a href="the-programming-environment.html#cb211-4" aria-hidden="true" tabindex="-1"></a>data_unique <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(GVKEY, Date_t, <span class="at">.keep_all =</span> T) </span>
<span id="cb211-5"><a href="the-programming-environment.html#cb211-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Define, for each company and quarter, the last date of the quarter (e.g. if your date is 2000-03-31, then Last_Date_Q_t = 2000-06-30)</span></span>
<span id="cb211-6"><a href="the-programming-environment.html#cb211-6" aria-hidden="true" tabindex="-1"></a>data_unique<span class="sc">$</span>Last_Date_Q_t <span class="ot">&lt;-</span> data_unique<span class="sc">$</span>Date_t <span class="sc">%m+%</span> <span class="fu">months</span>(<span class="dv">2</span>)</span>
<span id="cb211-7"><a href="the-programming-environment.html#cb211-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Define the interval, in months, between both the first and last date of each quarter and add 1 (to get the absolute period interval)</span></span>
<span id="cb211-8"><a href="the-programming-environment.html#cb211-8" aria-hidden="true" tabindex="-1"></a>data_unique<span class="sc">$</span>Interval_Date_Q <span class="ot">&lt;-</span> (<span class="fu">interval</span>(data_unique<span class="sc">$</span>Date_t, data_unique<span class="sc">$</span>Last_Date_Q_t) <span class="sc">%/%</span> <span class="fu">months</span>(<span class="dv">1</span>)) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb211-9"><a href="the-programming-environment.html#cb211-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-10"><a href="the-programming-environment.html#cb211-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-11"><a href="the-programming-environment.html#cb211-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Tidy command to create duplicated observations for each month (going from quarterly to monthly observations)</span></span>
<span id="cb211-12"><a href="the-programming-environment.html#cb211-12" aria-hidden="true" tabindex="-1"></a>data_monthly <span class="ot">&lt;-</span> <span class="fu">expandRows</span>(data_unique, <span class="st">&quot;Interval_Date_Q&quot;</span>, <span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(GVKEY, Date_t) <span class="sc">%&gt;%</span> </span>
<span id="cb211-13"><a href="the-programming-environment.html#cb211-13" aria-hidden="true" tabindex="-1"></a><span class="fu">group_by</span>(GVKEY, Date_t, Last_Date_Q_t)  <span class="sc">%&gt;%</span> </span>
<span id="cb211-14"><a href="the-programming-environment.html#cb211-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date_Monthly =</span> <span class="fu">seq</span>(<span class="fu">as.Date</span>(<span class="fu">ceiling_date</span>(<span class="fu">first</span>(Date_t), <span class="at">unit =</span> <span class="st">&quot;month&quot;</span>)),</span>
<span id="cb211-15"><a href="the-programming-environment.html#cb211-15" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">as.Date</span>(<span class="fu">ceiling_date</span>(<span class="fu">first</span>(Last_Date_Q_t) , <span class="st">&quot;month&quot;</span>)),</span>
<span id="cb211-16"><a href="the-programming-environment.html#cb211-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">by =</span> <span class="st">&quot;months&quot;</span>) <span class="sc">-</span> <span class="fu">days</span>(<span class="dv">1</span>)) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb211-17"><a href="the-programming-environment.html#cb211-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-18"><a href="the-programming-environment.html#cb211-18" aria-hidden="true" tabindex="-1"></a><span class="co"># This command is a little nasty. So nasty, that it even looks complicated with a tidy command. But fear not, it can be defined accordingly: </span></span>
<span id="cb211-19"><a href="the-programming-environment.html#cb211-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-20"><a href="the-programming-environment.html#cb211-20" aria-hidden="true" tabindex="-1"></a><span class="do">## expandRows: This expands or duplicates each row based on the Interval variable. That is, if the interval = 3, then we get three duplicated rows per observation. </span></span>
<span id="cb211-21"><a href="the-programming-environment.html#cb211-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-22"><a href="the-programming-environment.html#cb211-22" aria-hidden="true" tabindex="-1"></a><span class="do">## arrange: This is needed such that tidy understands how to sort each expansion </span></span>
<span id="cb211-23"><a href="the-programming-environment.html#cb211-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-24"><a href="the-programming-environment.html#cb211-24" aria-hidden="true" tabindex="-1"></a><span class="do">## group_by: Here, we then group by GVKEY First Date and Last Date of the Quarter to tell R that it should execute the following commands for each group individually (as such, no duplication of the commands can be ensured)</span></span>
<span id="cb211-25"><a href="the-programming-environment.html#cb211-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-26"><a href="the-programming-environment.html#cb211-26" aria-hidden="true" tabindex="-1"></a><span class="do">## mutate: Here, we create the new date variables per group. This basically then creates for each group defined a variable that the last day of each month for the specific quarter as a Date. We do this in the following fashion:</span></span>
<span id="cb211-27"><a href="the-programming-environment.html#cb211-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-28"><a href="the-programming-environment.html#cb211-28" aria-hidden="true" tabindex="-1"></a><span class="do">### seq(): We first enter for each quarter-company group a sequence, starting with the first day of the first month of each quarter and ending with the first day of the last month of the next quarter. By defines the interval fromt the first to the last observation  </span></span>
<span id="cb211-29"><a href="the-programming-environment.html#cb211-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-30"><a href="the-programming-environment.html#cb211-30" aria-hidden="true" tabindex="-1"></a><span class="do">### unit = &quot;month&quot; defines that we want to have the specific date in a month format (e.g. 2000-03-31)</span></span>
<span id="cb211-31"><a href="the-programming-environment.html#cb211-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-32"><a href="the-programming-environment.html#cb211-32" aria-hidden="true" tabindex="-1"></a><span class="do">### ceiling_date(): This command ensure that we get the first day of the respective month</span></span>
<span id="cb211-33"><a href="the-programming-environment.html#cb211-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-34"><a href="the-programming-environment.html#cb211-34" aria-hidden="true" tabindex="-1"></a><span class="do">### days(1) We then subtract from the respective dates one day, by doing so, we get the last days of each month for each quarter (we want the last days as, in monthly intervals of financial analysis, the dates are always w.r.t the last day of each month)</span></span>
<span id="cb211-35"><a href="the-programming-environment.html#cb211-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-36"><a href="the-programming-environment.html#cb211-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Like this, we create a column which includes, for each quarter-company combination, the three end dates of the respective quarter. For instance, for the quarter between 2000-03-31 and 2000-06-30, we get. 2000-03-31, 2000-04-30 and 2000-05-31. Like that, we successfully duplicated each company-quarter analysis three times and assigned the correct end-of-month dates to each of the rows. </span></span>
<span id="cb211-37"><a href="the-programming-environment.html#cb211-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-38"><a href="the-programming-environment.html#cb211-38" aria-hidden="true" tabindex="-1"></a><span class="co"># That is, we finally created a monthly upsampled dataset from quarterly observations. Halleluja (this actually took an entire day to code so don&#39;t worry if you don&#39;t get it from the start). </span></span>
<span id="cb211-39"><a href="the-programming-environment.html#cb211-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-40"><a href="the-programming-environment.html#cb211-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Lastly, we can create a Time-Series Object :</span></span>
<span id="cb211-41"><a href="the-programming-environment.html#cb211-41" aria-hidden="true" tabindex="-1"></a>data_monthly <span class="ot">&lt;-</span> data_monthly <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Date_t, Interval_Date_Q, Last_Date_Q_t)) </span>
<span id="cb211-42"><a href="the-programming-environment.html#cb211-42" aria-hidden="true" tabindex="-1"></a>data_monthly_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(data_monthly[, <span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(data_monthly) <span class="sc">==</span> <span class="st">&quot;Date_Monthly&quot;</span>)] , <span class="at">order.by =</span> <span class="fu">as.Date</span>(<span class="fu">as.POSIXct</span>(data_monthly<span class="sc">$</span>Date_Monthly)))</span></code></pre></div>
<p>Now, we have upsampled the quarterly fundamentals data set. We may now take data on securities and combine it with the fundamentals data.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="the-programming-environment.html#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the monthly data on share prices </span></span>
<span id="cb212-2"><a href="the-programming-environment.html#cb212-2" aria-hidden="true" tabindex="-1"></a>column_a <span class="ot">=</span> <span class="fu">list</span>(<span class="st">&#39;gvkey&#39;</span>, <span class="st">&#39;iid&#39;</span>, <span class="st">&#39;datadate&#39;</span>, <span class="st">&#39;cik&#39;</span>, <span class="st">&#39;conm&#39;</span>, <span class="st">&#39;tic&#39;</span>, <span class="st">&#39;cusip&#39;</span>, <span class="st">&#39;prccm&#39;</span>, <span class="st">&#39;cshom&#39;</span>, <span class="st">&#39;cshtrm&#39;</span>, <span class="st">&#39;trt1m&#39;</span>, <span class="st">&#39;dvrate&#39;</span>)</span>
<span id="cb212-3"><a href="the-programming-environment.html#cb212-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-4"><a href="the-programming-environment.html#cb212-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note, here we say multi_function = FALSE as we only retrieve data from one source. Note that if we use it from only one source, we nevertheless need to type in an entry for dataset_b and column_b. </span></span>
<span id="cb212-5"><a href="the-programming-environment.html#cb212-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-6"><a href="the-programming-environment.html#cb212-6" aria-hidden="true" tabindex="-1"></a>query <span class="ot">=</span> <span class="fu">query_sql</span>(<span class="at">dataset_a =</span> <span class="st">&quot;comp.secm&quot;</span>,</span>
<span id="cb212-7"><a href="the-programming-environment.html#cb212-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dataset_b =</span> <span class="st">&quot;comp.secm&quot;</span>,</span>
<span id="cb212-8"><a href="the-programming-environment.html#cb212-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">multi_function =</span> <span class="cn">FALSE</span>,</span>
<span id="cb212-9"><a href="the-programming-environment.html#cb212-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">column_a =</span> column_a,</span>
<span id="cb212-10"><a href="the-programming-environment.html#cb212-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">column_b =</span> column_b,</span>
<span id="cb212-11"><a href="the-programming-environment.html#cb212-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">column_sql =</span> column_sql,</span>
<span id="cb212-12"><a href="the-programming-environment.html#cb212-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">gvkey =</span> gvkey,</span>
<span id="cb212-13"><a href="the-programming-environment.html#cb212-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">sic =</span> sic,</span>
<span id="cb212-14"><a href="the-programming-environment.html#cb212-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">tic =</span> tic,</span>
<span id="cb212-15"><a href="the-programming-environment.html#cb212-15" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cusip =</span> cusip, </span>
<span id="cb212-16"><a href="the-programming-environment.html#cb212-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">datafmt =</span> <span class="st">&#39;STD&#39;</span>, </span>
<span id="cb212-17"><a href="the-programming-environment.html#cb212-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">consol =</span> <span class="st">&#39;C&#39;</span>, </span>
<span id="cb212-18"><a href="the-programming-environment.html#cb212-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">indfmt =</span> <span class="st">&#39;INDL&#39;</span>,</span>
<span id="cb212-19"><a href="the-programming-environment.html#cb212-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start =</span> <span class="st">&#39;2000-01-01&#39;</span>,</span>
<span id="cb212-20"><a href="the-programming-environment.html#cb212-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">end =</span> <span class="st">&#39;2010-01-01&#39;</span>)</span>
<span id="cb212-21"><a href="the-programming-environment.html#cb212-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-22"><a href="the-programming-environment.html#cb212-22" aria-hidden="true" tabindex="-1"></a>res_shares <span class="ot">&lt;-</span> <span class="fu">dbSendQuery</span>(wrds, query)</span></code></pre></div>
<pre><code>## Warning in result_create(conn@ptr, statement, immediate): Closing open result set, cancelling previous query</code></pre>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="the-programming-environment.html#cb214-1" aria-hidden="true" tabindex="-1"></a>data_shares <span class="ot">&lt;-</span> <span class="fu">dbFetch</span>(res_shares)</span>
<span id="cb214-2"><a href="the-programming-environment.html#cb214-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-3"><a href="the-programming-environment.html#cb214-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-4"><a href="the-programming-environment.html#cb214-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Here, we define again the names for each variable</span></span>
<span id="cb214-5"><a href="the-programming-environment.html#cb214-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data_shares) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;GVKEY&#39;</span>, <span class="st">&#39;IID_check&#39;</span>, <span class="st">&#39;Date_t&#39;</span>, <span class="st">&#39;CIK_check&#39;</span>, <span class="st">&#39;Comp_name&#39;</span>, <span class="st">&#39;Ticker&#39;</span>, <span class="st">&#39;CUSIP&#39;</span>, <span class="st">&#39;Closing_Price_t&#39;</span>, <span class="st">&#39;Shares_Outst_t&#39;</span>, <span class="st">&#39;Trading_Volume_t&#39;</span>, <span class="st">&#39;HRT_t&#39;</span>, <span class="st">&#39;Div_Rate_t&#39;</span>)</span>
<span id="cb214-6"><a href="the-programming-environment.html#cb214-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-7"><a href="the-programming-environment.html#cb214-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform to Time-Series Object</span></span>
<span id="cb214-8"><a href="the-programming-environment.html#cb214-8" aria-hidden="true" tabindex="-1"></a>data_shares_unique <span class="ot">&lt;-</span> data_shares <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(GVKEY, Date_t, <span class="at">.keep_all =</span> T) </span>
<span id="cb214-9"><a href="the-programming-environment.html#cb214-9" aria-hidden="true" tabindex="-1"></a>data_shares_monthly_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(data_shares_unique[, <span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(data_shares_unique) <span class="sc">==</span> <span class="st">&quot;Date_t&quot;</span>)] , <span class="at">order.by =</span> <span class="fu">as.Date</span>(<span class="fu">as.POSIXct</span>(data_shares_unique<span class="sc">$</span>Date_t)))</span>
<span id="cb214-10"><a href="the-programming-environment.html#cb214-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-11"><a href="the-programming-environment.html#cb214-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Close database</span></span>
<span id="cb214-12"><a href="the-programming-environment.html#cb214-12" aria-hidden="true" tabindex="-1"></a><span class="fu">dbClearResult</span>(res)</span></code></pre></div>
<pre><code>## Warning: Expired, result set already closed</code></pre>
<p>Now, we can merge both dataframes</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="the-programming-environment.html#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge both dataframes and convert to one Time-Series Object</span></span>
<span id="cb216-2"><a href="the-programming-environment.html#cb216-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-3"><a href="the-programming-environment.html#cb216-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Change variable name of data_monthly Date</span></span>
<span id="cb216-4"><a href="the-programming-environment.html#cb216-4" aria-hidden="true" tabindex="-1"></a>data_monthly<span class="sc">$</span>Date_t <span class="ot">&lt;-</span> data_monthly<span class="sc">$</span>Date_Monthly</span>
<span id="cb216-5"><a href="the-programming-environment.html#cb216-5" aria-hidden="true" tabindex="-1"></a>data_monthly<span class="sc">$</span>Date_Monthly <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb216-6"><a href="the-programming-environment.html#cb216-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-7"><a href="the-programming-environment.html#cb216-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Create a merged object</span></span>
<span id="cb216-8"><a href="the-programming-environment.html#cb216-8" aria-hidden="true" tabindex="-1"></a>data_final_monthly <span class="ot">&lt;-</span> <span class="fu">merge</span>(data_monthly, data_shares_unique, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;GVKEY&quot;</span>, <span class="st">&quot;Date_t&quot;</span>, <span class="st">&quot;CUSIP&quot;</span>, <span class="st">&quot;Comp_name&quot;</span>, <span class="st">&quot;Ticker&quot;</span>))</span>
<span id="cb216-9"><a href="the-programming-environment.html#cb216-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-10"><a href="the-programming-environment.html#cb216-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Create a Time-Series Object</span></span>
<span id="cb216-11"><a href="the-programming-environment.html#cb216-11" aria-hidden="true" tabindex="-1"></a>data_final_monthly_ts <span class="ot">&lt;-</span> <span class="fu">xts</span>(data_final_monthly[, <span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(data_final_monthly) <span class="sc">==</span> <span class="st">&quot;Date_t&quot;</span>)] , <span class="at">order.by =</span> <span class="fu">as.Date</span>(<span class="fu">as.POSIXct</span>(data_final_monthly<span class="sc">$</span>Date_t)))</span></code></pre></div>
<p>This is just great! Now, we are able to retrieve tons of data quickly from multiple sources, change periodicity to the same levels and combine the data to get one large dataframe in which we can conduct all the operations for factor and variable creation we need.</p>
</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="statistical-properties.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/NikolasAnic/Advanced_Empirical_Finance_UZH_2022/edit/master/02-Statistical_Props.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/NikolasAnic/Advanced_Empirical_Finance_UZH_2022/blob/master/02-Statistical_Props.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
